"use strict";angular.module("ui.autocomplete",[]).directive("uiAutocomplete",["$timeout","$exceptionHandler",function(e,t){function n(e,t){var n=new RegExp($.ui.autocomplete.escapeRegex(t),"i");return $.grep(e,function(e){return n.test($("<div>").html(e.label||e.value||e).text())})}var o=$.ui.autocomplete.prototype,i=o._initSource;return $.extend(o,{_initSource:function(){this.options.html&&$.isArray(this.options.source)?this.source=function(e,t){t(n(this.options.source,e.term))}:i.call(this)},_normalize:function(e){return $.map(e,function(e){return e&&"object"==typeof e?$.extend({label:e.label||e.value,value:e.value||e.label},e):{label:e+"",value:e}})},_renderItemData:function(e,t){var n=t.groupLabel||t.label;return t.groupLabel?n=$("<div>").append(n).addClass("ui-menu-group"):this.options.html?("object"==typeof n&&(n=$(n)),("object"!=typeof n||n.length>1||!n.is("a"))&&(n=$("<a>").append(n))):n=$("<a>").text(n),$("<li>").append(n).appendTo(e).data("ui-autocomplete-item",t)},_resizeMenu:function(){var e=this;setTimeout(function(){var t=e.menu.element,n=t.css("max-height")||0,o=Math.max(t.width("").outerWidth()+1,e.element.outerWidth()),i=(e.element.height(),$(window).height()-e.options.outHeight-t.offset().top);i=n&&i>n?n:i,t.css({width:o,maxHeight:i})},10)}}),{require:"ngModel",link:function(o,i,u,a){function l(e){d(f)&&(a.$viewValue||0===a.$viewValue?e&&e.item&&(e.item.label=d(e.item.label)?$("<div>").append(e.item.label).html():e.item.label,h(f,e.item)):r(f),m(a.$viewChangeListeners,function(e){try{e()}catch(e){t(e)}}))}function r(e){if(d(e)){var t=/^\$/;m(e,function(n,o){var i=typeof n;t.test(o)||("number"===i?e[o]=0:"string"===i?e[o]="":"boolean"===i?e[o]=!1:d(n)&&r(n))})}}var c=!1,s=null,p={},f=null,m=angular.forEach,d=angular.isObject,h=angular.extend,v=o.$eval(u.uiAutocomplete),g=angular.bind(i,i.val),b=o.$watch(u.ngModel,function(e){d(f=e)&&(a.$formatters.push(function(e){return e.value}),a.$parsers.push(function(e){return f.value=e,f}),o.$watch(u.ngModel,function(e){g()!==e.value&&(a.$viewValue=e.value,a.$render())},!0),a.$pristine=!1,a.$setViewValue(f.value),a.$pristine=!0),e&&b()}),w={open:function(e,t){c=!0,s=null},close:function(e,t){c=!1},select:function(t,n){s=n,e(function(){i.blur()},0)},change:function(e,t){var n=g();null===(n=s&&s.item?s.item.value:v.options.onlySelect?"":n)?a.$render():""===n?o.$apply(function(){l()}):a.$viewValue!==n&&o.$apply(function(){a.$setViewValue(n),a.$render(),l(s)})}};d(v)&&(v.methods={},v.options=function(e){return e=d(e)?e:{},e.disabled=!e.source||e.disabled,e.appendTo=e.appendTo||i.parents(".ng-view")[0]||i.parents("[ng-view]")[0]||null,e.minLength=e.focusOpen?0:e.minLength,e.outHeight=e.outHeight||0,e.position=e.position||{my:"left top",at:"left bottom",collision:"flipfit"},e}(v.options),m(["change","close","create","focus","open","response","search","select"],function(e){var t=v.options[e];t="function"==typeof t?t:angular.noop,p[e]=function(n,o){w[e]&&w[e](n,o),t(n,o),v.events&&"function"==typeof v.events[e]&&v.events[e](n,o)}}),m(["close","destroy","disable","enable","option","search","widget"],function(e){v.methods[e]=function(){var t=[e];return m(arguments,function(e){t.push(e)}),i.autocomplete.apply(i,t)}}),v.methods.filter=n,v.methods.clean=function(){a.$setViewValue(""),a.$render(),l()},i.on("focus",function(){v.options.focusOpen&&!c&&i.autocomplete("search","")}),i.autocomplete(h({},v.options,p)),v.widget=i.autocomplete("widget"))}}}]);