{"version":3,"file":"react-popper.umd.js","sources":["../src/Manager.js","../src/utils.js","../src/Popper.js","../src/Reference.js"],"sourcesContent":["// @flow\nimport React, { Component, type Node } from 'react';\nimport createContext, { type Context } from 'create-react-context';\n\nexport const ManagerContext: Context<{\n  getReferenceRef?: (?HTMLElement) => void,\n  referenceNode?: ?HTMLElement,\n}> = createContext({});\n\ntype ManagerProps = {\n  children: Node,\n};\ntype ManagerState = {\n  referenceNode?: ?HTMLElement,\n};\n\nexport default class Manager extends Component<ManagerProps, ManagerState> {\n  state = {};\n\n  getReferenceRef = (referenceNode: ?HTMLElement) =>\n    this.setState({ referenceNode });\n\n  render() {\n    return (\n      <ManagerContext.Provider\n        value={{\n          referenceNode: this.state.referenceNode,\n          getReferenceRef: this.getReferenceRef,\n        }}\n      >\n        {this.props.children}\n      </ManagerContext.Provider>\n    );\n  }\n}\n","// @flow\n\n// Takes an argument and if it's an array, returns the first item in the array,\n// otherwise returns the argument. Used for Preact compatibility.\nexport const unwrapArray = (arg: *): * => (Array.isArray(arg) ? arg[0] : arg);\n","// @flow\nimport React, { Component, type Node } from 'react';\nimport PopperJS, {\n  type Placement,\n  type Instance as PopperJS$Instance,\n  type ReferenceObject,\n} from 'popper.js';\nimport { ManagerContext } from './Manager';\nimport { unwrapArray } from './utils';\n\ntype getRefFn = (?HTMLElement) => void;\ntype Style = Object;\n\ntype ReferenceElement = ReferenceObject | HTMLElement | null;\n\ntype RenderProp = ({|\n  ref: getRefFn,\n  style: Style,\n  placement: ?Placement,\n  arrowProps: {\n    ref: getRefFn,\n    style: Style,\n  },\n|}) => Node;\n\ntype PopperProps = {\n  modifiers?: {\n    [string]: { order: number, enabled: boolean, fn: Object => Object },\n  },\n  placement?: Placement,\n  eventsEnabled?: boolean,\n  referenceElement?: ReferenceElement,\n  children: RenderProp,\n};\n\ntype PopperState = {\n  popperNode: ?HTMLElement,\n  arrowNode: ?HTMLElement,\n  popperInstance: ?PopperJS$Instance,\n  data: ?Object,\n};\n\nconst initialStyle = {\n  position: 'absolute',\n  opacity: 0,\n  pointerEvents: 'none',\n};\n\nconst initialArrowStyle = {};\n\nexport class Popper extends Component<PopperProps, PopperState> {\n  static defaultProps = {\n    placement: 'bottom',\n    eventsEnabled: true,\n    referenceElement: undefined,\n  };\n\n  state = {\n    popperNode: undefined,\n    arrowNode: undefined,\n    popperInstance: undefined,\n    data: undefined,\n  };\n\n  setPopperNode = (popperNode: ?HTMLElement) => this.setState({ popperNode });\n  setArrowNode = (arrowNode: ?HTMLElement) => this.setState({ arrowNode });\n\n  updateStateModifier = {\n    enabled: true,\n    order: 900,\n    fn: (data: Object) => {\n      this.setState({ data });\n      return data;\n    },\n  };\n\n  getOptions = () => ({\n    placement: this.props.placement,\n    eventsEnabled: this.props.eventsEnabled,\n    modifiers: {\n      ...this.props.modifiers,\n      arrow: {\n        enabled: !!this.state.arrowNode,\n        element: this.state.arrowNode,\n      },\n      applyStyle: { enabled: false },\n      updateStateModifier: this.updateStateModifier,\n    },\n  });\n\n  getPopperStyle = () =>\n    !this.state.popperNode || !this.state.data\n      ? initialStyle\n      : {\n          position: this.state.data.offsets.popper.position,\n          ...this.state.data.styles,\n        };\n\n  getPopperPlacement = () =>\n    !this.state.data ? undefined : this.state.data.placement;\n\n  getArrowStyle = () =>\n    !this.state.arrowNode || !this.state.data\n      ? initialArrowStyle\n      : this.state.data.arrowStyles;\n\n  initPopperInstance = () => {\n    const { referenceElement } = this.props;\n    const { popperNode, popperInstance } = this.state;\n    if (referenceElement && popperNode && !popperInstance) {\n      const popperInstance = new PopperJS(\n        referenceElement,\n        popperNode,\n        this.getOptions()\n      );\n      this.setState({ popperInstance });\n      return true;\n    }\n    return false;\n  };\n\n  destroyPopperInstance = (callback: () => boolean) => {\n    if (this.state.popperInstance) {\n      this.state.popperInstance.destroy();\n    }\n    this.setState({ popperInstance: undefined }, callback);\n  };\n\n  updatePopperInstance = () => {\n    if (this.state.popperInstance) {\n      this.destroyPopperInstance(() => this.initPopperInstance());\n    }\n  };\n\n  componentDidUpdate(prevProps: PopperProps, prevState: PopperState) {\n    // If needed, initialize the Popper.js instance\n    // it will return `true` if it initialized a new instance, or `false` otherwise\n    // if it returns `false`, we make sure Popper props haven't changed, and update\n    // the Popper.js instance if needed\n    if (!this.initPopperInstance()) {\n      // If the Popper.js options have changed, update the instance (destroy + create)\n      if (\n        this.props.placement !== prevProps.placement ||\n        this.props.eventsEnabled !== prevProps.eventsEnabled ||\n        this.state.arrowNode !== prevState.arrowNode ||\n        this.state.popperNode !== prevState.popperNode ||\n        this.props.referenceElement !== prevProps.referenceElement\n      ) {\n        this.updatePopperInstance();\n      }\n    }\n  }\n\n  componentWillUnmount() {\n    if (this.state.popperInstance) {\n      this.state.popperInstance.destroy();\n    }\n  }\n\n  render() {\n    return unwrapArray(this.props.children)({\n      ref: this.setPopperNode,\n      style: this.getPopperStyle(),\n      placement: this.getPopperPlacement(),\n      arrowProps: {\n        ref: this.setArrowNode,\n        style: this.getArrowStyle(),\n      },\n    });\n  }\n}\n\nconst placements = PopperJS.placements;\nexport { placements };\n\nexport default (props: PopperProps) => (\n  <ManagerContext.Consumer>\n    {({ referenceNode }) => (\n      <Popper referenceElement={referenceNode} {...props} />\n    )}\n  </ManagerContext.Consumer>\n);\n","// @flow\nimport React, { type Node } from 'react';\nimport { ManagerContext } from './Manager';\nimport { unwrapArray } from './utils';\n\ntype ReferenceProps = {\n  children: ({ ref: (?HTMLElement) => void }) => Node,\n};\nexport default ({ children }: ReferenceProps) => (\n  <ManagerContext.Consumer>\n    {({ getReferenceRef }) => unwrapArray(children)({ ref: getReferenceRef })}\n  </ManagerContext.Consumer>\n);\n"],"names":["ManagerContext","createContext","Manager","state","getReferenceRef","referenceNode","setState","React","props","children","Component","unwrapArray","arg","Array","isArray","initialStyle","position","opacity","pointerEvents","initialArrowStyle","Popper","popperNode","undefined","arrowNode","popperInstance","data","setPopperNode","setArrowNode","updateStateModifier","enabled","order","fn","getOptions","placement","eventsEnabled","modifiers","arrow","element","applyStyle","getPopperStyle","offsets","popper","styles","getPopperPlacement","getArrowStyle","arrowStyles","initPopperInstance","referenceElement","PopperJS","destroyPopperInstance","callback","destroy","updatePopperInstance","prevProps","prevState","ref","style","arrowProps","defaultProps","placements"],"mappings":"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"}