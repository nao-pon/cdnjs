{"version":3,"file":"react-popper.js","sources":["../src/Manager.js","../src/utils.js","../src/Popper.js","../src/Reference.js"],"sourcesContent":["// @flow\nimport React, { Component, type Node } from 'react';\nimport createContext, { type Context } from 'create-react-context';\n\nexport const ManagerContext: Context<{\n  getReferenceRef?: (?HTMLElement) => void,\n  referenceNode?: ?HTMLElement,\n}> = createContext({});\n\ntype ManagerProps = {\n  children: Node,\n};\ntype ManagerState = {\n  referenceNode?: ?HTMLElement,\n};\n\nexport default class Manager extends Component<ManagerProps, ManagerState> {\n  state = {};\n\n  getReferenceRef = (referenceNode: ?HTMLElement) =>\n    this.setState({ referenceNode });\n\n  render() {\n    return (\n      <ManagerContext.Provider\n        value={{\n          referenceNode: this.state.referenceNode,\n          getReferenceRef: this.getReferenceRef,\n        }}\n      >\n        {this.props.children}\n      </ManagerContext.Provider>\n    );\n  }\n}\n","// @flow\n\n// Takes an argument and if it's an array, returns the first item in the array,\n// otherwise returns the argument. Used for Preact compatibility.\nexport const unwrapArray = (arg: *): * => (Array.isArray(arg) ? arg[0] : arg);\n","// @flow\nimport React, { Component, type Node } from 'react';\nimport PopperJS, {\n  type Placement,\n  type Instance as PopperJS$Instance,\n  type ReferenceObject,\n} from 'popper.js';\nimport { ManagerContext } from './Manager';\nimport { unwrapArray } from './utils';\n\ntype getRefFn = (?HTMLElement) => void;\ntype Style = Object;\n\ntype ReferenceElement = ReferenceObject | HTMLElement | null;\n\ntype RenderProp = ({|\n  ref: getRefFn,\n  style: Style,\n  placement: ?Placement,\n  arrowProps: {\n    ref: getRefFn,\n    style: Style,\n  },\n|}) => Node;\n\ntype PopperProps = {\n  modifiers?: {\n    [string]: { order: number, enabled: boolean, fn: Object => Object },\n  },\n  placement?: Placement,\n  eventsEnabled?: boolean,\n  referenceElement?: ReferenceElement,\n  children: RenderProp,\n};\n\ntype PopperState = {\n  popperNode: ?HTMLElement,\n  arrowNode: ?HTMLElement,\n  popperInstance: ?PopperJS$Instance,\n  data: ?Object,\n};\n\nconst initialStyle = {\n  position: 'absolute',\n  opacity: 0,\n  pointerEvents: 'none',\n};\n\nconst initialArrowStyle = {};\n\nexport class Popper extends Component<PopperProps, PopperState> {\n  static defaultProps = {\n    placement: 'bottom',\n    eventsEnabled: true,\n    referenceElement: undefined,\n  };\n\n  state = {\n    popperNode: undefined,\n    arrowNode: undefined,\n    popperInstance: undefined,\n    data: undefined,\n  };\n\n  setPopperNode = (popperNode: ?HTMLElement) => this.setState({ popperNode });\n  setArrowNode = (arrowNode: ?HTMLElement) => this.setState({ arrowNode });\n\n  updateStateModifier = {\n    enabled: true,\n    order: 900,\n    fn: (data: Object) => {\n      this.setState({ data });\n      return data;\n    },\n  };\n\n  getOptions = () => ({\n    placement: this.props.placement,\n    eventsEnabled: this.props.eventsEnabled,\n    modifiers: {\n      ...this.props.modifiers,\n      arrow: {\n        enabled: !!this.state.arrowNode,\n        element: this.state.arrowNode,\n      },\n      applyStyle: { enabled: false },\n      updateStateModifier: this.updateStateModifier,\n    },\n  });\n\n  getPopperStyle = () =>\n    !this.state.popperNode || !this.state.data\n      ? initialStyle\n      : {\n          position: this.state.data.offsets.popper.position,\n          ...this.state.data.styles,\n        };\n\n  getPopperPlacement = () =>\n    !this.state.data ? undefined : this.state.data.placement;\n\n  getArrowStyle = () =>\n    !this.state.arrowNode || !this.state.data\n      ? initialArrowStyle\n      : this.state.data.arrowStyles;\n\n  initPopperInstance = () => {\n    const { referenceElement } = this.props;\n    const { popperNode, popperInstance } = this.state;\n    if (referenceElement && popperNode && !popperInstance) {\n      const popperInstance = new PopperJS(\n        referenceElement,\n        popperNode,\n        this.getOptions()\n      );\n      this.setState({ popperInstance });\n      return true;\n    }\n    return false;\n  };\n\n  destroyPopperInstance = (callback: () => boolean) => {\n    if (this.state.popperInstance) {\n      this.state.popperInstance.destroy();\n    }\n    this.setState({ popperInstance: undefined }, callback);\n  };\n\n  updatePopperInstance = () => {\n    if (this.state.popperInstance) {\n      this.destroyPopperInstance(() => this.initPopperInstance());\n    }\n  };\n\n  componentDidUpdate(prevProps: PopperProps, prevState: PopperState) {\n    // If needed, initialize the Popper.js instance\n    // it will return `true` if it initialized a new instance, or `false` otherwise\n    // if it returns `false`, we make sure Popper props haven't changed, and update\n    // the Popper.js instance if needed\n    if (!this.initPopperInstance()) {\n      // If the Popper.js options have changed, update the instance (destroy + create)\n      if (\n        this.props.placement !== prevProps.placement ||\n        this.props.eventsEnabled !== prevProps.eventsEnabled ||\n        this.state.arrowNode !== prevState.arrowNode ||\n        this.state.popperNode !== prevState.popperNode ||\n        this.props.referenceElement !== prevProps.referenceElement\n      ) {\n        this.updatePopperInstance();\n      }\n    }\n  }\n\n  componentWillUnmount() {\n    if (this.state.popperInstance) {\n      this.state.popperInstance.destroy();\n    }\n  }\n\n  render() {\n    return unwrapArray(this.props.children)({\n      ref: this.setPopperNode,\n      style: this.getPopperStyle(),\n      placement: this.getPopperPlacement(),\n      arrowProps: {\n        ref: this.setArrowNode,\n        style: this.getArrowStyle(),\n      },\n    });\n  }\n}\n\nconst placements = PopperJS.placements;\nexport { placements };\n\nexport default (props: PopperProps) => (\n  <ManagerContext.Consumer>\n    {({ referenceNode }) => (\n      <Popper referenceElement={referenceNode} {...props} />\n    )}\n  </ManagerContext.Consumer>\n);\n","// @flow\nimport React, { type Node } from 'react';\nimport { ManagerContext } from './Manager';\nimport { unwrapArray } from './utils';\n\ntype ReferenceProps = {\n  children: ({ ref: (?HTMLElement) => void }) => Node,\n};\nexport default ({ children }: ReferenceProps) => (\n  <ManagerContext.Consumer>\n    {({ getReferenceRef }) => unwrapArray(children)({ ref: getReferenceRef })}\n  </ManagerContext.Consumer>\n);\n"],"names":["ManagerContext","createContext","Manager","state","getReferenceRef","referenceNode","setState","React","props","children","Component","unwrapArray","arg","Array","isArray","initialStyle","initialArrowStyle","Popper","undefined","setPopperNode","popperNode","setArrowNode","arrowNode","updateStateModifier","data","getOptions","placement","eventsEnabled","modifiers","enabled","getPopperStyle","offsets","popper","position","styles","getPopperPlacement","getArrowStyle","arrowStyles","initPopperInstance","referenceElement","popperInstance","PopperJS","destroyPopperInstance","callback","destroy","updatePopperInstance","prevProps","prevState","defaultProps","placements","ref"],"mappings":"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"}