{"version":3,"file":"react-popper.js","sources":["../src/index.js"],"sourcesContent":["// @flow\nimport { Component, type Node } from 'react';\nimport PopperJS from 'popper.js';\n\ntype PopperInstance = {\n  destroy: () => void,\n};\n\ntype Placement =\n  | 'auto-start'\n  | 'auto'\n  | 'auto-end'\n  | 'top-start'\n  | 'top'\n  | 'top-end'\n  | 'right-start'\n  | 'right'\n  | 'right-end'\n  | 'bottom-end'\n  | 'bottom'\n  | 'bottom-start'\n  | 'left-end'\n  | 'left'\n  | 'left-start';\n\ntype getRefFn = (?HTMLElement) => void;\ntype Style = { [string]: string | number };\n\ntype RenderProp = ({|\n  referenceProps: {\n    getRef: getRefFn,\n  },\n  popperProps: {\n    getRef: getRefFn,\n    style: Style,\n    placement: ?Placement,\n  },\n  arrowProps: {\n    getRef: getRefFn,\n    style: Style,\n    placement: ?Placement,\n  },\n|}) => Node;\n\ntype PopperProps = {\n  modifiers?: {\n    [string]: { order: number, enabled: boolean, fn: Object => Object },\n  },\n  placement?: Placement,\n  eventsEnabled?: boolean,\n  referenceElement?: {\n    +getBoundingClientRect: () => {\n      width: number,\n      height: number,\n      top: number,\n      right: number,\n      bottom: number,\n      left: number,\n    },\n    +clientWidth: number,\n    +clientHeight: number,\n  },\n  children: RenderProp,\n};\n\ntype PopperState = {\n  referenceNode: ?HTMLElement,\n  popperNode: ?HTMLElement,\n  arrowNode: ?HTMLElement,\n  popperInstance: ?PopperInstance,\n  data: ?Object,\n};\n\nconst initialStyle = {\n  position: 'absolute',\n  opacity: 0,\n  pointerEvents: 'none',\n};\n\nconst initialArrowStyle = {};\n\nexport default class Popper extends Component<PopperProps, PopperState> {\n  static defaultProps = {\n    placement: 'bottom',\n    eventsEnabled: true,\n    referenceElement: undefined,\n  };\n\n  state = {\n    referenceNode: undefined,\n    popperNode: undefined,\n    arrowNode: undefined,\n    popperInstance: undefined,\n    data: undefined,\n  };\n\n  setReferenceNode = (referenceNode: ?HTMLElement) =>\n    this.setState({ referenceNode });\n  setPopperNode = (popperNode: ?HTMLElement) => this.setState({ popperNode });\n  setArrowNode = (arrowNode: ?HTMLElement) => this.setState({ arrowNode });\n\n  updateStateModifier = {\n    enabled: true,\n    order: 900,\n    fn: (data: Object) => {\n      this.setState({ data });\n      return data;\n    },\n  };\n\n  getOptions = () => ({\n    placement: this.props.placement,\n    eventsEnabled: this.props.eventsEnabled,\n    modifiers: {\n      ...this.props.modifiers,\n      arrow: {\n        enabled: !!this.state.arrowNode,\n        element: this.state.arrowNode,\n      },\n      applyStyle: { enabled: false },\n      updateStateModifier: this.updateStateModifier,\n    },\n  });\n\n  getPopperStyle = () =>\n    !this.state.popperNode || !this.state.data\n      ? initialStyle\n      : {\n          position: this.state.data.offsets.popper.position,\n          ...this.state.data.styles,\n        };\n\n  getPopperPlacement = () =>\n    !this.state.data ? undefined : this.state.data.placement;\n\n  getArrowStyle = () =>\n    !this.state.arrowNode || !this.state.data\n      ? initialArrowStyle\n      : this.state.data.arrowStyles;\n\n  initPopperInstance = () => {\n    const { referenceElement } = this.props;\n    const { referenceNode, popperNode, popperInstance } = this.state;\n    const reference = referenceElement || referenceNode;\n    if (reference && popperNode && !popperInstance) {\n      const popperInstance = new PopperJS(\n        reference,\n        popperNode,\n        this.getOptions()\n      );\n      this.setState({ popperInstance });\n      return true;\n    }\n    return false;\n  };\n\n  destroyPopperInstance = (callback: () => boolean) => {\n    if (this.state.popperInstance) {\n      this.state.popperInstance.destroy();\n    }\n    this.setState({ popperInstance: undefined }, callback);\n  };\n\n  updatePopperInstance = () => {\n    if (this.state.popperInstance) {\n      this.destroyPopperInstance(() => this.initPopperInstance());\n    }\n  };\n\n  componentDidUpdate(prevProps: PopperProps, prevState: PopperState) {\n    // If needed, initialize the Popper.js instance\n    // it will return `true` if it initialized a new instance, or `false` otherwise\n    // if it returns `false`, we make sure Popper props haven't changed, and update\n    // the Popper.js instance if needed\n    if (!this.initPopperInstance()) {\n      // If the Popper.js options have changed, update the instance (destroy + create)\n      if (\n        this.props.placement !== prevProps.placement ||\n        this.props.eventsEnabled !== prevProps.eventsEnabled ||\n        this.state.referenceNode !== prevState.referenceNode ||\n        this.state.arrowNode !== prevState.arrowNode ||\n        this.state.popperNode !== prevState.popperNode ||\n        this.props.referenceElement !== prevProps.referenceElement\n      ) {\n        this.updatePopperInstance();\n      }\n    }\n  }\n\n  componentWillUnmount() {\n    if (this.state.popperInstance) {\n      this.state.popperInstance.destroy();\n    }\n  }\n\n  render() {\n    return this.props.children({\n      referenceProps: {\n        getRef: this.setReferenceNode,\n      },\n      popperProps: {\n        getRef: this.setPopperNode,\n        style: this.getPopperStyle(),\n        placement: this.getPopperPlacement(),\n      },\n      arrowProps: {\n        getRef: this.setArrowNode,\n        style: this.getArrowStyle(),\n        placement: this.getPopperPlacement(),\n      },\n    });\n  }\n}\n\nconst placements = PopperJS.placements;\nexport { placements };\n"],"names":["initialStyle","initialArrowStyle","Popper","state","undefined","setReferenceNode","referenceNode","setState","setPopperNode","popperNode","setArrowNode","arrowNode","updateStateModifier","data","getOptions","props","placement","eventsEnabled","modifiers","enabled","getPopperStyle","offsets","popper","position","styles","getPopperPlacement","getArrowStyle","arrowStyles","initPopperInstance","referenceElement","popperInstance","reference","PopperJS","destroyPopperInstance","callback","destroy","updatePopperInstance","prevProps","prevState","children","Component","defaultProps","placements"],"mappings":"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"}