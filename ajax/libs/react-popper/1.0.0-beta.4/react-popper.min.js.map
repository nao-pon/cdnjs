{"version":3,"file":"react-popper.min.js","sources":["../src/Manager.js","../src/utils.js","../src/Popper.js","../src/Reference.js"],"sourcesContent":["// @flow\nimport React, { Component, type Node } from \"react\";\nimport createContext, { type Context } from \"create-react-context\";\n\nexport const ManagerContext: Context<{\n  getReferenceRef?: (?HTMLElement) => void,\n  referenceNode?: ?HTMLElement,\n}> = createContext({ getRefeferenceRef: undefined, referenceNode: undefined });\n\ntype ManagerProps = {\n  children: Node,\n};\ntype ManagerState = {\n  context: {\n    getReferenceRef?: (?HTMLElement) => void,\n    referenceNode?: ?HTMLElement,\n  },\n};\n\nexport default class Manager extends Component<ManagerProps, ManagerState> {\n  constructor() {\n    super();\n    this.state = {\n      context: {\n        getReferenceRef: this.getReferenceRef,\n        referenceNode: undefined,\n      },\n    };\n  }\n\n  getReferenceRef = (referenceNode: ?HTMLElement) =>\n    this.setState(({ context }) => ({\n      context: { ...context, referenceNode },\n    }));\n\n  render() {\n    return (\n      <ManagerContext.Provider value={this.state.context}>\n        {this.props.children}\n      </ManagerContext.Provider>\n    );\n  }\n}\n","// @flow\n\n// Takes an argument and if it's an array, returns the first item in the array,\n// otherwise returns the argument. Used for Preact compatibility.\nexport const unwrapArray = (arg: *): * => (Array.isArray(arg) ? arg[0] : arg);\n","// @flow\nimport React, { Component, type Node } from 'react';\nimport PopperJS, {\n  type Placement,\n  type Instance as PopperJS$Instance,\n  type Data,\n  type ReferenceObject,\n} from 'popper.js';\nimport { ManagerContext } from './Manager';\nimport { unwrapArray } from './utils';\n\ntype getRefFn = (?HTMLElement) => void;\ntype Style = Object;\n\ntype ReferenceElement = ReferenceObject | HTMLElement | null;\n\ntype RenderProp = ({|\n  ref: getRefFn,\n  style: Style,\n  placement: ?Placement,\n  arrowProps: {\n    ref: getRefFn,\n    style: Style,\n  },\n\n  \n|}) => Node;\n\ntype PopperProps = {\n  modifiers?: {\n    [string]: { order: number, enabled: boolean, fn: Object => Object },\n  },\n  placement?: Placement,\n  eventsEnabled?: boolean,\n  referenceElement?: ReferenceElement,\n  children: RenderProp,\n};\n\ntype PopperState = {\n  popperNode: ?HTMLElement,\n  arrowNode: ?HTMLElement,\n  popperInstance: ?PopperJS$Instance,\n  data: ?Data,\n};\n\nconst initialStyle = {\n  position: 'absolute',\n  opacity: 0,\n  pointerEvents: 'none',\n};\n\nconst initialArrowStyle = {};\n\nexport class Popper extends Component<PopperProps, PopperState> {\n  static defaultProps = {\n    placement: 'bottom',\n    eventsEnabled: true,\n    referenceElement: undefined,\n  };\n\n  state = {\n    popperNode: undefined,\n    arrowNode: undefined,\n    popperInstance: undefined,\n    data: undefined,\n  };\n\n  setPopperNode = (popperNode: ?HTMLElement) => this.setState({ popperNode });\n  setArrowNode = (arrowNode: ?HTMLElement) => this.setState({ arrowNode });\n\n  updateStateModifier = {\n    enabled: true,\n    order: 900,\n    fn: (data: Object) => {\n      this.setState({ data });\n      return data;\n    },\n  };\n\n  getOptions = () => ({\n    placement: this.props.placement,\n    eventsEnabled: this.props.eventsEnabled,\n    modifiers: {\n      ...this.props.modifiers,\n      arrow: {\n        enabled: !!this.state.arrowNode,\n        element: this.state.arrowNode,\n      },\n      applyStyle: { enabled: false },\n      updateStateModifier: this.updateStateModifier,\n    },\n  });\n\n  getPopperStyle = () =>\n    !this.state.popperNode || !this.state.data\n      ? initialStyle\n      : {\n          position: this.state.data.offsets.popper.position,\n          ...this.state.data.styles,\n        };\n\n  getPopperPlacement = () =>\n    !this.state.data ? undefined : this.state.data.placement;\n\n  getArrowStyle = () =>\n    !this.state.arrowNode || !this.state.data\n      ? initialArrowStyle\n      : this.state.data.arrowStyles;\n\n  initPopperInstance = () => {\n    const { referenceElement } = this.props;\n    const { popperNode, popperInstance } = this.state;\n    if (referenceElement && popperNode && !popperInstance) {\n      const popperInstance = new PopperJS(\n        referenceElement,\n        popperNode,\n        this.getOptions()\n      );\n      this.setState({ popperInstance });\n      return true;\n    }\n    return false;\n  };\n\n  destroyPopperInstance = (callback: () => boolean) => {\n    if (this.state.popperInstance) {\n      this.state.popperInstance.destroy();\n    }\n    this.setState({ popperInstance: undefined }, callback);\n  };\n\n  updatePopperInstance = () => {\n    if (this.state.popperInstance) {\n      this.destroyPopperInstance(() => this.initPopperInstance());\n    }\n  };\n\n  componentDidUpdate(prevProps: PopperProps, prevState: PopperState) {\n    // If needed, initialize the Popper.js instance\n    // it will return `true` if it initialized a new instance, or `false` otherwise\n    // if it returns `false`, we make sure Popper props haven't changed, and update\n    // the Popper.js instance if needed\n    if (!this.initPopperInstance()) {\n      // If the Popper.js options have changed, update the instance (destroy + create)\n      if (\n        this.props.placement !== prevProps.placement ||\n        this.props.eventsEnabled !== prevProps.eventsEnabled ||\n        this.state.arrowNode !== prevState.arrowNode ||\n        this.state.popperNode !== prevState.popperNode ||\n        this.props.referenceElement !== prevProps.referenceElement\n      ) {\n        this.updatePopperInstance();\n      }\n    }\n  }\n\n  componentWillUnmount() {\n    if (this.state.popperInstance) {\n      this.state.popperInstance.destroy();\n    }\n  }\n\n  render() {\n    return unwrapArray(this.props.children)({\n      ref: this.setPopperNode,\n      style: this.getPopperStyle(),\n      placement: this.getPopperPlacement(),\n      arrowProps: {\n        ref: this.setArrowNode,\n        style: this.getArrowStyle(),\n      },\n    });\n  }\n}\n\nconst placements = PopperJS.placements;\nexport { placements };\n\nexport default (props: PopperProps) => (\n  <ManagerContext.Consumer>\n    {({ referenceNode }) => (\n      <Popper referenceElement={referenceNode} {...props} />\n    )}\n  </ManagerContext.Consumer>\n);\n","// @flow\nimport React, { type Node } from \"react\";\nimport warning from \"warning\";\nimport { ManagerContext } from \"./Manager\";\nimport { unwrapArray } from \"./utils\";\n\ntype ReferenceProps = {\n  children: ({ ref: (?HTMLElement) => void }) => Node,\n};\nexport default ({ children }: ReferenceProps) => (\n  <ManagerContext.Consumer>\n    {({ getReferenceRef }) => {\n      warning(\n        getReferenceRef,\n        \"`Reference` should not be used outside of a `Manager` component.\"\n      );\n      return unwrapArray(children)({ ref: getReferenceRef });\n    }}\n  </ManagerContext.Consumer>\n);\n"],"names":["ManagerContext","createContext","getRefeferenceRef","referenceNode","Manager","getReferenceRef","setState","context","state","React","Provider","value","props","children","Component","unwrapArray","Array","isArray","arg","initialStyle","initialArrowStyle","Popper","setPopperNode","popperNode","setArrowNode","arrowNode","updateStateModifier","data","getOptions","placement","eventsEnabled","modifiers","enabled","getPopperStyle","offsets","popper","position","styles","getPopperPlacement","getArrowStyle","arrowStyles","initPopperInstance","referenceElement","popperInstance","destroyPopperInstance","destroy","updatePopperInstance","prevProps","prevState","defaultProps","placements","PopperJS","Consumer","ref"],"mappings":"khDAIaA,EAGRC,EAAc,CAAEC,wBAAF,CAAgCC,oBAAhC,CAAdF,EAYgBG,0BACL,UAAA,2EAUdC,gBAAkB,kBAChB,GAAKC,QAAL,CAAc,eAAGC,KAAAA,cAAe,iBACPJ,iBADO,CAAhC,CAAA,CAXY,IAEPK,MAAQ,SACF,iBACU,EAAKH,eADf,qBAAA,CADE,qDAaN,OAELI,gBAAAA,GAAgBC,QAAhBD,EAAyBE,MAAO,KAAKH,KAAL,CAAWD,QAA3CE,MACQG,MAAMC,QADdJ,SAlB+BK,aCfxBC,EAAc,kBAAgBC,OAAMC,OAAND,IAAqBE,EAAI,CAAJA,CAArBF,EAApC,ECyCDG,EAAe,UACT,UADS,SAEV,CAFU,eAGJ,MAHI,EAMfC,EAAoB,GAEbC,0NAOXb,MAAQ,kBAAA,iBAAA,sBAAA,YAAA,IAORc,cAAgB,kBAA8B,GAAKhB,QAAL,CAAc,CAAEiB,YAAF,CAAd,CAdhD,IAeEC,aAAe,kBAA6B,GAAKlB,QAAL,CAAc,CAAEmB,WAAF,CAAd,CAf9C,IAiBEC,oBAAsB,WAAA,OAEb,GAFa,IAGhB,WAAkB,UACfpB,SAAS,CAAEqB,MAAF,KAJI,IAStBC,WAAa,iBAAO,WACP,EAAKhB,KAAL,CAAWiB,SADJ,eAEH,EAAKjB,KAAL,CAAWkB,aAFR,gBAIb,EAAKlB,KAAL,CAAWmB,iBACP,SACI,CAAC,CAAC,EAAKvB,KAAL,CAAWiB,SADjB,SAEI,EAAKjB,KAAL,CAAWiB,SAFf,aAIK,CAAEO,UAAF,sBACS,EAAKN,qBAVV,CA1BtB,IAwCEO,eAAiB,iBACd,GAAKzB,KAAL,CAAWe,UAAZ,EAA2B,EAAKf,KAAL,CAAWmB,IAAtC,aAGgB,EAAKnB,KAAL,CAAWmB,IAAX,CAAgBO,OAAhB,CAAwBC,MAAxB,CAA+BC,UACtC,EAAK5B,KAAL,CAAWmB,IAAX,CAAgBU,OAJzB,EAzCJ,IAgDEC,mBAAqB,iBAClB,GAAK9B,KAAL,CAAWmB,IAAZ,CAA+B,EAAKnB,KAAL,CAAWmB,IAAX,CAAgBE,SAA/C,OAjDJ,IAmDEU,cAAgB,iBACb,GAAK/B,KAAL,CAAWiB,SAAZ,EAA0B,EAAKjB,KAAL,CAAWmB,IAArC,CAEI,EAAKnB,KAAL,CAAWmB,IAAX,CAAgBa,WAFpB,EApDJ,IAwDEC,mBAAqB,UAAM,IACjBC,GAAqB,EAAK9B,KAAL,CAArB8B,mBAC+B,EAAKlC,MAApCe,IAAAA,WAAYoB,IAAAA,kBAChBD,MAAkC,GAAiB,IAC/CC,GAAiB,UAGrB,EAAKf,UAAL,EAHqB,WAKlBtB,SAAS,CAAEqC,gBAAF,cAjEpB,IAuEEC,sBAAwB,WAA6B,CAC/C,EAAKpC,KAAL,CAAWmC,cADoC,IAE5CnC,MAAMmC,eAAeE,SAFuB,GAI9CvC,SAAS,CAAEqC,qBAAF,IA3ElB,IA8EEG,qBAAuB,UAAM,CACvB,EAAKtC,KAAL,CAAWmC,cADY,IAEpBC,sBAAsB,iBAAM,GAAKH,kBAAL,EAAjC,EAhFN,4EAoFqE,CAK5D,KAAKA,kBAAL,EAL4D,EAQ7D,KAAK7B,KAAL,CAAWiB,SAAX,GAAyBkB,EAAUlB,SAAnC,EACA,KAAKjB,KAAL,CAAWkB,aAAX,GAA6BiB,EAAUjB,aADvC,EAEA,KAAKtB,KAAL,CAAWiB,SAAX,GAAyBuB,EAAUvB,SAFnC,EAGA,KAAKjB,KAAL,CAAWe,UAAX,GAA0ByB,EAAUzB,UAHpC,EAIA,KAAKX,KAAL,CAAW8B,gBAAX,GAAgCK,EAAUL,gBAZmB,OAcxDI,qEAKY,CACjB,KAAKtC,KAAL,CAAWmC,cADM,OAEdnC,MAAMmC,eAAeE,0CAIrB,OACA9B,GAAY,KAAKH,KAAL,CAAWC,QAAvBE,EAAiC,KACjC,KAAKO,aAD4B,OAE/B,KAAKW,cAAL,EAF+B,WAG3B,KAAKK,kBAAL,EAH2B,YAI1B,KACL,KAAKd,YADA,OAEH,KAAKe,aAAL,EAFG,CAJ0B,CAAjCxB,SA9GiBD,aDnD5B;AACA;ACkDaO,EACJ4B,YADI5B,CACW,WACT,QADS,iBAAA,wBAAA,KAyHlB6B,GAAaC,EAASD,oBAGb,kBACbzC,gBAAAA,GAAgB2C,QAAhB3C,KAAAA,gBACMN,KAAAA,oBACFM,gBAAAA,MAAQiC,sBAARjC,EAFJA,CADF,yCCzKe,eAAGI,KAAAA,eAChBJ,gBAAAA,GAAgB2C,QAAhB3C,KAAAA,YAC4B,IAAtBJ,KAAAA,2BAGA,oEAEKU,KAAsB,CAAEsC,KAAF,CAAtBtC,EANXN,CADF"}