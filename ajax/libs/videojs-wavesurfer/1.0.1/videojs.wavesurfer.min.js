!function(i,e){"function"==typeof define&&define.amd?define(["wavesurfer"],e):i.WaveSurfer.Videojs=e(i.WaveSurfer)}(this,function(i){var e=videojs.getComponent("Component");videojs.Waveform=videojs.extend(e,{constructor:function(t,s){if(e.call(this,t,s),this.waveReady=!1,this.waveFinished=!1,this.liveMode=!1,"live"===this.options_.options.src)try{this.microphone=Object.create(i.Microphone),this.liveMode=!0,this.waveReady=!0}catch(i){console.warn("Could not find Microphone plugin!")}void 0!==this.options_.options.msDisplayMax?this.msDisplayMax=parseFloat(this.options_.options.msDisplayMax):this.msDisplayMax=3,this.player().one("ready",this.setupUI.bind(this))},setupUI:function(){if(this.player().bigPlayButton.hide(),this.player().options_.controls){this.liveMode&&(this.player().controlBar.show(),this.player().controlBar.el().style.display="flex"),this.player().controlBar.progressControl.hide(),this.player().on("userinactive",function(i){this.player().userActive(!0)});var e=[this.player().controlBar.currentTimeDisplay,this.player().controlBar.timeDivider,this.player().controlBar.durationDisplay];for(var t in e)void 0!==e[t]&&(e[t].el().style.display="block",e[t].show());void 0!==this.player().controlBar.remainingTimeDisplay&&this.player().controlBar.remainingTimeDisplay.hide(),void 0!==this.player().controlBar.timeDivider&&(this.player().controlBar.timeDivider.el().style.textAlign="center",this.player().controlBar.timeDivider.el().style.width="2em"),this.liveMode||this.player().controlBar.playToggle.hide()}this.surfer=Object.create(i),this.surfer.on("error",this.onWaveError.bind(this)),this.surfer.on("finish",this.onWaveFinish.bind(this)),this.surferReady=this.onWaveReady.bind(this),this.surferProgress=this.onWaveProgress.bind(this),this.surferSeek=this.onWaveSeek.bind(this),this.liveMode||this.setupPlaybackEvents(!0),this.player().on("play",this.onPlay.bind(this)),this.player().on("pause",this.onPause.bind(this)),this.player().on("volumechange",this.onVolumeChange.bind(this)),this.player().on("fullscreenchange",this.onScreenChange.bind(this)),this.startPlayers()},setupPlaybackEvents:function(i){!1===i?(this.surfer.un("ready",this.surferReady),this.surfer.un("audioprocess",this.surferProgress),this.surfer.un("seek",this.surferSeek)):!0===i&&(this.surfer.on("ready",this.surferReady),this.surfer.on("audioprocess",this.surferProgress),this.surfer.on("seek",this.surferSeek))},startPlayers:function(){var i=this.options_.options;this.initialize(i),void 0!==i.src?void 0===this.microphone?(this.player().loadingSpinner.show(),this.load(i.src)):(this.player().loadingSpinner.hide(),this.microphone.init({wavesurfer:this.surfer})):this.player().loadingSpinner.hide()},initialize:function(i){this.originalHeight=this.player().options_.height;var e=this.player().controlBar.height();!0===this.player().options_.controls&&0===e&&(e=30),void 0===i.container&&(i.container=this.el()),void 0===i.waveformHeight?i.height=this.player().height()-e:i.height=i.waveformHeight,this.surfer.init(i)},load:function(i){i instanceof Blob||i instanceof File?this.surfer.loadBlob(i):this.surfer.load(i)},play:function(){this.liveMode?this.microphone.active?this.microphone.play():this.microphone.start():this.surfer.play()},pause:function(){this.liveMode?this.microphone.pause():(this.waveFinished?this.waveFinished=!1:this.surfer.pause(),this.setCurrentTime())},destroy:function(){this.liveMode&&this.microphone&&this.microphone.destroy(),this.surfer.destroy(),this.player().dispose()},setVolume:function(i){void 0!==i&&this.surfer.setVolume(i)},setCurrentTime:function(i,e){void 0===i&&(i=this.surfer.getCurrentTime()),void 0===e&&(e=this.surfer.getDuration());var t=Math.min(i,e);this.player().controlBar.currentTimeDisplay.contentEl().innerHTML=this.formatTime(t,e)},setDuration:function(i){void 0===i&&(i=this.surfer.getDuration()),this.player().controlBar.durationDisplay.contentEl().innerHTML=this.formatTime(i,i)},onWaveReady:function(){this.waveReady=!0,this.waveFinished=!1,this.liveMode=!1,this.setCurrentTime(),this.setDuration(),this.player().controlBar.playToggle.show(),this.player().loadingSpinner.hide(),this.player().options_.autoplay&&this.play()},onWaveFinish:function(){this.player().paused()||(this.player().options_.loop?(this.surfer.stop(),this.play()):(this.waveFinished=!0,this.player().pause()))},onWaveProgress:function(i){this.setCurrentTime()},onWaveSeek:function(){this.setCurrentTime()},onPlay:function(){this.waveReady&&this.play()},onPause:function(){this.pause()},onVolumeChange:function(){var i=this.player().volume();this.player().muted()&&(i=0),this.setVolume(i)},onScreenChange:function(){var i;if(i=this.player().isFullscreen()?window.outerHeight:this.originalHeight,this.waveReady){if(this.liveMode&&!this.microphone.active)return;this.surfer.drawer.destroy(),this.surfer.params.height=i-this.player().controlBar.height(),this.surfer.createDrawer(),this.surfer.drawBuffer(),this.surfer.drawer.progress(this.surfer.backend.getPlayedPercents())}},onWaveError:function(i){console.warn(i)},formatTime:function(i,e){e=e||i;var t=Math.floor(i%60),s=Math.floor(i/60%60),r=Math.floor(i/3600),o=Math.floor(e/60%60),n=Math.floor(e/3600),a=Math.floor(1e3*(i-t));return(isNaN(i)||i===1/0)&&(r=s=t=a="-"),e>0&&e<this.msDisplayMax?(a<100&&(a=a<10?"00"+a:"0"+a),a=":"+a):a="",r=r>0||n>0?r+":":"",s=((r||o>=10)&&s<10?"0"+s:s)+":",t=t<10?"0"+t:t,r+s+t+a}});var t={},s=function(i){var s=videojs.mergeOptions(t,i);this.waveform=new videojs.Waveform(this,{el:e.prototype.createEl("div",{className:"vjs-waveform",tabIndex:0}),options:s}),this.el().appendChild(this.waveform.el())};return videojs.plugin("wavesurfer",s),s});