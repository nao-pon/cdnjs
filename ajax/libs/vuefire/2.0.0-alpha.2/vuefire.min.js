/*!
 * vuefire v2.0.0-alpha.2
 * (c) 2017 Eduardo San Martin Morote
 * Released under the MIT License.
 */
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t(e.Vuefire={})}(this,function(e){"use strict";function t(e){return Object.defineProperty(e.data(),"id",{value:e.id})}e.default=function(e,n){var i=e.config.optionMergeStrategies;i.firestore=i.methods,e.mixin({created:function(){var e=this,t=this.$options.firestore;this._firestoreUnbinds=Object.create(null),this.$firestoreRefs=Object.create(null),t&&Object.keys(t).forEach(function(n){e.$bind(n,t[n])})},beforeDestroy:function(){Object.values(this._firestoreUnbinds).forEach(function(e){e()}),this._firestoreUnbinds=null,this.$firestoreRefs=null}}),e.prototype.$bind=function(e,n){var i=function(e){var n=e.vm,i=e.key,o=e.ref;return new Promise(function(e,r){var s;s=o.where?function(e){var n,i=e.vm,o=e.key,r=e.collection,s=e.resolve,f=e.reject,c=i[o]=[],u={added:function(e){var n=e.newIndex,i=e.doc;c.splice(n,0,t(i))},modified:function(e){var n=e.oldIndex,i=e.newIndex,o=e.doc;c.splice(n,1),c.splice(i,0,t(o))},removed:function(e){var t=e.oldIndex;c.splice(t,1)}};return r.onSnapshot(function(e){e.docChanges.forEach(function(e){u[e.type](e)}),n||(n=!0,s(c))},f)}({vm:n,key:i,collection:o,resolve:e,reject:r}):function(e){var n,i=e.vm,o=e.key,r=e.document,s=e.resolve,f=e.reject;return r.onSnapshot(function(e){if(e.exists){var r=function(e){return Object.keys(e).reduce(function(t,n){var i=e[n];return"function"==typeof i.isEqual?(t[0][n]=null,t[1][n]=i):t[0][n]=i,t},[{},{}])}(t(e))[0];i[o]=r}n||(n=!0,s(i[o]))},f)}({vm:n,key:i,document:o,resolve:e,reject:r}),n._firestoreUnbinds[i]=s})}({vm:this,key:e,ref:n});return this.$firestoreRefs[e]=n,i},e.prototype.$unbind=function(e){this._firestoreUnbinds[e](),delete this._firestoreUnbinds[e],delete this.$firestoreRefs[e]}},Object.defineProperty(e,"__esModule",{value:!0})});