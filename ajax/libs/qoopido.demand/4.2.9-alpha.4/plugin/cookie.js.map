{"version":3,"sources":["plugin/cookie.js"],"names":["document","provide","path","iterate","isObject","isTypeOf","enabled","past","pattern","setCookie","dependency","value","expiration","pointer","match","i","indexOf","weight","state","isEnabled","cookie","type","encodeURIComponent","demand","on","options","length","key","push","JSON","stringify"],"mappings":";CAAC,SAASA,GACN,aAyDAC,SAAS,OAAQ,2BAA4B,6BAA8B,8BAvD3E,SAAoBC,EAAMC,EAASC,EAAUC,GACzC,IAGIC,EAHAC,EAAO,gCAEPC,KA6BJ,SAASC,EAAUC,EAAYC,EAAOC,IAC9BN,GAKR,SAAmBJ,GAIf,IAHA,IACIW,EAASC,EADTC,EAAI,EAIHF,EAAUL,EAAQO,GAAKA,IACc,IAAlCb,EAAKc,QAAQH,EAAQL,YAAoBM,GAASD,EAAQI,OAASH,EAAMG,UACzEH,EAAQD,GAIhB,QAAOC,GAAQA,EAAMI,MAhBNC,CAAUT,EAAWR,SAChCF,EAASoB,OAAS,UAAYV,EAAWW,KAAO,KAAOX,EAAWR,KAAO,KAAOoB,mBAAmBX,GAAS,aAAeC,EAAa,YAkBhJ,OA9CAW,OACAC,GAAG,iBAAmBtB,EAAM,SAASuB,GACzBrB,EAASqB,IACTjB,EAAQkB,OAAS,EAEjBvB,EAAQsB,EAAS,SAASE,EAAKhB,GAC3BH,EAAQoB,MACJpB,QAASmB,EACTV,OAAQU,EAAID,OACZR,MAAOP,OAGRN,EAASoB,EAAS,aACzBnB,EAAUmB,KAGjBD,GAAG,YAAa,SAASd,GACtBD,EAAUC,EAAY,GAAIH,KAE7BiB,GAAG,aAAc,SAASd,GACvBD,EAAUC,EAAY,GAAIH,KAE7BiB,GAAG,YAAa,SAASd,EAAYQ,GAClCT,EAAUC,EAAYmB,KAAKC,UAAUZ,GA3BhC,oCAkDN,IAvDf,CA2DElB","file":"cookie.js","sourcesContent":["(function(document) {\n    'use strict';\n\n    function definition(path, iterate, isObject, isTypeOf) {\n        var past = 'Thu, 01 Jan 1970 00:00:00 GMT',\n            future = 'Fri, 31 Dec 9999 23:59:59 GMT',\n            pattern = [],\n            enabled;\n\n        demand.\n        on('postConfigure:' + path, function(options) {\n                if (isObject(options)) {\n                    pattern.length = 0;\n\n                    iterate(options, function(key, value) {\n                        pattern.push({\n                            pattern: key,\n                            weight: key.length,\n                            state: value\n                        });\n                    });\n                } else if (isTypeOf(options, 'boolean')) {\n                    enabled = options;\n                }\n            })\n            .on('cacheMiss', function(dependency) {\n                setCookie(dependency, '', past);\n            })\n            .on('cacheClear', function(dependency) {\n                setCookie(dependency, '', past);\n            })\n            .on('postCache', function(dependency, state) {\n                setCookie(dependency, JSON.stringify(state), future);\n            });\n\n        function setCookie(dependency, value, expiration) {\n            if (enabled || isEnabled(dependency.path)) {\n                document.cookie = 'demand[' + dependency.type + '][' + dependency.path + ']=' + encodeURIComponent(value) + '; expires=' + expiration + '; path=/';\n            }\n        }\n\n        function isEnabled(path) {\n            var i = 0,\n                pointer, match;\n\n            for (;\n                (pointer = pattern[i]); i++) {\n                if (path.indexOf(pointer.pattern) === 0 && (!match || pointer.weight > match.weight)) {\n                    match = pointer;\n                }\n            }\n\n            return match ? match.state : false;\n        }\n\n        return true;\n    }\n\n    provide(['path', '/demand/function/iterate', '/demand/validator/isObject', '/demand/validator/isTypeOf'], definition);\n}(document));"]}