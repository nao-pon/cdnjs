!function(t){"object"==typeof exports&&"object"==typeof module?t(require("../../lib/codemirror")):"function"==typeof define&&define.amd?define(["../../lib/codemirror"],t):t(CodeMirror)}(function(t){"use strict";var e,n,i=t.Pos;function r(t){return t.global?t:new RegExp(t.source,(null!=(n=(e=t).flags)?n:(e.ignoreCase?"i":"")+(e.global?"g":"")+(e.multiline?"m":""))+"g");var e,n}function o(t,e,n){e=r(e);for(var o=n.line,l=n.ch,h=t.lastLine();o<=h;o++,l=0){e.lastIndex=l;var s=t.getLine(o),c=e.exec(s);if(c)return{from:i(o,c.index),to:i(o,c.index+c[0].length),match:c}}}function l(t,e){for(var n,i=0;;){e.lastIndex=i;var r=e.exec(t);if(!r)return n;if((i=(n=r).index+(n[0].length||1))==t.length)return n}}function h(t,e,n,i){if(t.length==e.length)return n;for(var r=0,o=n+Math.max(0,t.length-e.length);;){if(r==o)return r;var l=r+o>>1,h=i(t.slice(0,l)).length;if(h==n)return l;h>n?o=l:r=l+1}}function s(t,s,c,f){var u;this.atOccurrence=!1,this.doc=t,c=c?t.clipPos(c):i(0,0),this.pos={from:c,to:c},"object"==typeof f?u=f.caseFold:(u=f,f=null),"string"==typeof s?(null==u&&(u=!1),this.matches=function(r,o){return(r?function(t,r,o,l){if(!r.length)return null;var s=l?e:n,c=s(r).split(/\r|\n\r?/);t:for(var f=o.line,u=o.ch,a=t.firstLine()-1+c.length;f>=a;f--,u=-1){var g=t.getLine(f);u>-1&&(g=g.slice(0,u));var m=s(g);if(1==c.length){var v=m.lastIndexOf(c[0]);if(-1==v)continue t;return{from:i(f,h(g,m,v,s)),to:i(f,h(g,m,v+c[0].length,s))}}var d=c[c.length-1];if(m.slice(0,d.length)==d){var p=1;for(o=f-c.length+1;p<c.length-1;p++)if(s(t.getLine(o+p))!=c[p])continue t;var L=t.getLine(f+1-c.length),x=s(L);if(x.slice(x.length-c[0].length)==c[0])return{from:i(f+1-c.length,h(L,x,L.length-c[0].length,s)),to:i(f,h(g,m,d.length,s))}}}}:function(t,r,o,l){if(!r.length)return null;var s=l?e:n,c=s(r).split(/\r|\n\r?/);t:for(var f=o.line,u=o.ch,a=t.lastLine()+1-c.length;f<=a;f++,u=0){var g=t.getLine(f).slice(u),m=s(g);if(1==c.length){var v=m.indexOf(c[0]);if(-1==v)continue t;return o=h(g,m,v,s)+u,{from:i(f,h(g,m,v,s)+u),to:i(f,h(g,m,v+c[0].length,s)+u)}}var d=m.length-c[0].length;if(m.slice(d)==c[0]){for(var p=1;p<c.length-1;p++)if(s(t.getLine(f+p))!=c[p])continue t;var L=t.getLine(f+c.length-1),x=s(L),C=c[c.length-1];if(x.slice(0,C.length)==C)return{from:i(f,h(g,m,d,s)+u),to:i(f+c.length-1,h(L,x,C.length,s))}}}})(t,s,o,u)}):(s=r(s),f&&!1===f.multiline?this.matches=function(e,n){return(e?function(t,e,n){e=r(e);for(var o=n.line,h=n.ch,s=t.firstLine();o>=s;o--,h=-1){var c=t.getLine(o);h>-1&&(c=c.slice(0,h));var f=l(c,e);if(f)return{from:i(o,f.index),to:i(o,f.index+f[0].length),match:f}}}:o)(t,s,n)}:this.matches=function(e,n){return(e?function(t,e,n){e=r(e);for(var o,h=1,s=n.line,c=t.firstLine();s>=c;){for(var f=0;f<h;f++){var u=t.getLine(s--);o=null==o?u.slice(0,n.ch):u+"\n"+o}h*=2;var a=l(o,e);if(a){var g=o.slice(0,a.index).split("\n"),m=a[0].split("\n"),v=s+g.length,d=g[g.length-1].length;return{from:i(v,d),to:i(v+m.length-1,1==m.length?d+m[0].length:m[m.length-1].length),match:a}}}}:function(t,e,n){if(!/\\s|\\n|\n|\\W|\\D|\[\^/.test(e.source))return o(t,e,n);e=r(e);for(var l,h=1,s=n.line,c=t.lastLine();s<=c;){for(var f=0;f<h;f++){var u=t.getLine(s++);l=null==l?u:l+"\n"+u}h*=2,e.lastIndex=n.ch;var a=e.exec(l);if(a){var g=l.slice(0,a.index).split("\n"),m=a[0].split("\n"),v=n.line+g.length-1,d=g[g.length-1].length;return{from:i(v,d),to:i(v+m.length-1,1==m.length?d+m[0].length:m[m.length-1].length),match:a}}}})(t,s,n)})}String.prototype.normalize?(e=function(t){return t.normalize("NFD").toLowerCase()},n=function(t){return t.normalize("NFD")}):(e=function(t){return t.toLowerCase()},n=function(t){return t}),s.prototype={findNext:function(){return this.find(!1)},findPrevious:function(){return this.find(!0)},find:function(e){for(var n=this.matches(e,this.doc.clipPos(e?this.pos.from:this.pos.to));n&&0==t.cmpPos(n.from,n.to);)e?n.from.ch?n.from=i(n.from.line,n.from.ch-1):n=n.from.line==this.doc.firstLine()?null:this.matches(e,this.doc.clipPos(i(n.from.line-1))):n.to.ch<this.doc.getLine(n.to.line).length?n.to=i(n.to.line,n.to.ch+1):n=n.to.line==this.doc.lastLine()?null:this.matches(e,i(n.to.line+1,0));if(n)return this.pos=n,this.atOccurrence=!0,this.pos.match||!0;var r=i(e?this.doc.firstLine():this.doc.lastLine()+1,0);return this.pos={from:r,to:r},this.atOccurrence=!1},from:function(){if(this.atOccurrence)return this.pos.from},to:function(){if(this.atOccurrence)return this.pos.to},replace:function(e,n){if(this.atOccurrence){var r=t.splitLines(e);this.doc.replaceRange(r,this.pos.from,this.pos.to,n),this.pos.to=i(this.pos.from.line+r.length-1,r[r.length-1].length+(1==r.length?this.pos.from.ch:0))}}},t.defineExtension("getSearchCursor",function(t,e,n){return new s(this.doc,t,e,n)}),t.defineDocExtension("getSearchCursor",function(t,e,n){return new s(this,t,e,n)}),t.defineExtension("selectMatches",function(e,n){for(var i=[],r=this.getSearchCursor(e,this.getCursor("from"),n);r.findNext()&&!(t.cmpPos(r.to(),this.getCursor("to"))>0);)i.push({anchor:r.from(),head:r.to()});i.length&&this.setSelections(i,0)})});