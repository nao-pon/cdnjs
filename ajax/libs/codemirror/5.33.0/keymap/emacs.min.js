!function(t){"object"==typeof exports&&"object"==typeof module?t(require("../lib/codemirror")):"function"==typeof define&&define.amd?define(["../lib/codemirror"],t):t(CodeMirror)}(function(t){"use strict";function e(t,e){return t.line==e.line&&t.ch==e.ch}function n(t){b.push(t),b.length>50&&b.shift()}function r(t){return b[b.length-(t?Math.min(t,1):1)]||""}function o(t,r,o,i,l){null==l&&(l=t.getRange(r,o)),"grow"==i&&U&&U.cm==t&&e(r,U.pos)&&t.isClean(U.gen)?function(t){if(!b.length)return n(t);b[b.length-1]+=t}(l):!1!==i&&n(l),t.replaceRange("",r,o,"+delete"),U="grow"==i?{cm:t,pos:r,gen:t.changeGeneration()}:null}function i(t,e,n){return t.findPosH(e,n,"char",!0)}function l(t,e,n){return t.findPosH(e,n,"word",!0)}function c(t,e,n){return t.findPosV(e,n,"line",t.doc.sel.goalColumn)}function a(t,e,n){return t.findPosV(e,n,"page",t.doc.sel.goalColumn)}function u(t,e,n){for(var r=e.line,o=t.getLine(r),i=/\S/.test(n<0?o.slice(0,e.ch):o.slice(e.ch)),l=t.firstLine(),c=t.lastLine();;){if((r+=n)<l||r>c)return t.clipPos(k(r-n,n<0?0:null));o=t.getLine(r);if(/\S/.test(o))i=!0;else if(i)return k(r,0)}}function f(t,e,n){for(var r=e.line,o=e.ch,i=t.getLine(e.line),l=!1;;){var c=i.charAt(o+(n<0?-1:0));if(c){if(l&&/[!?.]/.test(c))return k(r,o+(n>0?1:0));l||(l=/\w/.test(c)),o+=n}else{if(r==(n<0?t.firstLine():t.lastLine()))return k(r,o);if(i=t.getLine(r+n),!/\S/.test(i))return k(r,o);r+=n,o=n<0?i.length:0}}}function s(t,n,r){var o;if(t.findMatchingBracket&&(o=t.findMatchingBracket(n,{strict:!0}))&&o.match&&(o.forward?1:-1)==r)return r>0?k(o.to.line,o.to.ch+1):o.to;for(var i=!0;;i=!1){var l=t.getTokenAt(n),c=k(n.line,r<0?l.start:l.end);if(!(i&&r>0&&l.end==n.ch)&&/\w/.test(l.string))return c;var a=t.findPosH(c,r,"char");if(e(c,a))return n;n=a}}function g(t,e){var n=t.state.emacsPrefix;return n?(S(t),"-"==n?-1:Number(n)):e?null:1}function C(t){var e="string"==typeof t?function(e){e.execCommand(t)}:t;return function(t){var n=g(t);e(t);for(var r=1;r<n;++r)e(t)}}function d(t,n,r,o){var i=g(t);i<0&&(o=-o,i=-i);for(var l=0;l<i;++l){var c=r(t,n,o);if(e(c,n))break;n=c}return n}function p(t,e){var n=function(n){n.extendSelection(d(n,n.getCursor(),t,e))};return n.motion=!0,n}function h(t,e,n,r){for(var i,l=t.listSelections(),c=l.length;c--;)o(t,i=l[c].head,d(t,i,e,n),r)}function m(t,e){if(t.somethingSelected()){for(var n,r=t.listSelections(),i=r.length;i--;)o(t,(n=r[i]).anchor,n.head,e);return!0}}function A(t,e){t.state.emacsPrefix?"-"!=e&&(t.state.emacsPrefix+=e):(t.state.emacsPrefix=e,t.on("keyHandled",v),t.on("inputRead",P))}function v(t,e){t.state.emacsPrefixMap||X.hasOwnProperty(e)||S(t)}function S(t){t.state.emacsPrefix=null,t.off("keyHandled",v),t.off("inputRead",P)}function P(t,e){var n=g(t);if(n>1&&"+input"==e.origin){for(var r=e.text.join("\n"),o="",i=1;i<n;++i)o+=r;t.replaceSelection(o)}}function w(t,e){("string"!=typeof e||!/^\d$/.test(e)&&"Ctrl-U"!=e)&&(t.removeKeyMap(E),t.state.emacsPrefixMap=!1,t.off("keyHandled",w),t.off("inputRead",w))}function x(t){t.setCursor(t.getCursor()),t.setExtending(!t.getExtending()),t.on("change",function(){t.setExtending(!1)})}function L(t){t.setExtending(!1),t.setCursor(t.getCursor())}function R(t,e){var n=t.getCursor(),r=t.findPosH(n,1,"word");t.replaceRange(e(t.getRange(n,r)),n,r),t.setCursor(r)}function y(t){E[t]=function(e){A(e,t)},D["Ctrl-"+t]=function(e){A(e,t)},X["Ctrl-"+t]=!0}var k=t.Pos,b=[],U=null,X={"Alt-G":!0,"Ctrl-X":!0,"Ctrl-Q":!0,"Ctrl-U":!0};t.emacs={kill:o,killRegion:m,repeated:C};for(var D=t.keyMap.emacs=t.normalizeKeyMap({"Ctrl-W":function(t){o(t,t.getCursor("start"),t.getCursor("end"),!0)},"Ctrl-K":C(function(t){var e=t.getCursor(),n=t.clipPos(k(e.line)),r=t.getRange(e,n);/\S/.test(r)||(r+="\n",n=k(e.line+1,0)),o(t,e,n,"grow",r)}),"Alt-W":function(t){n(t.getSelection()),L(t)},"Ctrl-Y":function(t){var e=t.getCursor();t.replaceRange(r(g(t)),e,e,"paste"),t.setSelection(e,t.getCursor())},"Alt-Y":function(t){t.replaceSelection((b.length>1&&b.pop(),r()),"around","paste")},"Ctrl-Space":x,"Ctrl-Shift-2":x,"Ctrl-F":p(i,1),"Ctrl-B":p(i,-1),Right:p(i,1),Left:p(i,-1),"Ctrl-D":function(t){h(t,i,1,!1)},Delete:function(t){m(t,!1)||h(t,i,1,!1)},"Ctrl-H":function(t){h(t,i,-1,!1)},Backspace:function(t){m(t,!1)||h(t,i,-1,!1)},"Alt-F":p(l,1),"Alt-B":p(l,-1),"Alt-D":function(t){h(t,l,1,"grow")},"Alt-Backspace":function(t){h(t,l,-1,"grow")},"Ctrl-N":p(c,1),"Ctrl-P":p(c,-1),Down:p(c,1),Up:p(c,-1),"Ctrl-A":"goLineStart","Ctrl-E":"goLineEnd",End:"goLineEnd",Home:"goLineStart","Alt-V":p(a,-1),"Ctrl-V":p(a,1),PageUp:p(a,-1),PageDown:p(a,1),"Ctrl-Up":p(u,-1),"Ctrl-Down":p(u,1),"Alt-A":p(f,-1),"Alt-E":p(f,1),"Alt-K":function(t){h(t,f,1,"grow")},"Ctrl-Alt-K":function(t){h(t,s,1,"grow")},"Ctrl-Alt-Backspace":function(t){h(t,s,-1,"grow")},"Ctrl-Alt-F":p(s,1),"Ctrl-Alt-B":p(s,-1),"Shift-Ctrl-Alt-2":function(t){var e=t.getCursor();t.setSelection(d(t,e,s,1),e)},"Ctrl-Alt-T":function(t){var e=s(t,t.getCursor(),-1),n=s(t,e,1),r=s(t,n,1),o=s(t,r,-1);t.replaceRange(t.getRange(o,r)+t.getRange(n,o)+t.getRange(e,n),e,r)},"Ctrl-Alt-U":C(function(t){for(var e=t.getCursor(),n=e.line,r=e.ch,o=[];n>=t.firstLine();){for(var i=t.getLine(n),l=null==r?i.length:r;l>0;)if(")"==(r=i.charAt(--l)))o.push("(");else if("]"==r)o.push("[");else if("}"==r)o.push("{");else if(/[\(\{\[]/.test(r)&&(!o.length||o.pop()!=r))return t.extendSelection(k(n,l));--n,r=null}}),"Alt-Space":function(t){for(var e=t.getCursor(),n=e.ch,r=e.ch,o=t.getLine(e.line);n&&/\s/.test(o.charAt(n-1));)--n;for(;r<o.length&&/\s/.test(o.charAt(r));)++r;t.replaceRange(" ",k(e.line,n),k(e.line,r))},"Ctrl-O":C(function(t){t.replaceSelection("\n","start")}),"Ctrl-T":C(function(t){t.execCommand("transposeChars")}),"Alt-C":C(function(t){R(t,function(t){var e=t.search(/\w/);return-1==e?t:t.slice(0,e)+t.charAt(e).toUpperCase()+t.slice(e+1).toLowerCase()})}),"Alt-U":C(function(t){R(t,function(t){return t.toUpperCase()})}),"Alt-L":C(function(t){R(t,function(t){return t.toLowerCase()})}),"Alt-;":"toggleComment","Ctrl-/":C("undo"),"Shift-Ctrl--":C("undo"),"Ctrl-Z":C("undo"),"Cmd-Z":C("undo"),"Shift-Alt-,":"goDocStart","Shift-Alt-.":"goDocEnd","Ctrl-S":"findPersistentNext","Ctrl-R":"findPersistentPrev","Ctrl-G":function(t){t.execCommand("clearSearch"),L(t)},"Shift-Alt-5":"replace","Alt-/":"autocomplete",Enter:"newlineAndIndent","Ctrl-J":C(function(t){t.replaceSelection("\n","end")}),Tab:"indentAuto","Alt-G G":function(t){var e=g(t,!0);if(null!=e&&e>0)return t.setCursor(e-1);!function(t,e,n){t.openDialog?t.openDialog(e+': <input type="text" style="width: 10em"/>',n,{bottom:!0}):n(prompt(e,""))}(t,"Goto line",function(e){var n;e&&!isNaN(n=Number(e))&&n==(0|n)&&n>0&&t.setCursor(n-1)})},"Ctrl-X Tab":function(t){t.indentSelection(g(t,!0)||t.getOption("indentUnit"))},"Ctrl-X Ctrl-X":function(t){t.setSelection(t.getCursor("head"),t.getCursor("anchor"))},"Ctrl-X Ctrl-S":"save","Ctrl-X Ctrl-W":"save","Ctrl-X S":"saveAll","Ctrl-X F":"open","Ctrl-X U":C("undo"),"Ctrl-X K":"close","Ctrl-X Delete":function(t){o(t,t.getCursor(),f(t,t.getCursor(),1),"grow")},"Ctrl-X H":"selectAll","Ctrl-Q Tab":C("insertTab"),"Ctrl-U":function(t){t.state.emacsPrefixMap=!0,t.addKeyMap(E),t.on("keyHandled",w),t.on("inputRead",w)}}),E={"Ctrl-G":S},H=0;H<10;++H)y(String(H));y("-")});