!function(W){W.fn.magnify=function(k){k=W.extend({src:"",speed:100,timeout:-1,touchBottomOffset:0,finalWidth:null,finalHeight:null,magnifiedWidth:null,magnifiedHeight:null,limitBounds:!1,mobileCloseEvent:"touchstart",afterLoad:function(){}},k);var t=this,E=W("html"),e=0,H=function(){clearTimeout(e),e=setTimeout(function(){t.destroy(),t.magnify(k)},100)};return this.destroy=function(){return this.each(function(){var t=W(this),e=t.prev("div.magnify-lens"),i=t.data("originalStyle");t.parent("div.magnify").length&&e.length&&(i?t.attr("style",i):t.removeAttr("style"),t.unwrap(),e.remove())}),W(window).off("resize",H),t},W(window).resize(H),this.each(function(){!function(t){var e=W(t),n=e.closest("a"),a={};for(var i in k)a[i]=e.attr("data-magnify-"+i.toLowerCase());var o=a.src||k.src||n.attr("href")||"";if(o){var f,l,d,c,u,h,g,m,p,v,y=0,b=0,w=function(){var t=f.offset();return v={top:e.offset().top-t.top+parseInt(e.css("border-top-width"))+parseInt(e.css("padding-top")),left:e.offset().left-t.left+parseInt(e.css("border-left-width"))+parseInt(e.css("padding-left"))},t.top+=v.top,t.left+=v.left,t},N=function(){l.is(":visible")&&l.fadeOut(k.speed,function(){E.removeClass("magnifying").trigger("magnifyend")})};isNaN(+a.speed)||(k.speed=+a.speed),isNaN(+a.timeout)||(k.timeout=+a.timeout),isNaN(+a.finalWidth)||(k.finalWidth=+a.finalWidth),isNaN(+a.finalHeight)||(k.finalHeight=+a.finalHeight),isNaN(+a.magnifiedWidth)||(k.magnifiedWidth=+a.magnifiedWidth),isNaN(+a.magnifiedHeight)||(k.magnifiedHeight=+a.magnifiedHeight),"true"===a.limitBounds&&(k.limitBounds=!0),"function"==typeof window[a.afterLoad]&&(k.afterLoad=window[a.afterLoad]),/\b(Android|BlackBerry|IEMobile|iPad|iPhone|Mobile|Opera Mini)\b/.test(navigator.userAgent)?isNaN(+a.touchBottomOffset)||(k.touchBottomOffset=+a.touchBottomOffset):k.touchBottomOffset=0,e.data("originalStyle",e.attr("style"));var B=new Image;W(B).on({load:function(){var s,r;e.css("display","block"),e.parent(".magnify").length||e.wrap('<div class="magnify"></div>'),f=e.parent(".magnify"),e.prev(".magnify-lens").length?f.children(".magnify-lens").css("background-image","url('"+o+"')"):e.before('<div class="magnify-lens loading" style="background:url(\''+o+"') 0 0 no-repeat\"></div>"),(l=f.children(".magnify-lens")).removeClass("loading"),d=k.finalWidth||e.width(),c=k.finalHeight||e.height(),u=k.magnifiedWidth||B.width,h=k.magnifiedHeight||B.height,g=l.width(),m=l.height(),p=w(),k.limitBounds&&(y=g/2/(u/d),b=m/2/(h/c)),u===B.width&&h===B.height||l.css("background-size",u+"px "+h+"px"),e.data("zoomSize",{width:u,height:h}),f.data("mobileCloseEvent",a.mobileCloseEvent||k.mobileCloseEvent),B=null,k.afterLoad(),f.off().on({"mousemove touchmove":function(t){if(t.preventDefault(),c){if(s=(t.pageX||t.originalEvent.touches[0].pageX)-p.left,r=(t.pageY||t.originalEvent.touches[0].pageY)-p.top-k.touchBottomOffset,l.is(":animated")||(y<s&&s<d-y&&b<r&&r<c-b?l.is(":hidden")&&(E.addClass("magnifying").trigger("magnifystart"),l.fadeIn(k.speed)):N()),l.is(":visible")){var e="";if(u&&h){var i=-Math.round(s/d*u-g/2),n=-Math.round(r/c*h-m/2);if(k.limitBounds){var a=-Math.round((d-y)/d*u-g/2),o=-Math.round((c-b)/c*h-m/2);0<i?i=0:i<a&&(i=a),0<n?n=0:n<o&&(n=o)}e=i+"px "+n+"px"}l.css({top:Math.round(r-m/2)+v.top+"px",left:Math.round(s-g/2)+v.left+"px","background-position":e})}}else H()},mouseenter:function(){p=w()},mouseleave:N}),0<=k.timeout&&f.on("touchend",function(){setTimeout(N,k.timeout)}),W("body").not(f).on("touchstart",N);var t=e.attr("usemap");if(t){var i=W("map[name="+t.slice(1)+"]");e.after(i),f.click(function(t){if(t.clientX||t.clientY){l.hide();var e=document.elementFromPoint(t.clientX||t.originalEvent.touches[0].clientX,t.clientY||t.originalEvent.touches[0].clientY);"AREA"===e.nodeName?e.click():W("area",i).each(function(){var t=W(this).attr("coords").split(",");if(s>=t[0]&&s<=t[2]&&r>=t[1]&&r<=t[3])return this.click(),!1})}})}n.length&&(n.css("display","inline-block"),!n.attr("href")||a.src||k.src||n.click(function(t){t.preventDefault()}))},error:function(){B=null}}),B.src=o}}(this)})}}(jQuery);