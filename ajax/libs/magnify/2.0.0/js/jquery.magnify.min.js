!function(t){t.fn.magnify=function(i){i=t.extend({speed:100,src:"",timeout:-1,afterLoad:function(){},finalWidth:null,finalHeight:null,magnifiedWidth:null,magnifiedHeight:null},i);var e=this,n=0,a=function(){clearTimeout(n),n=setTimeout(function(){e.destroy(),e.magnify(i)},100)};return this.destroy=function(){return this.each(function(){var i=t(this),e=i.prev("div.magnify-lens"),n=i.data("originalStyle");i.parent("div.magnify").length&&e.length&&(n?i.attr("style",n):i.removeAttr("style"),i.unwrap(),e.remove())}),t(window).off("resize",a),e},t(window).resize(a),this.each(function(){!function(e){var n=t(e),o=n.closest("a"),r={};for(var s in i)r[s]=n.attr("data-magnify-"+s.toLowerCase());var f=r.src||i.src||o.attr("href")||"";if(f){var l,d,c,g,h,u,m,p,v,y,w=function(){var t=l.offset();return y={top:n.offset().top-t.top+parseInt(n.css("border-top-width"))+parseInt(n.css("padding-top")),left:n.offset().left-t.left+parseInt(n.css("border-left-width"))+parseInt(n.css("padding-left"))},t.top+=y.top,t.left+=y.left,t},N=function(){d.is(":visible")&&d.fadeOut(i.speed,function(){t("html").removeClass("magnifying").trigger("magnifyend")})};isNaN(+r.speed)||(i.speed=+r.speed),isNaN(+r.timeout)||(i.timeout=+r.timeout),"function"==typeof window[r.afterLoad]&&(i.afterLoad=window[r.afterLoad]),isNaN(+r.finalWidth)||(i.finalWidth=+r.finalWidth),isNaN(+r.finalHeight)||(i.finalHeight=+r.finalHeight),isNaN(+r.magnifiedWidth)||(i.magnifiedWidth=+r.magnifiedWidth),isNaN(+r.magnifiedHeight)||(i.magnifiedHeight=+r.magnifiedHeight),n.data("originalStyle",n.attr("style"));var b=new Image;t(b).on({load:function(){var e,s;n.css("display","block"),n.parent(".magnify").length||n.wrap('<div class="magnify"></div>'),l=n.parent(".magnify"),n.prev(".magnify-lens").length?l.children(".magnify-lens").css("background-image","url('"+f+"')"):n.before('<div class="magnify-lens loading" style="background:url(\''+f+"') 0 0 no-repeat\"></div>"),(d=l.children(".magnify-lens")).removeClass("loading"),c=i.finalWidth||n.width(),g=i.finalHeight||n.height(),h=i.magnifiedWidth||b.width,u=i.magnifiedHeight||b.height,m=d.width(),p=d.height(),v=w(),h===b.width&&u===b.height||d.css("background-size",h+"px "+u+"px"),n.data("zoomSize",{width:h,height:u}),b=null,i.afterLoad(),l.off().on({"mousemove touchmove":function(n){if(n.preventDefault(),g){if(e=(n.pageX||n.originalEvent.touches[0].pageX)-v.left,s=(n.pageY||n.originalEvent.touches[0].pageY)-v.top,d.is(":animated")||(e<c&&s<g&&e>0&&s>0?d.is(":hidden")&&(t("html").addClass("magnifying").trigger("magnifystart"),d.fadeIn(i.speed)):N()),d.is(":visible")){var o=e-m/2,r=s-p/2;if(h&&u)var f=-1*Math.round(e/c*h-m/2)+"px "+-1*Math.round(s/g*u-p/2)+"px";d.css({top:Math.round(r)+y.top+"px",left:Math.round(o)+y.left+"px",backgroundPosition:f||""})}}else a()},mouseenter:function(){v=w()},mouseleave:N}),i.timeout>=0&&l.on("touchend",function(){setTimeout(N,i.timeout)}),t("body").not(l).on("touchstart",N);var k=n.attr("usemap");if(k){var H=t("map[name="+k.slice(1)+"]");n.after(H),l.click(function(i){if(i.clientX||i.clientY){d.hide();var n=document.elementFromPoint(i.clientX||i.originalEvent.touches[0].clientX,i.clientY||i.originalEvent.touches[0].clientY);"AREA"===n.nodeName?n.click():t("area",H).each(function(){var i=t(this).attr("coords").split(",");if(e>=i[0]&&e<=i[2]&&s>=i[1]&&s<=i[3])return this.click(),!1})}})}o.length&&(o.css("display","inline-block"),!o.attr("href")||r.src||i.src||o.click(function(t){t.preventDefault()}))},error:function(){b=null}}),b.src=f}}(this)})}}(jQuery);