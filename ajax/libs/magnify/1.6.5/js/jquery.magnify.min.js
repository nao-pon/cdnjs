!function(n){n.fn.magnify=function(t){var e=n.extend({speed:100,timeout:-1,onload:function(){}},t);return this.each(function(){!function(t){var i,a,o=n(t),s=o.closest("a"),r=0,l=0,d=o.attr("data-magnify-src")||e.src||s.attr("href")||"",h=function(){a.is(":visible")&&a.fadeOut(e.speed,function(){n("html").removeClass("magnifying")})};if(d){var c=new Image;n(c).on({load:function(){o.css("display","block"),o.parent(".magnify").length||o.wrap('<div class="magnify"></div>'),i=o.parent(".magnify"),o.prev(".magnify-lens").length?i.children(".magnify-lens").css("background-image","url('"+d+"')"):o.before('<div class="magnify-lens loading" style="background:url(\''+d+"') no-repeat 0 0\"></div>"),(a=i.children(".magnify-lens")).removeClass("loading"),r=c.width,l=c.height,o.data("zoomSize",{width:r,height:l}),c=null,e.onload(),i.on("mousemove touchmove",function(t){t.preventDefault();var s=i.offset(),d=(t.pageX||t.originalEvent.touches[0].pageX)-s.left,c=(t.pageY||t.originalEvent.touches[0].pageY)-s.top;if(a.is(":animated")||(d<i.width()&&c<i.height()&&d>0&&c>0?a.is(":hidden")&&(n("html").addClass("magnifying"),a.fadeIn(e.speed)):h()),a.is(":visible")){var f=d-a.width()/2,u=c-a.height()/2;if(r&&l)var g=-1*Math.round(d/o.width()*r-a.width()/2)+"px "+-1*Math.round(c/o.height()*l-a.height()/2)+"px";a.css({top:Math.round(u)+"px",left:Math.round(f)+"px",backgroundPosition:g||""})}}),i.mouseleave(h),e.timeout>=0&&i.on("touchend",function(){setTimeout(h,e.timeout)}),n("body").not(i).on("touchstart",h),s.length&&(s.css("display","inline-block"),!s.attr("href")||o.attr("data-magnify-src")||e.src||s.click(function(n){n.preventDefault()}))},error:function(){c=null}}),c.src=d}}(this)})}}(jQuery);