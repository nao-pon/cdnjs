!function(e){e.fn.magnify=function(t){var n=this,i=e.extend({speed:100,timeout:-1,onload:function(){}},t),a=0,o=function(){clearTimeout(a),a=setTimeout(function(){n.destroy(),n.magnify(i)},100)};return this.destroy=function(){return this.each(function(){var t=e(this),n=t.prev("div.magnify-lens"),i=t.data("originalStyle");t.parent("div.magnify").length&&n.length&&(i?t.attr("style",i):t.removeAttr("style"),t.unwrap(),n.remove())}),e(window).off("resize",o),n},e(window).resize(o),this.each(function(){!function(t){var n,a,r,s,l,c,f,u,d,g=e(t),h=g.closest("a"),m=0,v=0,y=g.attr("data-magnify-src")||i.src||h.attr("href")||"",p=function(){a.is(":visible")&&a.fadeOut(i.speed,function(){e("html").removeClass("magnifying").trigger("magnifyend")})};if(y){g.data("originalStyle",g.attr("style"));var w=new Image;e(w).on({load:function(){var t,b;g.css("display","block"),g.parent(".magnify").length||g.wrap('<div class="magnify"></div>'),n=g.parent(".magnify"),g.prev(".magnify-lens").length?n.children(".magnify-lens").css("background-image","url('"+y+"')"):g.before('<div class="magnify-lens loading" style="background:url(\''+y+"') no-repeat 0 0\"></div>"),(a=n.children(".magnify-lens")).removeClass("loading"),r=n.offset(),s=n.width(),l=n.height(),c=g.innerWidth(),f=g.innerHeight(),u=a.width(),d=a.height(),m=w.width,v=w.height,g.data("zoomSize",{width:m,height:v}),w=null,i.onload(),n.off().on({"mousemove touchmove":function(n){if(n.preventDefault(),l){if(t=(n.pageX||n.originalEvent.touches[0].pageX)-r.left,b=(n.pageY||n.originalEvent.touches[0].pageY)-r.top,a.is(":animated")||(t<s&&b<l&&t>0&&b>0?a.is(":hidden")&&(e("html").addClass("magnifying").trigger("magnifystart"),a.fadeIn(i.speed)):p()),a.is(":visible")){var g=t-u/2,h=b-d/2;if(m&&v)var y=-1*Math.round(t/c*m-u/2)+"px "+-1*Math.round(b/f*v-d/2)+"px";a.css({top:Math.round(h)+"px",left:Math.round(g)+"px",backgroundPosition:y||""})}}else o()},mouseenter:function(){r=n.offset()},mouseleave:p}),i.timeout>=0&&n.on("touchend",function(){setTimeout(p,i.timeout)}),e("body").not(n).on("touchstart",p);var k=g.attr("usemap");if(k){var x=e("map[name="+k.slice(1)+"]");g.after(x),n.click(function(n){if(n.clientX||n.clientY){a.hide();var i=document.elementFromPoint(n.clientX||n.originalEvent.touches[0].clientX,n.clientY||n.originalEvent.touches[0].clientY);"AREA"===i.nodeName?i.click():e("area",x).each(function(){var n=e(this).attr("coords").split(",");if(t>=n[0]&&t<=n[2]&&b>=n[1]&&b<=n[3])return this.click(),!1})}})}h.length&&(h.css("display","inline-block"),!h.attr("href")||g.attr("data-magnify-src")||i.src||h.click(function(e){e.preventDefault()}))},error:function(){w=null}}),w.src=y}}(this)})}}(jQuery);