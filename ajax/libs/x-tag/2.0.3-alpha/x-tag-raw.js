!function(){var e=document.documentElement;Element.prototype.matches||(Element.prototype.matches=e.webkitMatchesSelector||e.msMatchesSelector||e.oMatchesSelector);var t=/([\w\-]+)|(::|:)(\w+)(?:\((.+?(?=\)))\))?/g,n=/,\s*/;document.createRange();var r={events:{},pseudos:{delegate:{onInvoke:function(e,t,n){for(var r,s=n.target,o=n.currentTarget;!r&&s&&s!=o;)s.tagName&&s.matches(t.args)&&(r=s),s=s.parentNode;if(!r&&o.tagName&&o.matches(t.args)&&(r=o),!r)return null;t.fn=t.fn.bind(r)}}},extensions:{rxn:{onParse:(e,t,n,r,s)=>(delete e.prototype[s],!1),onConstruct(e,t,n,r){e.rxn(t,r.value,!!n[1])}},attr:{mixin:e=>(class extends e{attributeChangedCallback(e,t,n){var r=this.constructor.getOptions("attributes")[e];r&&r.set&&!r._skip&&(r.set.call(this,n),r._skip=null)}}),types:{boolean:{set:function(e,t){t||""===t?this.setAttribute(e,""):this.removeAttribute(e)},get:function(e){return this.hasAttribute(e)}}},onParse(e,t,n,r,s){if(r.value)throw'Attribute accessor "'+t+'" was declared as a value, but must be declared as get or set';e.getOptions("attributes")[t]=r;var o=this.types[n[0]]||{};let i=r.set,a=o.set||HTMLElement.prototype.setAttribute;r.set=function(e){var n;r._skip||(r._skip=!0,i&&(n=i.call(this,e)),a.call(this,t,void 0===n?e:n),r._skip=null)};let c=r.get,l=o.get||HTMLElement.prototype.getAttribute;r.get=function(){var e,n=l.call(this,t);return c&&(e=c.call(this,n)),void 0===e?n:e},delete e.prototype[s]},onCompiled(e){e.observedAttributes=Object.keys(e.getOptions("attributes")).concat(e.observedAttributes||[])}},event:{onParse:(e,t,n,r,s)=>(delete e.prototype[s],!1),onConstruct(e,t,n,s){r.addEvent(e,t,s.value)}},template:{throttle:{frame:function(e,t,n){n.cancel=cancelAnimationFrame.bind(window,requestAnimationFrame(()=>{e._render(t,n)}))},debounce:function(e,t,n,r){n.cancel=clearTimeout.bind(window,setTimeout(()=>{node_.render(t,n)},r.throttle))}},mixin:e=>(class extends e{set"template::attr"(e){this.render(e)}get templates(){return this.constructor.getOptions("templates")}_render(e,t){this.innerHTML=e.call(this),this._XTagRender=null,t.resolve&&t.resolve(this)}render(e,t={}){var n=e||"default",s=this.templates[n];if(!s)throw new ReferenceError('Template "'+n+'" undefined for '+this.nodeName);var o=this._XTagRender;if(o){if(o.name===n)return o.promise;o.cancel&&o.cancel()}this.getAttribute("template")!=n&&this.setAttribute("template",n),o=this._XTagRender={name:n};var i=r.extensions.template.throttle,a=!!t.throttle&&(i[t.throttle]||i.debounce);return a?o.promise=new Promise(e=>{o.resolve=e,a(this,s,o,t)}):(this._render(s,o),Promise.resolve(this))}}),onParse:(e,t,n,r)=>(e.getOptions("templates")[t||"default"]=r.value,!1),onReady(e,t,n,r){r[0]&&("ready"===r[0]?e.render(n):e.rxn("firstpaint",()=>e.render(n))),t()}}},create(e,t){var n=t||e;return n.options=Object.assign({},n.options),a(n),t&&e&&customElements.define(e,n),n},register(e,t){customElements.define(e,t)},addEvents(e,t){let n={};for(let s in t)n[s]=r.addEvent(e,s,t[s]);return n},addEvent(e,s,o,a){var c,l=o,u={data:{},capture:a},p=e.constructor.getOptions("pseudos");s.replace(t,(t,s,o,a,d)=>{if(s)c=s;else{var f=p[f=o||d]||r.pseudos[f],m=a?a.split(n):[];l=i(f,m,l,u),f.onParse&&f.onParse(e,c,m,l,u)}}),e.addEventListener(c,l,a),u.type=c,u.listener=l;var d=e.constructor.getOptions("events")[c]||r.events[c];if(d){var f=function(e){new Promise((t,n)=>{d.onFilter(this,e,u,t,n)}).then(()=>{r.fireEvent(e.target,c)})};u.attached=d.attach.map(t=>r.addEvent(e,t,f,!0)),d.onAdd&&d.onAdd(e,u)}return u},removeEvents(e,t){for(let n in t)r.removeEvent(e,t[n])},removeEvent(e,t){e.removeEventListener(t.type,t.listener,t.capture);var n=e.constructor.getOptions("events")[t.type]||r.events[t.type];n&&n.onRemove&&n.onRemove(e,t),t.attached&&t.attached.forEach(n=>{r.removeEvent(e,t)})},fireEvent(e,t,n={}){let r=Object.assign({bubbles:!0,cancelable:!0},n);e.dispatchEvent(new CustomEvent(t,r))}},s=0;function o(e,t){var n=e.rxns[t],r=n.queue;for(let t in r)r[t].fn.call(e),!n.singleton&&r[t].recurring||delete r[t];n.fired=!0}function i(e,t,n,r){return function(){var s={fn:n,args:t,detail:r},o=e.onInvoke(this,s,...arguments);return null===o||!1===o?o:s.fn.apply(this,o instanceof Array?o:arguments)}}function a(e){var s={},o=function(e){var t={},n=e.prototype;return Object.getOwnPropertyNames(n).forEach(e=>{t[e]=Object.getOwnPropertyDescriptor(n,e)}),t}(e),a=e.getOptions("extensions"),c=e._processedExtensions=new Map;for(let l in o){let u,p,d,f=[],m=[],v=o[l],h=e._pseudos||r.pseudos;if(l.replace(t,function(){f.unshift(arguments)}),f.forEach(t=>(function(t,s,o,l,d){if(u=s||u,d)var f=d.split(n);if("::"==o)m=f||[],p=a[l]||r.extensions[l],c.get(p)||c.set(p,[]);else if(!s){let t=h[l];if(t)for(let n in v){let r=v[n];"function"==typeof r&&t.onInvoke&&(r=v[n]=i(t,f,r),t.onParse&&t.onParse(e,u,f,r))}}}).apply(null,t)),p&&(c.get(p).push([u,m,v]),p.onParse&&(d=p.onParse(e,u,m,v,l))),u){if(!1!==d){let e=s[u]||(s[u]={});for(let t in v)e[t]=v[t]}}else delete e.prototype[l]}for(let t of c.keys())t.onCompiled&&t.onCompiled(e,s);Object.defineProperties(e.prototype,s)}XTagElement=function e(t={}){var n;return(n=class extends(t.native?Object.getPrototypeOf(document.createElement(t.native)).constructor:HTMLElement){constructor(){super(),this.rxns||(this.rxns={ready:{queue:{},singleton:!0},firstpaint:{queue:{},singleton:!0},render:{queue:{}}}),function(e){var t=e.constructor._processedExtensions;for(let[n,r]of t)n.onConstruct&&r.forEach(t=>n.onConstruct(e,...t))}(this),new Promise(e=>(function(e,t){var n=e.constructor._processedExtensions;for(let[r,s]of n)r.onReady&&Promise.all(s.map(t=>new Promise(n=>r.onReady(e,n,...t)))).then(()=>t())})(this,e)).then(()=>o(this,"ready"))}connectedCallback(){!function(e){var t=e.constructor._processedExtensions;for(let[n,r]of t)n.onConnect&&r.forEach(t=>n.onConnect(e,...t))}(this),this.rxns.firstpaint.frame||(this.rxns.firstpaint.frame=requestAnimationFrame(()=>o(this,"firstpaint")))}rxn(e,t,n){var r=this.rxns[e];if(!r.singleton||!r.fired)return r.queue[s++]={fn:t,recurring:n},s;t.call(this)}cancelRxn(e,t){delete this.rxns[e].queue[t]}}).options={extensions:{},pseudos:{}},n.getOptions=function(e){return this.options[e]||(this.options[e]=Object.assign({},Object.getPrototypeOf(this).options?Object.getPrototypeOf(this).options[e]:{}))},n.extensions=function(...e){var t=this.getOptions("extensions");return e.reduce((e,n)=>{var s,o=e;return t[n.name]||("string"==typeof n?s=r.extensions[n].mixin:(s=n.mixin,t[n.name]=n),s&&a(o=s(e))),o},this)},n.as=function(t){return e({native:t})},n.extensions("attr","event","template")}(),"function"==typeof define&&define.amd?(define(r),define(XTagElement)):"undefined"!=typeof module&&module.exports?module.exports={xtag:r,XTagElement:XTagElement}:(window.xtag=r,window.XTagElement=XTagElement)}();