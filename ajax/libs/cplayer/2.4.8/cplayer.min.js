"use strict";function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function cLyric(t){var e=0,i=[];return t.replace(/\n+/gi,"\n").split("\n").forEach(function(t){if(-1!==t.indexOf("offset")&&(e=parseInt(/offset\:(\d+)/gi.exec(t)[1])),/\[\d+:[\d\.]+\]/gi.test(t)){var n=[];[].forEach.call(t.match(/\[\d+\:[\.\d]+\]/gi),function(t){var i=/\[(\d+)\:([\.\d]+)\]/gi.exec(t);n.push(60*parseInt(i[1])+parseFloat(i[2]-.001*e))}),n.push(/(?:\[\d+\:[\.\d]+\])*(.*)/gi.exec(t)[1]);do{i.push({time:n.shift(),content:n[n.length-1]})}while(n.length>=2)}}),i.sort(function(t,e){return t.time-e.time})}var _createClass=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),cPlayer=function(){function t(e){function i(t){var e=[];if(Object.defineProperties(e,{0:{get:function(){return t.target===r.__LIST__.timePoint||t.target===r.__LIST__.volumePoint}},1:{get:function(){return t.target===r.__LIST__.timeLine||t.target===r.__LIST__.volumeLine}},2:{get:function(){return t.target===r.__LIST__.timePoint||t.target===r.__LIST__.volumePoint||t.target===r.__LIST__.timeBody||t.target===r.__LIST__.volumeBody||t.target===r.__LIST__.timeLine||t.target===r.__LIST__.volumeLine}}}),e[2]){r.dragging.contain=!0,r.dragging.target=t.target;var i=function(t){if(!1!==r.dragging.contain&&e[0]){if(parent=r.dragging.target.parentNode.parentNode,parent.classList&&parent.classList.contains("volume-body")?r.__LIST__.volumeLine.style.width=(t.clientX-parent.getBoundingClientRect().left)/parent.offsetWidth*100+"%":parent.classList&&parent.classList.contains("time-body")&&(r.__LIST__.timeLine.style.width=(t.clientX-parent.getBoundingClientRect().left)/parent.offsetWidth*100+"%"),parent.classList.contains("volume-body")){var i=(t.clientX-parent.getBoundingClientRect().left)/parent.offsetWidth;i=(i=i>1?1:i)<0?0:i,r.music.volume=i}window.addEventListener("mouseup",n,{once:!0})}},n=function(t){if(window.removeEventListener("mousemove",i),!1!==r.dragging.contain){if(e[0])parent=r.dragging.target.parentNode.parentNode;else if(e[1])parent=r.dragging.target.parentNode;else{if(!e[2])throw new Error(JSON.stringify([r.dragging.target,e]));parent=r.dragging.target}if(parent.classList.contains("volume-body")){var n=(t.clientX-parent.getBoundingClientRect().left)/parent.offsetWidth;n=(n=n>1?1:n)<0?0:n,r.music.volume=n}else if(parent.classList.contains("time-body")){var s=(t.clientX-parent.getBoundingClientRect().left)/parent.offsetWidth;s=(s=s>1?1:s)<0?0:s,r.updateTime(s*r.music.duration)}r.dragging.contain=!1,r.dragging.target=void 0}};window.addEventListener("mousemove",i),window.addEventListener("click",n,{once:!0})}}var n=this;_classCallCheck(this,t),this.transLock=!1;var s={play:[],pause:[],volumechange:[],timeupdate:[],canplaythrough:[],ended:[],toggle:[],previous:[],next:[],changeList:[],changeLyric:[],slideList:[],slideLyric:[],clickLyricPower:[],clickListPower:[],clickVolumePower:[]};this.emitter=new cEmitter(s),this.on=function(t,e){return n.emitter.on(t,e)};var o={element:document.getElementById("cplayer"),list:[]};void 0!==Object.assign&&(this.options=Object.assign({},o,e)),this.SVG={playArrow:"M16 10v28l22-14z",pause:"M12 38h8V10h-8v28zm16-28v28h8V10h-8z",playlistPlay:"M26 6H-8v4h34V6zm0-8H-8v4h34v-4zM-8 18h26v-4H-8v4zm30-4v12l10-6-10-6z",note:"M44 20L32 8H8c-2.2 0-4 1.8-4 4v24.02C4 38.22 5.8 40 8 40l32-.02c2.2 0 4-1.78 4-3.98V20zm-14-9l11 11H30V11z",volumeUp:"M6 18v12h8l10 10V8L14 18H6zm27 6c0-3.53-2.04-6.58-5-8.05v16.11c2.96-1.48 5-4.53 5-8.06zM28 6.46v4.13c5.78 1.72 10 7.07 10 13.41s-4.22 11.69-10 13.41v4.13c8.01-1.82 14-8.97 14-17.54S36.01 8.28 28 6.46z",volumeMute:"M14 18v12h8l10 10V8L22 18h-8z",volumeOff:"M33 24c0-3.53-2.04-6.58-5-8.05v4.42l4.91 4.91c.06-.42.09-.85.09-1.28zm5 0c0 1.88-.41 3.65-1.08 5.28l3.03 3.03C41.25 29.82 42 27 42 24c0-8.56-5.99-15.72-14-17.54v4.13c5.78 1.72 10 7.07 10 13.41zM8.55 6L6 8.55 15.45 18H6v12h8l10 10V26.55l8.51 8.51c-1.34 1.03-2.85 1.86-4.51 2.36v4.13c2.75-.63 5.26-1.89 7.37-3.62L39.45 42 42 39.45l-18-18L8.55 6zM24 8l-4.18 4.18L24 16.36V8z",volumeDown:"M37 24c0-3.53-2.04-6.58-5-8.05v16.11c2.96-1.48 5-4.53 5-8.06zm-27-6v12h8l10 10V8L18 18h-8z"},function(){for(var t=0,e=Object.keys(n.SVG),i=e.length;t<i;t++){var s="playlistPlay"===e[t]?'<svg xmlns="http://www.w3.org/2000/svg" width="100%" height="100%" viewBox="-12 -12 48 48" enable-background="new -12 -12 48 48"><path d="'+n.SVG[e[t]]+'"/></svg>':'<svg xmlns="http://www.w3.org/2000/svg" width="100%" height="100%" viewBox="0 0 48 48"><path d="'+n.SVG[e[t]]+'"/></svg>';n.SVG[e[t]]=s}}(),this.CBASE=new cBase,this.now=0,this.dragging={contain:!1,target:void 0},this.options.element.innerHTML='<c-player><div class="lyric invisible"><lyric-body></lyric-body></div><div class="controls"><div class="c-left"><div class="music-description"><div class="image"><img class="meta-bak"></div><div class="music-meta"><div><span class="music-name"></span><span class="music-artist"></span></div></div></div><a class="play-icon"><svg xmlns="http://www.w3.org/2000/svg" width="100%" height="100%" viewBox="0 0 48 48"><path d="M16 10v28l22-14z"></path></svg></a></div><div class="c-center"><div class="time"><div class="time-body"><div class="time-line"><div class="time-point"></div></div></div></div></div><div class="c-right"><div class="volume"><div class="volume-button"><a class="volume-power"><svg xmlns="http://www.w3.org/2000/svg" width="100%" height="100%" viewBox="0 0 48 48"><path d="M33 24c0-3.53-2.04-6.58-5-8.05v4.42l4.91 4.91c.06-.42.09-.85.09-1.28zm5 0c0 1.88-.41 3.65-1.08 5.28l3.03 3.03C41.25 29.82 42 27 42 24c0-8.56-5.99-15.72-14-17.54v4.13c5.78 1.72 10 7.07 10 13.41zM8.55 6L6 8.55 15.45 18H6v12h8l10 10V26.55l8.51 8.51c-1.34 1.03-2.85 1.86-4.51 2.36v4.13c2.75-.63 5.26-1.89 7.37-3.62L39.45 42 42 39.45l-18-18L8.55 6zM24 8l-4.18 4.18L24 16.36V8z"></path></svg></a></div><div class="volume-body"><div class="volume-line"><div class="volume-point"></div></div></div></div><div class="list-button"><a class="list-power"><svg xmlns="http://www.w3.org/2000/svg" width="100%" height="100%" viewBox="-12 -12 48 48" enable-background="new -12 -12 48 48"><path d="M26 6H-8v4h34V6zm0-8H-8v4h34v-4zM-8 18h26v-4H-8v4zm30-4v12l10-6-10-6z"></path></svg></a></div><div class="lyric-button"><a class="lyric-power"><svg xmlns="http://www.w3.org/2000/svg" width="100%" height="100%" viewBox="0 0 48 48"><path d="M44 20L32 8H8c-2.2 0-4 1.8-4 4v24.02C4 38.22 5.8 40 8 40l32-.02c2.2 0 4-1.78 4-3.98V20zm-14-9l11 11H30V11z"></path></svg></a></div></div></div><div class="list invisible"><list-body></list-body></div></c-player>',this.CBASE.root=this.options.element.getElementsByTagName("c-player"),this.CBASE.root=this.CBASE.root[this.CBASE.root.length-1],this.__LIST__={lyric:this.CBASE.getByClass("lyric"),lyricBody:this.CBASE.getByTagName("lyric-body"),toggle:this.CBASE.getByClass("play-icon"),img:this.CBASE.getByClass("meta-bak"),name:this.CBASE.getByClass("music-name"),artist:this.CBASE.getByClass("music-artist"),time:this.CBASE.getByClass("time"),timeBody:this.CBASE.getByClass("time-body"),timeLine:this.CBASE.getByClass("time-line"),timePoint:this.CBASE.getByClass("time-point"),lyricPower:this.CBASE.getByClass("lyric-power"),volumePower:this.CBASE.getByClass("volume-power"),volumeBody:this.CBASE.getByClass("volume-body"),volumeLine:this.CBASE.getByClass("volume-line"),volumePoint:this.CBASE.getByClass("volume-point"),listPower:this.CBASE.getByClass("list-power"),list:this.CBASE.getByClass("list"),listBody:this.CBASE.getByTagName("list-body")},this.__LIST__.toggle.focus(),this.__LIST__.toggleIcon=this.CBASE.getByTagName("svg",this.__LIST__.toggle),this.__LIST__.volumeIcon=this.CBASE.getByTagName("svg",this.__LIST__.volumePower);var r=this;this.music=document.createElement("audio"),this.music.autoplay=!!this.options.autoplay,this.music.preload="metadata",this.emitter.on("toggle",function(){n.isPaused()?n.play():n.pause()}).on("clickLyricPower",function(){n.hasLyric(n.now)&&n.__LIST__.lyric.classList.contains("invisible")?n.showLyric():n.hasLyric(n.now)&&!n.__LIST__.lyric.classList.contains("invisible")&&n.hideLyric()}).on("clickListPower",function(){n.hasList()&&n.__LIST__.list.classList.contains("invisible")?n.showList():n.hasList()&&!n.__LIST__.list.classList.contains("invisible")&&n.hideList()}).on("clickVolumePower",function(){n.isMuted()?n.music.muted=!1:n.volume(0)}).on("timeupdate",function(){n.updateTime(),n.hasLyric(n.now)&&n.slideLyric(n.music.currentTime)}).on("volumechange",function(){n.volume()}).on("pause",function(){n.CBASE.replaceInner(n.__LIST__.toggle,n.SVG.playArrow)}).on("play",function(){n.CBASE.replaceInner(n.__LIST__.toggle,n.SVG.pause),n.__LIST__.toggleIcon=n.CBASE.getByTagName("svg",n.__LIST__.toggle)}).on("ended",function(){n.CBASE.style(n.__LIST__.lyricBody,"transform",""),!0===n.options.list[n.now].loop?(n.updateTime(0),n.play()):n.hasList()&&n.now!==n.options.list.length-1&&n.next()}),new cContext({element:this.options.element,items:[{name:"上一曲",action:function(){return n.previous()}},{name:"下一曲",action:function(){return n.next()}},{name:"翻译",action:function(){return n.translate()}}]}),this.options.list[0]&&this.toggle(),this.__LIST__.toggle.addEventListener("click",function(){return n.emitter.emit("toggle")}),this.__LIST__.lyricPower.addEventListener("click",function(){return n.emitter.emit("clickLyricPower")}),this.__LIST__.listPower.addEventListener("click",function(){return n.emitter.emit("clickListPower")}),this.__LIST__.volumePower.addEventListener("click",function(){return n.emitter.emit("clickVolumePower")}),this.music.addEventListener("volumechange",function(t){return n.emitter.emit("volumechange",t)}),this.music.addEventListener("timeupdate",function(t){return n.emitter.emit("timeupdate",t)}),this.music.addEventListener("canplaythrough",function(){return n.emitter.emit("canplaythrough")}),this.music.addEventListener("pause",function(){return n.emitter.emit("pause")}),this.music.addEventListener("play",function(){return n.emitter.emit("play")}),this.music.addEventListener("ended",function(){return n.emitter.emit("ended")}),this.options.element.addEventListener("mousedown",function(t){return i(t)}),this.volume(),this.refreshList()}return _createClass(t,[{key:"volume",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:void 0,i=function(){0===t.music.volume||t.isMuted()?t.CBASE.replaceInner(t.__LIST__.volumePower,t.SVG.volumeOff):t.music.volume>0&&t.music.volume<=.5?t.CBASE.replaceInner(t.__LIST__.volumePower,t.SVG.volumeDown):t.music.volume>.5&&t.music.volume<=1?t.CBASE.replaceInner(t.__LIST__.volumePower,t.SVG.volumeUp):console.log("Unexcepted Volume: "+t.music.volume)};if(void 0===e)return this.__LIST__.volumeLine.style.width=100*this.music.volume+"%",i(),this.isMuted()?0:this.music.volume;0===e?(this.music.muted=!0,i()):(this.music.volume=e,i())}},{key:"isMuted",value:function(){return this.music.muted}},{key:"play",value:function(){return!0===this.music.seeking?this:(this.music.play(),this)}},{key:"pause",value:function(){if(!0!==this.music.seeking)return this.music.pause(),this}},{key:"previous",value:function(){if(this.emitter.emit("previous"),0!==this.now)return this.now--,this.toggle().play(),this}},{key:"next",value:function(){if(this.emitter.emit("next"),this.now!==this.options.list.length-1)return this.now++,this.toggle().play(),this}},{key:"to",value:function(t){return this.now=t,this.toggle(),this.play(),this}},{key:"toggle",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.now,e=this.options.list[t],i=this.__LIST__;this.music.pause();var n=[e.image,e.name,e.artist,e.url];return i.img.src=n[0],i.name.innerHTML=n[1],i.artist.innerHTML=n[2],this.music.src=n[3],this.transLock=!1,this.refreshLyric(),this.hasLyric(this.now)||this.hideLyric(),this.CBASE.style(this.__LIST__.lyricBody,"transform",""),this}},{key:"isPaused",value:function(t){return void 0!==t&&t(),this.music.paused}},{key:"hasLyric",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments[1];return void 0!==e&&e(),void 0!=this.options.list[t].lyric}},{key:"showLyric",value:function(){return this.emitter.emit("slideLyric",!0),this.hasLyric(this.now)&&this.__LIST__.lyric.classList.remove("invisible"),this.__LIST__.list.classList.contains("invisible")||this.hideList(),this}},{key:"hideLyric",value:function(){return this.emitter.emit("slideLyric",!1),this.__LIST__.lyric.classList.add("invisible"),this}},{key:"hasList",value:function(t){return void 0!==t&&t(),this.options.list.length>1}},{key:"showList",value:function(t){return this.emitter.emit("slideList",!0),this.__LIST__.list.classList.remove("invisible"),this.__LIST__.lyric.classList.contains("invisible")||this.hideLyric(),void 0!==t&&t(),this}},{key:"hideList",value:function(t){return this.emitter.emit("slideList",!1),this.__LIST__.list.classList.add("invisible"),void 0!==t&&t(),this}},{key:"refreshList",value:function(t){var e=this;this.emitter.emit("changeList");var i=this.options.list,n=this.__LIST__.listBody;n.innerHTML="";for(var s=0;s<=i.length-1;s++)!function(t){var s=document.createElement("div");s.innerHTML='<span class="music-name">'+i[t].name+'</span><span class="music-artist">'+i[t].artist+"</span>",(s=n.appendChild(s)).addEventListener("click",function(){e.to(t)})}(s);void 0!==t&&t()}},{key:"add",value:function(t,e){var i=this,n=this.options.list.push(t),s=document.createElement("div");s.innerHTML='<span class="music-name">'+t.name+'</span><span class="music-artist">'+t.artist+"</span>",(s=this.__LIST__.listBody.appendChild(s)).addEventListener("click",function(){i.to(n-1)}),1===n&&this.toggle(),void 0!==e&&e()}},{key:"lyric",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:void 0;if(void 0===t){if(this.hasLyric(this.now))return this.options.list[this.now].lyric}else this.options.list[this.now].lyric=t,this.refreshLyric();return this}},{key:"refreshLyric",value:function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this.__LIST__.lyricBody.innerHTML="",this.hasLyric(this.now)){var e=cLyric(!1!==t?this.options.list[this.now].transLyric:this.options.list[this.now].lyric);e.now=0,this.__LYRIC__=e;for(var i=0;i<=e.length-1;i++){var n=document.createElement("lrc");n.innerHTML=e[i].content,this.__LIST__.lyricBody.appendChild(n)}this.emitter.emit("changeLyric")}}},{key:"updateTime",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:void 0,e=arguments[1];void 0!==t&&(this.music.currentTime=t),!1===this.dragging.contain&&(this.__LIST__.timeLine.style.width=this.music.currentTime/this.music.duration*100+"%"),void 0!==e&&e(this.music.currentTime)}},{key:"slideLyric",value:function(t){if(!this.__LIST__.lyric.classList.contains("invisible")){var e=void 0,i=this.__LIST__.lyricBody,n=this.__LIST__.lyricBody.getElementsByTagName("lrc"),s=function(){for(var t=a.length-1;t>=0;t--)a[t]!==n[r]&&a[t].classList.remove("now")},o=this.CBASE.find(this.__LYRIC__,function(e){return e.time<t}).reverse()[0],r=this.__LYRIC__.indexOf(o);r<0&&(this.CBASE.style(i,"transform",""),s()),this.__LYRIC__.now!==r&&(this.__LYRIC__.now=r),n[r].classList.add("now"),e=-(i.childNodes[r].offsetTop-i.childNodes[0].offsetTop-.5*i.childNodes[r].clientHeight-(.5*this.__LIST__.lyric.clientHeight-i.childNodes[r].clientHeight)),this.CBASE.style(i,"transform","translateY("+e+"px)");var a=this.__LIST__.lyricBody.getElementsByClassName("now");a.length>1&&s()}}},{key:"translate",value:function(){if(!this.options.list[this.now].transLyric||!this.hasLyric(this.now))return!1;this.transLock=!this.transLock,this.refreshLyric(this.transLock)}},{key:"length",get:function(){return this.options.list.length},set:function(t){throw new SyntaxError("Read-only Property.")}}]),t}();"function"!=typeof Object.assign&&(Object.assign=function(t){if(null==t)throw new TypeError("Cannot convert undefined or null to object");t=Object(t);for(var e=1;e<arguments.length;e++){var i=arguments[e];if(null!=i)for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(t[n]=i[n])}return t});var cEmitter=function(){function t(e){_classCallCheck(this,t),this.events=e||[]}return _createClass(t,[{key:"on",value:function(t,e){if(this.events[t]&&void 0!==this.events[t].push&&"function"==typeof e)this.events[t].push(e);else{if(void 0!==this.events[t]&&void 0!==this.events[t].push)throw new TypeError("Uncaught Unexcepted TypeError.");this.events[t]=[]}return this}},{key:"emit",value:function(t){for(var e=arguments.length,i=Array(e>1?e-1:0),n=1;n<e;n++)i[n-1]=arguments[n];for(var s=0;s<this.events[t].length;s++)this.events[t][s](i);return this}}]),t}(),cBase=function(){function t(){var e=this,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:document.documentElement;_classCallCheck(this,t),this.root=i;for(var n=document.documentElement.style,s=n.length;s>0&&"break"!==function(t,i){if(["-webkit-","-moz-","-o-","-ms-"].forEach(function(n){-1!==t[i].indexOf(n)&&(e.browser=n.replace("-",""))}),e.browser)return"break"}(n,s);s--);}return _createClass(t,[{key:"replace",value:function(t,e){e=e.cloneNode(!0),t.parentNode.appendChild(e),t.parentNode.removeChild(t)}},{key:"replaceInner",value:function(t,e){t.innerHTML=e}},{key:"getByClass",value:function(t,e){return void 0!=e?e.getElementsByClassName(t)[0]:this.root.getElementsByClassName(t)[0]}},{key:"getByTagName",value:function(t,e){return void 0!=e?e.getElementsByTagName(t)[0]:this.root.getElementsByTagName(t)[0]}},{key:"rand",value:function(t,e){if(!t||!e)return Math.random();if(t>e)throw new RangeError("the EndNumber must be bigger than the StartNumber");return(e-t)*Math.random()+t}},{key:"find",value:function(t,e){var i=[];return t.forEach(function(t){e(t)&&i.push(t)}),i}},{key:"style",value:function(t,e,i){t.style[this.browser+e.slice(0,1).toUpperCase()+e.slice(1)]=i,t.style[e]=i}}]),t}(),cContext=function(){function t(e){var i=this;if(_classCallCheck(this,t),!e.element)throw new Error("Need a element to bind.");return this.options=e,this.options.element.oncontextmenu=function(){return!1},this.options.element.addEventListener("contextmenu",function(t){return i.hide(),i.show(t),!1}),document.documentElement.addEventListener("click",function(){return i.hide()}),this}return _createClass(t,[{key:"add",value:function(t){var e=t.name,i=t.action;return this.options.items.push({name:e,action:i}),this}},{key:"show",value:function(t){var e=t.pageX,i=t.pageY,n=document.createElement("div");n.classList.add("c-context");for(var s=this.options.items,o=0;o<s.length;o++)n.appendChild(document.createElement("div")),n.children[o].classList.add("c-context--list"),n.children[o].innerHTML=s[o].name,n.children[o].addEventListener("click",s[o].action);return document.body.appendChild(n),document.documentElement.clientWidth>n.offsetWidth?n.style.left=document.documentElement.clientWidth>n.offsetWidth+e?e+"px":e-n.offsetWidth+"px":n.style.width=document.documentElement.clientWidth+"px",document.documentElement.clientHeight>n.offsetHeight&&(n.style.top=document.documentElement.clientHeight>n.offsetHeight+i?i+"px":i-n.offsetHeight+"px"),n.style.visibility="visible",this}},{key:"hide",value:function(){for(var t=document.getElementsByClassName("c-context"),e=t.length-1;e>=0;e--)document.body.removeChild(t[e]);return this}},{key:"items",get:function(){return this.options.items},set:function(t){return this.options.items=t,this.options.items}}]),t}();window&&(window.cPlayer=cPlayer),console.log("\n%ccPlayer%cv2.4.7%c\n\n","padding:7px;background:#cd3e45;font-family:'Sitka Heading';font-weight:bold;font-size:large;color:white","padding:7px;background:#ff5450;font-family:'Sitka Text';font-size:large;color:#eee","");