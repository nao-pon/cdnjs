{"version":3,"file":"esri-leaflet-geocoder.js","sources":["../package.json","../src/Tasks/ReverseGeocode.js","../src/Tasks/Suggest.js","../src/Services/Geocode.js","../src/Classes/GeosearchCore.js","../src/Providers/ArcgisOnlineGeocoder.js","../src/Controls/Geosearch.js","../src/Providers/FeatureLayer.js","../src/Providers/MapService.js","../src/Providers/GeocodeService.js","../src/EsriLeafletGeocoding.js","../src/Tasks/Geocode.js","../src/EsriLeafletGeocoding.js"],"sourcesContent":["{\n  \"name\": \"esri-leaflet-geocoder\",\n  \"description\": \"Esri Geocoding utility and search plugin for Leaflet.\",\n  \"version\": \"2.2.7\",\n  \"author\": \"Patrick Arlt <parlt@esri.com> (http://patrickarlt.com)\",\n  \"contributors\": [\n    \"Patrick Arlt <parlt@esri.com> (http://patrickarlt.com)\",\n    \"John Gravois <jgravois@esri.com> (http://johngravois.com)\"\n  ],\n  \"dependencies\": {\n    \"esri-leaflet\": \"^2.0.3\",\n    \"leaflet\": \"^1.0.0\"\n  },\n  \"devDependencies\": {\n    \"chai\": \"3.5.0\",\n    \"gh-release\": \"^2.0.0\",\n    \"http-server\": \"^0.8.5\",\n    \"imagemin\": \"^3.2.0\",\n    \"isparta\": \"^4.0.0\",\n    \"istanbul\": \"^0.4.2\",\n    \"karma\": \"^1.3.0\",\n    \"karma-chai-sinon\": \"^0.1.3\",\n    \"karma-coverage\": \"^1.1.1\",\n    \"karma-mocha\": \"^1.3.0\",\n    \"karma-mocha-reporter\": \"^2.2.1\",\n    \"karma-phantomjs-launcher\": \"^0.2.0\",\n    \"karma-sourcemap-loader\": \"^0.3.5\",\n    \"mkdirp\": \"^0.5.1\",\n    \"mocha\": \"^3.1.0\",\n    \"node-sass\": \"^3.2.0\",\n    \"parallelshell\": \"^2.0.0\",\n    \"phantomjs\": \"^1.9.8\",\n    \"rollup\": \"^0.25.4\",\n    \"rollup-plugin-json\": \"^2.0.0\",\n    \"rollup-plugin-node-resolve\": \"^1.4.0\",\n    \"rollup-plugin-uglify\": \"^0.3.1\",\n    \"semistandard\": \"^9.0.0\",\n    \"sinon\": \"^1.11.1\",\n    \"sinon-chai\": \"2.8.0\",\n    \"snazzy\": \"^5.0.0\",\n    \"uglify-js\": \"^2.6.1\",\n    \"watch\": \"^0.17.1\"\n  },\n  \"homepage\": \"https://github.com/Esri/esri-leaflet-geocoder\",\n  \"jsnext:main\": \"src/EsriLeafletGeocoding.js\",\n  \"jspm\": {\n    \"registry\": \"npm\",\n    \"format\": \"es6\",\n    \"main\": \"src/EsriLeafletGeocoding.js\"\n  },\n  \"license\": \"Apache-2.0\",\n  \"main\": \"dist/esri-leaflet-geocoder-debug.js\",\n  \"browser\": \"dist/esri-leaflet-geocoder-debug.js\",\n  \"readmeFilename\": \"README.md\",\n  \"repository\": {\n    \"type\": \"git\",\n    \"url\": \"git@github.com:Esri/esri-leaflet-geocoder.git\"\n  },\n  \"scripts\": {\n    \"prebuild\": \"mkdirp dist\",\n    \"build\": \"rollup -c profiles/debug.js & rollup -c profiles/production.js & npm run css & npm run img\",\n    \"css\": \"node-sass ./src/esri-leaflet-geocoder.css ./dist/esri-leaflet-geocoder.css --output-style compressed\",\n    \"img\": \"imagemin ./src/img ./dist/img\",\n    \"lint\": \"semistandard | snazzy\",\n    \"prepublish\": \"npm run build\",\n    \"pretest\": \"npm run build\",\n    \"release\": \"./scripts/release.sh\",\n    \"start-watch\": \"watch \\\"npm run build\\\" src\",\n    \"start\": \"parallelshell \\\"npm run start-watch\\\" \\\"http-server -p 5678 -c-1 -o\\\"\",\n    \"test\": \"npm run lint && karma start\"\n  },\n  \"semistandard\": {\n    \"globals\": [\n      \"expect\",\n      \"L\",\n      \"XMLHttpRequest\",\n      \"sinon\",\n      \"xhr\"\n    ]\n  },\n  \"style\": \"./dist/esri-leaflet-geocoder.css\"\n}\n","import L from 'leaflet';\r\nimport { Task } from 'esri-leaflet';\r\nimport { WorldGeocodingServiceUrl } from '../EsriLeafletGeocoding';\r\n\r\nexport var ReverseGeocode = Task.extend({\r\n  path: 'reverseGeocode',\r\n\r\n  params: {\r\n    outSR: 4326,\r\n    returnIntersection: false\r\n  },\r\n\r\n  setters: {\r\n    'distance': 'distance',\r\n    'language': 'langCode',\r\n    'intersection': 'returnIntersection'\r\n  },\r\n\r\n  initialize: function (options) {\r\n    options = options || {};\r\n    options.url = options.url || WorldGeocodingServiceUrl;\r\n    Task.prototype.initialize.call(this, options);\r\n  },\r\n\r\n  latlng: function (latlng) {\r\n    latlng = L.latLng(latlng);\r\n    this.params.location = latlng.lng + ',' + latlng.lat;\r\n    return this;\r\n  },\r\n\r\n  run: function (callback, context) {\r\n    return this.request(function (error, response) {\r\n      var result;\r\n\r\n      if (!error) {\r\n        result = {\r\n          latlng: L.latLng(response.location.y, response.location.x),\r\n          address: response.address\r\n        };\r\n      } else {\r\n        result = undefined;\r\n      }\r\n\r\n      callback.call(context, error, result, response);\r\n    }, this);\r\n  }\r\n});\r\n\r\nexport function reverseGeocode (options) {\r\n  return new ReverseGeocode(options);\r\n}\r\n\r\nexport default reverseGeocode;\r\n","import L from 'leaflet';\r\nimport { Task, Util } from 'esri-leaflet';\r\nimport { WorldGeocodingServiceUrl } from '../EsriLeafletGeocoding';\r\n\r\nexport var Suggest = Task.extend({\r\n  path: 'suggest',\r\n\r\n  params: {},\r\n\r\n  setters: {\r\n    text: 'text',\r\n    category: 'category',\r\n    countries: 'countryCode',\r\n    maxSuggestions: 'maxSuggestions'\r\n  },\r\n\r\n  initialize: function (options) {\r\n    options = options || {};\r\n    if (!options.url) {\r\n      options.url = WorldGeocodingServiceUrl;\r\n      options.supportsSuggest = true;\r\n    }\r\n    Task.prototype.initialize.call(this, options);\r\n  },\r\n\r\n  within: function (bounds) {\r\n    bounds = L.latLngBounds(bounds);\r\n    bounds = bounds.pad(0.5);\r\n    var center = bounds.getCenter();\r\n    var ne = bounds.getNorthWest();\r\n    this.params.location = center.lng + ',' + center.lat;\r\n    this.params.distance = Math.min(Math.max(center.distanceTo(ne), 2000), 50000);\r\n    this.params.searchExtent = Util.boundsToExtent(bounds);\r\n    return this;\r\n  },\r\n\r\n  nearby: function (latlng, radius) {\r\n    latlng = L.latLng(latlng);\r\n    this.params.location = latlng.lng + ',' + latlng.lat;\r\n    this.params.distance = Math.min(Math.max(radius, 2000), 50000);\r\n    return this;\r\n  },\r\n\r\n  run: function (callback, context) {\r\n    if (this.options.supportsSuggest) {\r\n      return this.request(function (error, response) {\r\n        callback.call(context, error, response, response);\r\n      }, this);\r\n    } else {\r\n      console.warn('this geocoding service does not support asking for suggestions');\r\n    }\r\n  }\r\n\r\n});\r\n\r\nexport function suggest (options) {\r\n  return new Suggest(options);\r\n}\r\n\r\nexport default suggest;\r\n","import { Service } from 'esri-leaflet';\r\nimport { WorldGeocodingServiceUrl } from '../EsriLeafletGeocoding';\r\nimport geocode from '../Tasks/Geocode';\r\nimport reverseGeocode from '../Tasks/ReverseGeocode';\r\nimport suggest from '../Tasks/Suggest';\r\n\r\nexport var GeocodeService = Service.extend({\r\n  initialize: function (options) {\r\n    options = options || {};\r\n    if (options.url) {\r\n      Service.prototype.initialize.call(this, options);\r\n      this._confirmSuggestSupport();\r\n    } else {\r\n      options.url = WorldGeocodingServiceUrl;\r\n      options.supportsSuggest = true;\r\n      Service.prototype.initialize.call(this, options);\r\n    }\r\n  },\r\n\r\n  geocode: function () {\r\n    return geocode(this);\r\n  },\r\n\r\n  reverse: function () {\r\n    return reverseGeocode(this);\r\n  },\r\n\r\n  suggest: function () {\r\n    // requires either the Esri World Geocoding Service or a <10.3 ArcGIS Server Geocoding Service that supports suggest.\r\n    return suggest(this);\r\n  },\r\n\r\n  _confirmSuggestSupport: function () {\r\n    this.metadata(function (error, response) {\r\n      if (error) { return; }\r\n      // pre 10.3 geocoding services dont list capabilities (and dont support maxLocations)\r\n      // only SOME individual services have been configured to support asking for suggestions\r\n      if (!response.capabilities) {\r\n        this.options.supportsSuggest = false;\r\n      } else if (response.capabilities.indexOf('Suggest') > -1) {\r\n        this.options.supportsSuggest = true;\r\n      } else {\r\n        this.options.supportsSuggest = false;\r\n      }\r\n      // whether the service supports suggest or not, utilize the metadata response to determine the appropriate parameter name for single line geocoding requests\r\n      this.options.customParam = response.singleLineAddressField.name;\r\n    }, this);\r\n  }\r\n});\r\n\r\nexport function geocodeService (options) {\r\n  return new GeocodeService(options);\r\n}\r\n\r\nexport default geocodeService;\r\n","import L from 'leaflet';\r\n\r\nexport var GeosearchCore = L.Evented.extend({\r\n\r\n  options: {\r\n    zoomToResult: true,\r\n    useMapBounds: 12,\r\n    searchBounds: null\r\n  },\r\n\r\n  initialize: function (control, options) {\r\n    L.Util.setOptions(this, options);\r\n    this._control = control;\r\n\r\n    if (!options || !options.providers || !options.providers.length) {\r\n      throw new Error('You must specify at least one provider');\r\n    }\r\n\r\n    this._providers = options.providers;\r\n  },\r\n\r\n  _geocode: function (text, key, provider) {\r\n    var activeRequests = 0;\r\n    var allResults = [];\r\n    var bounds;\r\n\r\n    var callback = L.Util.bind(function (error, results) {\r\n      activeRequests--;\r\n      if (error) {\r\n        return;\r\n      }\r\n\r\n      if (results) {\r\n        allResults = allResults.concat(results);\r\n      }\r\n\r\n      if (activeRequests <= 0) {\r\n        bounds = this._boundsFromResults(allResults);\r\n\r\n        this.fire('results', {\r\n          results: allResults,\r\n          bounds: bounds,\r\n          latlng: (bounds) ? bounds.getCenter() : undefined,\r\n          text: text\r\n        }, true);\r\n\r\n        if (this.options.zoomToResult && bounds) {\r\n          this._control._map.fitBounds(bounds);\r\n        }\r\n\r\n        this.fire('load');\r\n      }\r\n    }, this);\r\n\r\n    if (key) {\r\n      activeRequests++;\r\n      provider.results(text, key, this._searchBounds(), callback);\r\n    } else {\r\n      for (var i = 0; i < this._providers.length; i++) {\r\n        activeRequests++;\r\n        this._providers[i].results(text, key, this._searchBounds(), callback);\r\n      }\r\n    }\r\n  },\r\n\r\n  _suggest: function (text) {\r\n    var activeRequests = this._providers.length;\r\n\r\n    var createCallback = L.Util.bind(function (text, provider) {\r\n      return L.Util.bind(function (error, suggestions) {\r\n        if (error) { return; }\r\n\r\n        var i;\r\n\r\n        activeRequests = activeRequests - 1;\r\n\r\n        if (text.length < 2) {\r\n          this._suggestions.innerHTML = '';\r\n          this._suggestions.style.display = 'none';\r\n          return;\r\n        }\r\n\r\n        if (suggestions.length) {\r\n          for (i = 0; i < suggestions.length; i++) {\r\n            suggestions[i].provider = provider;\r\n          }\r\n        } else {\r\n          // we still need to update the UI\r\n          this._control._renderSuggestions(suggestions);\r\n        }\r\n\r\n        if (provider._lastRender !== text && provider.nodes) {\r\n          for (i = 0; i < provider.nodes.length; i++) {\r\n            if (provider.nodes[i].parentElement) {\r\n              this._control._suggestions.removeChild(provider.nodes[i]);\r\n            }\r\n          }\r\n\r\n          provider.nodes = [];\r\n        }\r\n\r\n        if (suggestions.length && this._control._input.value === text) {\r\n          this._control.clearSuggestions(provider.nodes);\r\n\r\n          provider._lastRender = text;\r\n          provider.nodes = this._control._renderSuggestions(suggestions);\r\n          this._control._nodes = [];\r\n        }\r\n      }, this);\r\n    }, this);\r\n\r\n    this._pendingSuggestions = [];\r\n\r\n    for (var i = 0; i < this._providers.length; i++) {\r\n      var provider = this._providers[i];\r\n      var request = provider.suggestions(text, this._searchBounds(), createCallback(text, provider));\r\n      this._pendingSuggestions.push(request);\r\n    }\r\n  },\r\n\r\n  _searchBounds: function () {\r\n    if (this.options.searchBounds !== null) {\r\n      return this.options.searchBounds;\r\n    }\r\n\r\n    if (this.options.useMapBounds === false) {\r\n      return null;\r\n    }\r\n\r\n    if (this.options.useMapBounds === true) {\r\n      return this._control._map.getBounds();\r\n    }\r\n\r\n    if (this.options.useMapBounds <= this._control._map.getZoom()) {\r\n      return this._control._map.getBounds();\r\n    }\r\n\r\n    return null;\r\n  },\r\n\r\n  _boundsFromResults: function (results) {\r\n    if (!results.length) {\r\n      return;\r\n    }\r\n\r\n    var nullIsland = L.latLngBounds([0, 0], [0, 0]);\r\n    var resultBounds = [];\r\n    var resultLatlngs = [];\r\n\r\n    // collect the bounds and center of each result\r\n    for (var i = results.length - 1; i >= 0; i--) {\r\n      var result = results[i];\r\n\r\n      resultLatlngs.push(result.latlng);\r\n\r\n      // make sure bounds are valid and not 0,0. sometimes bounds are incorrect or not present\r\n      if (result.bounds && result.bounds.isValid() && !result.bounds.equals(nullIsland)) {\r\n        resultBounds.push(result.bounds);\r\n      }\r\n    }\r\n\r\n    // form a bounds object containing all center points\r\n    var bounds = L.latLngBounds(resultLatlngs);\r\n\r\n    // and extend it to contain all bounds objects\r\n    for (var j = 0; j < resultBounds.length; j++) {\r\n      bounds.extend(resultBounds[j]);\r\n    }\r\n\r\n    return bounds;\r\n  },\r\n\r\n  _getAttribution: function () {\r\n    var attribs = [];\r\n    var providers = this._providers;\r\n\r\n    for (var i = 0; i < providers.length; i++) {\r\n      if (providers[i].options.attribution) {\r\n        attribs.push(providers[i].options.attribution);\r\n      }\r\n    }\r\n\r\n    return attribs.join(', ');\r\n  }\r\n\r\n});\r\n\r\nexport function geosearchCore (control, options) {\r\n  return new GeosearchCore(control, options);\r\n}\r\n\r\nexport default geosearchCore;\r\n","import { GeocodeService } from '../Services/Geocode';\r\n\r\nexport var ArcgisOnlineProvider = GeocodeService.extend({\r\n  options: {\r\n    label: 'Places and Addresses',\r\n    maxResults: 5\r\n  },\r\n\r\n  suggestions: function (text, bounds, callback) {\r\n    var request = this.suggest().text(text);\r\n\r\n    if (bounds) {\r\n      request.within(bounds);\r\n    }\r\n\r\n    if (this.options.countries) {\r\n      request.countries(this.options.countries);\r\n    }\r\n\r\n    if (this.options.categories) {\r\n      request.category(this.options.categories);\r\n    }\r\n\r\n    // 15 is the maximum number of suggestions that can be returned\r\n    request.maxSuggestions(this.options.maxResults);\r\n\r\n    return request.run(function (error, results, response) {\r\n      var suggestions = [];\r\n      if (!error) {\r\n        while (response.suggestions.length && suggestions.length <= (this.options.maxResults - 1)) {\r\n          var suggestion = response.suggestions.shift();\r\n          if (!suggestion.isCollection) {\r\n            suggestions.push({\r\n              text: suggestion.text,\r\n              unformattedText: suggestion.text,\r\n              magicKey: suggestion.magicKey\r\n            });\r\n          }\r\n        }\r\n      }\r\n      callback(error, suggestions);\r\n    }, this);\r\n  },\r\n\r\n  results: function (text, key, bounds, callback) {\r\n    var request = this.geocode().text(text);\r\n\r\n    if (key) {\r\n      request.key(key);\r\n    }\r\n    // in the future Address/StreetName geocoding requests that include a magicKey will always only return one match\r\n    request.maxLocations(this.options.maxResults);\r\n\r\n    if (bounds) {\r\n      request.within(bounds);\r\n    }\r\n\r\n    if (this.options.forStorage) {\r\n      request.forStorage(true);\r\n    }\r\n\r\n    return request.run(function (error, response) {\r\n      callback(error, response.results);\r\n    }, this);\r\n  }\r\n});\r\n\r\nexport function arcgisOnlineProvider (options) {\r\n  return new ArcgisOnlineProvider(options);\r\n}\r\n\r\nexport default arcgisOnlineProvider;\r\n","import L from 'leaflet';\r\nimport { geosearchCore } from '../Classes/GeosearchCore';\r\nimport { arcgisOnlineProvider } from '../Providers/ArcgisOnlineGeocoder';\r\nimport { Util } from 'esri-leaflet';\r\n\r\nexport var Geosearch = L.Control.extend({\r\n  includes: L.Evented.prototype,\r\n\r\n  options: {\r\n    position: 'topleft',\r\n    collapseAfterResult: true,\r\n    expanded: false,\r\n    allowMultipleResults: true,\r\n    placeholder: 'Search for places or addresses',\r\n    title: 'Location Search'\r\n  },\r\n\r\n  initialize: function (options) {\r\n    L.Util.setOptions(this, options);\r\n\r\n    if (!options || !options.providers || !options.providers.length) {\r\n      if (!options) {\r\n        options = {};\r\n      }\r\n      options.providers = [ arcgisOnlineProvider() ];\r\n    }\r\n\r\n    // instantiate the underlying class and pass along options\r\n    this._geosearchCore = geosearchCore(this, options);\r\n    this._geosearchCore._providers = options.providers;\r\n\r\n    // bubble each providers events to the control\r\n    this._geosearchCore.addEventParent(this);\r\n    for (var i = 0; i < this._geosearchCore._providers.length; i++) {\r\n      this._geosearchCore._providers[i].addEventParent(this);\r\n    }\r\n\r\n    this._geosearchCore._pendingSuggestions = [];\r\n\r\n    L.Control.prototype.initialize.call(options);\r\n  },\r\n\r\n  _renderSuggestions: function (suggestions) {\r\n    var currentGroup;\r\n\r\n    if (suggestions.length > 0) {\r\n      this._suggestions.style.display = 'block';\r\n    }\r\n    // set the maxHeight of the suggestions box to\r\n    // map height\r\n    // - suggestions offset (distance from top of suggestions to top of control)\r\n    // - control offset (distance from top of control to top of map)\r\n    // - 10 (extra padding)\r\n    this._suggestions.style.maxHeight = (this._map.getSize().y - this._suggestions.offsetTop - this._wrapper.offsetTop - 10) + 'px';\r\n\r\n    var nodes = [];\r\n    var list;\r\n    var header;\r\n    var suggestionTextArray = [];\r\n\r\n    for (var i = 0; i < suggestions.length; i++) {\r\n      var suggestion = suggestions[i];\r\n      if (!header && this._geosearchCore._providers.length > 1 && currentGroup !== suggestion.provider.options.label) {\r\n        header = L.DomUtil.create('span', 'geocoder-control-header', this._suggestions);\r\n        header.textContent = suggestion.provider.options.label;\r\n        header.innerText = suggestion.provider.options.label;\r\n        currentGroup = suggestion.provider.options.label;\r\n        nodes.push(header);\r\n      }\r\n\r\n      if (!list) {\r\n        list = L.DomUtil.create('ul', 'geocoder-control-list', this._suggestions);\r\n      }\r\n\r\n      if (suggestionTextArray.indexOf(suggestion.text) === -1) {\r\n        var suggestionItem = L.DomUtil.create('li', 'geocoder-control-suggestion', list);\r\n\r\n        suggestionItem.innerHTML = suggestion.text;\r\n        suggestionItem.provider = suggestion.provider;\r\n        suggestionItem['data-magic-key'] = suggestion.magicKey;\r\n        suggestionItem.unformattedText = suggestion.unformattedText;\r\n      } else {\r\n        for (var j = 0; j < list.childNodes.length; j++) {\r\n          // if the same text already appears in the list of suggestions, append an additional ObjectID to its magicKey instead\r\n          if (list.childNodes[j].innerHTML === suggestion.text) {\r\n            list.childNodes[j]['data-magic-key'] += ',' + suggestion.magicKey;\r\n          }\r\n        }\r\n      }\r\n      suggestionTextArray.push(suggestion.text);\r\n    }\r\n\r\n    L.DomUtil.removeClass(this._input, 'geocoder-control-loading');\r\n\r\n    nodes.push(list);\r\n\r\n    return nodes;\r\n  },\r\n\r\n  _boundsFromResults: function (results) {\r\n    if (!results.length) {\r\n      return;\r\n    }\r\n\r\n    var nullIsland = L.latLngBounds([0, 0], [0, 0]);\r\n    var resultBounds = [];\r\n    var resultLatlngs = [];\r\n\r\n    // collect the bounds and center of each result\r\n    for (var i = results.length - 1; i >= 0; i--) {\r\n      var result = results[i];\r\n\r\n      resultLatlngs.push(result.latlng);\r\n\r\n      // make sure bounds are valid and not 0,0. sometimes bounds are incorrect or not present\r\n      if (result.bounds && result.bounds.isValid() && !result.bounds.equals(nullIsland)) {\r\n        resultBounds.push(result.bounds);\r\n      }\r\n    }\r\n\r\n    // form a bounds object containing all center points\r\n    var bounds = L.latLngBounds(resultLatlngs);\r\n\r\n    // and extend it to contain all bounds objects\r\n    for (var j = 0; j < resultBounds.length; j++) {\r\n      bounds.extend(resultBounds[j]);\r\n    }\r\n\r\n    return bounds;\r\n  },\r\n\r\n  clear: function () {\r\n    this._suggestions.innerHTML = '';\r\n    this._suggestions.style.display = 'none';\r\n    this._input.value = '';\r\n\r\n    if (this.options.collapseAfterResult) {\r\n      this._input.placeholder = '';\r\n      L.DomUtil.removeClass(this._wrapper, 'geocoder-control-expanded');\r\n    }\r\n\r\n    if (!this._map.scrollWheelZoom.enabled() && this._map.options.scrollWheelZoom) {\r\n      this._map.scrollWheelZoom.enable();\r\n    }\r\n  },\r\n\r\n  clearSuggestions: function () {\r\n    if (this._nodes) {\r\n      for (var k = 0; k < this._nodes.length; k++) {\r\n        if (this._nodes[k].parentElement) {\r\n          this._suggestions.removeChild(this._nodes[k]);\r\n        }\r\n      }\r\n    }\r\n  },\r\n\r\n  _setupClick: function () {\r\n    L.DomUtil.addClass(this._wrapper, 'geocoder-control-expanded');\r\n    this._input.focus();\r\n  },\r\n\r\n  disable: function () {\r\n    this._input.disabled = true;\r\n    L.DomUtil.addClass(this._input, 'geocoder-control-input-disabled');\r\n    L.DomEvent.removeListener(this._wrapper, 'click', this._setupClick, this);\r\n  },\r\n\r\n  enable: function () {\r\n    this._input.disabled = false;\r\n    L.DomUtil.removeClass(this._input, 'geocoder-control-input-disabled');\r\n    L.DomEvent.addListener(this._wrapper, 'click', this._setupClick, this);\r\n  },\r\n\r\n  getAttribution: function () {\r\n    var attribs = [];\r\n\r\n    for (var i = 0; i < this._providers.length; i++) {\r\n      if (this._providers[i].options.attribution) {\r\n        attribs.push(this._providers[i].options.attribution);\r\n      }\r\n    }\r\n\r\n    return attribs.join(', ');\r\n  },\r\n\r\n  geocodeSuggestion: function (e) {\r\n    var suggestionItem = e.target || e.srcElement;\r\n\r\n    // make sure and point at the actual 'geocoder-control-suggestion'\r\n    if (suggestionItem.classList.length < 1) {\r\n      suggestionItem = suggestionItem.parentNode;\r\n    }\r\n\r\n    this._geosearchCore._geocode(suggestionItem.unformattedText, suggestionItem['data-magic-key'], suggestionItem.provider);\r\n    this.clear();\r\n  },\r\n\r\n  onAdd: function (map) {\r\n    // include 'Powered by Esri' in map attribution\r\n    Util.setEsriAttribution(map);\r\n\r\n    this._map = map;\r\n    this._wrapper = L.DomUtil.create('div', 'geocoder-control');\r\n    this._input = L.DomUtil.create('input', 'geocoder-control-input leaflet-bar', this._wrapper);\r\n    this._input.title = this.options.title;\r\n\r\n    if (this.options.expanded) {\r\n      L.DomUtil.addClass(this._wrapper, 'geocoder-control-expanded');\r\n      this._input.placeholder = this.options.placeholder;\r\n    }\r\n\r\n    this._suggestions = L.DomUtil.create('div', 'geocoder-control-suggestions leaflet-bar', this._wrapper);\r\n\r\n    var credits = this._geosearchCore._getAttribution();\r\n    map.attributionControl.addAttribution(credits);\r\n\r\n    L.DomEvent.addListener(this._input, 'focus', function (e) {\r\n      this._input.placeholder = this.options.placeholder;\r\n      L.DomUtil.addClass(this._wrapper, 'geocoder-control-expanded');\r\n    }, this);\r\n\r\n    L.DomEvent.addListener(this._wrapper, 'click', this._setupClick, this);\r\n\r\n    // make sure both click and touch spawn an address/poi search\r\n    L.DomEvent.addListener(this._suggestions, 'mousedown', this.geocodeSuggestion, this);\r\n    L.DomEvent.addListener(this._suggestions, 'touchend', this.geocodeSuggestion, this);\r\n\r\n    L.DomEvent.addListener(this._input, 'blur', function (e) {\r\n      this.clear();\r\n    }, this);\r\n\r\n    L.DomEvent.addListener(this._input, 'keydown', function (e) {\r\n      var text = (e.target || e.srcElement).value;\r\n\r\n      L.DomUtil.addClass(this._wrapper, 'geocoder-control-expanded');\r\n\r\n      var list = this._suggestions.querySelectorAll('.' + 'geocoder-control-suggestion');\r\n      var selected = this._suggestions.querySelectorAll('.' + 'geocoder-control-selected')[0];\r\n      var selectedPosition;\r\n\r\n      for (var i = 0; i < list.length; i++) {\r\n        if (list[i] === selected) {\r\n          selectedPosition = i;\r\n          break;\r\n        }\r\n      }\r\n\r\n      switch (e.keyCode) {\r\n        case 13:\r\n          /*\r\n            if an item has been selected, geocode it\r\n            if focus is on the input textbox, geocode only if multiple results are allowed and more than two characters are present, or if a single suggestion is displayed.\r\n            if less than two characters have been typed, abort the geocode\r\n          */\r\n          if (selected) {\r\n            this._geosearchCore._geocode(selected.unformattedText, selected['data-magic-key'], selected.provider);\r\n            this.clear();\r\n          } else if (this.options.allowMultipleResults && text.length >= 2) {\r\n            this._geosearchCore._geocode(this._input.value, undefined);\r\n            this.clear();\r\n          } else {\r\n            if (list.length === 1) {\r\n              L.DomUtil.addClass(list[0], 'geocoder-control-selected');\r\n              this._geosearchCore._geocode(list[0].innerHTML, list[0]['data-magic-key'], list[0].provider);\r\n            } else {\r\n              this.clear();\r\n              this._input.blur();\r\n            }\r\n          }\r\n          L.DomEvent.preventDefault(e);\r\n          break;\r\n        case 38:\r\n          if (selected) {\r\n            L.DomUtil.removeClass(selected, 'geocoder-control-selected');\r\n          }\r\n\r\n          var previousItem = list[selectedPosition - 1];\r\n\r\n          if (selected && previousItem) {\r\n            L.DomUtil.addClass(previousItem, 'geocoder-control-selected');\r\n          } else {\r\n            L.DomUtil.addClass(list[list.length - 1], 'geocoder-control-selected');\r\n          }\r\n          L.DomEvent.preventDefault(e);\r\n          break;\r\n        case 40:\r\n          if (selected) {\r\n            L.DomUtil.removeClass(selected, 'geocoder-control-selected');\r\n          }\r\n\r\n          var nextItem = list[selectedPosition + 1];\r\n\r\n          if (selected && nextItem) {\r\n            L.DomUtil.addClass(nextItem, 'geocoder-control-selected');\r\n          } else {\r\n            L.DomUtil.addClass(list[0], 'geocoder-control-selected');\r\n          }\r\n          L.DomEvent.preventDefault(e);\r\n          break;\r\n        default:\r\n          // when the input changes we should cancel all pending suggestion requests if possible to avoid result collisions\r\n          for (var x = 0; x < this._geosearchCore._pendingSuggestions.length; x++) {\r\n            var request = this._geosearchCore._pendingSuggestions[x];\r\n            if (request && request.abort && !request.id) {\r\n              request.abort();\r\n            }\r\n          }\r\n          break;\r\n      }\r\n    }, this);\r\n\r\n    L.DomEvent.addListener(this._input, 'keyup', L.Util.throttle(function (e) {\r\n      var key = e.which || e.keyCode;\r\n      var text = (e.target || e.srcElement).value;\r\n\r\n      // require at least 2 characters for suggestions\r\n      if (text.length < 2) {\r\n        this._suggestions.innerHTML = '';\r\n        this._suggestions.style.display = 'none';\r\n        L.DomUtil.removeClass(this._input, 'geocoder-control-loading');\r\n        return;\r\n      }\r\n\r\n      // if this is the escape key it will clear the input so clear suggestions\r\n      if (key === 27) {\r\n        this._suggestions.innerHTML = '';\r\n        this._suggestions.style.display = 'none';\r\n        return;\r\n      }\r\n\r\n      // if this is NOT the up/down arrows or enter make a suggestion\r\n      if (key !== 13 && key !== 38 && key !== 40) {\r\n        if (this._input.value !== this._lastValue) {\r\n          this._lastValue = this._input.value;\r\n          L.DomUtil.addClass(this._input, 'geocoder-control-loading');\r\n          this._geosearchCore._suggest(text);\r\n        }\r\n      }\r\n    }, 50, this), this);\r\n\r\n    L.DomEvent.disableClickPropagation(this._wrapper);\r\n\r\n    // when mouse moves over suggestions disable scroll wheel zoom if its enabled\r\n    L.DomEvent.addListener(this._suggestions, 'mouseover', function (e) {\r\n      if (map.scrollWheelZoom.enabled() && map.options.scrollWheelZoom) {\r\n        map.scrollWheelZoom.disable();\r\n      }\r\n    });\r\n\r\n    // when mouse moves leaves suggestions enable scroll wheel zoom if its disabled\r\n    L.DomEvent.addListener(this._suggestions, 'mouseout', function (e) {\r\n      if (!map.scrollWheelZoom.enabled() && map.options.scrollWheelZoom) {\r\n        map.scrollWheelZoom.enable();\r\n      }\r\n    });\r\n\r\n    this._geosearchCore.on('load', function (e) {\r\n      L.DomUtil.removeClass(this._input, 'geocoder-control-loading');\r\n      this.clear();\r\n      this._input.blur();\r\n    }, this);\r\n\r\n    return this._wrapper;\r\n  }\r\n});\r\n\r\nexport function geosearch (options) {\r\n  return new Geosearch(options);\r\n}\r\n\r\nexport default geosearch;\r\n","import L from 'leaflet';\r\nimport { FeatureLayerService } from 'esri-leaflet';\r\n\r\nexport var FeatureLayerProvider = FeatureLayerService.extend({\r\n  options: {\r\n    label: 'Feature Layer',\r\n    maxResults: 5,\r\n    bufferRadius: 1000,\r\n    formatSuggestion: function (feature) {\r\n      return feature.properties[this.options.searchFields[0]];\r\n    }\r\n  },\r\n\r\n  initialize: function (options) {\r\n    FeatureLayerService.prototype.initialize.call(this, options);\r\n    if (typeof this.options.searchFields === 'string') {\r\n      this.options.searchFields = [this.options.searchFields];\r\n    }\r\n    this._suggestionsQuery = this.query();\r\n    this._resultsQuery = this.query();\r\n  },\r\n\r\n  suggestions: function (text, bounds, callback) {\r\n    var query = this._suggestionsQuery.where(this._buildQuery(text))\r\n      .returnGeometry(false);\r\n\r\n    if (bounds) {\r\n      query.intersects(bounds);\r\n    }\r\n\r\n    if (this.options.idField) {\r\n      query.fields([this.options.idField].concat(this.options.searchFields));\r\n    }\r\n\r\n    var request = query.run(function (error, results, raw) {\r\n      if (error) {\r\n        callback(error, []);\r\n      } else {\r\n        this.options.idField = raw.objectIdFieldName;\r\n        var suggestions = [];\r\n        for (var i = results.features.length - 1; i >= 0; i--) {\r\n          var feature = results.features[i];\r\n          suggestions.push({\r\n            text: this.options.formatSuggestion.call(this, feature),\r\n            unformattedText: feature.properties[this.options.searchFields[0]],\r\n            magicKey: feature.id\r\n          });\r\n        }\r\n        callback(error, suggestions.slice(0, this.options.maxResults));\r\n      }\r\n    }, this);\r\n\r\n    return request;\r\n  },\r\n\r\n  results: function (text, key, bounds, callback) {\r\n    var query = this._resultsQuery;\r\n\r\n    if (key) {\r\n      delete query.params.where;\r\n      query.featureIds([key]);\r\n    } else {\r\n      query.where(this._buildQuery(text));\r\n    }\r\n\r\n    if (bounds) {\r\n      query.within(bounds);\r\n    }\r\n\r\n    return query.run(L.Util.bind(function (error, features) {\r\n      var results = [];\r\n      for (var i = 0; i < features.features.length; i++) {\r\n        var feature = features.features[i];\r\n        if (feature) {\r\n          var bounds = this._featureBounds(feature);\r\n\r\n          var result = {\r\n            latlng: bounds.getCenter(),\r\n            bounds: bounds,\r\n            text: this.options.formatSuggestion.call(this, feature),\r\n            properties: feature.properties,\r\n            geojson: feature\r\n          };\r\n\r\n          results.push(result);\r\n\r\n          // clear query parameters for the next search\r\n          delete this._resultsQuery.params['objectIds'];\r\n        }\r\n      }\r\n      callback(error, results);\r\n    }, this));\r\n  },\r\n\r\n  orderBy: function (fieldName, order) {\r\n    this._suggestionsQuery.orderBy(fieldName, order);\r\n  },\r\n\r\n  _buildQuery: function (text) {\r\n    var queryString = [];\r\n\r\n    for (var i = this.options.searchFields.length - 1; i >= 0; i--) {\r\n      var field = 'upper(\"' + this.options.searchFields[i] + '\")';\r\n\r\n      queryString.push(field + \" LIKE upper('%\" + text + \"%')\");\r\n    }\r\n\r\n    if (this.options.where) {\r\n      return this.options.where + ' AND (' + queryString.join(' OR ') + ')';\r\n    } else {\r\n      return queryString.join(' OR ');\r\n    }\r\n  },\r\n\r\n  _featureBounds: function (feature) {\r\n    var geojson = L.geoJson(feature);\r\n    if (feature.geometry.type === 'Point') {\r\n      var center = geojson.getBounds().getCenter();\r\n      var lngRadius = ((this.options.bufferRadius / 40075017) * 360) / Math.cos((180 / Math.PI) * center.lat);\r\n      var latRadius = (this.options.bufferRadius / 40075017) * 360;\r\n      return L.latLngBounds([center.lat - latRadius, center.lng - lngRadius], [center.lat + latRadius, center.lng + lngRadius]);\r\n    } else {\r\n      return geojson.getBounds();\r\n    }\r\n  }\r\n});\r\n\r\nexport function featureLayerProvider (options) {\r\n  return new FeatureLayerProvider(options);\r\n}\r\n\r\nexport default featureLayerProvider;\r\n","import L from 'leaflet';\r\nimport { MapService } from 'esri-leaflet';\r\n\r\nexport var MapServiceProvider = MapService.extend({\r\n  options: {\r\n    layers: [0],\r\n    label: 'Map Service',\r\n    bufferRadius: 1000,\r\n    maxResults: 5,\r\n    formatSuggestion: function (feature) {\r\n      return feature.properties[feature.displayFieldName] + ' <small>' + feature.layerName + '</small>';\r\n    }\r\n  },\r\n\r\n  initialize: function (options) {\r\n    MapService.prototype.initialize.call(this, options);\r\n    this._getIdFields();\r\n  },\r\n\r\n  suggestions: function (text, bounds, callback) {\r\n    var request = this.find().text(text).fields(this.options.searchFields).returnGeometry(false).layers(this.options.layers);\r\n\r\n    return request.run(function (error, results, raw) {\r\n      var suggestions = [];\r\n      if (!error) {\r\n        var count = Math.min(this.options.maxResults, results.features.length);\r\n        raw.results = raw.results.reverse();\r\n        for (var i = 0; i < count; i++) {\r\n          var feature = results.features[i];\r\n          var result = raw.results[i];\r\n          var layer = result.layerId;\r\n          var idField = this._idFields[layer];\r\n          feature.layerId = layer;\r\n          feature.layerName = this._layerNames[layer];\r\n          feature.displayFieldName = this._displayFields[layer];\r\n          if (idField) {\r\n            suggestions.push({\r\n              text: this.options.formatSuggestion.call(this, feature),\r\n              unformattedText: feature.properties[feature.displayFieldName],\r\n              magicKey: result.attributes[idField] + ':' + layer\r\n            });\r\n          }\r\n        }\r\n      }\r\n      callback(error, suggestions.reverse());\r\n    }, this);\r\n  },\r\n\r\n  results: function (text, key, bounds, callback) {\r\n    var results = [];\r\n    var request;\r\n\r\n    if (key) {\r\n      var featureId = key.split(':')[0];\r\n      var layer = key.split(':')[1];\r\n      request = this.query().layer(layer).featureIds(featureId);\r\n    } else {\r\n      request = this.find().text(text).fields(this.options.searchFields).layers(this.options.layers);\r\n    }\r\n\r\n    return request.run(function (error, features, response) {\r\n      if (!error) {\r\n        if (response.results) {\r\n          response.results = response.results.reverse();\r\n        }\r\n        for (var i = 0; i < features.features.length; i++) {\r\n          var feature = features.features[i];\r\n          layer = layer || response.results[i].layerId;\r\n\r\n          if (feature && layer !== undefined) {\r\n            var bounds = this._featureBounds(feature);\r\n            feature.layerId = layer;\r\n            feature.layerName = this._layerNames[layer];\r\n            feature.displayFieldName = this._displayFields[layer];\r\n\r\n            var result = {\r\n              latlng: bounds.getCenter(),\r\n              bounds: bounds,\r\n              text: this.options.formatSuggestion.call(this, feature),\r\n              properties: feature.properties,\r\n              geojson: feature\r\n            };\r\n\r\n            results.push(result);\r\n          }\r\n        }\r\n      }\r\n      callback(error, results.reverse());\r\n    }, this);\r\n  },\r\n\r\n  _featureBounds: function (feature) {\r\n    var geojson = L.geoJson(feature);\r\n    if (feature.geometry.type === 'Point') {\r\n      var center = geojson.getBounds().getCenter();\r\n      var lngRadius = ((this.options.bufferRadius / 40075017) * 360) / Math.cos((180 / Math.PI) * center.lat);\r\n      var latRadius = (this.options.bufferRadius / 40075017) * 360;\r\n      return L.latLngBounds([center.lat - latRadius, center.lng - lngRadius], [center.lat + latRadius, center.lng + lngRadius]);\r\n    } else {\r\n      return geojson.getBounds();\r\n    }\r\n  },\r\n\r\n  _layerMetadataCallback: function (layerid) {\r\n    return L.Util.bind(function (error, metadata) {\r\n      if (error) { return; }\r\n      this._displayFields[layerid] = metadata.displayField;\r\n      this._layerNames[layerid] = metadata.name;\r\n      for (var i = 0; i < metadata.fields.length; i++) {\r\n        var field = metadata.fields[i];\r\n        if (field.type === 'esriFieldTypeOID') {\r\n          this._idFields[layerid] = field.name;\r\n          break;\r\n        }\r\n      }\r\n    }, this);\r\n  },\r\n\r\n  _getIdFields: function () {\r\n    this._idFields = {};\r\n    this._displayFields = {};\r\n    this._layerNames = {};\r\n    for (var i = 0; i < this.options.layers.length; i++) {\r\n      var layer = this.options.layers[i];\r\n      this.get(layer, {}, this._layerMetadataCallback(layer));\r\n    }\r\n  }\r\n});\r\n\r\nexport function mapServiceProvider (options) {\r\n  return new MapServiceProvider(options);\r\n}\r\n\r\nexport default mapServiceProvider;\r\n","import { GeocodeService } from '../Services/Geocode';\r\n\r\nexport var GeocodeServiceProvider = GeocodeService.extend({\r\n  options: {\r\n    label: 'Geocode Server',\r\n    maxResults: 5\r\n  },\r\n\r\n  suggestions: function (text, bounds, callback) {\r\n    if (this.options.supportsSuggest) {\r\n      var request = this.suggest().text(text);\r\n      if (bounds) {\r\n        request.within(bounds);\r\n      }\r\n\r\n      return request.run(function (error, results, response) {\r\n        var suggestions = [];\r\n        if (!error) {\r\n          while (response.suggestions.length && suggestions.length <= (this.options.maxResults - 1)) {\r\n            var suggestion = response.suggestions.shift();\r\n            if (!suggestion.isCollection) {\r\n              suggestions.push({\r\n                text: suggestion.text,\r\n                unformattedText: suggestion.text,\r\n                magicKey: suggestion.magicKey\r\n              });\r\n            }\r\n          }\r\n        }\r\n        callback(error, suggestions);\r\n      }, this);\r\n    } else {\r\n      callback(undefined, []);\r\n      return false;\r\n    }\r\n  },\r\n\r\n  results: function (text, key, bounds, callback) {\r\n    var request = this.geocode().text(text);\r\n\r\n    if (key) {\r\n      request.key(key);\r\n    }\r\n\r\n    request.maxLocations(this.options.maxResults);\r\n\r\n    if (bounds) {\r\n      request.within(bounds);\r\n    }\r\n\r\n    return request.run(function (error, response) {\r\n      callback(error, response.results);\r\n    }, this);\r\n  }\r\n});\r\n\r\nexport function geocodeServiceProvider (options) {\r\n  return new GeocodeServiceProvider(options);\r\n}\r\n\r\nexport default geocodeServiceProvider;\r\n","export { version as VERSION } from '../package.json';\r\nexport var WorldGeocodingServiceUrl = 'https://geocode.arcgis.com/arcgis/rest/services/World/GeocodeServer/';\r\n\r\n// import tasks\r\nexport { Geocode, geocode } from './Tasks/Geocode';\r\nexport { ReverseGeocode, reverseGeocode } from './Tasks/ReverseGeocode';\r\nexport { Suggest, suggest } from './Tasks/Suggest';\r\n\r\n// import service\r\nexport { GeocodeService, geocodeService } from './Services/Geocode';\r\n\r\n// import control\r\nexport { Geosearch, geosearch } from './Controls/Geosearch';\r\n\r\n// import supporting class\r\nexport { GeosearchCore, geosearchCore } from './Classes/GeosearchCore';\r\n\r\n// import providers\r\nexport { ArcgisOnlineProvider, arcgisOnlineProvider } from './Providers/ArcgisOnlineGeocoder';\r\nexport { FeatureLayerProvider, featureLayerProvider } from './Providers/FeatureLayer';\r\nexport { MapServiceProvider, mapServiceProvider } from './Providers/MapService';\r\nexport { GeocodeServiceProvider, geocodeServiceProvider } from './Providers/GeocodeService';\r\n","import L from 'leaflet';\r\nimport { Task, Util } from 'esri-leaflet';\r\nimport { WorldGeocodingServiceUrl } from '../EsriLeafletGeocoding';\r\n\r\nexport var Geocode = Task.extend({\r\n  path: 'findAddressCandidates',\r\n\r\n  params: {\r\n    outSr: 4326,\r\n    forStorage: false,\r\n    outFields: '*',\r\n    maxLocations: 20\r\n  },\r\n\r\n  setters: {\r\n    'address': 'address',\r\n    'neighborhood': 'neighborhood',\r\n    'city': 'city',\r\n    'subregion': 'subregion',\r\n    'region': 'region',\r\n    'postal': 'postal',\r\n    'country': 'country',\r\n    'text': 'singleLine',\r\n    'category': 'category',\r\n    'token': 'token',\r\n    'key': 'magicKey',\r\n    'fields': 'outFields',\r\n    'forStorage': 'forStorage',\r\n    'maxLocations': 'maxLocations'\r\n  },\r\n\r\n  initialize: function (options) {\r\n    options = options || {};\r\n    options.url = options.url || WorldGeocodingServiceUrl;\r\n    Task.prototype.initialize.call(this, options);\r\n  },\r\n\r\n  within: function (bounds) {\r\n    bounds = L.latLngBounds(bounds);\r\n    this.params.searchExtent = Util.boundsToExtent(bounds);\r\n    return this;\r\n  },\r\n\r\n  nearby: function (latlng, radius) {\r\n    latlng = L.latLng(latlng);\r\n    this.params.location = latlng.lng + ',' + latlng.lat;\r\n    this.params.distance = Math.min(Math.max(radius, 2000), 50000);\r\n    return this;\r\n  },\r\n\r\n  run: function (callback, context) {\r\n    if (this.options.customParam) {\r\n      this.params[this.options.customParam] = this.params.singleLine;\r\n      delete this.params.singleLine;\r\n    }\r\n\r\n    return this.request(function (error, response) {\r\n      var processor = this._processGeocoderResponse;\r\n      var results = (!error) ? processor(response) : undefined;\r\n      callback.call(context, error, { results: results }, response);\r\n    }, this);\r\n  },\r\n\r\n  _processGeocoderResponse: function (response) {\r\n    var results = [];\r\n\r\n    for (var i = 0; i < response.candidates.length; i++) {\r\n      var candidate = response.candidates[i];\r\n      if (candidate.extent) {\r\n        var bounds = Util.extentToBounds(candidate.extent);\r\n      }\r\n\r\n      results.push({\r\n        text: candidate.address,\r\n        bounds: bounds,\r\n        score: candidate.score,\r\n        latlng: L.latLng(candidate.location.y, candidate.location.x),\r\n        properties: candidate.attributes\r\n      });\r\n    }\r\n    return results;\r\n  }\r\n});\r\n\r\nexport function geocode (options) {\r\n  return new Geocode(options);\r\n}\r\n\r\nexport default geocode;\r\n","export { version as VERSION } from '../package.json';\r\nexport var WorldGeocodingServiceUrl = 'https://geocode.arcgis.com/arcgis/rest/services/World/GeocodeServer/';\r\n\r\n// import tasks\r\nexport { Geocode, geocode } from './Tasks/Geocode';\r\nexport { ReverseGeocode, reverseGeocode } from './Tasks/ReverseGeocode';\r\nexport { Suggest, suggest } from './Tasks/Suggest';\r\n\r\n// import service\r\nexport { GeocodeService, geocodeService } from './Services/Geocode';\r\n\r\n// import control\r\nexport { Geosearch, geosearch } from './Controls/Geosearch';\r\n\r\n// import supporting class\r\nexport { GeosearchCore, geosearchCore } from './Classes/GeosearchCore';\r\n\r\n// import providers\r\nexport { ArcgisOnlineProvider, arcgisOnlineProvider } from './Providers/ArcgisOnlineGeocoder';\r\nexport { FeatureLayerProvider, featureLayerProvider } from './Providers/FeatureLayer';\r\nexport { MapServiceProvider, mapServiceProvider } from './Providers/MapService';\r\nexport { GeocodeServiceProvider, geocodeServiceProvider } from './Providers/GeocodeService';\r\n"],"names":["reverseGeocode","options","ReverseGeocode","suggest","Suggest","geocodeService","GeocodeService","geosearchCore","control","GeosearchCore","arcgisOnlineProvider","ArcgisOnlineProvider","geosearch","Geosearch","featureLayerProvider","FeatureLayerProvider","mapServiceProvider","MapServiceProvider","geocodeServiceProvider","GeocodeServiceProvider","geocode","Geocode","Task","extend","path","params","outSR","returnIntersection","setters","distance","language","intersection","initialize","url","WorldGeocodingServiceUrl","prototype","call","this","latlng","L","latLng","location","lng","lat","run","callback","context","request","error","response","result","undefined","y","x","address","text","category","countries","maxSuggestions","supportsSuggest","within","bounds","latLngBounds","pad","center","getCenter","ne","getNorthWest","Math","min","max","distanceTo","searchExtent","Util","boundsToExtent","nearby","radius","console","warn","Service","_confirmSuggestSupport","reverse","metadata","capabilities","indexOf","customParam","singleLineAddressField","name","Evented","zoomToResult","useMapBounds","searchBounds","setOptions","_control","providers","length","Error","_providers","_geocode","key","provider","activeRequests","allResults","bind","results","concat","_boundsFromResults","fire","_map","fitBounds","_searchBounds","i","_suggest","createCallback","suggestions","_suggestions","innerHTML","style","display","_renderSuggestions","_lastRender","nodes","parentElement","removeChild","_input","value","clearSuggestions","_nodes","_pendingSuggestions","push","getBounds","getZoom","nullIsland","resultBounds","resultLatlngs","isValid","equals","j","_getAttribution","attribs","attribution","join","label","maxResults","categories","suggestion","shift","isCollection","unformattedText","magicKey","maxLocations","forStorage","Control","includes","position","collapseAfterResult","expanded","allowMultipleResults","placeholder","title","_geosearchCore","addEventParent","currentGroup","maxHeight","getSize","offsetTop","_wrapper","list","header","suggestionTextArray","DomUtil","create","textContent","innerText","suggestionItem","childNodes","removeClass","clear","scrollWheelZoom","enabled","enable","k","_setupClick","addClass","focus","disable","disabled","DomEvent","removeListener","addListener","getAttribution","geocodeSuggestion","e","target","srcElement","classList","parentNode","onAdd","map","setEsriAttribution","credits","attributionControl","addAttribution","selectedPosition","querySelectorAll","selected","keyCode","blur","preventDefault","previousItem","nextItem","abort","id","throttle","which","_lastValue","disableClickPropagation","on","FeatureLayerService","bufferRadius","formatSuggestion","feature","properties","searchFields","_suggestionsQuery","query","_resultsQuery","where","_buildQuery","returnGeometry","intersects","idField","fields","raw","objectIdFieldName","features","slice","featureIds","_featureBounds","geojson","orderBy","fieldName","order","queryString","field","geoJson","geometry","type","lngRadius","cos","PI","latRadius","MapService","layers","displayFieldName","layerName","_getIdFields","find","count","layer","layerId","_idFields","_layerNames","_displayFields","attributes","featureId","split","_layerMetadataCallback","layerid","displayField","get","outSr","outFields","neighborhood","city","subregion","region","postal","country","token","singleLine","processor","_processGeocoderResponse","candidates","candidate","extent","extentToBounds","score"],"mappings":"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"}