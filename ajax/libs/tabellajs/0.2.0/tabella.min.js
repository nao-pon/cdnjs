/*! tabella - v0.1.0 - 2015-03-20
* https://github.com/iliketomatoes/tabellajs
* Copyright (c) 2015 ; Licensed  */
!function(a){"use strict";"function"==typeof define&&define.amd?define(a):window.Tabella=a()}(function(){"use strict";function a(a){return new RegExp("(^|\\s+)"+a+"(\\s+|$)")}function b(a,b){var c=o(a,b)?q:p;c(a,b)}function c(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c]);return a}function d(){for(var a="transform WebkitTransform MozTransform OTransform msTransform".split(" "),b=0;b<a.length;b++)if(void 0!==document.createElement("div").style[a[b]])return a[b];return!1}function e(a,b,c,d){var e=document.createElement(a);return e.className=b,d&&(e.innerHTML=d),c.appendChild(e),e}function f(a){return Array.prototype.slice.call(a,0)}function g(a,b,c){for(var d=b.split(" "),e=d.length;e--;)a.addEventListener(d[e],c,!1)}function h(a,b){var c=b||null,d=Array.prototype.slice.call(arguments,2);return a.apply(c,d)}function i(a,b){return Math.round(Math.abs(a)/b*1e3)}function j(a){this.value=a,this.message="Tabella.js error: ",this.toString=function(){return this.message+this.value}}function k(a){return t.hasOwnProperty(a)?t[a]:t.easeInOutSine}function l(a,b){return m(a[0],a[1],a[2],a[3],b)}function m(a,b,c,d,e){var f=function(b){var d=1-b;return 3*d*d*b*a+3*d*b*b*c+b*b*b},g=function(a){var c=1-a;return 3*c*c*a*b+3*c*a*a*d+a*a*a},h=function(b){var d=1-b;return 3*(2*(b-1)*b+d*d)*a+3*(-b*b*b+2*d*b)*c};return function(a){var b,c,d,i,j,k,l=a;for(d=l,k=0;8>k;k++){if(i=f(d)-l,Math.abs(i)<e)return g(d);if(j=h(d),Math.abs(j)<1e-6)break;d-=i/j}if(b=0,c=1,d=l,b>d)return g(b);if(d>c)return g(c);for(;c>b;){if(i=f(d),Math.abs(i-l)<e)return g(d);l>i?b=d:c=d,d=.5*(c-b)+b}return g(d)}}function n(a,b){var d=this,e={periods:null,rows:null,cellBreakpoints:{"default":[0,1],small:[360,2],medium:[640,3],large:[820,4],xlarge:[1080,5]},descBreakpoints:{"default":[0,0],medium:[460,160],large:[900,200]},from:"from",to:"to",currency:"&euro;",easing:"easeInOutSine",duration:600,reboundSpeed:300,edgeThreshold:150,swipeThreshold:60,swipeSingleTick:!0,onRefreshSize:!1,headerRowDevider:"-"};if("undefined"==typeof a)throw new j("You did not pass a valid target element to the constructor");if("undefined"==typeof b)throw new j("You did not pass any options to the constructor");if(d.options=c(e,b),d.periodRow=null,d.slidingRows=null,d.arrows=null,d.pointer=0,d.currentBreakpoint={},d.currentCellWidth=0,d.el=a,null===d.options.periods||null===d.options.rows)throw new j("Periods or rows are null");if(d.periodRow=C.setUpPeriods(d.el,d.options),!d.periodRow)throw new j("Periods is not an Array");if(!C.setUpRows(d.el,d.options))throw new j("There is a mismatch between periods and cells");d.arrows=C.setUpArrows(d.periodRow),d.slidingRows=f(d.el.querySelectorAll(".t-sliding-row"));var g=function(a,b,c){var e;return function(){var f=arguments,g=function(){e=null,c||a.apply(d,f)},h=c&&!e;clearTimeout(e),e=setTimeout(g,b),h&&a.apply(d,f)}},h=function(){d.currentBreakpoint=d.getBreakpoint(),d.currentCellWidth=d.getCellWidth(d.currentBreakpoint),d.refreshSize()};"function"==typeof define&&define.amd?h():window.addEventListener("load",g(h,50)),window.addEventListener("resize",g(d.refreshSize,250)),d.attachEvents()}var o,p,q;"classList"in document.documentElement?(o=function(a,b){return a.classList.contains(b)},p=function(a,b){a.classList.add(b)},q=function(a,b){a.classList.remove(b)}):(o=function(b,c){return a(c).test(b.className)},p=function(a,b){o(a,b)||(a.className=a.className+" "+b)},q=function(b,c){b.className=b.className.replace(a(c)," ")});var r={hasClass:o,addClass:p,removeClass:q,toggleClass:b,has:o,add:p,remove:q,toggle:b},s=d(),t={easeInSine:[.47,0,.745,.715],easeOutSine:[.39,.575,.565,1],easeInOutSine:[.445,.05,.55,.95],easeInQuad:[.55,.085,.68,.53],easeOutQuad:[.25,.46,.45,.94],easeInOutQuad:[.455,.03,.515,.955],easeInCubic:[.55,.055,.675,.19],easeOutCubic:[.215,.61,.355,1],easeInOutCubic:[.645,.045,.355,1],easeInQuart:[.895,.03,.685,.22],easeOutQuart:[.165,.84,.44,1],easeInOutQuart:[.77,0,.175,1],easeInQuint:[.755,.05,.855,.06],easeOutQuint:[.23,1,.32,1],easeInOutQuint:[.86,0,.07,1],easeInExpo:[.95,.05,.795,.035],easeOutExpo:[.19,1,.22,1],easeInOutExpo:[1,0,0,1],easeInCirc:[.6,.04,.98,.335],easeOutCirc:[.075,.82,.165,1],easeInOutCirc:[.785,.135,.15,.86],easeInBack:[.6,-.28,.735,.045],easeOutBack:[.175,.885,.32,1.275],easeInOutBack:[.68,-.55,.265,1.55]},u=0;window.requestAnimationFrame||(window.requestAnimationFrame=function(a){var b=(new Date).getTime(),c=Math.max(0,16-(b-u)),d=window.setTimeout(function(){a(b+c)},c);return u=b+c,d}),window.cancelAnimationFrame||(window.cancelAnimationFrame=function(a){clearTimeout(a)});var v=window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.oRequestAnimationFrame||window.requestAnimationFrame,w=window.mozCancelAnimationFrame||window.cancelAnimationFrame,x={easeing:"easeInOutSine",animated:!1,dragged:null,getAnimationCurve:function(a,b){var c=1e3/60/a/4;return l(b,c)},actualAnimation:function(a,b,c,d,e){function f(b){null===j&&(j=b);var k=b-j,l=k/c;l>=1&&(l=1);var m=d(l).toFixed(2);h.step(a,m,e,i),1===l?(w(g),j=null):v(f)}var g,h=this,i=e-b,j=null;g=v(f)},step:function(a,b,c,d){this.offset(a,parseInt(c)+parseInt((d-c)*b))},offset:function(a,b){if("undefined"==typeof b){if(s){var c=a.style[s]?a.style[s].match(/-?\d+/g)[0]:0;return c}return a.style.left}s?a.style[s]="translate("+b+"px, 0px)":a.style.left=b+"px"},animate:function(a,b,c,d){var e=this,f=d||e.easeing,g=k(f);if(e.animated)return!1;e.animated=!0;var h=e.getAnimationCurve(c,g);a.forEach(function(a){e.actualAnimation(a,b,c,h,e.offset(a))}),e.animated=!1},resetRows:function(a,b,c){var d=this;if(d.animated)return!1;d.animated=!0;var e=d.getAnimationCurve(b,c||k(d.easeing));a.forEach(function(a){d.actualAnimation(a,0,b,e,0)}),d.animated=!1},drag:function(a,b){var c=this;return c.animated?!1:void a.forEach(function(a){c.dragged=v(function(){c.offset(a,b)})})},stopDragging:function(){var a=this;w(a.dragged)}},y=(!!navigator.pointerEnabled||navigator.msPointerEnabled,function(a){var b=a.toLowerCase(),c="MS"+a;return navigator.msPointerEnabled?c:b}),z={start:y("PointerDown")+" touchstart mousedown",end:y("PointerUp")+" touchend mouseup",move:y("PointerMove")+" touchmove mousemove"},A=function(a){return a.targetTouches?a.targetTouches[0]:a},B={points:{cachedX:null,cachedY:null,currX:null,currY:null},touchStarted:!1,touchEvents:z,getPointerEvent:A,onTouchStart:function(a){var b=this,c=b.getPointerEvent(a);return b.points.cachedX=b.points.currX=c.pageX,b.points.cachedY=b.points.currY=c.pageY,b.touchStarted=!0,b.points},onTouchEnd:function(){var a=this,b=a.points.cachedY-a.points.currY,c=a.points.cachedX-a.points.currX;return a.touchStarted=!1,{deltaX:c,deltaY:b}},onTouchMove:function(a){var b=this;if(b.touchStarted===!1)return!1;var c=b.getPointerEvent(a);return b.points.currX=c.pageX,b.points.currY=c.pageY,Math.abs(b.points.cachedY-b.points.currY)>=Math.abs(b.points.cachedX-b.points.currX)?!1:b.points}},C={setUpPeriods:function(a,b){var c=b.periods,d=document.createDocumentFragment();if(c instanceof Array&&c.length){var f=c.length,g=e("div","t-row t-first-row",d),h=e("div","t-row-content-wrapper",g),i=e("div","t-row-content",h),j='<div class="t-element">';j+='<div class="t-cell-desc-l">',j+=b.from,"undefined"!=typeof c[0][1]&&(j+='<span class="t-header-devider">'+b.headerRowDevider+"</span>",j+=b.to),j+="</div>",j+="</div>";for(var k=(e("div","t-row-desc",i,j),e("div","t-row-values",i)),l=e("div","t-sliding-row",k),m=0;f>m;m++){var n=document.createElement("div");n.className="t-row-cell";var o='<div class="t-cell-desc-s">';o+=b.from,"undefined"!=typeof c[m][1]&&(o+='<span class="t-header-devider">'+b.headerRowDevider+"</span>",o+=b.to),o+="</div>",o+='<div class="t-cell-value t-bold">',o+="undefined"!=typeof c[m][0]?c[m][0]:"not set","undefined"!=typeof c[m][1]&&(o+='<span class="t-header-devider">'+b.headerRowDevider+"</span>",o+=c[m][1]),o+="</div>";{e("div","t-element",n,o)}l.appendChild(n)}return a.appendChild(d),g}return!1},setUpRows:function(a,b){var c=b.periods,d=b.rows,f=c.length,g=d.length,h=document.createDocumentFragment();if(g>0){for(var i=!0,j=0;g>j&&i;j++){var k=e("div","t-row",h);if(d[j].desc){e("section","t-row-header",k,d[j].desc)}if(d[j].prices)for(var l=0;l<d[j].prices.length;l++){var m=e("div","t-row-content-wrapper",k),n=e("div","t-row-content",m);if(!i)break;var o='<div class="t-element">';o+='<div class="t-cell-desc-l">',o+=d[j].pricesDesc[l],o+="</div>",o+="</div>";var p="t-row-desc";l>=1&&(p+=" t-cell-border-top");for(var q=(e("div",p,n,o),e("div","t-row-values",n)),r=e("div","t-sliding-row",q),s=0;s<d[j].prices[l].length;s++){if(d[j].prices[l].length!==f){i=!1;break}var t=document.createElement("div"),u="t-row-cell";l>=1&&(u+=" t-cell-border-top"),t.className=u;var v="";d[j].pricesDesc[l]&&(v+='<div class="t-cell-desc-s">',v+=d[j].pricesDesc[l],v+="</div>"),v+='<div class="t-cell-value">',v+="undefined"!=typeof d[j].prices[l][s]?d[j].prices[l][s]:"not set",v+=" "+b.currency,v+="</div>";{e("div","t-element",t,v)}r.appendChild(t)}}}return a.appendChild(h),i}return!1},setUpArrows:function(a){var b="http://www.w3.org/2000/svg",c=document.createElementNS(b,"svg");c.setAttribute("viewBox","0 0 100 100");var d=document.createElementNS(b,"path");d.setAttribute("d","M 50,0 L 60,10 L 20,50 L 60,90 L 50,100 L 0,50 Z"),d.setAttribute("transform","translate(15,0)"),d.setAttribute("class","t-svg-arrow"),c.appendChild(d);var f=document.createElementNS(b,"svg");f.setAttribute("viewBox","0 0 100 100");var g=document.createElementNS(b,"path");g.setAttribute("d","M 50,0 L 60,10 L 20,50 L 60,90 L 50,100 L 0,50 Z"),g.setAttribute("class","t-svg-arrow"),g.setAttribute("transform","translate(85,100) rotate(180)"),f.appendChild(g);var h=e("div","t-arr-right t-hide",a),i=e("div","t-arr-left t-hide",a);return h.appendChild(f),i.appendChild(c),{arrowRight:h,arrowLeft:i}}};return n.prototype.attachEvents=function(){var a=this;x.easing=a.options.easing,a.arrows.arrowLeft.addEventListener("click",function(){a.move("left")}),a.arrows.arrowRight.addEventListener("click",function(){a.move("right")});var b,c,d,e,f,h,i=a.options.periods.length,j=a.periodRow.querySelector(".t-sliding-row"),k=!0,l=0;a.slidingRows.forEach(function(m){g(m,B.touchEvents.start,function(b){d=x.offset(j),c=B.onTouchStart(b),f=parseInt(a.currentCellWidth),l=0,h=a.pointer}),g(m,B.touchEvents.move,function(g){if(b=B.onTouchMove(g),b&&k){if(e=b.currX-c.cachedX,x.drag(a.slidingRows,e+parseInt(d)),l=Math.abs(Math.floor(e/a.options.swipeThreshold)),a.options.swipeSingleTick&&l>=1&&(l=1),e>=0)0===a.pointer?Math.abs(parseInt(x.offset(j)))>=a.options.edgeThreshold&&(k=!1):a.pointer=h-l;else if(a.pointer===i-a.currentBreakpoint.cellBreakpoint[1]||i<a.currentBreakpoint.cellBreakpoint[1]){{var m=Math.abs(parseInt(x.offset(j)));j.clientWidth}m>=a.options.edgeThreshold+f*a.pointer&&(k=!1)}else a.pointer=h+l;c=b}}),g(m,B.touchEvents.end,function(){B.onTouchEnd(),d=0;var b=parseInt(x.offset(j));a.resetDragging(parseInt(b+a.pointer*f)),k=!0,a.updateArrows()})})},n.prototype.resetDragging=function(a){var b=this;x.stopDragging(),x.animate(b.slidingRows,a,i(a,b.options.reboundSpeed),"easeOutBack")},n.prototype.refreshSize=function(){var a=this,b=a.currentBreakpoint,c=a.currentBreakpoint=a.getBreakpoint(),d=a.currentCellWidth,e=a.currentCellWidth=a.getCellWidth(c),g=c.descBreakpoint[1],i=a.options.periods.length;a.refreshArrowPosition(g);var j=f(a.el.querySelectorAll(".t-row"));j.forEach(function(a){var b=f(a.querySelectorAll(".t-row-content"));b.forEach(c.descBreakpoint[1]>0?function(a){a.style.width=g+i*e+"px";var b=a.querySelector(".t-row-desc");b.style.width=g+"px",r.remove(b,"t-hide"),f(a.querySelectorAll(".t-row-cell")).forEach(function(a){a.style.width=e+"px"}),f(a.querySelectorAll(".t-cell-desc-s")).forEach(function(a){r.add(a,"t-hide")})}:function(a){a.style.width=i*e+"px",r.add(a.querySelector(".t-row-desc"),"t-hide"),f(a.querySelectorAll(".t-row-cell")).forEach(function(a){a.style.width=e+"px"}),f(a.querySelectorAll(".t-cell-desc-s")).forEach(function(a){r.remove(a,"t-hide")})})}),a.pointer>0&&(b.cellBreakpoint[0]!=c.cellBreakpoint[0]||b.descBreakpoint[1]!=c.descBreakpoint[1]?a.move():d!=e&&a.move(parseInt(e-d)*parseInt(a.pointer))),"function"==typeof a.options.onRefreshSize&&h(a.options.onRefreshSize,a),a.arrowsCentering()},n.prototype.getCellWidth=function(a){var b,c=this,d=c.options.periods.length,e=a.cellBreakpoint,f=a.descBreakpoint;return b=e[1]>d?(c.el.clientWidth-f[1])/d:(c.el.clientWidth-f[1])/e[1],Math.round(b)},n.prototype.getBreakpoint=function(){var a=this,b=0,c=a.el.clientWidth,d=a.options.cellBreakpoints,e=a.options.descBreakpoints,f=[0,1],g=[0,0];for(var h in d){var i=d[h][0];"number"==typeof i&&i>0&&c>=i&&Math.abs(c-i)<Math.abs(c-b)&&(b=i,f=d[h])}b=0;for(var j in e){var k=e[j][0];"number"==typeof k&&k>0&&c>=k&&Math.abs(c-k)<Math.abs(c-b)&&(b=k,g=e[j])}return{cellBreakpoint:f,descBreakpoint:g}},n.prototype.refreshArrowPosition=function(a){var b=this,c=a||b.currentBreakpoint.descBreakpoint[1];b.arrows.arrowLeft.style.left=c+"px",b.updateArrows()},n.prototype.updateArrows=function(){var a=this,b=a.currentBreakpoint||a.getBreakpoint(),c=a.options.periods.length;c>b.cellBreakpoint[1]?0===a.pointer?(r.add(a.arrows.arrowLeft,"t-hide"),r.remove(a.arrows.arrowRight,"t-hide")):a.pointer===c-b.cellBreakpoint[1]?(r.remove(a.arrows.arrowLeft,"t-hide"),r.add(a.arrows.arrowRight,"t-hide")):(r.remove(a.arrows.arrowLeft,"t-hide"),r.remove(a.arrows.arrowRight,"t-hide")):(r.add(a.arrows.arrowLeft,"t-hide"),r.add(a.arrows.arrowRight,"t-hide"))},n.prototype.move=function(a){{var b=this,c=b.getCellWidth(b.currentBreakpoint);b.options.periods.length}"right"===a?(x.animate(b.slidingRows,c,b.options.duration),b.pointer++):"left"===a?(x.animate(b.slidingRows,-c,b.options.duration),b.pointer--):"number"==typeof a?x.animate(b.slidingRows,a,i(a,b.options.reboundSpeed)):(x.resetRows(b.slidingRows,200),b.pointer=0),b.updateArrows()},n.prototype.setSingleTick=function(a){this.options.swipeSingleTick=!!a},n.prototype.getCurrentBreakPoint=function(){return this.currentBreakpoint},n.prototype.arrowsCentering=function(){var a=this,b=a.periodRow.offsetHeight,c=a.arrows.arrowRight.offsetHeight;if(c&&b>c){var d=parseInt((b-c)/2-1);a.arrows.arrowRight.style.marginTop=d+"px",a.arrows.arrowLeft.style.marginTop=d+"px"}},n});