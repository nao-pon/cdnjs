/**
 * jQuery Typeahead
 *
 * @author Tom Bertrand
 * @version 1.3.0 (2014-09-10)
 *
 * @copyright
 * Copyright (C) 2014 RunningCoder.
 *
 * @link
 * http://www.runningcoder.org/jquerytypeahead/
 *
 * @license
 * Licensed under the MIT license.
 */
(function(e,t,n,r){e.Typeahead={source:{}};if(typeof Object.preventExtensions!=="function"){Object.preventExtensions=function(e){return e}}var i={input:null,minLength:2,maxItem:8,order:null,offset:false,hint:false,accent:false,highlight:true,list:false,group:false,filter:false,backdrop:false,cache:false,ttl:36e5,compression:false,containerClass:"typeahead-search-container",fieldClass:"typeahead-search-field",groupClass:"typeahead-search-group",resultClass:"typeahead-search-result",backdropClass:"typeahead-search-backdrop",display:"display",template:null,source:null,callback:{onInit:null,onMouseEnter:null,onMouseLeave:null,onClick:null,onSubmit:null},debug:false};var s={order:["asc","desc"],offset:[true,false],accent:[true,false],highlight:[true,false],cache:[true,false],compression:[true,false],debug:[true,false]};var o={display:"typeahead-display",query:"typeahead-query",filter:"typeahead-filter",button:"typeahead-button",filterValue:"typeahead-filter-value",dropdown:"typeahead-dropdown",hint:"typeahead-hint"};var u={from:"ãàáäâẽèéëêìíïîõòóöôùúüûñç",to:"aaaaaeeeeeiiiiooooouuuunc"};var a=function(r,a){function y(){for(var t in a){if(!a.hasOwnProperty(t)){continue}if(t==="source"){for(var r in a[t]){if(!a[t].hasOwnProperty(r)){continue}if(!(a[t][r]instanceof Object)||r==="data"){r="list";a[t]={list:a[t]}}}}else if(s[t]&&n.inArray(a[t],s[t])===-1){delete a[t]}}if(a.cache){a.cache=function(){var t=typeof e.localStorage!=="undefined";if(t){try{localStorage.setItem("typeahead","typeahead");localStorage.removeItem("typeahead")}catch(n){t=false}}return t}()}a=n.extend(true,Object.preventExtensions(n.extend(true,{},i)),a)}function b(){B(a.callback.onInit,[r]);var e=".typeahead.input",t=["focus"+e,"input"+e,"keydown"+e];n("html").on("click"+e,function(){N()});r.parents("."+a.containerClass).on("click"+e,function(e){e.stopPropagation();if(a.filter){r.parents("."+a.containerClass).find("."+o.dropdown).hide()}});r.parents("form").on("submit",function(e){if(B(a.callback.onSubmit,[r,this,e])){return false}});r.on(t.join(" "),function(e){switch(e.type){case"keydown":if(e.keyCode&&~[9,13,27,38,39,40].indexOf(e.keyCode)){T(e)}break;case"focus":if(l===null){S();C()}break;case"input":default:if(!l){return}f=n(this).val().trim();N();if(f.length>=a.minLength&&f!==""){w();x();E()}break}})}function w(){if(f===""){return false}if(d&&!a.source[d]){d=false}var e;if(a.accent){f=P(f)}for(var t in h){if(!h.hasOwnProperty(t)||d&&t!==d){continue}for(var n in h[t]){if(!h[t].hasOwnProperty(n)){continue}if(p.length>=a.maxItem){break}e=h[t][n][a.display];if(a.accent){e=P(e)}if(e&&e.toLowerCase().indexOf(f.toLowerCase())!==-1&&(!a.offset||e.toLowerCase().indexOf(f.toLowerCase())===0)){if(a.source[t].ignore&&~a.source[t].ignore.indexOf(e)){continue}h[t][n].list=t;p.push(h[t][n])}}}if(a.order){p.sort(D(a.display,a.group?!(a.order==="asc"):a.order==="asc",function(e){return e.toUpperCase()}))}}function E(){if(p.length!==0){var e,t=n("<div/>",{"class":a.resultClass,html:n("<ul/>",{html:function(){for(var e in p){if(!p.hasOwnProperty(e)){continue}(function(e,t){var i,s,u,l,c,h,p,d;if(a.group){i=e.list;if(typeof a.group!=="boolean"&&e[a.group]){i=e[a.group]}}if(a.list){s=e.list;if(typeof a.list!=="boolean"&&e[a.list]){s=e[a.list]}}if(a.group&&!n(t).find('li[data-search-group="'+i+'"]')[0]){n(t).append(n("<li/>",{"class":a.groupClass,html:n("<a/>",{html:i}),"data-search-group":i}))}c=e[a.display].toLowerCase();h=f.toLowerCase();if(a.accent){c=P(c);h=P(h)}p=c.indexOf(h);d=e[a.display].substr(p,h.length);if(a.highlight){d="<strong>"+d+"</strong>"}c=H(e[a.display],p,h.length,d);u=n("<li/>",{html:n("<a/>",{href:"javascript:;","data-list":i,html:function(){l='<span class="'+o.display+'">'+c+"</span>"+(s?"<small>"+s+"</small>":"");if(a.template){l=a.template.replace(/\{\{([a-z0-9_\-]+)\}\}/gi,function(t,n,r){if(n===a.display){return l}return e[n]||"null"})}n(this).append(l)},click:({result:e},function(t){t.preventDefault();r.val(e[a.display]).focus();f=e[a.display];N();B(a.callback.onClick,[r,this,e,t])}),mouseenter:function(t){n(this).parents("."+a.resultClass).find(".active").removeClass("active");B(a.callback.onMouseEnter,[r,this,e,t])},mouseleave:function(t){B(a.callback.onMouseLeave,[r,this,e,t])}}),mouseenter:function(){n(this).siblings("li.active").removeClass("active");n(this).addClass("active")}});if(a.group){n(u).insertAfter(n(t).find('li[data-search-group="'+i+'"]'))}else{n(t).append(u)}})(p[e],this)}}})});r.parents("."+a.containerClass).addClass("result").append(t)}if(!a.backdrop||f===""){return}var i=n.extend({opacity:.6,filter:"alpha(opacity=60)",position:"fixed",top:0,right:0,bottom:0,left:0,"z-index":1040,"background-color":"#000"},a.backdrop);r.parents("."+a.containerClass).addClass("backdrop").css({"z-index":i["z-index"]+1,position:"relative"});n("<div/>",{"class":a.backdropClass,css:i,click:function(){N()}}).insertAfter(r.parents("."+a.containerClass))}function S(){if(!a.hint){return false}r.css({position:"relative","z-index":2,"background-color":"transparent"}).parent().css({position:"relative"});var e={top:r.css("border-top-width"),right:r.css("border-right-width"),bottom:r.css("border-bottom-width"),left:r.css("border-left-width")};var t=n.extend({border:"none",display:r.css("display"),position:"absolute",top:parseFloat(e.top)?e.top:"auto",left:parseFloat(e.left)?e.left:"auto","z-index":1,width:r.outerWidth(true)-(parseFloat(e.right)+parseFloat(e.left))+"px",height:r.outerHeight(true)-(parseFloat(e.top)+parseFloat(e.bottom))+"px","-webkit-text-fill-color":"silver",color:"silver","background-color":"transparent","user-select":"none"},a.hint);n("<input/>",{"class":o.hint,readonly:true,tabindex:-1,css:t,type:"search"}).insertBefore(r)}function x(){if(!a.hint||!p[0]){return false}var e=p[0];if(a.group){e=p[p.length-1]}if(e[a.display].toLowerCase().indexOf(f.toLowerCase())===0){r.siblings("."+o.hint).val(f+e[a.display].substring(f.length)).show();return e[a.display]}}function T(e){if(p.length===0&&e.keyCode!==13){return false}var t=r.parents("."+a.containerClass).find("."+a.resultClass).find("li:not([data-search-group])"),i=t.siblings(".active");if(e.keyCode===13){if(t.filter(".active")[0]){e.preventDefault();e.stopPropagation();t.filter(".active").find("a").click()}N()}else{e.preventDefault();if(t.length>1){i.removeClass("active")}if(e.keyCode===40){if(i[0]){i.next().addClass("active")}else{n(t[0]).toggleClass("active")}}else if(e.keyCode===38){if(i[0]){i.prev().addClass("active")}else{n(t[p.length-1]).toggleClass("active")}}else if(e.keyCode===39){if(a.hint&&!i[0]){r.val(x())}if(i[0]){i.find("a").click()}else{t.filter(".active").find("a").click()}f=r.val();N();return}if(a.group){var s=t.siblings(".active");if(s.attr("data-search-group")){s.removeClass("active");if(e.keyCode===40){s.next().addClass("active")}else if(e.keyCode===38){s.prev().addClass("active")}}}}if(a.hint){if(t.filter(".active")[0]){r.siblings("."+o.hint).hide()}else{r.siblings("."+o.hint).show()}}r.val(t.filter(".active").find("."+o.display).text()||f);return true}function N(){p=[];var e=r.parents("."+a.containerClass);if(a.filter){e.removeClass("filter").find("."+o.dropdown).hide()}if(a.hint){e.removeClass("hint").find("."+o.hint).val("")}if(a.backdrop){e.removeClass("backdrop").removeAttr("style").siblings("."+a.backdropClass).remove()}e.removeClass("result").find("."+a.resultClass).remove()}function C(){l=false;if(g===0){for(var t in a.source){if(a.source.hasOwnProperty(t)){++g}}}for(var i in a.source){if(!a.source.hasOwnProperty(i)){continue}if(h[i]&&h[i].length!==0){_();continue}if(a.cache){h[i]=localStorage.getItem(r.selector+":"+i);if(h[i]){if(a.compression&&typeof LZString==="object"){h[i]=LZString.decompress(h[i])}var s=JSON.parse(h[i]);if(s.data&&s.ttl&&s.ttl>(new Date).getTime()){h[i]=s.data;_();continue}}}if(!a.source[i].data&&!a.source[i].url){a.source[i]={url:a.source[i]}}h[i]=[];if(a.source[i].data&&a.source[i].data instanceof Array){for(var o in a.source[i].data){if(!a.source[i].data.hasOwnProperty(o)){continue}if(a.source[i].data[o]instanceof Object){break}var u={};u[a.display]=a.source[i].data[o];a.source[i].data[o]=u}h[i]=h[i].concat(a.source[i].data);if(!a.source[i].url){O(i);_();continue}}if(a.source[i].url){var f=a.source[i].url instanceof Array&&a.source[i].url[0]||a.source[i].url,c=a.source[i].url instanceof Array&&a.source[i].url[1]||null,p={};if(typeof f==="object"){p=f;f=JSON.stringify(f)}var d=M.get(f);if(/https?:\/\//.test(f)&&!~f.indexOf(e.location.host)&&!!~f.indexOf("{callback}")){j.fetch(f.replace("{callback}",encodeURIComponent(v)),function(e){})}else{if(typeof d==="undefined"){M.set(f,[])}else if(d instanceof Array&&d.length===0){M.queue(f,i,c);continue}else{A(d,i,c);_();continue}n.ajax(n.extend({async:true,url:f,dataType:"json",ajaxList:i,ajaxPath:c},p)).done(function(e){A(e,this.ajaxList,this.ajaxPath);_();M.set(f,e);M.processQueue(f)}).fail(function(){_()})}}}}function k(){function e(e){d=e;r.parents("."+a.containerClass).find("."+o.filterValue).text(d||a.filter);r.parents("."+a.containerClass).find("."+o.dropdown).hide();N();w();x();E();r.focus()}if(!a.filter){return false}n("<span/>",{"class":o.filter,html:function(){n(this).append(n("<button/>",{type:"button",html:"<span class='"+o.filterValue+"'>"+a.filter+"</span> <span class='caret'></span>",click:function(e){e.stopPropagation();var t=n(this).parents("."+a.containerClass),r=t.find("."+o.dropdown);if(!r.is(":visible")){t.addClass("filter");r.show()}else{t.removeClass("filter");r.hide()}}}));n(this).append(n("<ul/>",{"class":o.dropdown,html:function(){for(var t in a.source){if(!a.source.hasOwnProperty(t)){continue}(function(t,r){var i=n("<li/>",{html:n("<a/>",{href:"javascript:;",html:t,click:({i:t},function(n){n.preventDefault();e(t)})})});n(r).append(i)})(t,this)}n(this).append(n("<li/>",{"class":"divider"}));n(this).append(n("<li/>",{html:n("<a/>",{href:"javascript:;",html:a.filter,click:function(t){t.preventDefault();e()}})}))}}))}}).insertAfter(r.parents("."+a.containerClass).find("."+o.query))}function L(e){if(!e||!e.list){return false}var t=e.list||"list",n=a.source[t].url instanceof Array?a.source[t].url[1]:null;A(e,t,n);_()}function _(){m++;if(m===g){l=true;delete c}}var f="",l=null,c=[],h=[],p=[],d,v="window.Typeahead.source['"+r.selector+"'].populate",m=0,g=0;var A=function(e,t,n){var r=true;if(n){var i=n.split("."),s=0;while(s<i.length){if(typeof e!=="undefined"){e=e[i[s++]]}else{r=false;break}}}if(r){for(var o in e){if(!e.hasOwnProperty(o)){continue}if(e[o]instanceof Object){break}var u={};u[a.display]=e[o];e[o]=u}h[t]=h[t].concat(e);O(t)}};var O=function(e){if(!a.cache){return false}var t={ttl:(new Date).getTime()+a.ttl,data:h[e]};t=JSON.stringify(t);if(a.compression&&typeof LZString==="object"){t=LZString.compress(t)}localStorage.setItem(r.selector+":"+e,t)};var M={_queue:[],get:function(e){return c[e]},set:function(e,t){c[e]=t},queue:function(e,t,n){this._queue.push({url:e,list:t,path:n})},processQueue:function(e){for(var t in this._queue){if(this._queue[t].url!==e){continue}A(c[e],this._queue[t].list,this._queue[t].path);_();delete this._queue[t]}}};var D=function(e,t,n){var r=n?function(t){return n(t[e])}:function(t){return t[e]};t=[-1,1][+!!t];return function(e,n){return e=r(e),n=r(n),t*((e>n)-(n>e))}};var P=function(e){if(!e||typeof e!=="string"){return false}e=e.toLowerCase();for(var t=0,n=u.from.length;t<n;t++){e=e.replace(new RegExp(u.from.charAt(t),"g"),u.to.charAt(t))}return e};var H=function(e,t,n,r){return e.substring(0,t)+r+e.substring(t+n)};var B=function(t,r){if(!t){return false}var i;if(typeof t==="function"){i=t}else if(typeof t==="string"||t instanceof Array){i=e;if(typeof t==="string"){t=[t,[]]}var s=t[0].split("."),o=t[1],u=true,a=0;while(a<s.length){if(typeof i!=="undefined"){i=i[s[a++]]}else{u=false;break}}if(!u||typeof i!=="function"){return false}}i.apply(this,n.merge(o||[],r?r:[]));return true};var j={fetch:function(n,r){var i=encodeURIComponent(v);e[i]=this.evalJSONP(r);n=n.replace("="+v,"="+i);var s=t.createElement("SCRIPT");s.src=n;t.getElementsByTagName("HEAD")[0].appendChild(s)},evalJSONP:function(e){return function(t){var n=false;if(typeof t==="string"){try{n=JSON.parse(t)}catch(r){}}else{n=JSON.parse(JSON.stringify(t))}if(n){e(n)}else{throw"JSONP call returned invalid or empty JSON"}}}};this.__construct=function(){y();b();k()}();return{populate:L}};n.fn.typeahead=n.typeahead=function(e){return f.typeahead(this,e)};var f={typeahead:function(t,r){if(!r||!r.source){return}if(typeof t==="function"){if(!r.input){return}t=n(r.input);if(!t[0]||t.length>1){return}}else if(typeof t[0]==="undefined"||t.length>1){return}return t.each(function(){e.Typeahead.source[t.selector]=new a(t,r)})}}})(window,document,window.jQuery)