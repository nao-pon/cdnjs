/**
 * jQuery Typeahead
 *
 * @author Tom Bertrand
 * @version 1.6.1 (2014-10-11)
 *
 * @copyright
 * Copyright (C) 2014 RunningCoder.
 *
 * @link
 * http://www.runningcoder.org/jquerytypeahead/
 *
 * @license
 * Licensed under the MIT license.
 *
 * @note
 * Remove debug code: //\s?\{debug\}[\s\S]*?\{/debug\}
 */
(function(e,t,n,r){e.Typeahead={source:{}};if(typeof Object.preventExtensions!=="function"){Object.preventExtensions=function(e){return e}}var i={input:null,minLength:2,maxItem:8,dynamic:false,delay:300,order:null,offset:false,hint:false,accent:false,highlight:true,list:false,group:false,groupMaxItem:false,filter:false,backdrop:false,cache:false,ttl:36e5,compression:false,selector:{container:"typeahead-container",group:"typeahead-group",result:"typeahead-result",list:"typeahead-list",display:"typeahead-display",query:"typeahead-query",filter:"typeahead-filter",filterButton:"typeahead-filter-button",filterValue:"typeahead-filter-value",dropdown:"typeahead-dropdown",button:"typeahead-button",backdrop:"typeahead-backdrop",hint:"typeahead-hint"},display:"display",template:null,source:null,callback:{onInit:null,onResult:null,onMouseEnter:null,onMouseLeave:null,onClick:null,onSubmit:null},debug:false};var s={dynamic:[true,false],order:["asc","desc"],offset:[true,false],accent:[true,false],highlight:[true,false],cache:[true,false],compression:[true,false],debug:[true,false]};var o=".typeahead.input";var u={from:"ãàáäâẽèéëêìíïîõòóöôùúüûñç",to:"aaaaaeeeeeiiiiooooouuuunc"};var a=function(r,a){function S(){for(var t in a){if(!a.hasOwnProperty(t)){continue}if(t==="source"){if(JSON.stringify(a[t])==="{}"){a.debug&&e.Debug.log({node:r.selector,"function":"extendOptions()",arguments:"{options.source}",message:"ERROR - source.group.url or source.group.data is Required"})}for(var o in a[t]){if(!a[t].hasOwnProperty(o)){continue}if(!(a[t][o]instanceof Object)||o==="data"){o="group";a[t]={group:a[t]}}if(!a[t][o].url&&!a[t][o].data){i.debug&&e.Debug.log({node:r.selector,"function":"extendOptions()",arguments:"{options.source}",message:"ERROR - source.group.url or source.group.data is Required"})}}}else if(s[t]&&n.inArray(a[t],s[t])===-1){a.debug&&e.Debug.log({node:r.selector,"function":"extendOptions()",arguments:"{"+t+":"+JSON.stringify(a[t])+"}",message:"WARNING - Unsupported option: "+t});delete a[t]}}if(a.dynamic){a.cache=false;a.compression=false}if(a.cache){a.cache=function(){var t=typeof e.localStorage!=="undefined";if(t){try{localStorage.setItem("typeahead","typeahead");localStorage.removeItem("typeahead")}catch(n){t=false}}return t}()}a=n.extend(true,Object.preventExtensions(n.extend(true,{},i)),a)}function x(){q(a.callback.onInit,[r]);a.debug&&e.Debug.log({node:r.selector,"function":"delegateTypeahead()",arguments:JSON.stringify(a),message:"OK - Typeahead activated on "+r.selector});v=r.parents("."+a.selector.container);var t=["focus"+o,"input"+o,"propertychange"+o,"keydown"+o,"dynamic"+o];n("html").on("click"+o,function(e){k()});v.on("click"+o,function(e){e.stopPropagation();if(a.filter){v.find("."+a.selector.dropdown.replace(" ",".")).hide()}});r.parents("form").on("submit",function(e){if(q(a.callback.onSubmit,[r,this,e])){return false}});r.on(t.join(" "),function(e){switch(e.type){case"keydown":if(e.keyCode&&~[9,13,27,38,39,40].indexOf(e.keyCode)){C(e)}break;case"focus":if(l===null){if(!a.dynamic){L()}}break;case"input":case"propertychange":if(!l){if(a.dynamic){f=n(this).val().trim();I(function(){if(f.length>=a.minLength&&f!==""){L()}},a.delay)}return};case"dynamic":default:f=n(this).val().trim();k();if(f.length>=a.minLength&&f!==""){T();N()}if(e.type==="dynamic"&&a.dynamic){l=false;w=0}break}})}function T(){if(f===""){return false}if(d&&!a.source[d]){d=false}var t,n=f,i=0,s=/\d/.test(a.groupMaxItem)&&a.groupMaxItem,o;if(a.accent){n=j(f)}for(var u in h){if(!h.hasOwnProperty(u)||d&&u!==d){continue}if(s){o=0}for(var l in h[u]){if(!h[u].hasOwnProperty(l)){continue}if((p.length>=a.maxItem||s&&o>=s)&&!a.callback.onResult){break}t=h[u][l][a.display];if(!t){a.debug&&e.Debug.log({node:r.selector,"function":"search()",arguments:'{display: "'+a.display+'"}',message:'WARNING - unable to find display: "'+a.display+'" inside '+JSON.stringify(h[u][l])});continue}if(a.accent){t=j(t)}if(t.toLowerCase().indexOf(n.toLowerCase())!==-1&&(!a.offset||t.toLowerCase().indexOf(n.toLowerCase())===0)){if(a.source[u].ignore&&~a.source[u].ignore.indexOf(t)){continue}i++;if(a.callback.onResult&&(p.length>=a.maxItem||s&&o>=s)){continue}h[u][l].group=u;p.push(h[u][l]);if(s){o++}}}}e.Debug.print();if(a.order){p.sort(B(a.display,a.order==="asc",function(e){return e.toUpperCase()}))}if(a.group){var c=[];for(var u in h){for(var v in p){if(p[v].group===u){c.push(p[v])}}}p=c}q(a.callback.onResult,[r,f,p,i]);return true}function N(){if(f===""||p.length===0){return false}var e=n("<div/>",{"class":a.selector.result,html:n("<ul/>",{"class":a.selector.list,html:function(){for(var e in p){if(!p.hasOwnProperty(e)){continue}(function(e,t){var i,s,o,u,l,c,h,p;if(a.group){i=e.group;if(typeof a.group!=="boolean"&&e[a.group]){i=e[a.group]}}if(a.list){s=e.group;if(typeof a.list!=="boolean"&&e[a.list]){s=e[a.list]}}if(a.group&&!n(t).find('li[data-search-group="'+i+'"]')[0]){n(t).append(n("<li/>",{"class":a.selector.group,html:n("<a/>",{html:i}),"data-search-group":i}))}l=e[a.display].toLowerCase();c=f.toLowerCase();if(a.accent){l=j(l);c=j(c)}h=l.indexOf(c);p=e[a.display].substr(h,c.length);if(a.highlight){p="<strong>"+p+"</strong>"}l=F(e[a.display],h,c.length,p);o=n("<li/>",{html:n("<a/>",{href:"javascript:;","data-group":i,html:function(){u='<span class="'+a.selector.display+'">'+l+"</span>"+(s?"<small>"+s+"</small>":"");if(a.template){u=a.template.replace(/\{\{([a-z0-9_\-]+)\}\}/gi,function(t,n,r){if(n===a.display){return u}return e[n]||"null"})}n(this).append(u)},click:({result:e},function(t){t.preventDefault();f=e[a.display];r.val(f).focus();k();q(a.callback.onClick,[r,this,e,t])}),mouseenter:function(t){n(this).parent().siblings("li.active").removeClass("active");n(this).parent().addClass("active");q(a.callback.onMouseEnter,[r,this,e,t])},mouseleave:function(t){n(this).parent().removeClass("active");q(a.callback.onMouseLeave,[r,this,e,t])}})});if(a.group){var d=n(t).find('a[data-group="'+i+'"]:last').closest("li");if(!d[0]){d=n(t).find('li[data-search-group="'+i+'"]')}n(o).insertAfter(d)}else{n(t).append(o)}})(p[e],this)}}})});v.addClass("result").append(e);if(a.backdrop){if(m.container){m.container.show()}else{m.css=n.extend({opacity:.6,filter:"alpha(opacity=60)",position:"fixed",top:0,right:0,bottom:0,left:0,"z-index":1040,"background-color":"#000"},a.backdrop);m.container=n("<div/>",{"class":a.selector.backdrop,css:m.css,click:function(){k()}}).insertAfter(v)}v.addClass("backdrop").css({"z-index":m.css["z-index"]+1,position:"relative"})}if(a.hint){if(!g.container){g.css=n.extend({"border-color":"transparent",position:"absolute","z-index":1,"-webkit-text-fill-color":"silver",color:"silver","background-color":"transparent","user-select":"none","box-shadow":"none","min-width":r.outerWidth(true)},a.hint);g.container=r.clone(true).attr({"class":a.selector.hint,readonly:true,tabindex:-1}).removeAttr("id placeholder name").css(g.css).insertBefore(r);r.css({position:"relative","z-index":2,"background-color":"transparent"}).parent().css({position:"relative"})}var t,i=p[0].group;for(var s in p){if(!p.hasOwnProperty(s)){continue}if(p[s].group!==i){if(!t){i=p[s].group}else{break}}if(p[s][a.display].toLowerCase().indexOf(f.toLowerCase())===0){t=p[s][a.display];if(!a.group){break}}}if(t){g.container.val(f+t.substring(f.length)).show()}}return true}function C(e){if(p.length===0&&e.keyCode!==13){return false}var t=v.find("."+a.selector.result).find("li:not([data-search-group])"),i=t.siblings(".active");if(e.keyCode===13){if(t.filter(".active")[0]){e.preventDefault();e.stopPropagation();t.filter(".active").find("a").click()}k()}else{e.preventDefault();if(t.length>1){i.removeClass("active")}if(e.keyCode===40){if(i[0]){i.next().addClass("active")}else{n(t[0]).toggleClass("active")}}else if(e.keyCode===38){if(i[0]){i.prev().addClass("active")}else{n(t[p.length-1]).toggleClass("active")}}else if(e.keyCode===39){if(a.hint&&!i[0]){r.val(g.container.val())}if(i[0]){i.find("a").click()}else{t.filter(".active").find("a").click()}f=r.val();k();return true}if(a.group){var s=t.siblings(".active");if(s.attr("data-search-group")){s.removeClass("active");if(e.keyCode===40){s.next().addClass("active")}else if(e.keyCode===38){s.prev().addClass("active")}}}}if(a.hint){if(t.filter(".active")[0]){g.container.hide()}else{g.container.show()}}r.val(t.filter(".active").find("."+a.selector.display).text()||f);return true}function k(){p=[];if(a.filter){v.removeClass("filter").find("."+a.selector.dropdown.replace(" ",".")).hide()}if(a.hint){v.removeClass("hint");if(g.container){g.container.val("")}}if(a.backdrop||f===""){v.removeClass("backdrop").removeAttr("style");if(m.container){m.container.hide()}}v.removeClass("result").find("."+a.selector.result).remove();q(a.callback.onResult,[r,"",[],0])}function L(){l=false;y=(new Date).getTime();if(E===0){for(var t in a.source){if(a.source.hasOwnProperty(t)){++E}}}for(var i in a.source){if(!a.source.hasOwnProperty(i)){continue}if(!a.dynamic&&h[i]&&h[i].length!==0){P();continue}if(a.cache){h[i]=localStorage.getItem(r.selector+":"+i);if(h[i]){if(a.compression&&typeof LZString==="object"){h[i]=LZString.decompress(h[i])}var s=JSON.parse(h[i]);if(s.data&&s.ttl&&s.ttl>(new Date).getTime()){a.debug&&e.Debug.log({node:r.selector,"function":"generate()",arguments:"{cache: true}",message:"OK - List: "+r.selector+":"+i+'" found in localStorage.'});e.Debug.print();h[i]=s.data;P();continue}}}if(!a.source[i].data&&!a.source[i].url){a.source[i]={url:a.source[i]}}h[i]=[];if(a.source[i].data&&a.source[i].data instanceof Array){for(var o in a.source[i].data){if(!a.source[i].data.hasOwnProperty(o)){continue}if(a.source[i].data[o]instanceof Object){break}var u={};u[a.display]=a.source[i].data[o];a.source[i].data[o]=u}h[i]=h[i].concat(a.source[i].data);if(!a.source[i].url){_(i);P();continue}}if(a.source[i].url){var c=a.source[i].url instanceof Array&&a.source[i].url[0]||a.source[i].url,p=a.source[i].url instanceof Array&&a.source[i].url[1]||null,d={};if(typeof c==="object"){d=n.extend(true,{},c);c=JSON.stringify(c)}var v=D.get(c);if(/https?:\/\//.test(c)&&!~c.indexOf(e.location.host)&&!!~c.indexOf("{callback}")){R.fetch(c.replace("{callback}",encodeURIComponent(b)),function(e){})}else{if(typeof v==="undefined"){D.set(c,[])}else if(v instanceof Array&&v.length===0){D.queue(c,i,p);continue}else{M(v,i,p);P();continue}if(d&&d.data){for(var m in d.data){if(d.data[m]==="{{query}}"){d.data[m]=f;break}}}n.ajax(n.extend({async:true,url:c,dataType:"json",ajaxGroup:i,ajaxPath:p,ajaxTimestamp:y},d)).done(function(e){if(this.ajaxTimestamp!==y){return false}D.set(c,e);D.processQueue(c);M(e,this.ajaxGroup,this.ajaxPath)}).fail(function(){a.debug&&e.Debug.log({node:r.selector,"function":"generate()",arguments:"{url: "+this.url+"}",message:"ERROR - Ajax request failed."})}).complete(function(){if(this.ajaxTimestamp===y){P()}})}}}}function A(){function e(e){d=e;v.find("."+a.selector.filterValue).text(d||a.filter);v.find("."+a.selector.dropdown.replace(" ",".")).hide();k();T();N();r.focus()}if(!a.filter){return false}n("<span/>",{"class":a.selector.filter,html:function(){n(this).append(n("<button/>",{type:"button","class":a.selector.filterButton,html:"<span class='"+a.selector.filterValue+"'>"+a.filter+"</span> <span class='caret'></span>",click:function(e){e.stopPropagation();var t=v.find("."+a.selector.dropdown.replace(" ","."));if(!t.is(":visible")){v.addClass("filter");t.show()}else{v.removeClass("filter");t.hide()}}}));n(this).append(n("<ul/>",{"class":a.selector.dropdown,html:function(){for(var t in a.source){if(!a.source.hasOwnProperty(t)){continue}(function(t,r){var i=n("<li/>",{html:n("<a/>",{href:"javascript:;",html:t,click:({i:t},function(n){n.preventDefault();e(t)})})});n(r).append(i)})(t,this)}n(this).append(n("<li/>",{"class":"divider"}));n(this).append(n("<li/>",{html:n("<a/>",{href:"javascript:;",html:a.filter,click:function(t){t.preventDefault();e()}})}))}}))}}).insertAfter(v.find("."+a.selector.query))}function O(t){if(!t||!t.group){a.debug&&e.Debug.log({node:r.selector,"function":"populate()",message:'ERROR - Empty data or Missing {data.group} parameter"'});e.Debug.print();return false}var n=t.group||"group",i=a.source[n].url instanceof Array?a.source[n].url[1]:null;M(t,n,i);P()}function P(){w++;if(w===E){l=true;c=[];if(a.dynamic){r.trigger("dynamic.typeahead.input")}}}function H(){if(!v[0]){a.debug&&e.Debug.log({node:r.selector,"function":"_validateHtml()",arguments:a.selector.container,message:'ERROR - Missing input parent container class: ".'+a.selector.container+'"'});return false}n.each([a.selector.query,a.selector.button],function(t,n){if(!v.find("."+n)[0]){a.debug&&e.Debug.log({node:r.selector,"function":"_validateHtml()",arguments:a.selector.query,message:'ERROR - Missing container with class: ".'+n+'"'})}})}var f="",l=null,c=[],h=[],p=[],d,v,m={},g={},y=null,b="window.Typeahead.source['"+r.selector+"'].populate",w=0,E=0;var M=function(e,t,n){var r=true;if(n){var i=n.split("."),s=0;while(s<i.length){if(typeof e!=="undefined"){e=e[i[s++]]}else{r=false;break}}}if(r){for(var o in e){if(!e.hasOwnProperty(o)){continue}if(e[o]instanceof Object){break}var u={};u[a.display]=e[o];e[o]=u}h[t]=h[t].concat(e);_(t)}};var _=function(e){if(!a.cache){return false}var t={ttl:(new Date).getTime()+a.ttl,data:h[e]};t=JSON.stringify(t);if(a.compression&&typeof LZString==="object"){t=LZString.compress(t)}localStorage.setItem(r.selector+":"+e,t)};var D={_queue:[],get:function(e){return c[e]},set:function(e,t){c[e]=t},queue:function(e,t,n){this._queue.push({url:e,group:t,path:n})},processQueue:function(e){for(var t in this._queue){if(this._queue[t].url!==e){continue}M(c[e],this._queue[t].group,this._queue[t].path);P();delete this._queue[t]}}};var B=function(e,t,n){var r=n?function(t){return n(t[e])}:function(t){return t[e]};t=[-1,1][+!!t];return function(e,n){return e=r(e),n=r(n),t*((e>n)-(n>e))}};var j=function(e){if(!e||typeof e!=="string"){return false}e=e.toLowerCase();for(var t=0,n=u.from.length;t<n;t++){e=e.replace(new RegExp(u.from.charAt(t),"g"),u.to.charAt(t))}return e};var F=function(e,t,n,r){return e.substring(0,t)+r+e.substring(t+n)};var I=function(){var e=0;return function(t,n){clearTimeout(e);e=setTimeout(t,n)}}();var q=function(t,i){if(!t){return false}var s;if(typeof t==="function"){s=t}else if(typeof t==="string"||t instanceof Array){s=e;if(typeof t==="string"){t=[t,[]]}var o=t[0].split("."),u=t[1],f=true,l=0;while(l<o.length){if(typeof s!=="undefined"){s=s[o[l++]]}else{f=false;break}}if(!f||typeof s!=="function"){a.debug&&e.Debug.log({node:r.selector,"function":"_executeCallback()",arguments:JSON.stringify(t),message:'WARNING - Invalid callback function"'});return false}}s.apply(this,n.merge(u||[],i?i:[]));return true};var R={fetch:function(n,r){var i=encodeURIComponent(b);e[i]=this.evalJSONP(r);n=n.replace("="+b,"="+i);var s=t.createElement("SCRIPT");s.src=n;t.getElementsByTagName("HEAD")[0].appendChild(s)},evalJSONP:function(e){return function(t){var n=false;if(typeof t==="string"){try{n=JSON.parse(t)}catch(r){}}else{n=JSON.parse(JSON.stringify(t))}if(n){e(n)}else{throw"JSONP call returned invalid or empty JSON"}}}};this.__construct=function(){S();x();A();H();e.Debug&&e.Debug.print()}();return{populate:O}};n.fn.typeahead=n.typeahead=function(e){return f.typeahead(this,e)};var f={typeahead:function(t,r){if(!r||!r.source){e.Debug.log({node:t.selector,"function":"$.typeahead()",arguments:"",message:"Missing source option - Typeahead dropped"});e.Debug.print();return}if(typeof t==="function"){if(!r.input){e.Debug.log({node:t.selector,"function":"$.typeahead()",arguments:"",message:'Undefined property "options.input - Typeahead dropped'});e.Debug.print();return}t=n(r.input);if(!t[0]||t.length>1){e.Debug.log({node:t.selector,"function":"$.typeahead()",arguments:JSON.stringify(r.input),message:"Unable to find jQuery input element OR more than 1 input is found - Typeahead dropped"});e.Debug.print();return}}else if(typeof t[0]==="undefined"||t.length>1){e.Debug.log({node:t.selector,"function":"$.typeahead()",arguments:'$("'+t["selector"]+'").typeahead()',message:"Unable to find jQuery input element OR more than 1 input is found - Typeahead dropped"});e.Debug.print();return}return e.Typeahead.source[t.selector]=new a(t,r)}};e.Debug={table:{},log:function(e){if(!e.message||typeof e.message!=="string"){return false}this.table[e.message]=n.extend(Object.preventExtensions({node:"","function":"",arguments:""}),e)},print:function(){if(n.isEmptyObject(this.table)){return false}if(console.group!==r||console.table!==r){console.groupCollapsed("--- jQuery Typeahead Debug ---");if(console.table){console.table(this.table)}else{n.each(this.table,function(e,t){console.log(t["Name"]+": "+t["Execution Time"]+"ms")})}console.groupEnd()}else{console.log("Debug is not available on your current browser, try the most recent version of Chrome or Firefox.")}this.table={}}};if(!Array.prototype.indexOf){Array.prototype.indexOf=function(e){var t=this.length>>>0;var n=Number(arguments[1])||0;n=n<0?Math.ceil(n):Math.floor(n);if(n<0)n+=t;for(;n<t;n++){if(n in this&&this[n]===e)return n}return-1}}})(window,document,window.jQuery)