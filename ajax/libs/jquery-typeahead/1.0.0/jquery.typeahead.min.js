/**
 * jQuery Typeahead
 *
 * @author Tom Bertrand
 * @version 1.0.0 (2014-08-30)
 *
 * @copyright
 * Copyright (C) 2014 RunningCoder.
 *
 * @link
 * http://www.runningcoder.org/jquerytypeahead/
 *
 * @license
 * Licensed under the MIT license.
 */
(function(e,t,n,r){e.Typeahead={source:{}};if(typeof Object.preventExtensions!=="function"){Object.preventExtensions=function(e){return e}}var i={input:null,minLength:2,maxItem:8,order:null,position:"any",list:false,group:false,filter:false,backdrop:false,jStorage:false,ttl:36e5,compression:false,containerClass:"typeahead-search-container",fieldClass:"typeahead-search-field",groupClass:"typeahead-search-group",resultClass:"typeahead-search-result",backdropClass:"typeahead-search-backdrop",source:null,callback:{onInit:null,onMouseEnter:null,onMouseLeave:null,onClick:null},debug:false};var s={order:["asc","desc"],position:["any","start"],group:[true,false],jStorage:[true,false],compression:[true,false],debug:[true,false]};var o={query:"typeahead-query",filter:"typeahead-filter",button:"typeahead-button",filterValue:"typeahead-filter-value",dropdown:"typeahead-dropdown"};var u=function(r,u){function v(){for(var e in u){if(!u.hasOwnProperty(e)){continue}if(e==="source"){for(var t in u[e]){if(!u[e].hasOwnProperty(t)){continue}if(!(u[e][t]instanceof Object)||t==="data"){t="list";u[e]={list:u[e]}}}}else if(s[e]&&n.inArray(u[e],s[e])===-1){delete u[e]}}u=n.extend(true,Object.preventExtensions(n.extend(true,{},i)),u)}function m(){function i(){if(!u.filter){return false}return n(r).parents("."+u.containerClass).find("."+o.filterValue).text()}L(u.callback.onInit,[r]);var e=".typeahead.input",t=["focus"+e,"keyup"+e,"input"+e];n("html").on("click"+e,function(e){w()});n(r).parents("."+u.containerClass).on("click"+e,function(e){e.stopPropagation();if(u.filter){n(r).parents("."+u.containerClass).find("."+o.dropdown).hide()}});n(r).on(t.join(" "),function(e){if(e.type==="keyup"){if(e.keyCode&&n.inArray(e.keyCode,[38,39,40])!==-1){b(e)}return}if(e.type==="focus"&&f===null){E();return}if(!f||n(this).val()===a){return false}a=n(this).val().toLowerCase().trim();w();if(a.length>=u.minLength&&a!==""){g(i());y()}})}function g(e){if(a===""){return false}if(e&&!u.source[e]){e=false}for(var t in l){if(e&&t!==e){continue}for(var r in l[t]){if(c.length>=u.maxItem){break}if(l[t][r].display&&l[t][r].display.toLowerCase().indexOf(a)!==-1&&(u.position==="any"||l[t][r].display.toLowerCase().indexOf(a)===0)){if(u.source[t].ignore&&n.inArray(l[t][r].display,u.source[t].ignore)!==-1){continue}l[t][r].list=t;c.push(l[t][r])}}}if(u.order){c.sort(k("display",u.group?!(u.order==="asc"):!!(u.order==="asc"),function(e){return e.toUpperCase()}))}}function y(){if(c.length!==0){var e,t=n("<div/>",{"class":u.resultClass,html:n("<ul/>",{html:function(){for(var t in c){(function(t,i){if(u.group&&!n(i).find('li[data-search-group="'+t.list+'"]')[0]){n(i).append(n("<li/>",{"class":u.groupClass,html:n("<a/>",{html:t.list}),"data-search-group":t.list}))}e=t.display.match(new RegExp(a,"i"));var s=n("<li/>",{html:n("<a/>",{href:"javascript:;","data-list":t.list,html:t.display.replace(new RegExp(a,"i"),"<strong>"+e[0]+"</strong>")+(u.list?"<small>"+t.list+"</small>":""),click:({result:t},function(e){e.preventDefault();n(r).val(t.display).focus();a=t.display;w();L(u.callback.onClick,[r,this,t])}),mouseenter:function(){n(this).parents("."+u.resultClass).find(".active").removeClass("active");L(u.callback.onMouseEnter,[r,this,t])},mouseleave:function(){L(u.callback.onMouseLeave,[r,this,t])}}),mouseenter:function(){n(this).siblings("li.active").removeClass("active");n(this).addClass("active")}});if(u.group){n(s).insertAfter(n(i).find('li[data-search-group="'+t.list+'"]'))}else{n(i).append(s)}})(c[t],this)}}})});n(r).parents("."+u.containerClass).addClass("result").append(t)}if(!u.backdrop||a===""){return}var i=n.extend({opacity:.6,filter:"alpha(opacity=60)",position:"fixed",top:0,right:0,bottom:0,left:0,"z-index":1040,"background-color":"#000"},u.backdrop);n(r).parents("."+u.containerClass).addClass("backdrop").css({"z-index":i["z-index"]+1,position:"relative"});n("<div/>",{"class":u.backdropClass,css:i,click:function(){w()}}).insertAfter(n(r).parents("."+u.containerClass))}function b(e){if(c.length===0){return false}var t=n(r).parents("."+u.containerClass).find("."+u.resultClass).find("li:not([data-search-group])"),i=t.siblings(".active");if(t.length>1){i.removeClass("active")}if(e.keyCode===40){e.preventDefault();if(i[0]){i.next().addClass("active")}else{n(t[0]).toggleClass("active")}}else if(e.keyCode===38){e.preventDefault();if(i[0]){i.prev().addClass("active")}else{n(t[c.length-1]).toggleClass("active")}}else if(e.keyCode===39){w();return}if(u.group){var s=t.siblings(".active");if(s.attr("data-search-group")){s.removeClass("active");if(e.keyCode===40){s.next().addClass("active")}else if(e.keyCode===38){s.prev().addClass("active")}}}n(r).val(t.filter(".active").clone().find("small").remove().end().text().toLowerCase()||a)}function w(){c=[];var e=n(r).parents("."+u.containerClass);if(u.filter){e.removeClass("filter").find("."+o.dropdown).hide()}e.removeClass("result").find("."+u.resultClass).remove();e.removeClass("backdrop").removeAttr("style").siblings("."+u.backdropClass).remove()}function E(){f=false;if(d===0){for(var t in u.source){if(u.source.hasOwnProperty(t)){++d}}}for(var i in u.source){if(!u.source.hasOwnProperty(i)){continue}if(l[i]&&l[i].length!==0){C();continue}if(u.jStorage&&n.jStorage){l[i]=n.jStorage.get(r.selector+":"+i);if(l[i]){if(u.compression&&typeof LZString==="object"){l[i]=JSON.parse(LZString.decompress(l[i]))}C();continue}}l[i]=[];if(u.source[i].data&&u.source[i].data instanceof Array){for(var s in u.source[i].data){if(u.source[i].data[s]instanceof Object){break}u.source[i].data[s]={display:u.source[i].data[s]}}l[i]=l[i].concat(u.source[i].data);if(!u.source[i].url){N(i);C();continue}}if(u.source[i].url){var o=u.source[i].url instanceof Array&&u.source[i].url[0]||u.source[i].url,a=u.source[i].url instanceof Array&&u.source[i].url[1]||null;if(/https?:\/\//.test(o)&&o.indexOf(e.location.host)===-1){if(o.indexOf("{callback}")===-1){C();continue}A.fetch(o.replace("{callback}",encodeURIComponent(h)),function(e){})}else{n.ajax({async:true,url:o,ajaxList:i,ajaxPath:a}).done(function(e){T(e,this.ajaxList,this.ajaxPath);C()}).fail(function(e){C()})}}}}function S(){function e(e){n(r).parents("."+u.containerClass).find("."+o.filterValue).text(e||u.filter);n(r).parents("."+u.containerClass).find("."+o.dropdown).hide();w();g(e);y();n(r).focus()}if(!u.filter){return false}n("<span/>",{"class":o.filter,html:function(){n(this).append(n("<button/>",{type:"button",html:"<span class='"+o.filterValue+"'>"+u.filter+"</span> <span class='caret'></span>",click:function(e){e.stopPropagation();var t=n(this).parents("."+u.containerClass),r=t.find("."+o.dropdown);if(!r.is(":visible")){t.addClass("filter");r.show()}else{t.removeClass("filter");r.hide()}}}));n(this).append(n("<ul/>",{"class":o.dropdown,html:function(){for(var t in u.source){(function(t,r){var i=n("<li/>",{html:n("<a/>",{href:"javascript:;",html:t,click:({i:t},function(n){n.preventDefault();e(t)})})});n(r).append(i)})(t,this)}n(this).append(n("<li/>",{"class":"divider"}));n(this).append(n("<li/>",{html:n("<a/>",{href:"javascript:;",html:u.filter,click:function(t){t.preventDefault();e()}})}))}}))}}).insertAfter(n(r).parents("."+u.containerClass).find("."+o.query))}function x(e){if(!e||!e.list){return false}var t=e.list||"list",n=u.source[t].url instanceof Array?u.source[t].url[1]:null;T(e,t,n);C()}function C(){p++;if(p===d){f=true}}var a="",f=null,l=[],c=[],h="window.Typeahead.source['"+r.selector+"'].populate",p=0,d=0;var T=function(e,t,n){var r=true;if(n){var i=n.split("."),s=0;while(s<i.length){if(typeof e!=="undefined"){e=e[i[s++]]}else{r=false;break}}}if(r){for(var o in e){if(e[o]instanceof Object){break}e[o]={display:e[o]}}l[t]=l[t].concat(e);N(t)}};var N=function(e){if(!u.jStorage||!n.jStorage){return false}var t=l[e];if(u.compression&&typeof LZString==="object"){t=LZString.compress(JSON.stringify(t))}n.jStorage.set(r.selector+":"+e,t,{TTL:u.ttl})};var k=function(e,t,n){var r=n?function(t){return n(t[e])}:function(t){return t[e]};t=[-1,1][+!!t];return function(e,n){return e=r(e),n=r(n),t*((e>n)-(n>e))}};var L=function(t,r){if(!t){return false}var i;if(typeof t==="function"){i=t}else if(typeof t==="string"||t instanceof Array){i=e;if(typeof t==="string"){t=[t,[]]}var s=t[0].split("."),o=t[1],u=true,a=0;while(a<s.length){if(typeof i!=="undefined"){i=i[s[a++]]}else{u=false;break}}if(!u||typeof i!=="function"){return false}}i.apply(this,n.merge(o||[],r?r:[]));return true};var A={fetch:function(n,r){var i=encodeURIComponent(h);e[i]=this.evalJSONP(r);n=n.replace("="+h,"="+i);var s=t.createElement("SCRIPT");s.src=n;t.getElementsByTagName("HEAD")[0].appendChild(s)},evalJSONP:function(e){return function(t){var n=false;if(typeof t==="string"){try{n=JSON.parse(t)}catch(r){}}else{n=JSON.parse(JSON.stringify(t))}if(n){e(n)}else{throw"JSONP call returned invalid or empty JSON"}}}};this.__construct=function(){v();m();S()}();return{populate:x}};n.fn.typeahead=n.typeahead=function(e){return a.typeahead(this,e)};var a={typeahead:function(t,r){if(!r||!r.source){return}if(typeof t==="function"){if(!r.input){return}t=n(r.input);if(!t[0]||t.length>1){return}}else if(typeof t[0]==="undefined"||t.length>1){return}return t.each(function(){e.Typeahead.source[t.selector]=new u(t,r)})}}})(window,document,window.jQuery)