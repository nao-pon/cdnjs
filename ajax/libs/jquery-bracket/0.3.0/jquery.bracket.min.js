!function(e){var n=function(t){var r,i;if(!t)throw new Error("Options not set");if(!t.el)throw new Error("Invalid jQuery object as container");if(!t.init&&!t.save)throw new Error("No bracket data or save callback given");if(void 0===t.userData&&(t.userData=null),!(!t.decorator||t.decorator.edit&&t.decorator.render))throw new Error("Invalid decorator input");t.decorator||(t.decorator={edit:function(n,t,r){var i=e('<input type="text">');i.val(t),n.html(i),i.focus(),i.blur(function(){r(i.val())}),i.keydown(function(e){var n=e.keyCode||e.which;9!==n&&13!==n&&27!==n||(e.preventDefault(),r(i.val(),27!==n))})},render:function(e,n,t){e.append(n)}}),t.init||(t.init={teams:[["",""]],results:[]}),i=t.init;var s=e('<div class="jQBracket"></div>').appendTo(t.el.empty());function a(e){return!isNaN(parseFloat(e))&&isFinite(e)}function o(n){r=0,c.render(),l&&u&&(l.render(),u.render()),function(n){var t=function(t,r){var i=t,s=n.find(".team[index="+i+"]");if(r)var a=r;else var a="highlight";return{highlight:function(){s.each(function(){e(this).addClass(a),e(this).hasClass("win")&&e(this).parent().find(".connector").addClass(a)})},deHighlight:function(){s.each(function(){e(this).removeClass(a),e(this).parent().find(".connector").removeClass(a)})}}},r=u||c,i=r.winner(),s=r.loser(),a=null,o=null;i&&s&&(a=new t(i.idx,"highlightWinner"),o=new t(s.idx,"highlightLoser"),a.highlight(),o.highlight());n.find(".team").mouseover(function(){var n=e(this).attr("index");track=new t(n),track.highlight(),e(this).mouseout(function(){track.deHighlight(),e(this).unbind("mouseout")})})}(s),n&&(i.results[0]=c.results(),l&&u&&(i.results[1]=l.results(),i.results[2]=u.results()),t.save&&t.save(i,t.userData))}var c,l,u,h=function(n,i,c,l,u){function h(){if(a(i[0].score)&&a(i[1].score)){if(i[0].score>i[1].score)return i[0];if(i[0].score<i[1].score)return i[1]}return{source:null,name:null,id:-1,score:null}}function d(){if(a(i[0].score)&&a(i[1].score)){if(i[0].score>i[1].score)return i[1];if(i[0].score<i[1].score)return i[0]}return{source:null,name:null,id:-1,score:null}}function f(n,i,c){var l,u=r,f=e('<span id="result-'+u+'"></span>');i.name&&c?(a(i.score)||(i.score=0),l=i.score):(l="--",f.attr("disabled","disabled")),f.append(l),r++;var p=i.name?i.name:"--",v=e('<div class="team"></div>'),g=e("<b></b>").appendTo(v);return 0===n&&v.attr("id","team-"+u),t.decorator.render(g,p,l),a(i.idx)&&v.attr("index",i.idx),null===i.name?v.addClass("na"):h().name===i.name?v.addClass("win"):d().name===i.name&&v.addClass("lose"),v.append(f),null!==i.name&&c&&t.save?t.save&&(g.click(function(){var r=e(this);!function s(){r.unbind(),t.decorator.edit(r,i.name,function(a,c){a&&(t.init.teams[~~(i.idx/2)][i.idx%2]=a),o(!0),r.click(s);var l=t.el.find("#team-"+(i.idx+1)+" b:first");l.length&&!0===c&&0===n&&e(l).click()})}()}),i.name&&f.click(function(){var n=e(this);!function t(){var r;n.unbind(),r=a(i.score)?n.text():"0";var c=e('<input type="text">');c.val(r),n.html(c),c.focus().select(),c.keydown(function(n){a(e(this).val())?e(this).removeClass("error"):e(this).addClass("error");var t=n.keyCode||n.which;if(9===t||13===t||27===t){if(n.preventDefault(),e(this).blur(),27===t)return;var r=s.find("span[id=result-"+(u+1)+"]");r&&r.click()}}),c.blur(function(){var e=c.val();e&&a(e)||a(i.score)?e&&a(e)||!a(i.score)||(e=i.score):e="0",n.html(e),a(e)&&r!==parseInt(e)&&(i.score=parseInt(e),o(!0)),n.click(t)})}()})):g.attr("disabled","disabled"),v}var p=null,v=null,g=e('<div class="match"></div>'),m=e('<div class="teamContainer"></div>');return i[0].id=0,i[1].id=1,i[0].name=i[0].source().name,i[1].name=i[1].source().name,i[0].score=l?l[0]:null,i[1].score=l?l[1]:null,i[0].name&&i[1].name||!a(i[0].score)&&!a(i[1].score)||(console.log("ERROR IN SCORE DATA: "+i[0].source().name+": "+i[0].score+", "+i[1].source().name+": "+i[1].score),i[0].score=i[1].score=null),{el:g,id:c,round:function(){return n},connectorCb:function(e){p=e},connect:function(n){var t,r,i=m.height()/4,s=g.height()/2;if(n&&null!==n){var a=n(m,this);if(null===a)return;t=a.shift,r=a.height}else c%2==0?0===this.winner().id?(t=i,r=s):1===this.winner().id?(t=3*i,r=s-2*i):(t=2*i,r=s-i):0===this.winner().id?(t=3*-i,r=2*i-s):1===this.winner().id?(t=-i,r=-s):(t=2*-i,r=-s+i);m.append(function(n,t,r){var i=parseInt(e(".round:first").css("margin-right"))/2,s=!0;n<0&&(s=!1,n=-n);var a=e('<div class="connector"></div>').appendTo(r);a.css("height",n),a.css("width",i+"px"),a.css("right",-i-2+"px"),t>=0?a.css("top",t+"px"):a.css("bottom",-t+"px"),s?a.css("border-bottom","none"):a.css("border-top","none");var o=e('<div class="connector"></div>').appendTo(a);return o.css("width",i+"px"),o.css("right",-i+"px"),s?o.css("bottom","0px"):o.css("top","0px"),a}(r,t,m))},winner:h,loser:d,setAlignCb:function(e){v=e},render:function(){g.empty(),m.empty(),i[0].name=i[0].source().name,i[1].name=i[1].source().name,i[0].idx=i[0].source().idx,i[1].idx=i[1].source().idx;var e=!1;!i[0].name&&""!==i[0].name||!i[1].name&&""!==i[1].name||(e=!0),h().name?m.removeClass("np"):m.addClass("np"),m.append(f(n.id,i[0],e)),m.append(f(n.id,i[1],e)),g.appendTo(n.el),g.append(m),this.el.css("height",n.bracket.el.height()/n.size()+"px"),m.css("top",this.el.height()/2-m.height()/2+"px"),v&&v(m),this.connect(p),"function"==typeof u&&u(this.el)},results:function(){return[i[0].score,i[1].score]}}},d=function(n,t,r){var i=[];return{el:n,addRound:function(){var n=i.length,r=null;n>0&&(r=i[n-1]);var s=new function(n,t,r,i){var s=[],a=e('<div class="round"></div>');return{el:a,bracket:n,id:r,addMatch:function(e,t){var a=s.length;if(null!==e)var o=e();else o=[{source:n.round(r-1).match(2*a).winner},{source:n.round(r-1).match(2*a+1).winner}];var c=new h(this,o,a,i?i[a]:null,t);return s.push(c),c},match:function(e){return s[e]},prev:function(){return t},size:function(){return s.length},render:function(){a.empty(),a.appendTo(n.el),s.forEach(function(e){e.render()})},results:function(){var e=[];return s.forEach(function(n){e.push(n.results())}),e}}}(this,r,n,t?t[n]:null);return i.push(s),s},round:function(e){return i[e]},size:function(){return i.length},final:function(){return i[i.length-1].match(0)},winner:function(){return i[i.length-1].match(0).winner()},loser:function(){return i[i.length-1].match(0).loser()},render:function(){n.empty(),i.forEach(function(e){e.render()})},results:function(){var e=[];return i.forEach(function(n){e.push(n.results())}),e}}};function f(e){e.find(".team.win").append('<div class="bubble">1st</div>'),e.find(".team.lose").append('<div class="bubble">2nd</div>')}function p(e){e.find(".team.win").append('<div class="bubble">3rd</div>')}var v=i.results;v=function e(n,t){return t>0&&(n=e([n],t-1)),n}(v,4-function e(n,t){return n instanceof Array?e(n[0],t+1):t}(v,0)),i.results=v;var g=v.length<=1;if(t.save){var m=e('<div class="tools"></div>').appendTo(s);if(e('<span class="increment">+</span>').appendTo(m).click(function(){var e,r=i.teams.length;for(e=0;e<r;e++)i.teams.push(["",""]);new n(t)}),i.teams.length>1&&1===i.results.length||i.teams.length>2&&3===i.results.length)e('<span class="decrement">-</span>').appendTo(m).click(function(){i.teams.length>1&&(i.teams=i.teams.slice(0,i.teams.length/2),new n(t))});if(1===i.results.length&&i.teams.length>1)e('<span class="doubleElimination">de</span>').appendTo(m).click(function(){i.teams.length>1&&i.results.length<3&&(i.results.push([],[]),new n(t))});else if(3===i.results.length&&i.teams.length>1){e('<span class="singleElimination">se</span>').appendTo(m).click(function(){3===i.results.length&&(i.results=i.results.slice(0,1),new n(t))})}}if(g)var b=e('<div class="bracket"></div>').appendTo(s);else var w=e('<div class="finals"></div>').appendTo(s),x=(b=e('<div class="bracket"></div>').appendTo(s),e('<div class="loserBracket"></div>').appendTo(s));var C,k=50*i.teams.length;return b.css("height",k),g&&i.teams.length<=2&&(k+=30,s.css("height",k)),x&&x.css("height",b.height()/2),C=g?Math.log(2*i.teams.length)/Math.log(2):2*(Math.log(2*i.teams.length)/Math.log(2)-1)+1,t.save?s.css("width",140*C+40):s.css("width",140*C+10),c=new d(b,v&&v[0]?v[0]:null,i.teams),g||(l=new d(x,v&&v[1]?v[1]:null,null),u=new d(w,v&&v[2]?v[2]:null,null)),function(e,n,t){for(var r,i=n.teams,s=(n.results,Math.log(2*i.length)/Math.log(2)),a=i.length,o=(e.el.height(),0);o<s;o++){var c=n.results&&n.results[o]?n.results[o]:null;r=e.addRound(c);for(var l=0;l<a;l++){var u=null;0===o&&(u=function(){var e=i[l],n=l;return[{source:function(){return{name:e[0],idx:2*n}}},{source:function(){return{name:e[1],idx:2*n+1}}}]}),o===s-1&&t?r.addMatch(u,f).setAlignCb(function(e){e.css("top",""),e.css("position","absolute"),e.css("bottom",-e.height()/2+"px")}):r.addMatch(u)}a/=2}if(t&&(e.final().connectorCb(function(){return null}),i.length>1)){var h=e.final().round().prev().match(0).loser,d=e.final().round().prev().match(1).loser,v=r.addMatch(function(){return[{source:h},{source:d}]},p);v.setAlignCb(function(n){var t=e.el.height()/2;v.el.css("height",t+"px");var r=n.height();n.css("top",r+"px")}),v.connectorCb(function(){return null})}}(c,i,g),g||(function(e,n,t){for(var r=t.teams,i=(t.results,Math.log(2*r.length)/Math.log(2)-1),s=r.length/2,a=(n.el.height(),0);a<i;a++){for(var o=0;o<2;o++)for(var c=n.addRound(),l=0;l<s;l++){var u=null;o%2==0&&0!==a||(u=function(){return o%2==0&&0===a?[{source:e.round(0).match(2*l).loser},{source:e.round(0).match(2*l+1).loser}]:[{source:n.round(2*a).match(l).winner},{source:e.round(a+1).match(l).loser}]});var h=c.addMatch(u),d=h.el.find(".teamContainer");if(h.setAlignCb(function(){d.css("top",h.el.height()/2-d.height()/2+"px")}),a<i-1||o<1){var f=null;o%2==0&&(f=function(e,n){var t=e.height()/4,r=0,i=0;return 0===n.winner().id?i=t:1===n.winner().id?(r=2*-t,i=t):i=2*t,{height:r,shift:i}}),h.connectorCb(f)}}s/=2}}(c,l,i),function(e,n,t,r){var i,s,a=e.addRound(),o=a.addMatch(function(){return[{source:n.winner},{source:t.winner}]},f);o.setAlignCb(function(e){var r=(n.el.height()+t.el.height())/2;o.el.css("height",r+"px");var i=(n.el.height()/2+n.el.height()+t.el.height()/2)/2-e.height();e.css("top",i+"px")});var c=t.final().round().prev().match(0).loser,l=a.addMatch(function(){return[{source:c},{source:t.loser}]},p);l.setAlignCb(function(e){var r=(n.el.height()+t.el.height())/2;l.el.css("height",r+"px");var i=e.height();i=(n.el.height()/2+n.el.height()+t.el.height()/2)/2+e.height()/2-r,e.css("top",i+"px")}),o.connectorCb(function(){return null}),l.connectorCb(function(){return null}),n.final().connectorCb(function(e){var r=e.height()/4,a=(n.el.height()/2+n.el.height()+t.el.height()/2)/2-e.height()/2-n.el.height()/2;return 0===n.winner().id?(s=a+2*r,i=r):1===n.winner().id?(s=a,i=3*r):(s=a+r,i=2*r),{height:s-=e.height()/2,shift:i}}),t.final().connectorCb(function(e){var r=e.height()/4,a=(n.el.height()/2+n.el.height()+t.el.height()/2)/2-e.height()/2-n.el.height()/2;return 0===t.winner().id?(s=a,i=3*r):1===t.winner().id?(s=a+2*r,i=r):(s=a+r,i=2*r),{height:-(s+=e.height()/2),shift:-i}})}(u,c,l)),o(!1),{data:function(){return t.init}}},t={init:function(t){t.el=this;var r=new n(t);return e(this).data("bracket",{target:this,obj:r}),r},data:function(){return e(this).data("bracket").obj.data()}};e.fn.bracket=function(n){return t[n]?t[n].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof n&&n?void e.error("Method "+n+" does not exist on jQuery.bracket"):t.init.apply(this,arguments)}}(jQuery);