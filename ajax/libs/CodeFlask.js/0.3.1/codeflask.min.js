!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):t.CodeFlask=e()}(this,function(){function o(t){this.indent=t||"    ",this.docroot=document}return o.isString=function(t){return"[object String]"===Object.prototype.toString.call(t)},o.prototype.run=function(t,e){var n=o.isString(t)?this.docroot.querySelectorAll(t):[t];if(e=e||{},1<n.length)throw"CodeFlask.js ERROR: run() expects only one element, "+n.length+" given. Use .runAll() instead.";this.scaffold(n[0],!1,e)},o.prototype.runAll=function(t,e){this.update=null,this.onUpdate=null;var n=o.isString(t)?this.docroot.querySelectorAll(t):t;for(r=0;r<n.length;r++)this.scaffold(n[r],!0,e);for(var i=this.docroot.getElementsByClassName("CodeFlask__textarea"),r=0;r<i.length;r++){window.MutationObserver=window.MutationObserver||window.WebKitMutationObserver||window.MozMutationObserver;n=i[r];observer=new MutationObserver(function(t){for(var e=this.docroot.getElementsByClassName("CodeFlask__textarea"),n=0;n<e.length;n++)e[n].nextSibling.getAttribute("dir")!=e[n].getAttribute("dir")&&e[n].nextSibling.setAttribute("dir",e[n].getAttribute("dir"))}),config={attributes:!0,attributeFilter:["dir"]},observer.observe(n,config)}},o.prototype.scaffold=function(t,e,n){var i,r=document.createElement("TEXTAREA"),o=document.createElement("PRE"),s=document.createElement("CODE"),l=t.textContent;n&&!n.enableAutocorrect&&(r.setAttribute("spellcheck","false"),r.setAttribute("autocapitalize","off"),r.setAttribute("autocomplete","off"),r.setAttribute("autocorrect","off")),n&&(i=this.handleLanguage(n.language||"html")),this.defaultLanguage=t.dataset.language||i||"markup",e||(this.textarea=r,this.highlightCode=s),t.classList.add("CodeFlask"),r.classList.add("CodeFlask__textarea"),o.classList.add("CodeFlask__pre"),s.classList.add("CodeFlask__code"),s.classList.add("language-"+this.defaultLanguage),/iPad|iPhone|iPod/.test(navigator.platform)&&(s.style.paddingLeft="3px"),1==n.rtl&&(r.setAttribute("dir","rtl"),o.setAttribute("dir","rtl")),n.lineNumbers&&(o.classList.add("line-numbers"),o.classList.add("CodeFlask__pre_line-numbers"),s.classList.add("CodeFlask__code_line-numbers"),r.classList.add("CodeFlask__textarea_line-numbers")),t.innerHTML="",t.appendChild(r),t.appendChild(o),o.appendChild(s),r.value=l,this.renderOutput(s,r),this.highlight(s),this.handleInput(r,s,o),this.handleScroll(r,o)},o.prototype.renderOutput=function(t,e){t.innerHTML=e.value.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")+"\n"},o.prototype.handleInput=function(t,c,e){var n,g=this;t.addEventListener("input",function(t){(n=this).value=n.value.replace(/\t/g,g.indent),g.renderOutput(c,n),g.highlight(c)}),t.addEventListener("keydown",function(t){if(9===t.keyCode){t.preventDefault();var e=this,n=e.selectionDirection,i=e.selectionStart,r=e.selectionEnd,o=e.value,s=o.substr(0,i),l=o.substring(i,r),a=o.substring(r);if(i!==r&&l.length>=g.indent.length){var d=i-s.split("\n").pop().length,u=g.indent.length,h=g.indent.length;if(t.shiftKey)o.substr(d,g.indent.length)===g.indent?(u=-u,i<d?(l=l.substring(0,d)+l.substring(d+g.indent.length),h=0):d==i?(h=u=0,l=l.substring(g.indent.length)):(h=-h,s=s.substring(0,d)+s.substring(d+g.indent.length))):h=u=0,l=l.replace(new RegExp("\n"+g.indent.split("").join("\\"),"g"),"\n");else s=s.substr(0,d)+g.indent+s.substring(d,i),l=l.replace(/\n/g,"\n"+g.indent);e.value=s+l+a,e.selectionStart=i+u,e.selectionEnd=i+l.length+h,e.selectionDirection=n}else e.value=s+g.indent+a,e.selectionStart=i+g.indent.length,e.selectionEnd=i+g.indent.length;g.renderOutput(c,e),Prism.highlightAll()}})},o.prototype.handleScroll=function(t,e){t.addEventListener("scroll",function(){roundedScroll=Math.floor(this.scrollTop),navigator.userAgent.toLowerCase().indexOf("firefox")<0&&(this.scrollTop=roundedScroll),e.scrollTop=roundedScroll})},o.prototype.handleLanguage=function(t){return t.match(/html|xml|xhtml|svg/)?"markup":t.match(/js/)?"javascript":t},o.prototype.onUpdate=function(e){if("function"!=typeof e)throw"CodeFlask.js ERROR: onUpdate() expects function, "+typeof e+" given instead.";this.textarea.addEventListener("input",function(t){e(this.value)})},o.prototype.update=function(t){var e=document.createEvent("HTMLEvents");this.textarea.value=t,this.renderOutput(this.highlightCode,this.textarea),this.highlight(this.highlightCode),e.initEvent("input",!1,!0),this.textarea.dispatchEvent(e)},o.prototype.highlight=function(t){(window.Prism||require("prismjs")).highlightElement(t)},o});