!function(){"undefined"==typeof window&&(window=root);var t=(window.excelFormulaUtilities=window.excelFormulaUtilities||{},window.excelFormulaUtilities.core={});window.excelFormulaUtilities.string=window.excelFormulaUtilities.string||{};var e=(window.excelFormulaUtilities.string.formatStr=function(t){for(var e=t,n=1;n<arguments.length;n++){var r=n-1,o=new RegExp("\\{{1}"+r.toString()+"{1}\\}{1}","g");e=e.replace(o,arguments[n])}return e},window.excelFormulaUtilities.string.trim=function(t){return t.replace(/^\s|\s$/,"")},window.excelFormulaUtilities.string.trim=function(t){return t.replace(/^(?:\s|&nbsp;|<\s*br\s*\/*\s*>)*|(?:\s|&nbsp;|<\s*br\s*\/*\s*>)*$/,"")},t.isFunction=function(t){return"function"==typeof t}),n=t.isArray=function(t){return"object"==typeof t&&t.length},r=t.isWindow=function(){return obj&&"object"==typeof obj&&"setInterval"in obj},o=t.isPlainObject=function(t){if(!t||"object"!=typeof t||t.nodeType||r(t))return!1;if(t.constructor&&!hasOwnProperty.call(t,"constructor")&&!hasOwnProperty.call(t.constructor.prototype,"isPrototypeOf"))return!1;var e;for(e in t);return void 0===e||hasOwnProperty.call(t,e)};t.extend=function(){var r,i,s,a,u,p,l=arguments[0]||{},c=1,d=arguments.length,g=!1;for("boolean"==typeof l&&(g=l,l=arguments[1]||{},c=2),"object"==typeof l||e(l)||(l={}),d===c&&(l=this,--c);d>c;c++)if(null!=(r=arguments[c]))for(i in r)s=l[i],a=r[i],l!==a&&(g&&a&&(o(a)||(u=n(a)))?(u?(u=!1,p=s&&n(s)?s:[]):p=s&&o(s)?s:{},l[i]=t.extend(g,p,a)):void 0!==a&&(l[i]=a));return l}}(),function(t){function e(t,e,n){this.value=t,this.type=e,this.subtype=n}function n(){this.items=[],this.add=function(t,n,r){r||(r="");var o=new e(t,n,r);return this.addRef(o),o},this.addRef=function(t){this.items.push(t)},this.index=-1,this.reset=function(){this.index=-1},this.BOF=function(){return this.index<=0},this.EOF=function(){return this.index>=this.items.length-1},this.moveNext=function(){return this.EOF()?!1:(this.index+=1,!0)},this.current=function(){return-1===this.index?null:this.items[this.index]},this.next=function(){return this.EOF()?null:this.items[this.index+1]},this.previous=function(){return this.index<1?null:this.items[this.index-1]}}function r(){this.items=[],this.push=function(t){this.items.push(t)},this.pop=function(t){var n=this.items.pop();return new e(t||"",n.type,v)},this.token=function(){return this.items.length>0?this.items[this.items.length-1]:null},this.value=function(){return this.token()?this.token().value.toString():""},this.type=function(){return this.token()?this.token().type.toString():""},this.subtype=function(){return this.token()?this.token().subtype.toString():""}}function o(e){for(var o=new n,i=new r,s=0,a=function(){return e.substr(s,1)},u=function(){return e.substr(s,2)},p=function(){return e.substr(s+1,1)},l=function(){return s>=e.length},c="",C=!1,N=!1,Y=!1,K=!1,B=/^[1-9]{1}(\.[0-9]+)?E{1}$/;e.length>0;){if(" "!==e.substr(0,1)){"="===e.substr(0,1)&&(e=e.substr(1));break}e=e.substr(1)}for(;!l();)if(C)'"'===a()?'"'===p()?(c+='"',s+=1):(C=!1,o.add(c,g,w),c=""):c+=a(),s+=1;else if(N)"'"===a()?"'"===p()?(c+="'",s+=1):(N=!1,c+="'"):c+=a(),s+=1;else if(Y)"]"===a()&&(Y=!1),c+=a(),s+=1;else if(K)c+=a(),s+=1,-1!==",#NULL!,#DIV/0!,#VALUE!,#REF!,#NAME?,#NUM!,#N/A,".indexOf(","+c+",")&&(K=!1,o.add(c,g,E),c="");else if(-1!=="+-".indexOf(a())&&c.length>1&&c.match(B))c+=a(),s+=1;else if('"'!==a())if("'"!==a())if("["!==a())if("#"!==a())if("{"!==a())if(";"!==a())if("}"!==a())if(" "!==a())-1===",>=,<=,<>,".indexOf(","+u()+",")?-1==="+-*/^&=><".indexOf(a())?-1==="%".indexOf(a())?"("!==a()?","!==a()||t.excelFormulaUtilities.isEu?")"!==a()?(c+=a(),s+=1):(c.length>0&&(o.add(c,g),c=""),o.addRef(i.pop()),s+=1):(c.length>0&&(o.add(c,g),c=""),i.type()!==m?o.add(a(),b,P):o.add(a(),S),s+=1):(c.length>0?(i.push(o.add(c,m,x)),c=""):i.push(o.add("",f,x)),s+=1):(c.length>0&&(o.add(c,g),c=""),o.add(a(),y),s+=1):(c.length>0&&(o.add(c,g),c=""),o.add(a(),b),s+=1):(c.length>0&&(o.add(c,g),c=""),o.add(u(),b,_),s+=2);else for(c.length>0&&(o.add(c,g),c=""),o.add("",T),s+=1;" "===a()&&!l();)s+=1;else c.length>0&&(o.add(c,g),c=""),o.addRef(i.pop("ARRAYROWSTOP")),o.addRef(i.pop("ARRAYSTOP")),s+=1;else{if(t.excelFormulaUtilities.isEu){c.length>0&&(o.add(c,g),c=""),i.type()!==m?o.add(a(),b,P):o.add(a(),S),s+=1;continue}c.length>0&&(o.add(c,g),c=""),o.addRef(i.pop()),o.add(",",S),i.push(o.add("ARRAYROW",m,x)),s+=1}else c.length>0&&(o.add(c,O),c=""),i.push(o.add("ARRAY",m,x)),i.push(o.add("ARRAYROW",m,x)),s+=1;else c.length>0&&(o.add(c,O),c=""),K=!0,c+=a(),s+=1;else Y=!0,c+=a(),s+=1;else c.length>0&&(o.add(c,O),c=""),c="'",N=!0,s+=1;else c.length>0&&(o.add(c,O),c=""),C=!0,s+=1;c.length>0&&o.add(c,g);for(var I=new n;o.moveNext();)if(c=o.current(),c.type.toString()!==T)I.addRef(c);else{var L=o.BOF()||o.EOF();L=L&&(o.previous().type.toString()===m&&o.previous().subtype.toString()===v||o.previous().type.toString()===f&&o.previous().subtype.toString()===v||o.previous().type.toString()===g),L=L&&(o.next().type.toString()===m&&o.next().subtype.toString()===x||o.next().type.toString()===f&&o.next().subtype.toString()===x||o.next().type.toString()===g),L&&I.add(c.value.toString(),b,F)}for(;I.moveNext();)c=I.current(),c.type.toString()!==b||"-"!==c.value.toString()?c.type.toString()!==b||"+"!==c.value.toString()?c.type.toString()!==b||0!==c.subtype.length?c.type.toString()!==g||0!==c.subtype.length?c.type.toString()!==m||"@"===c.value.substr(0,1)&&(c.value=c.value.substr(1).toString()):isNaN(parseFloat(c.value))?"TRUE"===c.value.toString()||"FALSE"===c.value.toString()?c.subtype=_.toString():c.subtype=R.toString():c.subtype=k.toString():-1!=="<>=".indexOf(c.value.substr(0,1))?c.subtype=_.toString():"&"===c.value.toString()?c.subtype=U.toString():c.subtype=A.toString():I.BOF()?c.type=d.toString():I.previous().type.toString()===m&&I.previous().subtype.toString()===v||I.previous().type.toString()===f&&I.previous().subtype.toString()===v||I.previous().type.toString()===y||I.previous().type.toString()===g?c.subtype=A.toString():c.type=d.toString():I.BOF()?c.type=h.toString():I.previous().type.toString()===m&&I.previous().subtype.toString()===v||I.previous().type.toString()===f&&I.previous().subtype.toString()===v||I.previous().type.toString()===y||I.previous().type.toString()===g?c.subtype=A.toString():c.type=h.toString();for(I.reset(),o=new n;I.moveNext();)I.current().type.toString()!==d&&o.addRef(I.current());return o.reset(),o}function i(t,e){if(!RegExp("[a-z]+[0-9]+:[a-z]+[0-9]+","gi").test(t))throw"This is not a valid range: "+t;var n=t.split(":"),r=parseInt(n[0].match(/[0-9]+/gi)[0]),o=n[0].match(/[A-Z]+/gi)[0],i=N(o);for(endRow=parseInt(n[1].match(/[0-9]+/gi)[0]),endCol=n[1].match(/[A-Z]+/gi)[0],endColDec=N(endCol),totalRows=endRow-r+1,totalCols=N(endCol)-N(o)+1,curCol=0,curRow=1,curCell="",retStr="";curRow<=totalRows;curRow+=1){for(;curCol<totalCols;curCol+=1)curCell=C(i+curCol)+""+(r+curRow-1),retStr+=curCell+(curRow===totalRows&&curCol===totalCols-1?"":e);curCol=0}return retStr}function s(t,e,n,r,o){var i=n,s=void 0===typeof arguments[5]||null===arguments[5]?null:arguments[5],a=function(t){return t.replace(/\{\{token\}\}/gi,"{0}").replace(/\{\{autoindent\}\}/gi,"{1}").replace(/\{\{autolinebreak\}\}/gi,"{2}")},u="";if(u="text"===t.subtype||"text"===t.type?t.value.toString():"operand"===t.type&&"range"===t.subtype?t.value.toString():(0===t.value.length?" ":t.value.toString()).split(" ").join("").toString(),"function"==typeof o){var l=o(u,t,n,r);if(u=l.tokenString,!l.useTemplate)return u}switch(t.type){case"function":switch(t.value){case"ARRAY":u=p(a(e.tmplFunctionStartArray),u,i,r);break;case"ARRAYROW":u=p(a(e.tmplFunctionStartArrayRow),u,i,r);break;default:u="start"===t.subtype.toString()?p(a(e.tmplFunctionStart),u,i,r):p(a(e.tmplFunctionStop),u,i,r)}break;case"operand":switch(t.subtype.toString()){case"error":u=p(a(e.tmplOperandError),u,i,r);break;case"range":u=p(a(e.tmplOperandRange),u,i,r);break;case"logical":u=p(a(e.tmplOperandLogical),u,i,r);break;case"number":u=p(a(e.tmplOperandNumber),u,i,r);break;case"text":u=p(a(e.tmplOperandText),u,i,r);break;case"argument":u=p(a(e.tmplArgument),u,i,r)}break;case"operator-infix":u=p(a(e.tmplOperandOperatorInfix),u,i,r);break;case"logical":u=p(a(e.tmplLogical),u,i,r);break;case"argument":u="argument"!==s.type?p(a(e.tmplArgument),u,i,r):p(a("{{autoindent}}"+e.tmplArgument),u,i,r);break;case"subexpression":u="start"===t.subtype.toString()?p(a(e.tmplSubexpressionStart),u,i,r):p(a(e.tmplSubexpressionStop),u,i,r)}return u}var a=t.excelFormulaUtilities=t.excelFormulaUtilities||{},u=t.excelFormulaUtilities.core,p=t.excelFormulaUtilities.string.formatStr,l=t.excelFormulaUtilities.string.trim,c={},d=c.TOK_TYPE_NOOP="noop",g=c.TOK_TYPE_OPERAND="operand",m=c.TOK_TYPE_FUNCTION="function",f=c.TOK_TYPE_SUBEXPR="subexpression",S=c.TOK_TYPE_ARGUMENT="argument",h=c.TOK_TYPE_OP_PRE="operator-prefix",b=c.TOK_TYPE_OP_IN="operator-infix",y=c.TOK_TYPE_OP_POST="operator-postfix",T=c.TOK_TYPE_WSPACE="white-space",O=c.TOK_TYPE_UNKNOWN="unknown",x=c.TOK_SUBTYPE_START="start",v=c.TOK_SUBTYPE_STOP="stop",w=c.TOK_SUBTYPE_TEXT="text",k=c.TOK_SUBTYPE_NUMBER="number",_=c.TOK_SUBTYPE_LOGICAL="logical",E=c.TOK_SUBTYPE_ERROR="error",R=c.TOK_SUBTYPE_RANGE="range",A=c.TOK_SUBTYPE_MATH="math",U=c.TOK_SUBTYPE_CONCAT="concatenate",F=c.TOK_SUBTYPE_INTERSECT="intersect",P=c.TOK_SUBTYPE_UNION="union";t.excelFormulaUtilities.isEu="boolean"==typeof t.excelFormulaUtilities.isEu?t.excelFormulaUtilities.isEu:!1;var C=(a.parseFormula=function(t,e){var n=0,r=function(){for(var t="|",e=0;n>e;e+=1)t+="&nbsp;&nbsp;&nbsp;|";return t},i=document.getElementById(t),s=i.value,a=o(s),u="";for(u+="<table cellspacing='0' style='border-top: 1px #cecece solid; margin-top: 5px; margin-bottom: 5px'>",u+="<tr>",u+="<td class='token' style='font-weight: bold; width: 50px'>index</td>",u+="<td class='token' style='font-weight: bold; width: 125px'>type</td>",u+="<td class='token' style='font-weight: bold; width: 125px'>subtype</td>",u+="<td class='token' style='font-weight: bold; width: 150px'>token</td>",u+="<td class='token' style='font-weight: bold; width: 300px'>token tree</td></tr>";a.moveNext();){var p=a.current();p.subtype===v&&(n-=n>0?1:0),u+="<tr>",u+="<td class='token'>"+(a.index+1)+"</td>",u+="<td class='token'>"+p.type+"</td>",u+="<td class='token'>"+(0===p.subtype.length?"&nbsp;":p.subtype.toString())+"</td>",u+="<td class='token'>"+(0===p.value.length?"&nbsp;":p.value).split(" ").join("&nbsp;")+"</td>",u+="<td class='token'>"+r()+(0===p.value.length?"&nbsp;":p.value).split(" ").join("&nbsp;")+"</td>",u+="</tr>",p.subtype===x&&(n+=1)}u+="</table>",document.getElementById(e).innerHTML=u,i.select(),i.focus()},a.toBase26=function(t){t=Math.abs(t);var e,n="",r=!1;do e=t%26,r&&25>t&&e--,n=String.fromCharCode(e+"A".charCodeAt(0))+n,t=Math.floor((t-e)/26),r=!0;while(t>0);return n}),N=a.fromBase26=function(t){t=t.toUpperCase();var e=0,n=0,r=0;if(null!==t&&"undefined"!=typeof t&&t.length>0)for(;n<t.length;n++)e=t.charCodeAt(t.length-n-1)-"A".charCodeAt(0),r+=Math.pow(26,n)*(e+1);return r-1},Y=a.formatFormula=function(t,e){t=t.replace(/^\s*=\s+/,"=");var n=!0,r={tmplFunctionStart:"{{autoindent}}{{token}}(\n",tmplFunctionStop:"\n{{autoindent}}{{token}})",tmplOperandError:" {{token}}",tmplOperandRange:"{{autoindent}}{{token}}",tmplLogical:"{{token}}{{autolinebreak}}",tmplOperandLogical:"{{autoindent}}{{token}}",tmplOperandNumber:"{{autoindent}}{{token}}",tmplOperandText:'{{autoindent}}"{{token}}"',tmplArgument:"{{token}}\n",tmplOperandOperatorInfix:" {{token}}{{autolinebreak}}",tmplFunctionStartArray:"",tmplFunctionStartArrayRow:"{",tmplFunctionStopArrayRow:"}",tmplFunctionStopArray:"",tmplSubexpressionStart:"{{autoindent}}(\n",tmplSubexpressionStop:"\n)",tmplIndentTab:"	",tmplIndentSpace:" ",autoLineBreak:"TOK_TYPE_FUNCTION | TOK_TYPE_ARGUMENT | TOK_SUBTYPE_LOGICAL | TOK_TYPE_OP_IN ",newLine:"\n",customTokenRender:null,prefix:"",postfix:""};e=e?u.extend(!0,r,e):r;for(var i=0,a=function(){for(var t="",n=0;i>n;n+=1)t+=e.tmplIndentTab;return t},p=o(t),d="",g=e.autoLineBreak.replace(/\s/gi,"").split("|"),m=!0,f=function(t){for(var e=0;e<g.length;e+=1)if(null!==t&&"undefined"!=typeof t&&(c[g[e]]===t.type.toString()||c[g[e]]===t.subtype.toString()))return!0;return!1},S=null;p.moveNext();){var h=p.current(),b=p.next();h.subtype.toString()===v&&(i-=i>0?1:0);var y=(new RegExp("^"+e.newLine,""),new RegExp(e.newLine+"$","")),T=f(b),O=m,w=O?a():e.tmplIndentSpace,k=T?e.newLine:"";d+=s(h,e,w,k,e.customTokenRender,S),h.subtype.toString()===x&&(i+=1),m=T||y.test(d),n=!1,S=h}return d=e.prefix+l(d)+e.postfix},K=(a.formatFormulaHTML=function(t){var e={tmplFunctionStart:'{{autoindent}}<span class="function">{{token}}</span><span class="function_start">(</span><br />',tmplFunctionStop:'<br />{{autoindent}}{{token}}<span class="function_stop">)</span>',tmplOperandText:'{{autoindent}}<span class="quote_mark">"</span><span class="text">{{token}}</span><span class="quote_mark">"</span>',tmplArgument:"{{token}}<br />",tmplSubexpressionStart:"{{autoindent}}(",tmplSubexpressionStop:" )",tmplIndentTab:'<span class="tabbed">&nbsp;&nbsp;&nbsp;&nbsp;</span>',tmplIndentSpace:"&nbsp;",newLine:"<br />",autoLineBreak:"TOK_TYPE_FUNCTION | TOK_TYPE_ARGUMENT | TOK_SUBTYPE_LOGICAL | TOK_TYPE_OP_IN ",trim:!0,prefix:"=",customTokenRender:null};return Y(t,e)},a.formula2CSharp=function(t){var e=[],n=function(t,n,r,o){var s="",a=t,u={"=":"==","<>":"!=",MIN:"Math.Min",MAX:"Math.Max",ABS:"Math.ABS",SUM:"",IF:"","&":"+"},p=e[e.length-1],l=!1;switch(n.type.toString()){case m:switch(n.subtype){case x:e.push({name:a,argumentNumber:0}),s="string"==typeof u[a.toUpperCase()]?u[a.toUpperCase()]:a,l=!0;break;case v:switch(l=!0,p.name.toLowerCase()){case"if":s=")",l=!1;break;default:s="string"==typeof u[a.toUpperCase()]?u[a.toUpperCase()]:a}e.pop()}break;case S:switch(p.name.toLowerCase()){case"if":switch(p.argumentNumber){case 0:s="?";break;case 1:s=":"}break;case"sum":s="+";break;default:s="string"==typeof u[a.toUpperCase()]?u[a.toUpperCase()]:a,l=!0}p.argumentNumber+=1;break;case g:switch(n.subtype){case R:switch(p.name.toLowerCase()){case"sum":RegExp(":","gi").test(a)?s=i(a,"+"):outStr=a;break;default:s=RegExp(":","gi").test(a)?"["+i(a,",")+"]":a}}default:""===s&&(s="string"==typeof u[a.toUpperCase()]?u[a.toUpperCase()]:a),l=!0}return{tokenString:s,useTemplate:l}},r=Y(t,{tmplFunctionStart:"{{token}}(",tmplFunctionStop:"{{token}})",tmplOperandError:"{{token}}",tmplOperandRange:"{{token}}",tmplOperandLogical:"{{token}}",tmplOperandNumber:"{{token}}",tmplOperandText:'"{{token}}"',tmplArgument:"{{token}}",tmplOperandOperatorInfix:"{{token}}",tmplFunctionStartArray:"",tmplFunctionStartArrayRow:"{",tmplFunctionStopArrayRow:"}",tmplFunctionStopArray:"",tmplSubexpressionStart:"(",tmplSubexpressionStop:")",tmplIndentTab:"	",tmplIndentSpace:" ",autoLineBreak:"TOK_SUBTYPE_STOP | TOK_SUBTYPE_START | TOK_TYPE_ARGUMENT",trim:!0,customTokenRender:n});return r});a.formula2JavaScript=function(t){return K(t).replace("==","===")};a.getTokens=o}(window||module.exports||{});