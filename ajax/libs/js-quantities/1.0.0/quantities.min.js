!function(e,t){"object"==typeof exports?module.exports=t():"function"==typeof define&&define.amd?define(t):e.Qty=t()}(this,function(){var e={"<googol>":[["googol"],1e100,"prefix"],"<kibi>":[["Ki","Kibi","kibi"],Math.pow(2,10),"prefix"],"<mebi>":[["Mi","Mebi","mebi"],Math.pow(2,20),"prefix"],"<gibi>":[["Gi","Gibi","gibi"],Math.pow(2,30),"prefix"],"<tebi>":[["Ti","Tebi","tebi"],Math.pow(2,40),"prefix"],"<pebi>":[["Pi","Pebi","pebi"],Math.pow(2,50),"prefix"],"<exi>":[["Ei","Exi","exi"],Math.pow(2,60),"prefix"],"<zebi>":[["Zi","Zebi","zebi"],Math.pow(2,70),"prefix"],"<yebi>":[["Yi","Yebi","yebi"],Math.pow(2,80),"prefix"],"<yotta>":[["Y","Yotta","yotta"],1e24,"prefix"],"<zetta>":[["Z","Zetta","zetta"],1e21,"prefix"],"<exa>":[["E","Exa","exa"],1e18,"prefix"],"<peta>":[["P","Peta","peta"],1e15,"prefix"],"<tera>":[["T","Tera","tera"],1e12,"prefix"],"<giga>":[["G","Giga","giga"],1e9,"prefix"],"<mega>":[["M","Mega","mega"],1e6,"prefix"],"<kilo>":[["k","kilo"],1e3,"prefix"],"<hecto>":[["h","Hecto","hecto"],100,"prefix"],"<deca>":[["da","Deca","deca","deka"],10,"prefix"],"<deci>":[["d","Deci","deci"],.1,"prefix"],"<centi>":[["c","Centi","centi"],.01,"prefix"],"<milli>":[["m","Milli","milli"],.001,"prefix"],"<micro>":[["u","Micro","micro"],1e-6,"prefix"],"<nano>":[["n","Nano","nano"],1e-9,"prefix"],"<pico>":[["p","Pico","pico"],1e-12,"prefix"],"<femto>":[["f","Femto","femto"],1e-15,"prefix"],"<atto>":[["a","Atto","atto"],1e-18,"prefix"],"<zepto>":[["z","Zepto","zepto"],1e-21,"prefix"],"<yocto>":[["y","Yocto","yocto"],1e-24,"prefix"],"<1>":[["1","<1>"],1,""],"<meter>":[["m","meter","meters","metre","metres"],1,"length",["<meter>"]],"<inch>":[["in","inch","inches",'"'],.0254,"length",["<meter>"]],"<foot>":[["ft","foot","feet","'"],.3048,"length",["<meter>"]],"<yard>":[["yd","yard","yards"],.9144,"length",["<meter>"]],"<mile>":[["mi","mile","miles"],1609.344,"length",["<meter>"]],"<naut-mile>":[["nmi"],1852,"length",["<meter>"]],"<league>":[["league","leagues"],4828,"length",["<meter>"]],"<furlong>":[["furlong","furlongs"],201.2,"length",["<meter>"]],"<rod>":[["rd","rod","rods"],5.029,"length",["<meter>"]],"<mil>":[["mil","mils"],254e-7,"length",["<meter>"]],"<angstrom>":[["ang","angstrom","angstroms"],1e-10,"length",["<meter>"]],"<fathom>":[["fathom","fathoms"],1.829,"length",["<meter>"]],"<pica>":[["pica","picas"],.004217,"length",["<meter>"]],"<point>":[["pt","point","points"],3514e-7,"length",["<meter>"]],"<redshift>":[["z","red-shift"],1.302773e26,"length",["<meter>"]],"<AU>":[["AU","astronomical-unit"],1495979e5,"length",["<meter>"]],"<light-second>":[["ls","light-second"],299792500,"length",["<meter>"]],"<light-minute>":[["lmin","light-minute"],1798755e4,"length",["<meter>"]],"<light-year>":[["ly","light-year"],9460528e9,"length",["<meter>"]],"<parsec>":[["pc","parsec","parsecs"],3085678e10,"length",["<meter>"]],"<kilogram>":[["kg","kilogram","kilograms"],1,"mass",["<kilogram>"]],"<AMU>":[["u","AMU","amu"],6.0221415e26,"mass",["<kilogram>"]],"<dalton>":[["Da","Dalton","Daltons","dalton","daltons"],6.0221415e26,"mass",["<kilogram>"]],"<slug>":[["slug","slugs"],14.5939029,"mass",["<kilogram>"]],"<short-ton>":[["tn","ton"],907.18474,"mass",["<kilogram>"]],"<metric-ton>":[["tonne"],1e3,"mass",["<kilogram>"]],"<carat>":[["ct","carat","carats"],2e-4,"mass",["<kilogram>"]],"<pound>":[["lbs","lb","pound","pounds","#"],.45359237,"mass",["<kilogram>"]],"<ounce>":[["oz","ounce","ounces"],.0283495231,"mass",["<kilogram>"]],"<gram>":[["g","gram","grams","gramme","grammes"],.001,"mass",["<kilogram>"]],"<grain>":[["grain","grains","gr"],6479891e-11,"mass",["<kilogram>"]],"<dram>":[["dram","drams","dr"],.0017718452,"mass",["<kilogram>"]],"<stone>":[["stone","stones","st"],6.35029318,"mass",["<kilogram>"]],"<hectare>":[["hectare"],1e4,"area",["<meter>","<meter>"]],"<acre>":[["acre","acres"],4046.85642,"area",["<meter>","<meter>"]],"<sqft>":[["sqft"],1,"area",["<feet>","<feet>"]],"<liter>":[["l","L","liter","liters","litre","litres"],.001,"volume",["<meter>","<meter>","<meter>"]],"<gallon>":[["gal","gallon","gallons"],.0037854118,"volume",["<meter>","<meter>","<meter>"]],"<quart>":[["qt","quart","quarts"],.00094635295,"volume",["<meter>","<meter>","<meter>"]],"<pint>":[["pt","pint","pints"],.000473176475,"volume",["<meter>","<meter>","<meter>"]],"<cup>":[["cu","cup","cups"],.000236588238,"volume",["<meter>","<meter>","<meter>"]],"<fluid-ounce>":[["floz","fluid-ounce"],295735297e-13,"volume",["<meter>","<meter>","<meter>"]],"<tablespoon>":[["tbs","tablespoon","tablespoons"],147867648e-13,"volume",["<meter>","<meter>","<meter>"]],"<teaspoon>":[["tsp","teaspoon","teaspoons"],492892161e-14,"volume",["<meter>","<meter>","<meter>"]],"<kph>":[["kph"],.277777778,"speed",["<meter>"],["<second>"]],"<mph>":[["mph"],.44704,"speed",["<meter>"],["<second>"]],"<knot>":[["kt","kn","kts","knot","knots"],.514444444,"speed",["<meter>"],["<second>"]],"<fps>":[["fps"],.3048,"speed",["<meter>"],["<second>"]],"<gee>":[["gee"],9.80665,"acceleration",["<meter>"],["<second>","<second>"]],"<kelvin>":[["degK","kelvin"],1,"temperature",["<kelvin>"]],"<celsius>":[["degC","celsius","celsius","centigrade"],1,"temperature",["<kelvin>"]],"<fahrenheit>":[["degF","fahrenheit"],5/9,"temperature",["<kelvin>"]],"<rankine>":[["degR","rankine"],5/9,"temperature",["<kelvin>"]],"<temp-K>":[["tempK"],1,"temperature",["<temp-K>"]],"<temp-C>":[["tempC"],1,"temperature",["<temp-K>"]],"<temp-F>":[["tempF"],5/9,"temperature",["<temp-K>"]],"<temp-R>":[["tempR"],5/9,"temperature",["<temp-K>"]],"<second>":[["s","sec","second","seconds"],1,"time",["<second>"]],"<minute>":[["min","minute","minutes"],60,"time",["<second>"]],"<hour>":[["h","hr","hrs","hour","hours"],3600,"time",["<second>"]],"<day>":[["d","day","days"],86400,"time",["<second>"]],"<week>":[["wk","week","weeks"],604800,"time",["<second>"]],"<fortnight>":[["fortnight","fortnights"],1209600,"time",["<second>"]],"<year>":[["y","yr","year","years","annum"],31556926,"time",["<second>"]],"<decade>":[["decade","decades"],315569260,"time",["<second>"]],"<century>":[["century","centuries"],3155692600,"time",["<second>"]],"<pascal>":[["Pa","pascal","Pascal"],1,"pressure",["<kilogram>"],["<meter>","<second>","<second>"]],"<bar>":[["bar","bars"],1e5,"pressure",["<kilogram>"],["<meter>","<second>","<second>"]],"<mmHg>":[["mmHg"],133.322368,"pressure",["<kilogram>"],["<meter>","<second>","<second>"]],"<inHg>":[["inHg"],3386.3881472,"pressure",["<kilogram>"],["<meter>","<second>","<second>"]],"<torr>":[["torr"],133.322368,"pressure",["<kilogram>"],["<meter>","<second>","<second>"]],"<atm>":[["atm","ATM","atmosphere","atmospheres"],101325,"pressure",["<kilogram>"],["<meter>","<second>","<second>"]],"<psi>":[["psi"],6894.76,"pressure",["<kilogram>"],["<meter>","<second>","<second>"]],"<cmh2o>":[["cmH2O"],98.0638,"pressure",["<kilogram>"],["<meter>","<second>","<second>"]],"<inh2o>":[["inH2O"],249.082052,"pressure",["<kilogram>"],["<meter>","<second>","<second>"]],"<poise>":[["P","poise"],.1,"viscosity",["<kilogram>"],["<meter>","<second>"]],"<stokes>":[["St","stokes"],1e-4,"viscosity",["<meter>","<meter>"],["<second>"]],"<mole>":[["mol","mole"],1,"substance",["<mole>"]],"<molar>":[["M","molar"],1e3,"concentration",["<mole>"],["<meter>","<meter>","<meter>"]],"<wtpercent>":[["wt%","wtpercent"],10,"concentration",["<kilogram>"],["<meter>","<meter>","<meter>"]],"<katal>":[["kat","katal","Katal"],1,"activity",["<mole>"],["<second>"]],"<unit>":[["U","enzUnit"],1.6667e-15,"activity",["<mole>"],["<second>"]],"<farad>":[["F","farad","Farad"],1,"capacitance",["<farad>"]],"<coulomb>":[["C","coulomb","Coulomb"],1,"charge",["<ampere>","<second>"]],"<ampere>":[["A","Ampere","ampere","amp","amps"],1,"current",["<ampere>"]],"<siemens>":[["S","Siemens","siemens"],1,"conductance",["<second>","<second>","<second>","<ampere>","<ampere>"],["<kilogram>","<meter>","<meter>"]],"<henry>":[["H","Henry","henry"],1,"inductance",["<meter>","<meter>","<kilogram>"],["<second>","<second>","<ampere>","<ampere>"]],"<volt>":[["V","Volt","volt","volts"],1,"potential",["<meter>","<meter>","<kilogram>"],["<second>","<second>","<second>","<ampere>"]],"<ohm>":[["Ohm","ohm"],1,"resistance",["<meter>","<meter>","<kilogram>"],["<second>","<second>","<second>","<ampere>","<ampere>"]],"<weber>":[["Wb","weber","webers"],1,"magnetism",["<meter>","<meter>","<kilogram>"],["<second>","<second>","<ampere>"]],"<tesla>":[["T","tesla","teslas"],1,"magnetism",["<kilogram>"],["<second>","<second>","<ampere>"]],"<gauss>":[["G","gauss"],1e-4,"magnetism",["<kilogram>"],["<second>","<second>","<ampere>"]],"<maxwell>":[["Mx","maxwell","maxwells"],1e-8,"magnetism",["<meter>","<meter>","<kilogram>"],["<second>","<second>","<ampere>"]],"<oersted>":[["Oe","oersted","oersteds"],250/Math.PI,"magnetism",["<ampere>"],["<meter>"]],"<joule>":[["J","joule","Joule","joules"],1,"energy",["<meter>","<meter>","<kilogram>"],["<second>","<second>"]],"<erg>":[["erg","ergs"],1e-7,"energy",["<meter>","<meter>","<kilogram>"],["<second>","<second>"]],"<btu>":[["BTU","btu","BTUs"],1055.056,"energy",["<meter>","<meter>","<kilogram>"],["<second>","<second>"]],"<calorie>":[["cal","calorie","calories"],4.184,"energy",["<meter>","<meter>","<kilogram>"],["<second>","<second>"]],"<Calorie>":[["Cal","Calorie","Calories"],4184,"energy",["<meter>","<meter>","<kilogram>"],["<second>","<second>"]],"<therm-US>":[["th","therm","therms","Therm"],105480400,"energy",["<meter>","<meter>","<kilogram>"],["<second>","<second>"]],"<newton>":[["N","Newton","newton"],1,"force",["<kilogram>","<meter>"],["<second>","<second>"]],"<dyne>":[["dyn","dyne"],1e-5,"force",["<kilogram>","<meter>"],["<second>","<second>"]],"<pound-force>":[["lbf","pound-force"],4.448222,"force",["<kilogram>","<meter>"],["<second>","<second>"]],"<hertz>":[["Hz","hertz","Hertz"],1,"frequency",["<1>"],["<second>"]],"<radian>":[["rad","radian","radian"],1,"angle",["<radian>"]],"<degree>":[["deg","degree","degrees"],Math.PI/180,"angle",["<radian>"]],"<grad>":[["grad","gradian","grads"],Math.PI/200,"angle",["<radian>"]],"<steradian>":[["sr","steradian","steradians"],1,"solid_angle",["<steradian>"]],"<rotation>":[["rotation"],2*Math.PI,"angle",["<radian>"]],"<rpm>":[["rpm"],2*Math.PI/60,"angular_velocity",["<radian>"],["<second>"]],"<byte>":[["B","byte"],1,"memory",["<byte>"]],"<bit>":[["b","bit"],.125,"memory",["<byte>"]],"<dollar>":[["USD","dollar"],1,"currency",["<dollar>"]],"<cents>":[["cents"],.01,"currency",["<dollar>"]],"<candela>":[["cd","candela"],1,"luminosity",["<candela>"]],"<lumen>":[["lm","lumen"],1,"luminous_power",["<candela>","<steradian>"]],"<lux>":[["lux"],1,"illuminance",["<candela>","<steradian>"],["<meter>","<meter>"]],"<watt>":[["W","watt","watts"],1,"power",["<kilogram>","<meter>","<meter>"],["<second>","<second>","<second>"]],"<horsepower>":[["hp","horsepower"],745.699872,"power",["<kilogram>","<meter>","<meter>"],["<second>","<second>","<second>"]],"<gray>":[["Gy","gray","grays"],1,"radiation",["<meter>","<meter>"],["<second>","<second>"]],"<roentgen>":[["R","roentgen"],.00933,"radiation",["<meter>","<meter>"],["<second>","<second>"]],"<sievert>":[["Sv","sievert","sieverts"],1,"radiation",["<meter>","<meter>"],["<second>","<second>"]],"<becquerel>":[["Bq","bequerel","bequerels"],1,"radiation",["<1>"],["<second>"]],"<curie>":[["Ci","curie","curies"],37e9,"radiation",["<1>"],["<second>"]],"<cpm>":[["cpm"],1/60,"rate",["<count>"],["<second>"]],"<dpm>":[["dpm"],1/60,"rate",["<count>"],["<second>"]],"<bpm>":[["bpm"],1/60,"rate",["<count>"],["<second>"]],"<dot>":[["dot","dots"],1,"resolution",["<each>"]],"<pixel>":[["pixel","px"],1,"resolution",["<each>"]],"<ppi>":[["ppi"],1,"resolution",["<pixel>"],["<inch>"]],"<dpi>":[["dpi"],1,"typography",["<dot>"],["<inch>"]],"<cell>":[["cells","cell"],1,"counting",["<each>"]],"<each>":[["each"],1,"counting",["<each>"]],"<count>":[["count"],1,"counting",["<each>"]],"<base-pair>":[["bp"],1,"counting",["<each>"]],"<nucleotide>":[["nt"],1,"counting",["<each>"]],"<molecule>":[["molecule","molecules"],1,"counting",["<1>"]],"<dozen>":[["doz","dz","dozen"],12,"prefix_only",["<each>"]],"<percent>":[["%","percent"],.01,"prefix_only",["<1>"]],"<ppm>":[["ppm"],1e-6,"prefix_only",["<1>"]],"<ppt>":[["ppt"],1e-9,"prefix_only",["<1>"]],"<gross>":[["gr","gross"],144,"prefix_only",["<dozen>","<dozen>"]],"<decibel>":[["dB","decibel","decibels"],1,"logarithmic",["<decibel>"]]},t=["<meter>","<kilogram>","<second>","<mole>","<farad>","<ampere>","<radian>","<kelvin>","<temp-K>","<byte>","<dollar>","<candela>","<each>","<steradian>","<decibel>"],r="<1>",n=[r],i="([+-]?\\d*(?:\\.\\d+)?(?:[Ee][+-]?\\d+)?)",a=(new RegExp(i),new RegExp("^([+-]?\\d*(?:\\.\\d+)?(?:[Ee][+-]?\\d+)?)\\s*([^/]*)(?:/(.+))?$")),o="\\^|\\*{2}",s=new RegExp("([^ \\*]+?)(?:"+o+")?(-?\\d+)"),m=new RegExp("([^ \\*]+?)(?:"+o+")?(\\d+)"),c=["length","time","temperature","mass","current","substance","luminosity","currency","memory","angle","capacitance"],u={"-312058":"resistance","-312038":"inductance","-152040":"magnetism","-152038":"magnetism","-152058":"potential","-39":"acceleration","-38":"radiation","-20":"frequency","-19":"speed","-18":"viscosity",0:"unitless",1:"length",2:"area",3:"volume",20:"time",400:"temperature",7942:"power",7959:"pressure",7962:"energy",7979:"viscosity",7981:"force",7997:"mass_concentration",8000:"mass",159999:"magnetism",160000:"current",160020:"charge",312058:"conductance",3199980:"activity",3199997:"molar_concentration",3200000:"substance",63999998:"illuminance",64000000:"luminous_power",1280000000:"currency",25600000000:"memory",511999999980:"angular_velocity",512000000000:"angle",10240000000000:"capacitance"},l={};function h(t){if(this.scalar=null,this.base_scalar=null,this.signature=null,this.output={},this.numerator=n,this.denominator=n,t.constructor===String?(t=t.trim(),function(e){var t=a.exec(e);if(!t)throw e+": Quantity not recognized";if(""===e.trim())throw"Unit not recognized";this.scalar=t[1]?parseFloat(t[1]):1;var r,i,o,c,u=t[2],l=t[3];for(;t=s.exec(u);){if(r=parseFloat(t[2]),isNaN(r))throw"Unit exponent is not a number";if(0===r&&!I.test(t[1]))throw"Unit not recognized";i=t[1]+" ",o="";for(var h=0;h<Math.abs(r);h++)o+=i;r>=0?u=u.replace(t[0],o):(l=l?l+o:o,u=u.replace(t[0],""))}for(;t=m.exec(l);){if(r=parseFloat(t[2]),isNaN(r))throw"Unit exponent is not a number";if(0===r&&!I.test(t[1]))throw"Unit not recognized";i=t[1]+" ",o="";for(var d=0;d<r;d++)o+=i;l=l.replace(t[0],o,"g")}if(u){if(!I.test(u))throw"Unit not recognized";for(this.numerator=[];c=E.exec(u);)this.numerator.push(c.slice(1))}if(l){if(!I.test(l))throw"Unit not recognized";for(this.denominator=[];c=E.exec(l);)this.denominator.push(c.slice(1))}this.numerator=function(){return this.numerator.map(function(e){return z[e[0]]?[z[e[0]],K[e[1]]]:[K[e[1]]]})}.call(this),this.numerator=this.numerator.reduce(function(e,t){return e.concat(t)},[]),this.numerator=this.numerator.filter(function(e){return e}),this.denominator=function(){return this.denominator.map(function(e){return z[e[0]]?[z[e[0]],K[e[1]]]:[K[e[1]]]})}.call(this),this.denominator=this.denominator.reduce(function(e,t){return e.concat(t)},[]),this.denominator=this.denominator.filter(function(e){return e}),0===this.numerator.length&&(this.numerator=n);0===this.denominator.length&&(this.denominator=n)}.call(this,t)):(this.scalar=t.scalar,this.numerator=t.numerator&&0!==t.numerator.length?t.numerator:n,this.denominator=t.denominator&&0!==t.denominator.length?t.denominator:n),this.denominator.join("*").indexOf("temp")>=0)throw"Cannot divide with temperatures";if(this.numerator.join("*").indexOf("temp")>=0){if(this.numerator.length>1)throw"Cannot multiply by temperatures";if(!g(this.denominator,n))throw"Cannot divide with temperatures"}if(this.init_value=t,function(){if(this.base_scalar)return this.base_scalar;if(this.isBase())this.base_scalar=this.scalar,this.signature=function(){if(this.signature)return this.signature;for(var t=function t(){if(!this.isBase())return t.call(this.toBase());var r=new Array(c.length);for(var n=0;n<r.length;n++)r[n]=0;var i,a;for(var o=0;o<this.numerator.length;o++)(i=e[this.numerator[o]])&&(a=c.indexOf(i[2]))>=0&&(r[a]=r[a]+1);for(var s=0;s<this.denominator.length;s++)(i=e[this.denominator[s]])&&(a=c.indexOf(i[2]))>=0&&(r[a]=r[a]-1);return r}.call(this),r=0;r<t.length;r++)t[r]*=Math.pow(20,r);return t.reduce(function(e,t,r,n){return e+t},0)}.call(this);else{var t=this.toBase();this.base_scalar=t.scalar,this.signature=t.signature}}.call(this),this.isTemperature()&&this.base_scalar<0)throw"Temperatures must not be less than absolute zero"}function d(e){var t=[];for(var r in e)e.hasOwnProperty(r)&&t.push(r);return t}function p(e){for(var t,r,n=[],i=0;i<e.length;i++)t=e[i],r=e[i+1],M[t]?(n.push(F[t]+F[r]),i++):n.push(F[t]);return n}function f(e){return function(e){if(1===e.length)return e;return e.reduce(function(e,t,r,n){return e.some(function(e){return g(e,t)})||e.push(t),e},[])}(e.map(function(t){return[t,e.filter(function(e){return e===t}).length]})).map(function(e){return e[0]+(e[1]>1?e[1]:"")})}function g(e,t){if(t.length!==e.length)return!1;for(var r=0;r<e.length;r++){if(t[r].compareArray&&!t[r].compareArray(e[r]))return!1;if(t[r]!==e[r])return!1}return!0}function b(e,t){return Math.round(e*Math.pow(10,t))/Math.pow(10,t)}h.parse=function(e){if("string"!=typeof e&&!(e instanceof String))throw"Argument should be a string";try{return new h(e)}catch(e){return null}},h.prototype={constructor:h,toFloat:function(){if(this.isUnitless())return this.scalar;throw"Can't convert to Float unless unitless.  Use Unit#scalar"},isUnitless:function(){return g(this.numerator,n)&&g(this.denominator,n)},isCompatible:function(e){return e&&e.constructor===String?this.isCompatible(new h(e)):e instanceof h&&(void 0!==e.signature&&this.signature===e.signature)},isInverse:function(e){return this.inverse().isCompatible(e)},kind:function(){return u[this.signature.toString()]},isBase:function(){return void 0!==this.is_base?this.is_base:this.isDegrees()&&this.numerator[0].match(/<(kelvin|temp-K)>/)?(this.is_base=!0,this.is_base):(this.numerator.concat(this.denominator).forEach(function(e){e!==r&&-1===t.indexOf(e)&&(this.is_base=!1)},this),!1===this.is_base?this.is_base:(this.is_base=!0,this.is_base))},toBase:function(){if(this.isBase())return this;if(this.isTemperature())return function(e){var t,r=e.units();if(r.match(/(deg)[CFRK]/))t=e.base_scalar;else if("tempK"===r)t=e.scalar;else if("tempC"===r)t=e.scalar+273.15;else if("tempF"===r)t=5*(e.scalar+459.67)/9;else{if("tempR"!==r)throw"Unknown type for temp conversion from: "+r;t=5*e.scalar/9}return new h({scalar:t,numerator:["<temp-K>"],denominator:n})}(this);var e=l[this.units()];return e||(e=function(e,t){for(var r,n=[],i=[],a=1,o=0;o<e.length;o++)r=e[o],M[r]?a=x(a,M[r]):T[r]&&(a*=T[r].scalar,T[r].numerator&&n.push(T[r].numerator),T[r].denominator&&i.push(T[r].denominator));for(var s=0;s<t.length;s++)r=t[s],M[r]?a/=M[r]:T[r]&&(a/=T[r].scalar,T[r].numerator&&i.push(T[r].numerator),T[r].denominator&&n.push(T[r].denominator));return n=n.reduce(function(e,t){return e.concat(t)},[]),i=i.reduce(function(e,t){return e.concat(t)},[]),new h({scalar:a,numerator:n,denominator:i})}(this.numerator,this.denominator),l[this.units()]=e),e.mul(this.scalar)},units:function(){if(void 0!==this._units)return this._units;var e=g(this.numerator,n),t=g(this.denominator,n);if(e&&t)return this._units="",this._units;var r=e?["1"]:f(p(this.numerator)),i=t?null:f(p(this.denominator));return this._units=r.join("*")+(t?"":"/"+i.join("*")),this._units},eq:function(e){return 0===this.compareTo(e)},lt:function(e){return-1===this.compareTo(e)},lte:function(e){return this.eq(e)||this.lt(e)},gt:function(e){return 1===this.compareTo(e)},gte:function(e){return this.eq(e)||this.gt(e)},toPrec:function(e){if(e&&e.constructor===String&&(e=new h(e)),"number"==typeof e&&(e=new h(e+" "+this.units())),this.isUnitless()){if(!e.isUnitless())throw"Incompatible Units"}else e=e.to(this.units());if(0===e.scalar)throw"Divide by zero";var t,r=Math.round(this.scalar/e.scalar)*e.scalar;return new h((r=b(r,-(t=e.scalar,Math.floor(Math.log(Math.abs(t))/Math.LN10))))+this.units())},toString:function(e,t){var r,n;if("number"==typeof e)t=e;else if("string"==typeof e)r=e;else if(e instanceof h)return this.toPrec(e).toString(t);return!t&&this.output[r]?n=this.output[r]:r?(n=this.to(r),this.output[r]=n):n=this,n=((void 0!==t?b(n.scalar,t):n.scalar)+" "+n.units()).trim()},compareTo:function(e){if(e&&e.constructor===String)return this.compareTo(new h(e));if(!this.isCompatible(e))throw"Incompatible quantities";return this.base_scalar<e.base_scalar?-1:this.base_scalar===e.base_scalar?0:this.base_scalar>e.base_scalar?1:void 0},same:function(e){return this.scalar===e.scalar&&this.units()===e.units()},inverse:function(){if(this.isTemperature())throw"Cannot divide with temperatures";if(0===this.scalar)throw"Divide by zero";return new h({scalar:1/this.scalar,numerator:this.denominator,denominator:this.numerator})},isDegrees:function(){return(null===this.signature||400===this.signature)&&1===this.numerator.length&&g(this.denominator,n)&&(this.numerator[0].match(/<temp-[CFRK]>/)||this.numerator[0].match(/<(kelvin|celsius|rankine|fahrenheit)>/))},isTemperature:function(){return this.isDegrees()&&this.numerator[0].match(/<temp-[CFRK]>/)},to:function(e){if(e&&e.constructor!==String)return this.to(e.units());var t=new h(e);if(t.units()===this.units())return this;if(!this.isCompatible(t)){if(this.isInverse(t))return this.inverse().to(e);throw"Incompatible Units"}return t.isTemperature()?function(e,t){var r,n=t.units();if("tempK"===n)r=e.base_scalar;else if("tempC"===n)r=e.base_scalar-273.15;else if("tempF"===n)r=9*e.base_scalar/5-459.67;else{if("tempR"!==n)throw"Unknown type for temp conversion to: "+n;r=9*e.base_scalar/5}return new h({scalar:r,numerator:t.numerator,denominator:t.denominator})}(this,t):t.isDegrees()?function(e,t){var r,i=function(e){var t,r=e.units();if(r.match(/(deg)[CFRK]/))t=e.base_scalar;else if("tempK"===r)t=e.scalar;else if("tempC"===r)t=e.scalar;else if("tempF"===r)t=5*e.scalar/9;else{if("tempR"!==r)throw"Unknown type for temp conversion from: "+r;t=5*e.scalar/9}return new h({scalar:t,numerator:["<kelvin>"],denominator:n})}(e),a=t.units();if("degK"===a)r=i.scalar;else if("degC"===a)r=i.scalar;else if("degF"===a)r=9*i.scalar/5;else{if("degR"!==a)throw"Unknown type for degree conversion to: "+a;r=9*i.scalar/5}return new h({scalar:r,numerator:t.numerator,denominator:t.denominator})}(this,t):new h({scalar:_(this.base_scalar,t.base_scalar),numerator:t.numerator,denominator:t.denominator})},add:function(e){if(e&&e.constructor===String&&(e=new h(e)),!this.isCompatible(e))throw"Incompatible Units";if(this.isTemperature()&&e.isTemperature())throw"Cannot add two temperatures";return this.isTemperature()?y(this,e):e.isTemperature()?y(e,this):new h({scalar:this.scalar+e.to(this).scalar,numerator:this.numerator,denominator:this.denominator})},sub:function(e){if(e&&e.constructor===String&&(e=new h(e)),!this.isCompatible(e))throw"Incompatible Units";if(this.isTemperature()&&e.isTemperature())return i=e,a=(n=this).units(),o=i.to(a),s=new h(k(a)),new h({scalar:n.scalar-o.scalar,numerator:s.numerator,denominator:s.denominator});if(this.isTemperature())return t=this,r=e.to(k(t.units())),new h({scalar:t.scalar-r.scalar,numerator:t.numerator,denominator:t.denominator});if(e.isTemperature())throw"Cannot subtract a temperature from a differential degree unit";var t,r,n,i,a,o,s;return new h({scalar:this.scalar-e.to(this).scalar,numerator:this.numerator,denominator:this.denominator})},mul:function(e){if("number"==typeof e)return new h({scalar:x(this.scalar,e),numerator:this.numerator,denominator:this.denominator});if(e&&e.constructor===String&&(e=new h(e)),(this.isTemperature()||e.isTemperature())&&!this.isUnitless()&&!e.isUnitless())throw"Cannot multiply by temperatures";var t=this,r=e;t.isCompatible(r)&&400!==t.signature&&(r=r.to(t));var n=U(t.numerator.concat(r.numerator),t.denominator.concat(r.denominator));return new h({scalar:x(t.scalar,r.scalar),numerator:n[0],denominator:n[1]})},div:function(e){if("number"==typeof e){if(0===e)throw"Divide by zero";return new h({scalar:this.scalar/e,numerator:this.numerator,denominator:this.denominator})}if(e&&e.constructor===String&&(e=new h(e)),0===e.scalar)throw"Divide by zero";if(e.isTemperature())throw"Cannot divide with temperatures";if(this.isTemperature()&&!e.isUnitless())throw"Cannot divide with temperatures";var t=this,r=e;t.isCompatible(r)&&400!==t.signature&&(r=r.to(t));var n=U(t.numerator.concat(r.denominator),t.denominator.concat(r.numerator));return new h({scalar:t.scalar/r.scalar,numerator:n[0],denominator:n[1]})}};var w=/^-?(\d+)(?:\.(\d+))?$/,v=/^-?(\d+)e-?(\d+)$/;function y(e,t){var r=t.to(k(e.units()));return new h({scalar:e.scalar+r.scalar,numerator:e.numerator,denominator:e.denominator})}function k(e){if("tempK"===e)return"degK";if("tempC"===e)return"degC";if("tempF"===e)return"degF";if("tempR"===e)return"degR";throw"Unknown type for temp conversion from: "+e}function x(){for(var e=1,t=0,r=0;r<arguments.length;r++){var n=arguments[r];t+=C(n),e*=n}return 0!==t?b(e,t):e}function _(e,t){if(0===t)throw"Divide by zero";return x(e,1/t)}function C(e){var t,r;return(r=w.exec(e))&&r[2]?t=r[2].length:(r=v.exec(e))&&(t=parseInt(r[2],10)),t||0}function U(e,t){e=e.filter(function(e){return e!==r}),t=t.filter(function(e){return e!==r});for(var i,a={},o=0;o<e.length;o++)M[e[o]]?(i=[e[o],e[o+1]],o++):i=e[o],i&&i!==r&&(a[i]?a[i][0]++:a[i]=[1,i]);for(var s=0;s<t.length;s++)M[t[s]]?(i=[t[s],t[s+1]],s++):i=t[s],i&&i!==r&&(a[i]?a[i][0]--:a[i]=[-1,i]);for(var m in e=[],t=[],a)if(a.hasOwnProperty(m)){var c,u=a[m];if(u[0]>0)for(c=0;c<u[0];c++)e.push(u[1]);else if(u[0]<0)for(c=0;c<-u[0];c++)t.push(u[1])}return 0===e.length&&(e=n),0===t.length&&(t=n),[e=e.reduce(function(e,t){return e.concat(t)},[]),t=t.reduce(function(e,t){return e.concat(t)},[])]}h.mul_safe=x,h.div_safe=_;var M={},z={},T={},K={},F={};for(var R in e)if(e.hasOwnProperty(R)){var S=e[R];if("prefix"===S[2]){M[R]=S[1];for(var P=0;P<S[0].length;P++)z[S[0][P]]=R}else{T[R]={scalar:S[1],numerator:S[3],denominator:S[4]};for(var q=0;q<S[0].length;q++)K[S[0][q]]=R}F[R]=S[0][0]}var D="("+d(z).sort(function(e,t){return t.length-e.length}).join("|")+")*?("+d(K).sort(function(e,t){return t.length-e.length}).join("|")+")\\b",E=new RegExp(D,"g"),I=new RegExp("^\\s*("+D+"\\s*\\*?\\s*)+$");return h});