/**
 * videojs-contrib-ads
 * @version 5.1.1-1
 * @copyright 2017 Brightcove, Inc.
 * @license Apache-2.0
 */
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t(require("video.js")):"function"==typeof define&&define.amd?define(["video.js"],t):e.videojsContribAds=t(e.videojs)}(this,function(e){"use strict";function t(e){"playing"===e.type?p(this,e):"ended"===e.type?m(this,e):"loadstart"===e.type||"loadeddata"===e.type||"loadedmetadata"===e.type?h(this,e):"play"===e.type?y(this,e):this.ads.isInAdMode()&&(this.ads.isContentResuming()?f(this,"content",e):f(this,"ad",e))}function n(t){var n=void 0;n=e.browser.IS_IOS&&t.ads.isLive(t)&&t.seekable().length>0?t.currentTime()-t.seekable().end(0):t.currentTime();var a=t.$(".vjs-tech"),i=t.remoteTextTracks?t.remoteTextTracks():[],s=t.textTracks?t.textTracks():[],o=[],d=[],r={ended:t.ended(),currentSrc:t.currentSrc(),src:t.tech_.src(),currentTime:n,type:t.currentType()};a&&(r.nativePoster=a.poster,r.style=a.getAttribute("style"));for(var c=0;c<i.length;c++){var u=i[c];o.push({track:u,mode:u.mode}),u.mode="disabled"}r.suppressedRemoteTracks=o;for(var l=0;l<s.length;l++){var f=s[l];d.push({track:f,mode:f.mode}),f.mode="disabled"}return r.suppressedTracks=d,r}function a(t,n){if(!0!==t.ads.disableNextSnapshotRestore){var a=t.$(".vjs-tech"),i=20,s=n.suppressedRemoteTracks,o=n.suppressedTracks,d=void 0,r=function(){for(var e=0;e<s.length;e++)(d=s[e]).track.mode=d.mode;for(var t=0;t<o.length;t++)(d=o[t]).track.mode=d.mode},c=function(){var a=void 0;e.browser.IS_IOS&&t.ads.isLive(t)?n.currentTime<0&&(a=t.seekable().length>0?t.seekable().end(0)+n.currentTime:t.currentTime(),t.currentTime(a)):n.ended?t.currentTime(t.duration()):t.currentTime(n.currentTime),n.ended||t.play()},l=function f(){if(t.off("contentcanplay",f),t.ads.tryToResumeTimeout_&&(t.clearTimeout(t.ads.tryToResumeTimeout_),t.ads.tryToResumeTimeout_=null),(a=t.el().querySelector(".vjs-tech")).readyState>1)return c();if(a.seekable===undefined)return c();if(a.seekable.length>0)return c();if(i--)u.setTimeout(f,50);else try{c()}catch(n){e.log.warn("Failed to resume the content after an advertisement",n)}};n.nativePoster&&(a.poster=n.nativePoster),"style"in n&&a.setAttribute("style",n.style||""),t.ads.videoElementRecycled()?(t.one("contentloadedmetadata",r),t.src({src:n.currentSrc,type:n.type}),t.one("contentcanplay",l),t.ads.tryToResumeTimeout_=t.setTimeout(l,2e3)):t.ended()&&n.ended||(r(),t.play())}else t.ads.disableNextSnapshotRestore=!1}function i(e){e.ads.contentSrc=e.currentSrc();var t=function(){if("ad-playback"!==e.ads.state){var t=e.currentSrc();t!==e.ads.contentSrc&&(e.trigger({type:"contentupdate",oldValue:e.ads.contentSrc,newValue:t}),e.ads.contentSrc=t)}};e.on("loadstart",t),u.setTimeout(t,1)}function s(t){if(!t.ads.cancelPlayTimeout){if(e.browser.IS_IOS&&e.browser.IS_IPHONE&&!t.el_.hasAttribute("playsinline")){var n=t.currentWidth?t.currentWidth():t.width(),a=t.currentHeight?t.currentHeight():t.height(),i=u.getComputedStyle(t.el_).position,s=u.getComputedStyle(t.el_).top,o=_.createElement("div");o.style.width=n+"px",o.style.height=a+"px",o.style.background="black",o.style.position=i,o.style.top=s,t.el_.parentNode.insertBefore(o,t.el_),t.el_.style.display="none",t.one(["adstart","adtimeout","adserror","adscanceled","adskip","playing"],function(){t.el_.style.display="block",o.remove()}),t.on("fullscreenchange",function(){o&&!t.isFullscreen()&&(t.el_.style.display="block",o.remove())})}t.ads.cancelPlayTimeout=u.setTimeout(function(){t.ads.cancelPlayTimeout=null,t.paused()||t.pause(),t.ads._cancelledPlay=!0},1)}}function o(t,n,a){n===undefined&&(n=!1);var i={};a!==undefined&&(i=a),i["{player.id}"]=this.options_["data-player"],i["{mediainfo.id}"]=this.mediainfo?this.mediainfo.id:"",i["{mediainfo.name}"]=this.mediainfo?this.mediainfo.name:"",i["{mediainfo.description}"]=this.mediainfo?this.mediainfo.description:"",i["{mediainfo.tags}"]=this.mediainfo?this.mediainfo.tags:"",i["{mediainfo.reference_id}"]=this.mediainfo?this.mediainfo.reference_id:"",i["{mediainfo.duration}"]=this.mediainfo?this.mediainfo.duration:"",i["{mediainfo.ad_keys}"]=this.mediainfo?this.mediainfo.ad_keys:"",i["{player.duration}"]=this.duration(),i["{timestamp}"]=(new Date).getTime(),i["{document.referrer}"]=_.referrer,i["{window.location.href}"]=u.location.href,i["{random}"]=Math.floor(1e12*Math.random()),S(this.mediainfo,i,"custom_fields"),S(this.mediainfo,i,"customFields");for(var s in i)t=t.split(s).join(A(i[s],n));return t=t.replace(/{pageVariable\.([^}]+)}/g,function(t,a){for(var i=void 0,s=u,o=a.split("."),d=0;d<o.length;d++)d===o.length-1?i=s[o[d]]:s=s[o[d]];var r=void 0===i?"undefined":k(i);return null===i?"null":i===undefined?(e.log.warn('Page variable "'+a+'" not found'),""):"string"!==r&&"number"!==r&&"boolean"!==r?(e.log.warn('Page variable "'+a+'" is not a supported type'),""):A(String(i),n)})}e="default"in e?e["default"]:e;var d,r,c="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},u=d="undefined"!=typeof window?window:void 0!==c?c:"undefined"!=typeof self?self:{},l=function(e,t){t.isImmediatePropagationStopped=function(){return!0},t.cancelBubble=!0,t.isPropagationStopped=function(){return!0}},f=function(e,t,n){l(0,n),e.trigger({type:t+n.type,state:e.ads.state,originalEvent:n})},p=function(e,t){e.ads.isInAdMode()&&(e.ads.isContentResuming()?e.ads._contentEnding&&f(e,"content",t):e.ads._cancelledPlay?l(0,t):f(e,"ad",t))},m=function(e,t){if(e.ads.isInAdMode()){if(e.ads.isContentResuming())return;f(e,"ad",t)}else f(e,"content",t)},h=function(e,t){if(!("loadstart"===t.type&&!e.ads._hasThereBeenALoadStartDuringPlayerLife||"loadeddata"===t.type&&!e.ads._hasThereBeenALoadedData||"loadedmetadata"===t.type&&!e.ads._hasThereBeenALoadedMetaData))if(e.ads.isAdPlaying())f(e,"ad",t);else{if(e.currentSrc()!==e.ads.contentSrc)return;f(e,"content",t)}},y=function(e,t){var n=e.ads._cancelledPlay&&!e.ads.isInAdMode();e.ads.isAdPlaying()?f(e,"ad",t):(e.ads.isContentResuming()||n)&&f(e,"content",t)},g={},T=(Object.freeze||Object)({"default":g}),v=T&&g||T,b=void 0!==c?c:"undefined"!=typeof window?window:{};"undefined"!=typeof document?r=document:(r=b["__GLOBAL_DOCUMENT_CACHE@4"])||(r=b["__GLOBAL_DOCUMENT_CACHE@4"]=v);var _=r,k="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},A=function(e,t){return t?encodeURIComponent(e):e},S=function(e,t,n){if(e&&e[n])for(var a=e[n],i=Object.keys(a),s=0;s<i.length;s++)t["{mediainfo."+n+"."+i[s]+"}"]=a[i[s]]},C={};C.processMetadataTracks=function(e,t){for(var n=e.textTracks(),a=function(n){"metadata"===n.kind&&(e.ads.cueTextTracks.setMetadataTrackMode(n),t(e,n))},i=0;i<n.length;i++)a(n[i]);n.addEventListener("addtrack",function(e){a(e.track)})},C.setMetadataTrackMode=function(e){},C.getSupportedAdCue=function(e,t){return t},C.isSupportedAdCue=function(e,t){return!0},C.getCueId=function(e,t){return t.id};var P=function(e,t){return t!==undefined&&e.ads.includedCues[t]},w=function(e,t){t!==undefined&&""!==t&&(e.ads.includedCues[t]=!0)};C.processAdTrack=function(t,n,a,i){t.ads.includedCues={};for(var s=0;s<n.length;s++){var o=n[s],d=this.getSupportedAdCue(t,o);if(!this.isSupportedAdCue(t,o))return void e.log.warn("Skipping as this is not a supported ad cue.",o);var r=this.getCueId(t,o),c=o.startTime;if(P(t,r))return void e.log("Skipping ad already seen with ID "+r);i&&i(t,d,r,c),a(t,d,r,c),w(t,r)}};var L=e.getTech("Html5").Events,E=function(e){var t=e.$(".vjs-tech");t&&t.removeAttribute("poster")},j={timeout:5e3,prerollTimeout:100,postrollTimeout:100,debug:!1,stitchedAds:!1},I=function(d){var r=this,c=e.mergeOptions(j,d),l=L.concat(["firstplay","loadedalldata","playing"]);r.on(l,t),u.setTimeout(function(){r.ads._hasThereBeenALoadStartDuringPlayerLife||""===r.src()||e.log.error("videojs-contrib-ads has not seen a loadstart event 5 seconds after being initialized, but a source is present. This indicates that videojs-contrib-ads was initialized too late. It must be initialized immediately after video.js in the same tick. As a result, some ads will not play and some media events will be incorrect. For more information, see https://github.com/videojs/videojs-contrib-ads#important-note-about-initialization")},5e3),r.on("ended",function(){r.hasClass("vjs-has-started")||r.addClass("vjs-has-started")}),r.on(["addurationchange","adcanplay"],function(){r.ads.snapshot&&r.currentSrc()===r.ads.snapshot.currentSrc||r.ads.isAdPlaying()&&r.play()}),r.on("nopreroll",function(){r.ads.nopreroll_=!0}),r.on("nopostroll",function(){r.ads.nopostroll_=!0}),r.on(["ads-ad-started","playing"],function(){r.removeClass("vjs-ad-loading")}),r.on("playing",function(){r.ads._cancelledPlay=!1}),r.one("loadstart",function(){r.ads._hasThereBeenALoadStartDuringPlayerLife=!0}),r.on("loadeddata",function(){r.ads._hasThereBeenALoadedData=!0}),r.on("loadedmetadata",function(){r.ads._hasThereBeenALoadedMetaData=!0}),r.ads={state:"content-set",disableNextSnapshotRestore:!1,_contentEnding:!1,_contentHasEnded:!1,_hasThereBeenALoadStartDuringPlayerLife:!1,_hasThereBeenALoadedData:!1,_hasThereBeenALoadedMetaData:!1,_inLinearAdMode:!1,adType:null,VERSION:"__VERSION__",reset:function(){r.ads.disableNextSnapshotRestore=!1,r.ads._contentEnding=!1,r.ads._contentHasEnded=!1,r.ads.snapshot=null,r.ads.adType=null,r.ads._hasThereBeenALoadedData=!1,r.ads._hasThereBeenALoadedMetaData=!1},startLinearAdMode:function(){"preroll?"!==r.ads.state&&"content-playback"!==r.ads.state&&"postroll?"!==r.ads.state||(r.ads._inLinearAdMode=!0,r.trigger("adstart"))},endLinearAdMode:function(){"ad-playback"===r.ads.state&&(r.ads._inLinearAdMode=!1,r.trigger("adend"),r.removeClass("vjs-ad-loading"))},skipLinearAdMode:function(){"ad-playback"!==r.ads.state&&r.trigger("adskip")},stitchedAds:function(e){return e!==undefined&&(this._stitchedAds=!!e),this._stitchedAds},videoElementRecycled:function(){if(r.ads.shouldPlayContentBehindAd(r))return!1;if(!this.snapshot)throw new Error("You cannot use videoElementRecycled while there is no snapshot.");var e=r.tech_.src()!==this.snapshot.src,t=r.currentSrc()!==this.snapshot.currentSrc;return e||t},isLive:function(t){return t.duration()===Infinity||"8"===e.browser.IOS_VERSION&&0===t.duration()},shouldPlayContentBehindAd:function(t){return!e.browser.IS_IOS&&!e.browser.IS_ANDROID&&t.duration()===Infinity},isInAdMode:function(){return"ads-ready?"===r.ads.state||"preroll?"===r.ads.state||"ad-playback"===r.ads.state||"content-resuming"===r.ads.state},isContentResuming:function(){return"content-resuming"===r.ads.state},isAdPlaying:function(){return this._inLinearAdMode}},r.ads.stitchedAds(c.stitchedAds),r.ads.cueTextTracks=C,r.ads.adMacroReplacement=o.bind(r),i(r),r.on("contentupdate",r.ads.reset);var f={"content-set":{events:{adscanceled:function(){this.state="content-playback"},adsready:function(){this.state="ads-ready"},play:function(){this.state="ads-ready?",s(r),E(r)},adserror:function(){this.state="content-playback"},adskip:function(){this.state="content-playback"}}},"ads-ready":{events:{play:function(){this.state="preroll?",s(r)},adskip:function(){this.state="content-playback"},adserror:function(){this.state="content-playback"}}},"preroll?":{enter:function(){r.ads.nopreroll_?(r.trigger("readyforpreroll"),u.setTimeout(function(){r.trigger("nopreroll")},1)):(r.addClass("vjs-ad-loading"),r.ads.adTimeoutTimeout=u.setTimeout(function(){r.trigger("adtimeout")},c.prerollTimeout),r.ads._hasThereBeenALoadStartDuringPlayerLife?r.trigger("readyforpreroll"):r.one("loadstart",function(){r.trigger("readyforpreroll")}))},leave:function(){u.clearTimeout(r.ads.adTimeoutTimeout)},events:{play:function(){s(r)},adstart:function(){this.state="ad-playback",r.ads.adType="preroll"},adskip:function(){this.state="content-playback"},adtimeout:function(){this.state="content-playback"},adserror:function(){this.state="content-playback"},nopreroll:function(){this.state="content-playback"}}},"ads-ready?":{enter:function(){r.addClass("vjs-ad-loading"),r.ads.adTimeoutTimeout=u.setTimeout(function(){r.trigger("adtimeout")},c.timeout)},leave:function(){u.clearTimeout(r.ads.adTimeoutTimeout),r.removeClass("vjs-ad-loading")},events:{play:function(){s(r)},adscanceled:function(){this.state="content-playback"},adsready:function(){this.state="preroll?"},adskip:function(){this.state="content-playback"},adtimeout:function(){this.state="content-playback"},adserror:function(){this.state="content-playback"}}},"ad-playback":{enter:function(){r.ads.shouldPlayContentBehindAd(r)||(this.snapshot=n(r)),r.ads.shouldPlayContentBehindAd(r)&&(this.preAdVolume_=r.volume(),r.volume(0)),r.addClass("vjs-ad-playing"),r.hasClass("vjs-live")&&r.removeClass("vjs-live"),E(r),r.ads.cancelPlayTimeout&&u.setTimeout(function(){u.clearTimeout(r.ads.cancelPlayTimeout),r.ads.cancelPlayTimeout=null},1)},leave:function(){r.removeClass("vjs-ad-playing"),r.ads.isLive(r)&&r.addClass("vjs-live"),r.ads.shouldPlayContentBehindAd(r)||a(r,this.snapshot),r.ads.shouldPlayContentBehindAd(r)&&r.volume(this.preAdVolume_)},events:{adend:function(){this.state="content-resuming",r.ads.adType=null},adserror:function(){r.ads.endLinearAdMode()}}},"content-resuming":{enter:function(){this._contentHasEnded&&(u.clearTimeout(r.ads._fireEndedTimeout),r.ads._fireEndedTimeout=u.setTimeout(function(){r.trigger("ended")},1e3))},leave:function(){u.clearTimeout(r.ads._fireEndedTimeout)},events:{contentupdate:function(){this.state="content-set"},contentresumed:function(){this.state="content-playback"},playing:function(){this.state="content-playback"},ended:function(){this.state="content-playback"}}},"postroll?":{enter:function(){r.ads._contentEnding=!0,this.snapshot=n(r),r.ads.nopostroll_?u.setTimeout(function(){r.ads.state="content-resuming",r.trigger("ended")},1):(r.addClass("vjs-ad-loading"),r.ads.adTimeoutTimeout=u.setTimeout(function(){r.trigger("adtimeout")},c.postrollTimeout))},leave:function(){u.clearTimeout(r.ads.adTimeoutTimeout),r.removeClass("vjs-ad-loading")},events:{adstart:function(){this.state="ad-playback",r.ads.adType="postroll"},adskip:function(){this.state="content-resuming",u.setTimeout(function(){r.trigger("ended")},1)},adtimeout:function(){this.state="content-resuming",u.setTimeout(function(){r.trigger("ended")},1)},adserror:function(){this.state="content-resuming",u.setTimeout(function(){r.trigger("ended")},1)},contentupdate:function(){this.state="ads-ready?"}}},"content-playback":{enter:function(){r.ads.cancelPlayTimeout&&(u.clearTimeout(r.ads.cancelPlayTimeout),r.ads.cancelPlayTimeout=null),r.trigger({type:"contentplayback",triggerevent:r.ads.triggerevent}),r.ads._cancelledPlay&&r.paused()&&r.play()},events:{adsready:function(){r.trigger("readyforpreroll")},adstart:function(){this.state="ad-playback","preroll"!==r.ads.adType&&(r.ads.adType="midroll")},contentupdate:function(){r.ads.shouldPlayContentBehindAd(r)||s(r),r.paused()?this.state="content-set":this.state="ads-ready?"},contentended:function(){this._contentHasEnded?this.state="content-resuming":(this._contentEnding=!1,this._contentHasEnded=!0,this.state="postroll?")}}}},p=function(t){var n=r.ads.state,a=f[n].events;if(a){var i=a[t.type];i&&i.apply(r.ads)}if(n!==r.ads.state){var s=n,o=r.ads.state;r.ads.triggerevent=t.type,f[s].leave&&f[s].leave.apply(r.ads),f[o].enter&&f[o].enter.apply(r.ads),c.debug&&e.log("ads",r.ads.triggerevent+" triggered: "+s+" -> "+o)}},m=function(){return!r.ads.shouldPlayContentBehindAd(r)&&r.ads.isAdPlaying()&&r.tech_.featuresNativeTextTracks&&e.browser.IS_IOS&&!Array.isArray(r.textTracks())},h=function(){var e=r.textTracks();if(m())for(var t=0;t<e.length;t++){var n=e[t];"showing"===n.mode&&(n.mode="disabled")}};r.textTracks().addEventListener("change",h),r.on(L.concat(["adtimeout","contentupdate","contentplaying","contentended","contentresumed","adstart","adend","adskip","adsready","adserror","adscanceled","nopreroll"]),p),r.on("dispose",function(){r.ads.adTimeoutTimeout&&u.clearTimeout(r.ads.adTimeoutTimeout),r.ads._fireEndedTimeout&&u.clearTimeout(r.ads._fireEndedTimeout),r.ads.cancelPlayTimeout&&u.clearTimeout(r.ads.cancelPlayTimeout),r.ads.tryToResumeTimeout_&&r.clearTimeout(r.ads.tryToResumeTimeout_),r.textTracks().removeEventListener("change",h)}),r.paused()||p({type:"play"})};return(e.registerPlugin||e.plugin)("ads",I),I});