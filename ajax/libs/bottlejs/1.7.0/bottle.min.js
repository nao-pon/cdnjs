(function(t){"use strict";var e=".",r="function",i="__global__",n="Provider",o=0,s=Array.prototype.slice,c=function(e,r){var i=e[r];if(i===t&&k.strict)throw new Error("Bottle was unable to resolve a service.  `"+r+"` is undefined.");return i},a=function(t){var e;return this.nested[t]||(e=O.pop(),this.nested[t]=e,this.factory(t,function(){return e.container})),this.nested[t]},l=function(t){return t.split(e).reduce(c,this)},u=function(t,e){Object.defineProperty(this,t,{configurable:!1,enumerable:!0,value:e,writable:!1})},d=function(t,n){var o,s;return typeof t===r&&(n=t,t=i),s=(o=t.split(e)).shift(),o.length?a.call(this,s).decorator(o.join(e),n):(this.decorators[s]||(this.decorators[s]=[]),this.decorators[s].push(n)),this},h=function(t,e){return g.call(this,t,function(){this.$get=e})},f=function(t){return!/^\$(?:decorator|register|list)$|Provider$/.test(t)},p=function(t){return Object.keys(t||this.container||{}).filter(f)},v={},b=function(t,e){return e(t)},g=function(t,r){var i,o;return i=t.split(e),this.providerMap[t]&&1===i.length&&!this.container[t+n]?console.error(t+" provider already instantiated."):(this.originalProviders[t]=r,this.providerMap[t]=!0,o=i.shift(),i.length?(a.call(this,o).provider(i.join(e),r),this):w.call(this,o,r))},y=function(t,e){return(t[e]||[]).concat(t.__global__||[])},w=function(e,r){var i,o,s,c,a;return this.id,s=this.container,c=this.decorators,a=this.middlewares,i=e+n,(o=Object.create(null))[i]={configurable:!0,enumerable:!0,get:function(){var t=new r;return delete s[i],s[i]=t,t}},o[e]={configurable:!0,enumerable:!0,get:function(){var r,n,o,l,u,d,h=s[i];return h&&(r=y(c,e).reduce(b,h.$get(s)),delete s[i],delete s[e]),r===t?r:(n=y(a,e),o=e,l=r,u=s,d={configurable:!0,enumerable:!0},n.length?d.get=function(){var t=0,e=function(r){if(r)throw r;n[t]&&n[t++](l,e)};return e(),l}:(d.value=l,d.writable=!0),Object.defineProperty(u,o,d),u[o])}},Object.defineProperties(s,o),this},m=function(e){var r=e.$value===t?e:e.$value;return this[e.$type||"service"].apply(this,[e.$name,r].concat(e.$inject||[]))},j=function(t){delete this.providerMap[t],delete this.container[t],delete this.container[t+n]},$=function(t,e,r){var i=arguments.length>3?s.call(arguments,3):[],n=this;return h.call(this,t,function(){var t=e,o=i.map(l,n.container);return r?new(e.bind.apply(e,[null].concat(o))):t.apply(null,o)})},P=function(t,e){var r=t[e];return r||(r={},_.call(t,e,r)),r},_=function(t,e){Object.defineProperty(this,t,{configurable:!0,enumerable:!0,value:e,writable:!0})},O=function t(e){if(!(this instanceof t))return t.pop(e);this.id=o++,this.decorators={},this.middlewares={},this.nested={},this.providerMap={},this.originalProviders={},this.deferred=[],this.container={$decorator:d.bind(this),$register:m.bind(this),$list:p.bind(this)}};O.prototype={constant:function(t,r){var i=t.split(e);return t=i.pop(),u.call(i.reduce(P,this.container),t,r),this},decorator:d,defer:function(t){return this.deferred.push(t),this},digest:function(t){return(t||[]).map(l,this.container)},factory:h,instanceFactory:function(t,e){return h.call(this,t,function(t){return{instance:e.bind(e,t)}})},list:p,middleware:function(t,n){var o,s;return typeof t===r&&(n=t,t=i),s=(o=t.split(e)).shift(),o.length?a.call(this,s).middleware(o.join(e),n):(this.middlewares[s]||(this.middlewares[s]=[]),this.middlewares[s].push(n)),this},provider:g,resetProviders:function(){var t=this.originalProviders;Object.keys(this.originalProviders).forEach(function(r){var i=r.split(e);i.length>1&&i.forEach(j,a.call(this,i[0])),j.call(this,r),this.provider(r,t[r])},this)},register:m,resolve:function(t){return this.deferred.forEach(function(e){e(t)}),this},service:function(t,e){return $.apply(this,[t,e,!0].concat(s.call(arguments,2)))},serviceFactory:function(t,e){return $.apply(this,[t,e,!1].concat(s.call(arguments,2)))},value:function(t,r){var i;return t=(i=t.split(e)).pop(),_.call(i.reduce(P,this.container),t,r),this}},O.pop=function(t){var e;return"string"==typeof t?((e=v[t])||(v[t]=e=new O,e.constant("BOTTLE_NAME",t)),e):new O},O.clear=function(t){"string"==typeof t?delete v[t]:v={}},O.list=p;var x,B,E,M,T,k=O.config={strict:!1},A={function:!0,object:!0};x=A[typeof window]&&window||this,B=A[typeof exports]&&exports&&!exports.nodeType&&exports,E=A[typeof module]&&module&&!module.nodeType&&module,M=E&&E.exports===B&&B,!(T=A[typeof global]&&global)||T.global!==T&&T.window!==T||(x=T),typeof define===r&&"object"==typeof define.amd&&define.amd?(x.Bottle=O,define(function(){return O})):B&&E?M?(E.exports=O).Bottle=O:B.Bottle=O:x.Bottle=O}).call(this);