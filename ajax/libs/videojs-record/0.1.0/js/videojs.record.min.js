!function(t,e){"use strict";e.Recorder=e.Component.extend({AUDIO_ONLY:"audio_only",VIDEO_ONLY:"video_only",AUDIO_VIDEO:"audio_video",init:function(t,i,r){switch(e.Component.call(this,t,i,r),this.recordAudio=this.options().options.audio,this.recordVideo=this.options().options.video,this.recordTimeMax=this.options().options.recordTimeMax,this._recording=!1,t.getBlob=this.getBlob,this.getUserMedia=(navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia).bind(navigator),this.getRecordType()){case this.AUDIO_ONLY:this.surfer=t.waveform,this.playhead=this.surfer.el().getElementsByTagName("wave")[1],this.playhead.style.display="none";break;default:this.player().bigPlayButton.hide(),this.player().options().controls&&(this.player().controlBar.progressControl.hide(),this.player().on("userinactive",function(t){this.player().userActive(!0)}),this.player().controlBar.show(),this.player().off("timeupdate"))}this.setDuration(this.recordTimeMax),this.player().controlBar.playToggle.hide()},isRecording:function(){return this._recording},getDevice:function(){switch(this.recordOptions={width:this.player().width(),height:this.player().height(),"buffer-size":4096,"sample-rate":44100},this.getRecordType()){case this.AUDIO_ONLY:this.surfer.microphone.on("deviceReady",this.onDeviceReady.bind(this)),this.surfer.microphone.on("deviceError",this.onDeviceError.bind(this)),this.player().play();break;case this.VIDEO_ONLY:this.getUserMedia({video:!0,audio:!1},this.onDeviceReady.bind(this),this.onDeviceError.bind(this));break;case this.AUDIO_VIDEO:this.getUserMedia({video:!0,audio:!0},this.onDeviceReady.bind(this),this.onDeviceError.bind(this))}},onDeviceReady:function(t){switch(this.stream=t,this.engine=new RecordRTC(this.stream,this.recordOptions),this.player().deviceButton.hide(),this.player().recordToggle.show(),this.player().controlBar.liveDisplay.hide(),this.player().controlBar.currentTimeDisplay.show(),this.player().controlBar.timeDivider.show(),this.player().controlBar.durationDisplay.show(),this.getRecordType()){case this.AUDIO_VIDEO:case this.VIDEO_ONLY:this.mediaElement=this.player().el().firstChild,this.mediaElement.muted=!0,this.mediaElement.controls=!1,this.load(URL.createObjectURL(this.stream)),this.mediaElement.play()}},onDeviceError:function(t){this.player().deviceErrorCode=t,this.player().trigger("deviceError")},start:function(){switch(this._recording=!0,this.player().controlBar.playToggle.hide(),this.getRecordType()){case this.AUDIO_ONLY:this.surfer.setupPlaybackEvents(!1),this.playhead.style.display="none",this.surfer.liveMode=!0,this.player().play();break;default:this.off("timeupdate"),this.off("play"),this.mediaElement.muted=!0,this.load(URL.createObjectURL(this.stream)),this.mediaElement.play()}this.startTime=this.stream.currentTime,this.countDown=this.setInterval(this.onCountDown.bind(this),100),this.engine.startRecording(),this.trigger("startRecord")},stop:function(){this._recording=!1,this.clearInterval(this.countDown),this.engine.stopRecording(this.onStopRecording.bind(this)),this.trigger("stopRecord")},onStopRecording:function(t){switch(this.player().controlBar.playToggle.show(),this.player().recordedData=this.engine.getBlob(),this.trigger("finishRecord"),this.getRecordType()){case this.AUDIO_ONLY:this.player().one("pause",function(){this.surfer.setupPlaybackEvents(!0),this.player().loadingSpinner.show(),this.playhead.style.display="block",this.load(this.player().recordedData)}.bind(this));break;default:this.player().one("pause",function(){this.player().loadingSpinner.hide(),this.setDuration(this.streamDuration),this.on(this.player(),"timeupdate",function(){this.setCurrentTime(this.player().currentTime(),this.streamDuration)}.bind(this)),this.on(this.player(),"play",function(){this.player().seeking()&&(this.load(t),this.player().play())}.bind(this)),this.getRecordType()===this.AUDIO_VIDEO&&(this.mediaElement.muted=!1),this.load(t)}.bind(this))}this.player().pause()},onCountDown:function(){var t=this.stream.currentTime-this.startTime,e=this.recordTimeMax;this.streamDuration=t,t>=e&&(t=e,this.stop()),this.setDuration(e),this.setCurrentTime(t,e)},setCurrentTime:function(t,e){switch(this.getRecordType()){case this.AUDIO_ONLY:this.surfer.setCurrentTime(t,e);break;default:var i=Math.min(t,e);this.player().controlBar.currentTimeDisplay.el().firstChild.innerHTML=this.formatTime(i,e)}},setDuration:function(t){switch(this.getRecordType()){case this.AUDIO_ONLY:this.surfer.setDuration(t);break;default:this.player().controlBar.durationDisplay.el().firstChild.innerHTML=this.formatTime(t,t)}},load:function(t){switch(this.getRecordType()){case this.AUDIO_ONLY:this.surfer.load(t);break;default:this.mediaElement.src=t}},getRecordType:function(){return this.recordAudio&&!this.recordVideo?this.AUDIO_ONLY:this.recordAudio&&this.recordVideo?this.AUDIO_VIDEO:!this.recordAudio&&this.recordVideo?this.VIDEO_ONLY:void 0},formatTime:function(t,e){e=e||t;var i=Math.floor(t%60),r=Math.floor(t/60%60),s=Math.floor(t/3600),o=Math.floor(e/60%60),n=Math.floor(e/3600),a=Math.floor(1e3*(t-i));return(isNaN(t)||t===1/0)&&(s=r=i=a="-"),e>0&&e<this.msDisplayMax?(a<100&&(a=a<10?"00"+a:"0"+a),a=":"+a):a="",s=s>0||n>0?s+":":"",r=((s||o>=10)&&r<10?"0"+r:r)+":",i=i<10?"0"+i:i,s+r+i+a}});var i,r;(i=e.Button.extend({init:function(t,i){e.Button.call(this,t,i),this.on("click",this.onClick),this.on(t,"startRecord",this.onStart),this.on(t,"stopRecord",this.onStop)}})).prototype.onClick=function(t){t.stopImmediatePropagation();var e=this.player().recorder;e.isRecording()?e.stop():e.start()},i.prototype.onStart=function(){this.removeClass("vjs-record-stop"),this.addClass("vjs-record-start"),this.el().firstChild.firstChild.innerHTML=this.localize("Stop")},i.prototype.onStop=function(){this.removeClass("vjs-record-start"),this.addClass("vjs-record-stop"),this.el().firstChild.firstChild.innerHTML=this.localize("Record")},(r=e.Button.extend({init:function(t,i){e.Button.call(this,t,i),this.on("click",this.onClick)}})).prototype.onClick=function(t){t.stopImmediatePropagation(),this.player().recorder.getDevice()};var s=function(t,i){var r={className:"vjs-"+t+"-button vjs-control",innerHTML:'<div class="vjs-control-content"><span class="vjs-control-text">'+i+"</span></div>",role:"button","aria-live":"polite",tabIndex:0};return e.Component.prototype.createEl(null,r)},o=function(){var t={className:"vjs-record",tabIndex:0};return e.Component.prototype.createEl(null,t)},n={audio:!1,video:!0,recordTimeMax:10};e.plugin("record",function(t){var a=e.util.mergeOptions(n,t),h=this;h.recorder=new e.Recorder(h,{el:o(),options:a}),h.el().appendChild(h.recorder.el()),h.deviceButton=new r(h,{el:s("device",h.localize("Device"))}),h.recorder.el().appendChild(h.deviceButton.el()),h.recordToggle=new i(h,{el:s("record",h.localize("Record"))}),h.recordToggle.hide(),h.controlBar.el().insertBefore(h.recordToggle.el(),h.controlBar.el().firstChild)})}(window,window.videojs);