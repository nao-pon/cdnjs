!function(i,t){"use strict";t.Recorder=t.Component.extend({IMAGE_ONLY:"image_only",AUDIO_ONLY:"audio_only",VIDEO_ONLY:"video_only",AUDIO_VIDEO:"audio_video",ANIMATION:"animation",init:function(i,e,s){switch(t.Component.call(this,i,e,s),this.recordImage=this.options().options.image,this.recordAudio=this.options().options.audio,this.recordVideo=this.options().options.video,this.recordAnimation=this.options().options.animation,this.maxLength=this.options().options.maxLength,this.debug=this.options().options.debug,this.audioBufferSize=this.options().options.audioBufferSize,this.audioSampleRate=this.options().options.audioSampleRate,this.animationFrameRate=this.options().options.animationFrameRate,this.animationQuality=this.options().options.animationQuality,this._recording=!1,this._processing=!1,i.getBlob=this.getBlob,this.getUserMedia=(navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia).bind(navigator),this.getRecordType()){case this.AUDIO_ONLY:this.surfer=i.waveform,this.playhead=this.surfer.el().getElementsByTagName("wave")[1],this.playhead.style.display="none";break;case this.IMAGE_ONLY:case this.VIDEO_ONLY:case this.AUDIO_VIDEO:case this.ANIMATION:this.player().bigPlayButton.hide(),this.player().options().controls&&(this.player().controlBar.progressControl.hide(),this.player().on("userinactive",function(i){this.player().userActive(!0)}),this.player().controlBar.show(),this.player().controlBar.el().style.display="block",this.player().off("timeupdate"))}this.setDuration(this.maxLength),this.player().controlBar.playToggle.hide()},isRecording:function(){return this._recording},isProcessing:function(){return this._processing},getDevice:function(){switch(this.getRecordType()){case this.AUDIO_ONLY:this.mediaType={audio:!0,video:!1},this.surfer.microphone.on("deviceReady",this.onDeviceReady.bind(this)),this.surfer.microphone.on("deviceError",this.onDeviceError.bind(this)),this.player().play();break;case this.IMAGE_ONLY:case this.VIDEO_ONLY:this.mediaType={audio:!1,video:!0},this.getUserMedia(this.mediaType,this.onDeviceReady.bind(this),this.onDeviceError.bind(this));break;case this.AUDIO_VIDEO:this.mediaType={audio:!0,video:!0},this.getUserMedia(this.mediaType,this.onDeviceReady.bind(this),this.onDeviceError.bind(this));break;case this.ANIMATION:this.mediaType={audio:!1,video:!1,gif:!0},this.getUserMedia({audio:!1,video:!0},this.onDeviceReady.bind(this),this.onDeviceError.bind(this))}},onDeviceReady:function(i){if(this.stream=i,this.player().trigger("deviceReady"),this.player().deviceButton.hide(),this.player().controlBar.liveDisplay.hide(),this.getRecordType()!==this.IMAGE_ONLY){this.engine=new MRecordRTC,this.engine.mediaType=this.mediaType,this.engine.disableLogs=!this.debug,this.engine.bufferSize=this.audioBufferSize,this.engine.sampleRate=this.audioSampleRate,this.engine.quality=this.animationQuality,this.engine.frameRate=this.animationFrameRate,this.engine.addStream(this.stream);var t,e=[this.player().controlBar.currentTimeDisplay,this.player().controlBar.timeDivider,this.player().controlBar.durationDisplay];for(t in e)e[t].el().style.display="block",e[t].show();this.player().recordToggle.show()}else this.player().recordIndicator.disable(),this.player().cameraButton.show();this.getRecordType()!==this.AUDIO_ONLY&&(this.mediaElement=this.player().el().firstChild,this.mediaElement.muted=!0,this.mediaElement.controls=!1,this.load(URL.createObjectURL(this.stream)),this.mediaElement.play())},onDeviceError:function(i){this.player().deviceErrorCode=i,this.player().trigger("deviceError")},start:function(){if(!this.isProcessing()){switch(this._recording=!0,this.player().controlBar.playToggle.hide(),this.getRecordType()){case this.AUDIO_ONLY:this.surfer.setupPlaybackEvents(!1),this.playhead.style.display="none",this.surfer.liveMode=!0,this.player().play();break;case this.VIDEO_ONLY:case this.AUDIO_VIDEO:this.startVideoPreview();break;case this.ANIMATION:this.player().recordCanvas.hide(),this.player().animationDisplay.hide(),this.mediaElement.style.display="block",this.captureFrame(),this.startVideoPreview()}this.getRecordType()!==this.IMAGE_ONLY?(this.startTime=(new Date).getTime(),this.countDown=this.setInterval(this.onCountDown.bind(this),100),this.engine.startRecording()):this.createSnapshot(),this.trigger("startRecord")}},stop:function(){this.isProcessing()||(this._recording=!1,this._processing=!0,this.trigger("stopRecord"),this.getRecordType()!==this.IMAGE_ONLY?(this.clearInterval(this.countDown),this.engine.stopRecording(this.onStopRecording.bind(this))):this.trigger("finishRecord"))},onStopRecording:function(i,t){this.mediaURL=i,this.engine.getBlob(function(i){switch(this.getRecordType()){case this.AUDIO_ONLY:this.player().controlBar.playToggle.show(),this.player().recordedData=i.audio,this.trigger("finishRecord"),this.player().one("pause",function(){this.surfer.setupPlaybackEvents(!0),this.player().loadingSpinner.show(),this.playhead.style.display="block",this.surfer.surfer.once("ready",function(){this._processing=!1}.bind(this)),this.load(this.player().recordedData)}.bind(this)),this.player().pause();break;case this.VIDEO_ONLY:case this.AUDIO_VIDEO:void 0!==i.video&&(this.player().controlBar.playToggle.show(),this.player().recordedData=i.video,this.getRecordType()===this.AUDIO_VIDEO&&isChrome&&(this.player().recordedData=i),this.trigger("finishRecord"),this.off(this.player(),"pause",this.onPlayerPause),this.off(this.player(),"play",this.onPlayerStart),this.player().one("pause",function(){this._processing=!1,this.player().loadingSpinner.hide(),this.setDuration(this.streamDuration),this.on(this.player(),"timeupdate",function(){this.setCurrentTime(this.player().currentTime(),this.streamDuration)}.bind(this)),this.getRecordType()===this.AUDIO_VIDEO&&isChrome&&(void 0===this.extraAudio&&(this.extraAudio=this.player().createEl("audio"),this.extraAudio.id="extraAudio"),this.extraAudio.src=URL.createObjectURL(this.player().recordedData.audio),this.on(this.player(),"pause",this.onPlayerPause)),this.on(this.player(),"play",this.onPlayerStart),this.getRecordType()===this.AUDIO_VIDEO&&(this.mediaElement.muted=!1),this.load(this.mediaURL)}.bind(this)),this.player().pause());break;case this.ANIMATION:this.player().controlBar.playToggle.show(),this.player().recordedData=i.gif,this.trigger("finishRecord"),this._processing=!1,this.player().loadingSpinner.hide(),this.setDuration(this.streamDuration),this.mediaElement.style.display="none",this.player().recordCanvas.show(),this.player().pause(),this.on(this.player(),"play",this.showAnimation),this.on(this.player(),"pause",this.hideAnimation)}}.bind(this))},onCountDown:function(){var i=((new Date).getTime()-this.startTime)/1e3,t=this.maxLength;this.streamDuration=i,i>=t&&(i=t,this.stop()),this.setDuration(t),this.setCurrentTime(i,t)},setCurrentTime:function(i,t){switch(this.getRecordType()){case this.AUDIO_ONLY:this.surfer.setCurrentTime(i,t);break;case this.VIDEO_ONLY:case this.AUDIO_VIDEO:case this.ANIMATION:var e=Math.min(i,t);this.player().controlBar.currentTimeDisplay.el().firstChild.innerHTML=this.formatTime(e,t)}},setDuration:function(i){switch(this.getRecordType()){case this.AUDIO_ONLY:this.surfer.setDuration(i);break;case this.VIDEO_ONLY:case this.AUDIO_VIDEO:case this.ANIMATION:this.player().controlBar.durationDisplay.el().firstChild.innerHTML=this.formatTime(i,i)}},load:function(i){switch(this.getRecordType()){case this.AUDIO_ONLY:this.surfer.load(i);break;case this.IMAGE_ONLY:case this.VIDEO_ONLY:case this.AUDIO_VIDEO:case this.ANIMATION:this.mediaElement.src=i}},destroy:function(){switch(this._recording=!1,this._processing=!1,this.clearInterval(this.countDown),this.getRecordType()){case this.AUDIO_ONLY:this.surfer.destroy();break;case this.IMAGE_ONLY:case this.VIDEO_ONLY:case this.AUDIO_VIDEO:case this.ANIMATION:this.player().dispose()}},getRecordType:function(){return this.recordImage?this.IMAGE_ONLY:this.recordAnimation?this.ANIMATION:this.recordAudio&&!this.recordVideo?this.AUDIO_ONLY:this.recordAudio&&this.recordVideo?this.AUDIO_VIDEO:!this.recordAudio&&this.recordVideo?this.VIDEO_ONLY:void 0},createSnapshot:function(){var i=this.captureFrame();this.player().recordedData=i.toDataURL("image/png"),this.mediaElement.style.display="none",this.player().recordCanvas.show(),this.stop()},captureFrame:function(){var i=this.player().recordCanvas.el().firstChild;return i.width=this.player().width(),i.height=this.player().height(),i.getContext("2d").drawImage(this.mediaElement,0,0,i.width,i.height),i},startVideoPreview:function(){this.off("timeupdate"),this.off("play"),this.mediaElement.muted=!0,this.load(URL.createObjectURL(this.stream)),this.mediaElement.play()},showAnimation:function(){var i=this.player().animationDisplay.el().firstChild;i.width=this.player().width(),i.height=this.player().height(),this.player().recordCanvas.hide(),i.src=this.mediaURL,this.player().animationDisplay.show()},hideAnimation:function(){this.player().recordCanvas.show(),this.player().animationDisplay.hide()},onPlayerStart:function(){this.player().seeking()&&(this.load(this.mediaURL),this.player().play()),this.getRecordType()===this.AUDIO_VIDEO&&isChrome&&!this._recording&&(this.extraAudio.currentTime=this.player().currentTime(),this.extraAudio.play())},onPlayerPause:function(){this.extraAudio.pause()},formatTime:function(i,t){t=t||i;var e=Math.floor(i%60),s=Math.floor(i/60%60),r=Math.floor(i/3600),o=Math.floor(t/60%60),a=Math.floor(t/3600),n=Math.floor(1e3*(i-e));return(isNaN(i)||i===1/0)&&(r=s=e=n="-"),t>0&&t<this.msDisplayMax?(n<100&&(n=n<10?"00"+n:"0"+n),n=":"+n):n="",r=r>0||a>0?r+":":"",s=((r||o>=10)&&s<10?"0"+s:s)+":",e=e<10?"0"+e:e,r+s+e+n}});var e,s,r,o,a,n;(e=t.Button.extend({init:function(i,e){t.Button.call(this,i,e),this.on("click",this.onClick),this.on(i,"startRecord",this.onStart),this.on(i,"stopRecord",this.onStop)}})).prototype.onClick=function(i){i.stopImmediatePropagation();var t=this.player().recorder;t.isRecording()?t.stop():t.start()},e.prototype.onStart=function(){this.removeClass("vjs-record-stop"),this.addClass("vjs-record-start"),this.el().firstChild.firstChild.innerHTML=this.localize("Stop")},e.prototype.onStop=function(){this.removeClass("vjs-record-start"),this.addClass("vjs-record-stop"),this.el().firstChild.firstChild.innerHTML=this.localize("Record")},(s=t.Button.extend({init:function(i,e){t.Button.call(this,i,e),this.on("click",this.onClick),this.on(i,"startRecord",this.onStart),this.on(i,"stopRecord",this.onStop)}})).prototype.onClick=function(i){i.stopImmediatePropagation();var t=this.player().recorder;t.isProcessing()?(t._processing=!1,this.player().recordCanvas.hide(),this.player().el().firstChild.style.display="block",this.onStop()):t.start()},s.prototype.onStart=function(){this.removeClass("vjs-record-stop"),this.addClass("vjs-record-start"),this.el().firstChild.firstChild.innerHTML=this.localize("Retry")},s.prototype.onStop=function(){this.removeClass("vjs-record-start"),this.addClass("vjs-record-stop"),this.el().firstChild.firstChild.innerHTML=this.localize("Image")},(r=t.Button.extend({init:function(i,e){t.Button.call(this,i,e),this.on("click",this.onClick)}})).prototype.onClick=function(i){i.stopImmediatePropagation(),this.player().recorder.getDevice()},(o=t.Component.extend({init:function(i,e){t.Component.call(this,i,e),this.on(i,"startRecord",this.show),this.on(i,"stopRecord",this.hide)}})).prototype.disable=function(){this.off(this.player(),"startRecord",this.show),this.off(this.player(),"stopRecord",this.hide)},a=t.Component.extend(),n=t.Component.extend();var h=function(i,e){var s={className:"vjs-"+i+"-button vjs-control",innerHTML:'<div class="vjs-control-content"><span class="vjs-control-text">'+e+"</span></div>",role:"button","aria-live":"polite",tabIndex:0};return t.Component.prototype.createEl(null,s)},d=function(){var i={className:"vjs-record",tabIndex:0};return t.Component.prototype.createEl(null,i)},l={image:!1,audio:!1,video:!1,animation:!1,maxLength:10,audioBufferSize:4096,audioSampleRate:22050,animationFrameRate:200,animationQuality:10,debug:!1};t.plugin("record",function(i){var c=t.util.mergeOptions(l,i),p=this;p.recorder=new t.Recorder(p,{el:d(),options:c}),p.el().appendChild(p.recorder.el()),p.deviceButton=new r(p,{el:h("device",p.localize("Device"))}),p.recorder.el().appendChild(p.deviceButton.el()),p.recordIndicator=new o(p,{el:t.Component.prototype.createEl(null,{className:"vjs-record-indicator vjs-control"})}),p.recordIndicator.hide(),p.recorder.el().appendChild(p.recordIndicator.el()),p.recordCanvas=new a(p,{el:t.Component.prototype.createEl(null,{className:"vjs-record-canvas",innerHTML:"<canvas></canvas>"})}),p.recordCanvas.hide(),p.recorder.el().appendChild(p.recordCanvas.el()),p.animationDisplay=new n(p,{el:t.Component.prototype.createEl(null,{className:"vjs-animation-display",innerHTML:"<img />"})}),p.animationDisplay.hide(),p.recorder.el().appendChild(p.animationDisplay.el()),p.cameraButton=new s(p,{el:h("camera",p.localize("Image"))}),p.cameraButton.hide(),p.controlBar.el().insertBefore(p.cameraButton.el(),p.controlBar.el().firstChild),p.recordToggle=new e(p,{el:h("record",p.localize("Record"))}),p.recordToggle.hide(),p.controlBar.el().insertBefore(p.recordToggle.el(),p.controlBar.el().firstChild)})}(window,window.videojs);