!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("inferno"),require("stream")):"function"==typeof define&&define.amd?define(["exports","inferno","stream"],t):t((e.Inferno=e.Inferno||{},e.Inferno.Server=e.Inferno.Server||{}),e.Inferno,e.stream)}(this,function(e,t,r){"use strict";var n="a runtime error occured! Use Inferno in development environment to find the error.";function o(e){return d(e)||c(e)}function s(e){return c(e)||!1===e||l(e)||d(e)}function i(e){return"function"==typeof e}function u(e){return"string"==typeof e}function a(e){return"number"==typeof e}function c(e){return null===e}function l(e){return!0===e}function d(e){return void 0===e}function h(e){throw e||(e=n),new Error("Inferno Error: "+e)}function p(e,t){var r={};if(e)for(var n in e)r[n]=e[n];if(t)for(var o in t)r[o]=t[o];return r}"undefined"==typeof window||window.document;var f=new RegExp(/["'&<>]/);function v(e){if(!f.test(e))return e;var t,r="",n="",o=0;for(t=0;t<e.length;t++){switch(e.charCodeAt(t)){case 34:n="&quot;";break;case 39:n="&#039;";break;case 38:n="&amp;";break;case 60:n="&lt;";break;case 62:n="&gt;";break;default:continue}t>o&&(r+=e.slice(o,t)),r+=n,o=t+1}return r+e.slice(o,t)}var m=/[A-Z]/g,y={};function x(e){return void 0!==y[e]?y[e]:y[e]=e.replace(m,"-$&").toLowerCase()+":"}var g=new Set(["area","base","br","col","command","embed","hr","img","input","keygen","link","meta","param","source","track","wbr"]);function S(e){if(u(e))return e;var r="";for(var n in e){var o=e[n];u(o)?r+=""+x(n)+o+";":a(o)&&(r+=""+x(n)+t.getNumberStyleValue(n,o)+";")}return r}function T(e){return function e(r,n,d,f){var m=r.flags,y=r.type,x=r.props||t.EMPTY_OBJ,T=r.children;if((14&m)>0){if(4&m){var b,k=new y(x,d);if(k.$BS=!1,i(k.getChildContext)&&(b=k.getChildContext()),b=o(b)?d:p(d,b),k.props===t.EMPTY_OBJ&&(k.props=x),k.context=d,k.$UN=!1,i(k.componentWillMount)&&(k.$BR=!0,k.componentWillMount(),k.$BR=!1),k.$PSS){var Q=k.state,P=k.$PS;if(null===Q)k.state=P;else for(var $ in P)Q[$]=P[$];k.$PSS=!1,k.$PS=null}var N=k.render(x,k.state,k.context);return s(N)?"\x3c!--!--\x3e":u(N)?v(N):a(N)?N+"":e(N,r,b,!0)}var _=y(x,d);return s(_)?"\x3c!--!--\x3e":u(_)?v(_):a(_)?_+"":e(_,r,d,!0)}if((481&m)>0){var C,w="<"+y,M=g.has(y),I=r.className;if(u(I)?w+=' class="'+v(I)+'"':a(I)&&(w+=' class="'+I+'"'),!c(x)){for(var B in x){var R=x[B];switch(B){case"dangerouslySetInnerHTML":C=R.__html;break;case"style":o(x.style)||(w+=' style="'+S(x.style)+'"');break;case"children":case"className":break;case"defaultValue":x.value||(w+=' value="'+(u(R)?v(R):R)+'"');break;case"defaultChecked":x.checked||(w+=' checked="'+R+'"');break;default:u(R)?w+=" "+B+'="'+v(R)+'"':a(R)?w+=" "+B+'="'+R+'"':l(R)&&(w+=" "+B)}}"option"===y&&void 0!==x.value&&x.value===n.props.value&&(w+=" selected")}if(M)w+=">";else{w+=">";var V=r.childFlags;if(2&V)w+=e(T,r,d,!0);else if(12&V)for(var E=0,O=T.length;E<O;E++)w+=e(T[E],r,d,0===E);else C&&(w+=C);M||(w+="</"+y+">")}return w}if((16&m)>0)return(f?"":"\x3c!----\x3e")+(""===T?" ":v(T));h()}(e,{},{},!0)}var b=function(e){function r(t){e.call(this),this.collector=[Infinity],this.promises=[],this.pushQueue=this.pushQueue.bind(this),t&&this.renderVNodeToQueue(t,null,!1,null)}return e&&(r.__proto__=e),r.prototype=Object.create(e&&e.prototype),r.prototype.constructor=r,r.prototype._read=function(){setTimeout(this.pushQueue,0)},r.prototype.addToQueue=function(e,t){if(o(t))"string"==typeof e&&this.collector.length-1==0?this.push(e):"string"==typeof e&&"string"==typeof this.collector[this.collector.length-2]?this.collector[this.collector.length-2]+=e:this.collector.splice(-1,0,e);else{var r=this.promises[t].length-1;"string"==typeof this.promises[t][r]&&"string"==typeof e?this.promises[t][r]+=e:this.promises[t].push(e)}},r.prototype.pushQueue=function(){var e=this.collector[0];if("string"==typeof e)this.push(e),this.collector.shift();else if(e&&("object"==typeof e||i(e))&&i(e.then)){var t=this;e.then(function(e){var r;(r=t.collector).splice.apply(r,[0,1].concat(t.promises[e])),t.promises[e]=null,setTimeout(t.pushQueue,0)}),this.collector[0]=null}else Infinity===e&&this.emit("end")},r.prototype.renderVNodeToQueue=function(e,r,n,f){var m=this,y=e.flags,x=e.type,T=e.props||t.EMPTY_OBJ,b=e.children;if((14&y)>0)if(4&y){var k,Q=new x(T,r);if(Q.$BS=!1,d(Q.getChildContext)||(k=Q.getChildContext()),o(k)||(r=p(r,k)),Q.props===t.EMPTY_OBJ&&(Q.props=T),Q.context=r,Q.$UN=!1,i(Q.componentWillMount)){if(Q.$BR=!0,Q.componentWillMount(),Q.$PSS){var P=Q.state,$=Q.$PS;if(null===P)Q.state=$;else for(var N in $)P[N]=$[N];Q.$PSS=!1,Q.$PS=null}Q.$BR=!1}if(i(Q.getInitialProps)){var _=Q.getInitialProps(Q.props,Q.context);if(_){if(Promise.resolve(_)===_){var C=this.promises.push([])-1;return void this.addToQueue(_.then(function(e){Q.$PSS=!1,"object"==typeof e&&(Q.props=p(Q.props,e));var t=Q.render(Q.props,Q.state,Q.context);return s(t)?m.addToQueue("\x3c!--!--\x3e",C):u(t)?m.addToQueue(v(t),C):a(t)?m.addToQueue(t+"",C):m.renderVNodeToQueue(t,Q.context,!0,C),setTimeout(m.pushQueue,0),C}),f)}Q.props=p(Q.props,_)}}var w=Q.render(Q.props,Q.state,Q.context);Q.$PSS=!1,s(w)?this.addToQueue("\x3c!--!--\x3e",f):u(w)?this.addToQueue(v(w),f):a(w)?this.addToQueue(w+"",f):this.renderVNodeToQueue(w,r,!0,f)}else{var M=x(T,r);s(M)?this.addToQueue("\x3c!--!--\x3e",f):u(M)?this.addToQueue(v(M),f):a(M)?this.addToQueue(M+"",f):this.renderVNodeToQueue(M,r,!0,f)}else if((481&y)>0){var I,B="<"+x,R=g.has(x),V=e.className;if(u(V)?B+=' class="'+v(V)+'"':a(V)&&(B+=' class="'+V+'"'),!c(T))for(var E in T){var O=T[E];switch(E){case"dangerouslySetInnerHTML":I=O.__html;break;case"style":o(T.style)||(B+=' style="'+S(T.style)+'"');break;case"children":case"className":break;case"defaultValue":T.value||(B+=' value="'+(u(O)?v(O):O)+'"');break;case"defaultChecked":T.checked||(B+=' checked="'+O+'"');break;default:u(O)?B+=" "+E+'="'+v(O)+'"':a(O)?B+=" "+E+'="'+O+'"':l(O)&&(B+=" "+E)}}if(R)this.addToQueue(B+">",f);else{B+=">";var j=e.childFlags;if(2&j)return this.addToQueue(B,f),this.renderVNodeToQueue(b,r,!0,f),void this.addToQueue("</"+x+">",f);if(12&j){this.addToQueue(B,f),B="";for(var A=0,W=b.length;A<W;A++)m.renderVNodeToQueue(b[A],r,0===A,f)}if(I)return void this.addToQueue(B+I+"</"+x+">",f);R||this.addToQueue(B+"</"+x+">",f)}}else(16&y)>0?this.addToQueue((n?"":"\x3c!----\x3e")+(""===b?" ":v(b)),f):h()},r}(r.Readable);function k(e){return new b(e)}var Q=Promise.resolve(),P=function(e){function t(t){e.call(this),this.started=!1,this.initNode=t}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype._read=function(){var e=this;this.started||(this.started=!0,Q.then(function(){return e.renderNode(e.initNode,null,!1)}).then(function(){e.push(null)}).catch(function(t){e.emit("error",t)}))},t.prototype.renderNode=function(e,t,r){var n=e.flags;return(14&n)>0?this.renderComponent(e,t,4&n):(481&n)>0?this.renderElement(e,t):this.renderText(e,r)},t.prototype.renderComponent=function(e,t,r){var n=this,c=e.type,l=e.props;if(!r){var d=c(l,t);return s(d)?this.push("\x3c!--!--\x3e"):u(d)?this.push(v(d)):a(d)?this.push(d+""):this.renderNode(d,t,!1)}var h,f=new c(l,t);return f.$BS=!1,i(f.getChildContext)&&(h=f.getChildContext()),o(h)||(t=p(t,h)),f.context=t,f.$BR=!0,Promise.resolve(f.componentWillMount&&f.componentWillMount()).then(function(){if(f.$PSS){var e=f.state,r=f.$PS;if(null===e)f.state=r;else for(var o in r)e[o]=r[o];f.$PSS=!1,f.$PS=null}f.$BR=!1;var i=f.render(f.props,f.state,f.context);return f.$PSS=!1,s(i)?n.push("\x3c!--!--\x3e"):u(i)?n.push(v(i)):a(i)?n.push(i+""):n.renderNode(i,t,!1)})},t.prototype.renderChildren=function(e,t,r){var n=this;return 2&r?this.renderNode(e,t,!1):12&r?e.reduce(function(e,r){return e.then(function(e){return(16&r.flags)>0&&e&&n.push("\x3c!----\x3e"),Promise.resolve(n.renderNode(r,t,!1)).then(function(){return!!(16&r.flags)})})},Promise.resolve(!1)):void 0},t.prototype.renderText=function(e,t){this.push((t?"\x3c!----\x3e":"")+(""===e.children?" ":v(e.children)))},t.prototype.renderElement=function(e,t){var r,n=this,s=e.type,i=e.props,d="<"+s,h=g.has(s),p=e.className;if(u(p)?d+=' class="'+v(p)+'"':a(p)&&(d+=' class="'+p+'"'),!c(i))for(var f in i){var m=i[f];switch(f){case"dangerouslySetInnerHTML":r=m.__html;break;case"style":o(i.style)||(d+=' style="'+S(i.style)+'"');break;case"children":case"className":break;case"defaultValue":i.value||(d+=' value="'+(u(m)?v(m):m)+'"');break;case"defaultChecked":i.checked||(d+=' checked="'+m+'"');break;default:u(m)?d+=" "+f+'="'+v(m)+'"':a(m)?d+=" "+f+'="'+m+'"':l(m)&&(d+=" "+f)}}if(h)return d+=">",void this.push(d);if(d+=">",this.push(d),r)return this.push(r),void this.push("</"+s+">");var y=e.childFlags;if(!(1&y))return Promise.resolve(this.renderChildren(e.children,t,y)).then(function(){n.push("</"+s+">")});this.push("</"+s+">")},t}(r.Readable);function $(e){return new P(e)}e.RenderQueueStream=b,e.RenderStream=P,e.renderToStaticMarkup=T,e.renderToString=T,e.streamAsStaticMarkup=$,e.streamAsString=$,e.streamQueueAsStaticMarkup=k,e.streamQueueAsString=k,Object.defineProperty(e,"__esModule",{value:!0})});
