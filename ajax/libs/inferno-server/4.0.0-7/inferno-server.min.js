!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("inferno"),require("stream")):"function"==typeof define&&define.amd?define(["exports","inferno","stream"],t):t((e.Inferno=e.Inferno||{},e.Inferno.Server=e.Inferno.Server||{}),e.Inferno,e.stream)}(this,function(e,t,r){"use strict";var n="a runtime error occured! Use Inferno in development environment to find the error.";"undefined"==typeof window||window.document;function o(e){return d(e)||l(e)}function i(e){return l(e)||!1===e||c(e)||d(e)}function s(e){return"function"==typeof e}function u(e){return"string"==typeof e}function a(e){return"number"==typeof e}function l(e){return null===e}function c(e){return!0===e}function d(e){return void 0===e}function h(e){throw e||(e=n),new Error("Inferno Error: "+e)}function p(e,t){var r={};if(e)for(var n in e)r[n]=e[n];if(t)for(var o in t)r[o]=t[o];return r}var f=/["'&<>]/;function v(e){if(!f.test(e))return e;var t,r="",n="",o=0;for(t=0;t<e.length;t++){switch(e.charCodeAt(t)){case 34:n="&quot;";break;case 39:n="&#039;";break;case 38:n="&amp;";break;case 60:n="&lt;";break;case 62:n="&gt;";break;default:continue}t>o&&(r+=e.slice(o,t)),r+=n,o=t+1}return r+e.slice(o,t)}var m=/[A-Z]/g,y={};function x(e){return void 0!==y[e]?y[e]:y[e]=e.replace(m,"-$&").toLowerCase()+":"}var S=new Set(["area","base","br","col","command","embed","hr","img","input","keygen","link","meta","param","source","track","wbr"]);function g(e){if(u(e))return e;var r="";for(var n in e){var o=e[n];u(o)?r+=""+x(n)+o+";":a(o)&&(r+=""+x(n)+o+(t.isUnitlessNumber.has(n)?"":"px")+";")}return r}function T(e){return function e(r,n,d,f){var m=r.flags,y=r.type,x=r.props||t.EMPTY_OBJ,T=r.children;if((14&m)>0){if(4&m){var Q=new y(x,d);Q.$BS=!1;var P;if(s(Q.getChildContext)&&(P=Q.getChildContext()),P=o(P)?d:p(d,P),Q.props===t.EMPTY_OBJ&&(Q.props=x),Q.context=d,Q.$UN=!1,s(Q.componentWillMount)&&(Q.$BR=!0,Q.componentWillMount(),Q.$BR=!1),Q.$PSS){var $=Q.state,_=Q.$PS;if(null===$)Q.state=_;else for(var C in _)$[C]=_[C];Q.$PSS=!1,Q.$PS=null}var N=Q.render(x,Q.state,Q.context);return i(N)?"\x3c!--!--\x3e":u(N)?v(N):a(N)?N+"":e(N,r,P,!0)}var b=y(x,d);return i(b)?"\x3c!--!--\x3e":u(b)?v(b):a(b)?b+"":e(b,r,d,!0)}if((481&m)>0){var k,M="<"+y,w=S.has(y),B=r.className;if(u(B)?M+=' class="'+v(B)+'"':a(B)&&(M+=' class="'+B+'"'),!l(x)){for(var I in x){var R=x[I];"dangerouslySetInnerHTML"===I?k=R.__html:"style"!==I||o(x.style)?"children"===I||("defaultValue"===I?x.value||(M+=' value="'+(u(R)?v(R):R)+'"'):"defaultChecked"===I?x.checked||(M+=' checked="'+R+'"'):u(R)?M+=" "+I+'="'+v(R)+'"':a(R)?M+=" "+I+'="'+R+'"':c(R)&&(M+=" "+I)):M+=' style="'+g(x.style)+'"'}"option"===y&&void 0!==x.value&&x.value===n.props.value&&(M+=" selected")}if(w)M+=">";else{M+=">";var V=r.childFlags;if(2&V)M+=e(T,r,d,!0);else if(12&V)for(var E=0,O=T.length;E<O;E++)M+=e(T[E],r,d,0===E);else k&&(M+=k);w||(M+="</"+y+">")}return M}if((16&m)>0)return(f?"":"\x3c!----\x3e")+(""===T?" ":v(T));h()}(e,{},{},!0)}var Q=function(e){function r(t){e.call(this),this.collector=[1/0],this.promises=[],this.pushQueue=this.pushQueue.bind(this),t&&this.renderVNodeToQueue(t,null,!1,null)}return e&&(r.__proto__=e),r.prototype=Object.create(e&&e.prototype),r.prototype.constructor=r,r.prototype._read=function(){setTimeout(this.pushQueue,0)},r.prototype.addToQueue=function(e,t){if(o(t))"string"==typeof e&&this.collector.length-1==0?this.push(e):"string"==typeof e&&"string"==typeof this.collector[this.collector.length-2]?this.collector[this.collector.length-2]+=e:this.collector.splice(-1,0,e);else{var r=this.promises[t].length-1;"string"==typeof this.promises[t][r]&&"string"==typeof e?this.promises[t][r]+=e:this.promises[t].push(e)}},r.prototype.pushQueue=function(){var e=this.collector[0];if("string"==typeof e)this.push(e),this.collector.shift();else if(e&&("object"==typeof e||s(e))&&s(e.then)){var t=this;e.then(function(e){(r=t.collector).splice.apply(r,[0,1].concat(t.promises[e])),t.promises[e]=null,setTimeout(t.pushQueue,0);var r}),this.collector[0]=null}else e===1/0&&this.emit("end")},r.prototype.renderVNodeToQueue=function(e,r,n,f){var m=this,y=e.flags,x=e.type,T=e.props||t.EMPTY_OBJ,Q=e.children;if((14&y)>0){if(4&y){var P=new x(T,r);P.$BS=!1;var $;if(d(P.getChildContext)||($=P.getChildContext()),o($)||(r=p(r,$)),P.props===t.EMPTY_OBJ&&(P.props=T),P.context=r,P.$UN=!1,s(P.componentWillMount)){if(P.$BR=!0,P.componentWillMount(),P.$PSS){var _=P.state,C=P.$PS;if(null===_)P.state=C;else for(var N in C)_[N]=C[N];P.$PSS=!1,P.$PS=null}P.$BR=!1}if(s(P.getInitialProps)){var b=P.getInitialProps(P.props,P.context);if(b){if(Promise.resolve(b)===b){var k=this.promises.push([])-1;return void this.addToQueue(b.then(function(e){P.$PSS=!1,"object"==typeof e&&(P.props=p(P.props,e));var t=P.render(P.props,P.state,P.context);return i(t)?m.addToQueue("\x3c!--!--\x3e",k):u(t)?m.addToQueue(v(t),k):a(t)?m.addToQueue(t+"",k):m.renderVNodeToQueue(t,P.context,!0,k),setTimeout(m.pushQueue,0),k}),f)}P.props=p(P.props,b)}}var M=P.render(P.props,P.state,P.context);P.$PSS=!1,i(M)?this.addToQueue("\x3c!--!--\x3e",f):u(M)?this.addToQueue(v(M),f):a(M)?this.addToQueue(M+"",f):this.renderVNodeToQueue(M,r,!0,f)}else{var w=x(T,r);i(w)?this.addToQueue("\x3c!--!--\x3e",f):u(w)?this.addToQueue(v(w),f):a(w)?this.addToQueue(w+"",f):this.renderVNodeToQueue(w,r,!0,f)}}else if((481&y)>0){var B,I="<"+x,R=S.has(x),V=e.className;if(u(V)?I+=' class="'+v(V)+'"':a(V)&&(I+=' class="'+V+'"'),!l(T))for(var E in T){var O=T[E];"dangerouslySetInnerHTML"===E?B=O.__html:"style"!==E||o(T.style)?"children"===E||("defaultValue"===E?T.value||(I+=' value="'+(u(O)?v(O):O)+'"'):"defaultChecked"===E?T.checked||(I+=' checked="'+O+'"'):u(O)?I+=" "+E+'="'+v(O)+'"':a(O)?I+=" "+E+'="'+O+'"':c(O)&&(I+=" "+E)):I+=' style="'+g(T.style)+'"'}if(R)this.addToQueue(I+">",f);else{I+=">";var j=e.childFlags;if(2&j)return this.addToQueue(I,f),this.renderVNodeToQueue(Q,r,!0,f),void this.addToQueue("</"+x+">",f);if(12&j){this.addToQueue(I,f),I="";for(var A=0,W=Q.length;A<W;A++)m.renderVNodeToQueue(Q[A],r,0===A,f)}if(B)return void this.addToQueue(I+B+"</"+x+">",f);R||this.addToQueue(I+"</"+x+">",f)}}else(16&y)>0?this.addToQueue((n?"":"\x3c!----\x3e")+(""===Q?" ":v(Q)),f):h()},r}(r.Readable);function P(e){return new Q(e)}var $=Promise.resolve(),_=function(e){function t(t){e.call(this),this.started=!1,this.initNode=t}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype._read=function(){var e=this;this.started||(this.started=!0,$.then(function(){return e.renderNode(e.initNode,null,!1)}).then(function(){e.push(null)}).catch(function(t){e.emit("error",t)}))},t.prototype.renderNode=function(e,t,r){var n=e.flags;return(14&n)>0?this.renderComponent(e,t,4&n):(481&n)>0?this.renderElement(e,t):this.renderText(e,r)},t.prototype.renderComponent=function(e,t,r){var n=this,l=e.type,c=e.props;if(!r){var d=l(c,t);return i(d)?this.push("\x3c!--!--\x3e"):u(d)?this.push(v(d)):a(d)?this.push(d+""):this.renderNode(d,t,!1)}var h=new l(c,t);h.$BS=!1;var f;return s(h.getChildContext)&&(f=h.getChildContext()),o(f)||(t=p(t,f)),h.context=t,h.$BR=!0,Promise.resolve(h.componentWillMount&&h.componentWillMount()).then(function(){if(h.$PSS){var e=h.state,r=h.$PS;if(null===e)h.state=r;else for(var o in r)e[o]=r[o];h.$PSS=!1,h.$PS=null}h.$BR=!1;var s=h.render(h.props,h.state,h.context);return h.$PSS=!1,i(s)?n.push("\x3c!--!--\x3e"):u(s)?n.push(v(s)):a(s)?n.push(s+""):n.renderNode(s,t,!1)})},t.prototype.renderChildren=function(e,t,r){var n=this;return 2&r?this.renderNode(e,t,!1):12&r?e.reduce(function(e,r){return e.then(function(e){return(16&r.flags)>0&&e&&n.push("\x3c!----\x3e"),Promise.resolve(n.renderNode(r,t,!1)).then(function(){return!!(16&r.flags)})})},Promise.resolve(!1)):void 0},t.prototype.renderText=function(e,t){this.push((t?"\x3c!----\x3e":"")+(""===e.children?" ":v(e.children)))},t.prototype.renderElement=function(e,t){var r,n=this,i=e.type,s=e.props,d="<"+i,h=S.has(i),p=e.className;if(u(p)?d+=' class="'+v(p)+'"':a(p)&&(d+=' class="'+p+'"'),!l(s))for(var f in s){var m=s[f];"dangerouslySetInnerHTML"===f?r=m.__html:"style"!==f||o(s.style)?"children"===f||("defaultValue"===f?s.value||(d+=' value="'+(u(m)?v(m):m)+'"'):"defaultChecked"===f?s.checked||(d+=' checked="'+m+'"'):u(m)?d+=" "+f+'="'+v(m)+'"':a(m)?d+=" "+f+'="'+m+'"':c(m)&&(d+=" "+f)):d+=' style="'+g(s.style)+'"'}if(h)return d+=">",void this.push(d);if(d+=">",this.push(d),r)return this.push(r),void this.push("</"+i+">");var y=e.childFlags;if(!(1&y))return Promise.resolve(this.renderChildren(e.children,t,y)).then(function(){n.push("</"+i+">")});this.push("</"+i+">")},t}(r.Readable);function C(e){return new _(e)}e.RenderQueueStream=Q,e.RenderStream=_,e.renderToStaticMarkup=T,e.renderToString=T,e.streamAsStaticMarkup=C,e.streamAsString=C,e.streamQueueAsStaticMarkup=P,e.streamQueueAsString=P,Object.defineProperty(e,"__esModule",{value:!0})});
