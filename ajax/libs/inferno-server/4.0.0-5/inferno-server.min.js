!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("inferno"),require("stream")):"function"==typeof define&&define.amd?define(["exports","inferno","stream"],t):t((e.Inferno=e.Inferno||{},e.Inferno.Server=e.Inferno.Server||{}),e.Inferno,e.stream)}(this,function(e,t,r){"use strict";var n="a runtime error occured! Use Inferno in development environment to find the error.",o=("undefined"==typeof window||window.document,Array.isArray);function i(e){var t=typeof e;return"string"===t||"number"===t}function s(e){return f(e)||h(e)}function u(e){return h(e)||!1===e||p(e)||f(e)}function a(e){return"function"==typeof e}function l(e){return"string"==typeof e}function c(e){return"number"==typeof e}function h(e){return null===e}function p(e){return!0===e}function f(e){return void 0===e}function d(e){throw e||(e=n),new Error("Inferno Error: "+e)}function v(e,t){var r={};if(e)for(var n in e)r[n]=e[n];if(t)for(var o in t)r[o]=t[o];return r}var m=/["'&<>]/;function y(e){if(!m.test(e))return e;var t,r="",n="",o=0;for(t=0;t<e.length;t++){switch(e.charCodeAt(t)){case 34:n="&quot;";break;case 39:n="&#039;";break;case 38:n="&amp;";break;case 60:n="&lt;";break;case 62:n="&gt;";break;default:continue}t>o&&(r+=e.slice(o,t)),r+=n,o=t+1}return r+e.slice(o,t)}var g=/[A-Z]/g,S={};function x(e){return S.hasOwnProperty(e)?S[e]:S[e]=e.replace(g,"-$&").toLowerCase()+":"}var T=new Set(["area","base","br","col","command","embed","hr","img","input","keygen","link","meta","param","source","track","wbr"]);function P(e){if(l(e))return e;var r="";for(var n in e){var o=e[n];l(o)?r+=""+x(n)+o+";":c(o)&&(r+=""+x(n)+o+(t.internal_isUnitlessNumber.has(n)?"":"px")+";")}return r}function Q(e,r,n,o){var f=e.flags,m=e.type,g=e.props||t.EMPTY_OBJ,S=e.children;if((14&f)>0){if(4&f){var x=new m(g,n);x.$BS=!1;var $;if(a(x.getChildContext)&&($=x.getChildContext()),$=s($)?n:v(n,$),x.props===t.EMPTY_OBJ&&(x.props=g),x.context=n,x.$UN=!1,a(x.componentWillMount)&&(x.$BR=!0,x.componentWillMount(),x.$BR=!1),x.$PSS){var _=x.state,b=x.$PS;if(null===_)x.state=b;else for(var N in b)_[N]=b[N];x.$PSS=!1,x.$PS=null}var C=x.render(g,x.state,x.context);return u(C)?"\x3c!--!--\x3e":(i(C)&&(C=t.createTextVNode(C,null)),Q(C,e,$,!0))}var M=m(g,n);return u(M)?"\x3c!--!--\x3e":Q(M,e,n,!0)}if((993&f)>0){var k,w="<"+m,I=T.has(m),B=e.className;if(l(B)?w+=' class="'+y(B)+'"':c(B)&&(w+=' class="'+B+'"'),!h(g)){for(var R in g){var V=g[R];"dangerouslySetInnerHTML"===R?k=V.__html:"style"===R?w+=' style="'+P(g.style)+'"':"children"===R||("defaultValue"===R?g.value||(w+=' value="'+(l(V)?y(V):V)+'"'):"defaultChecked"===R?g.checked||(w+=' checked="'+V+'"'):l(V)?w+=" "+R+'="'+y(V)+'"':c(V)?w+=" "+R+'="'+V+'"':p(V)&&(w+=" "+R))}"option"===m&&void 0!==g.value&&g.value===r.props.value&&(w+=" selected")}if(I)w+=">";else{w+=">";var E=e.childFlags;if(2&E)w+=Q(S,e,n,!0);else if(12&E)for(var O=0,j=S.length;O<j;O++)w+=Q(S[O],e,n,0===O);else k&&(w+=k);I||(w+="</"+m+">")}return w}if((16&f)>0)return(o?"":"\x3c!----\x3e")+(""===S?" ":y(S));d()}var $=function(e){function r(t,r){e.call(this),this.collector=[1/0],this.promises=[],this.pushQueue=this.pushQueue.bind(this),t&&this.renderVNodeToQueue(t,null,r,null)}return e&&(r.__proto__=e),(r.prototype=Object.create(e&&e.prototype)).constructor=r,r.prototype._read=function(){setTimeout(this.pushQueue,0)},r.prototype.addToQueue=function(e,t){if(s(t))"string"==typeof e&&this.collector.length-1==0?this.push(e):"string"==typeof e&&"string"==typeof this.collector[this.collector.length-2]?this.collector[this.collector.length-2]+=e:this.collector.splice(-1,0,e);else{var r=this.promises[t].length-1;"string"==typeof this.promises[t][r]&&"string"==typeof e?this.promises[t][r]+=e:this.promises[t].push(e)}},r.prototype.pushQueue=function(){var e=this.collector[0];if("string"==typeof e)this.push(e),this.collector.shift();else if(e&&("object"==typeof e||a(e))&&a(e.then)){var t=this;e.then(function(e){(r=t.collector).splice.apply(r,[0,1].concat(t.promises[e])),t.promises[e]=null,setTimeout(t.pushQueue,0);var r}),this.collector[0]=null}else e===1/0&&this.emit("end")},r.prototype.renderVNodeToQueue=function(e,r,n,i){var m=this;if(u(e))this.addToQueue("\x3c!--!--\x3e",i);else{var g=e.flags,S=e.type,x=e.props||t.EMPTY_OBJ,Q=e.children;if((14&g)>0){if(4&g){var $=new S(x,r);$.$BS=!1;var _;if(f($.getChildContext)||(_=$.getChildContext()),s(_)||(r=v(r,_)),$.props===t.EMPTY_OBJ&&($.props=x),$.context=r,$.$UN=!1,a($.componentWillMount)){if($.$BR=!0,$.componentWillMount(),$.$PSS){var b=$.state,N=$.$PS;if(null===b)$.state=N;else for(var C in N)b[C]=N[C];$.$PSS=!1,$.$PS=null}$.$BR=!1}if(a($.getInitialProps)){var M=$.getInitialProps($.props,$.context);if(M){if(Promise.resolve(M)===M){var k=this.promises.push([])-1;return void this.addToQueue(M.then(function(e){return $.$PSS=!1,"object"==typeof e&&($.props=v($.props,e)),m.renderVNodeToQueue($.render($.props,$.state,$.context),$.context,!0,k),setTimeout(m.pushQueue,0),k}),i)}$.props=v($.props,M)}}var w=$.render(x,$.state,e.context);$.$PSS=!1,this.renderVNodeToQueue(w,r,!0,i)}else{var I=S(x,r);this.renderVNodeToQueue(I,r,!0,i)}}else if((993&g)>0){var B,R="<"+S,V=T.has(S),E=e.className;if(l(E)?R+=' class="'+y(E)+'"':c(E)&&(R+=' class="'+E+'"'),!h(x))for(var O in x){var j=x[O];"dangerouslySetInnerHTML"===O?B=j.__html:"style"===O?R+=' style="'+P(x.style)+'"':"children"===O||("defaultValue"===O?x.value||(R+=' value="'+(l(j)?y(j):j)+'"'):"defaultChecked"===O?x.checked||(R+=' checked="'+j+'"'):l(j)?R+=" "+O+'="'+y(j)+'"':c(j)?R+=" "+O+'="'+j+'"':p(j)&&(R+=" "+O))}if(V)this.addToQueue(R+">",i);else{if(R+=">",u(Q)){if(B)return void this.addToQueue(R+B+"</"+S+">",i)}else{if(!o(Q))return l(Q)?void this.addToQueue(R+y(Q)+"</"+S+">",i):c(Q)?void this.addToQueue(R+Q+"</"+S+">",i):(this.addToQueue(R,i),this.renderVNodeToQueue(Q,r,!0,i),void this.addToQueue("</"+S+">",i));this.addToQueue(R,i),R="";for(var A=0,L=Q.length;A<L;A++){var W=Q[A];l(W)?m.addToQueue(y(W),i):c(W)?m.addToQueue(W+"",i):u(W)||m.renderVNodeToQueue(W,r,0===A,i)}}V||this.addToQueue(R+"</"+S+">",i)}}else(16&g)>0?this.addToQueue((n?"":"\x3c!----\x3e")+y(Q),i):d()}},r}(r.Readable);var _=Promise.resolve(),b=function(e){function t(t,r){e.call(this),this.started=!1,this.initNode=t,this.staticMarkup=r}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._read=function(){var e=this;this.started||(this.started=!0,_.then(function(){return e.renderNode(e.initNode,null,e.staticMarkup)}).then(function(){e.push(null)}).catch(function(t){e.emit("error",t)}))},t.prototype.renderNode=function(e,t,r){if(!u(e)){var n=e.flags;return(14&n)>0?this.renderComponent(e,r,t,4&n):(993&n)>0?this.renderElement(e,r,t):this.renderText(e)}},t.prototype.renderComponent=function(e,t,r,n){var o=this,i=e.type,u=e.props;if(!n)return this.renderNode(i(u),r,t);var l=new i(u);l.$BS=!1;var c;return a(l.getChildContext)&&(c=l.getChildContext()),s(c)||(r=v(r,c)),l.context=r,l.$BR=!0,Promise.resolve(l.componentWillMount&&l.componentWillMount()).then(function(){if(l.$PSS){var e=l.state,n=l.$PS;if(null===e)l.state=n;else for(var i in n)e[i]=n[i];l.$PSS=!1,l.$PS=null}l.$BR=!1;var s=l.render(l.props,l.state,l.context);return l.$PSS=!1,o.renderNode(s,r,t)})},t.prototype.renderChildren=function(e,t){var r=this;if(l(e))return this.push(y(e));if(c(e))return this.push(e+"");if(e){var n=o(e);if(!n&&!u(e))return this.renderNode(e,t,!1);if(!n)throw new Error("invalid component");return e.reduce(function(e,n){return e.then(function(e){return i(n)?(!0===e&&r.push("\x3c!----\x3e"),l(n)?r.push(y(n)):r.push(n+""),!0):o(n)?(r.push("\x3c!----\x3e"),Promise.resolve(r.renderChildren(n)).then(function(){return r.push("\x3c!--!--\x3e"),!0})):u(n)?void 0:((16&n.flags)>0&&e&&r.push("\x3c!----\x3e"),Promise.resolve(r.renderNode(n,t,!1)).then(function(){return!!(16&n.flags)}))})},Promise.resolve(!1))}},t.prototype.renderText=function(e){var t=this;return _.then(function(r){return t.push(y(e.children)),r})},t.prototype.renderElement=function(e,t,r){var n=this,o=e.type,i=e.props,s=function(e){for(var t=[],r=e&&Object.keys(e)||[],n=0,o=r.length;n<o;n++){var i=r[n];if("children"!==i&&"dangerouslySetInnerHTML"!==i&&"style"!==i){var s=e[i];l(s)?t.push(i+'="'+y(s)+'"'):c(s)?t.push(i+'="'+s+'"'):p(s)&&t.push(i)}}return t}(i),u="",a=e.className;if(l(a)?s.push('class="'+y(a)+'"'):c(a)&&s.push('class="'+a+'"'),i){var h=i.style;h&&s.push('style="'+P(h)+'"'),i.dangerouslySetInnerHTML&&(u=i.dangerouslySetInnerHTML.__html)}if(t&&s.push("data-infernoroot"),this.push("<"+o+(s.length>0?" "+s.join(" "):"")+">"),!T.has(o))return u?(this.push(u),void this.push("</"+o+">")):Promise.resolve(this.renderChildren(e.children,r)).then(function(){n.push("</"+o+">")})},t}(r.Readable);e.RenderQueueStream=$,e.RenderStream=b,e.renderToStaticMarkup=function(e){return Q(e,{},{},!0)},e.renderToString=function(e){return Q(e,{},{},!0)},e.streamAsStaticMarkup=function(e){return new b(e,!0)},e.streamAsString=function(e){return new b(e,!1)},e.streamQueueAsStaticMarkup=function(e){return new $(e,!0)},e.streamQueueAsString=function(e){return new $(e,!1)},Object.defineProperty(e,"__esModule",{value:!0})});
