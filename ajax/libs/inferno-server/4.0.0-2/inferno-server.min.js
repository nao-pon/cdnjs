!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("inferno"),require("stream")):"function"==typeof define&&define.amd?define(["exports","inferno","stream"],t):t((e.Inferno=e.Inferno||{},e.Inferno.Server={}),e.Inferno,e.stream)}(this,function(e,t,r){"use strict";function n(e){return c(e)||a(e)}function o(e){return a(e)||!1===e||l(e)||c(e)}function i(e){return"function"==typeof e}function s(e){return"string"==typeof e}function u(e){return"number"==typeof e}function a(e){return null===e}function l(e){return!0===e}function c(e){return void 0===e}function p(e){throw e||(e=P),new Error("Inferno Error: "+e)}function f(e,t){var r={};if(e)for(var n in e)r[n]=e[n];if(t)for(var o in t)r[o]=t[o];return r}function h(e){if(!M.test(e))return e;var t,r="",n="",o=0;for(t=0;t<e.length;t++){switch(e.charCodeAt(t)){case 34:n="&quot;";break;case 39:n="&#039;";break;case 38:n="&amp;";break;case 60:n="&lt;";break;case 62:n="&gt;";break;default:continue}t>o&&(r+=e.slice(o,t)),r+=n,o=t+1}return r+e.slice(o,t)}function d(e){return _.hasOwnProperty(e)?_[e]:_[e]=e.replace(k,"-$&").toLowerCase()+":"}function v(e){if(s(e))return e;var r="";for(var n in e){var o=e[n];s(o)?r+=""+d(n)+o+";":u(o)&&(r+=""+d(n)+o+(t.internal_isUnitlessNumber.has(n)?"":"px")+";")}return r}function m(e,r,c,d){var y=e.flags,S=e.type,g=e.props||t.EMPTY_OBJ,x=e.children;if((28&y)>0){if(4&y){var T=new S(g,c);T.$BS=!1;var Q;if(i(T.getChildContext)&&(Q=T.getChildContext()),Q=n(Q)?c:f(c,Q),T.props===t.EMPTY_OBJ&&(T.props=g),T.context=c,T.$UN=!1,i(T.componentWillMount)&&(T.$BR=!0,T.componentWillMount(),T.$BR=!1),T.$PSS){var P=T.state,M=T.$PS;if(null===P)T.state=M;else for(var k in M)P[k]=M[k];T.$PSS=!1,T.$PS=null}var _=T.render(g,T.state,T.context);return o(_)?"\x3c!--!--\x3e":m(_,e,Q,!0)}var C=S(g,c);return o(C)?"\x3c!--!--\x3e":m(C,e,c,!0)}if((3970&y)>0){var N,w="<"+S,B=b.has(S),I=e.className;if(s(I)?w+=' class="'+h(I)+'"':u(I)&&(w+=' class="'+I+'"'),!a(g)){for(var A in g){var R=g[A];"dangerouslySetInnerHTML"===A?N=R.__html:"style"===A?w+=' style="'+v(g.style)+'"':"children"===A||("defaultValue"===A?g.value||(w+=' value="'+(s(R)?h(R):R)+'"'):"defaultChecked"===A?g.checked||(w+=' checked="'+R+'"'):s(R)?w+=" "+A+'="'+h(R)+'"':u(R)?w+=" "+A+'="'+R+'"':l(R)&&(w+=" "+A))}"option"===S&&void 0!==g.value&&g.value===r.props.value&&(w+=" selected")}if(B)w+=">";else{if(w+=">",o(x))N&&(w+=N);else if(s(x))w+=""===x?" ":h(x);else if(u(x))w+=x+"";else if($(x))for(var E=0,O=x.length;E<O;E++){var V=x[E];s(V)?w+=""===V?" ":h(V):u(V)?w+=V:o(V)||(w+=m(V,e,c,0===E))}else w+=m(x,e,c,!0);B||(w+="</"+S+">")}return w}if((1&y)>0)return(d?"":"\x3c!----\x3e")+(""===x?" ":h(x));p()}function y(e){return m(e,{},{},!0)}function S(e){return m(e,{},{},!0)}function g(e){return new C(e,!1)}function x(e){return new C(e,!0)}function T(e){return new w(e,!1)}function Q(e){return new w(e,!0)}var P="a runtime error occured! Use Inferno in development environment to find the error.",$=("undefined"==typeof window||window.document,Array.isArray),M=/["'&<>]/,k=/[A-Z]/g,_={},b=new Set(["area","base","br","col","command","embed","hr","img","input","keygen","link","meta","param","source","track","wbr"]),C=function(e){function r(t,r){e.call(this),this.collector=[1/0],this.promises=[],this.pushQueue=this.pushQueue.bind(this),t&&this.renderVNodeToQueue(t,null,r,null)}return e&&(r.__proto__=e),r.prototype=Object.create(e&&e.prototype),r.prototype.constructor=r,r.prototype._read=function(){setTimeout(this.pushQueue,0)},r.prototype.addToQueue=function(e,t){if(n(t))"string"==typeof e&&this.collector.length-1==0?this.push(e):"string"==typeof e&&"string"==typeof this.collector[this.collector.length-2]?this.collector[this.collector.length-2]+=e:this.collector.splice(-1,0,e);else{var r=this.promises[t].length-1;"string"==typeof this.promises[t][r]&&"string"==typeof e?this.promises[t][r]+=e:this.promises[t].push(e)}},r.prototype.pushQueue=function(){var e=this.collector[0];if("string"==typeof e)this.push(e),this.collector.shift();else if(e&&("object"==typeof e||i(e))&&i(e.then)){var t=this;e.then(function(e){(r=t.collector).splice.apply(r,[0,1].concat(t.promises[e])),t.promises[e]=null,setTimeout(t.pushQueue,0);var r}),this.collector[0]=null}else e===1/0&&this.emit("end")},r.prototype.renderVNodeToQueue=function(e,r,d,m){var y=this;if(o(e))this.addToQueue("\x3c!--!--\x3e",m);else{var S=e.flags,g=e.type,x=e.props||t.EMPTY_OBJ,T=e.children;if((28&S)>0){if(4&S){var Q=new g(x,r);Q.$BS=!1;var P;if(c(Q.getChildContext)||(P=Q.getChildContext()),n(P)||(r=f(r,P)),Q.props===t.EMPTY_OBJ&&(Q.props=x),Q.context=r,Q.$UN=!1,i(Q.componentWillMount)){if(Q.$BR=!0,Q.componentWillMount(),Q.$PSS){var M=Q.state,k=Q.$PS;if(null===M)Q.state=k;else for(var _ in k)M[_]=k[_];Q.$PSS=!1,Q.$PS=null}Q.$BR=!1}if(i(Q.getInitialProps)){var C=Q.getInitialProps(Q.props,Q.context);if(C){if(Promise.resolve(C)===C){var N=this.promises.push([])-1;return void this.addToQueue(C.then(function(e){return Q.$PSS=!1,"object"==typeof e&&(Q.props=f(Q.props,e)),y.renderVNodeToQueue(Q.render(Q.props,Q.state,Q.context),Q.context,!0,N),setTimeout(y.pushQueue,0),N}),m)}Q.props=f(Q.props,C)}}var w=Q.render(x,Q.state,e.context);Q.$PSS=!1,this.renderVNodeToQueue(w,r,!0,m)}else{var B=g(x,r);this.renderVNodeToQueue(B,r,!0,m)}}else if((3970&S)>0){var I,A="<"+g,R=b.has(g),E=e.className;if(s(E)?A+=' class="'+h(E)+'"':u(E)&&(A+=' class="'+E+'"'),!a(x))for(var O in x){var V=x[O];"dangerouslySetInnerHTML"===O?I=V.__html:"style"===O?A+=' style="'+v(x.style)+'"':"children"===O||("defaultValue"===O?x.value||(A+=' value="'+(s(V)?h(V):V)+'"'):"defaultChecked"===O?x.checked||(A+=' checked="'+V+'"'):s(V)?A+=" "+O+'="'+h(V)+'"':u(V)?A+=" "+O+'="'+V+'"':l(V)&&(A+=" "+O))}if(R)this.addToQueue(A+">",m);else{if(A+=">",o(T)){if(I)return void this.addToQueue(A+I+"</"+g+">",m)}else{if(!$(T))return s(T)?void this.addToQueue(A+h(T)+"</"+g+">",m):u(T)?void this.addToQueue(A+T+"</"+g+">",m):(this.addToQueue(A,m),this.renderVNodeToQueue(T,r,!0,m),void this.addToQueue("</"+g+">",m));this.addToQueue(A,m),A="";for(var j=0,L=T.length;j<L;j++){var W=T[j];s(W)?y.addToQueue(h(W),m):u(W)?y.addToQueue(W+"",m):o(W)||y.renderVNodeToQueue(W,r,0===j,m)}}R||this.addToQueue(A+"</"+g+">",m)}}else(1&S)>0?this.addToQueue((d?"":"\x3c!----\x3e")+h(T),m):p()}},r}(r.Readable),N=Promise.resolve(),w=function(e){function t(t,r){e.call(this),this.started=!1,this.initNode=t,this.staticMarkup=r}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype._read=function(){var e=this;this.started||(this.started=!0,N.then(function(){return e.renderNode(e.initNode,null,e.staticMarkup)}).then(function(){e.push(null)}).catch(function(t){e.emit("error",t)}))},t.prototype.renderNode=function(e,t,r){if(!o(e)){var n=e.flags;return(28&n)>0?this.renderComponent(e,r,t,4&n):(3970&n)>0?this.renderElement(e,r,t):this.renderText(e)}},t.prototype.renderComponent=function(e,t,r,o){var s=this,u=e.type,a=e.props;if(!o)return this.renderNode(u(a),r,t);var l=new u(a);l.$BS=!1;var c;return i(l.getChildContext)&&(c=l.getChildContext()),n(c)||(r=f(r,c)),l.context=r,l.$BR=!0,Promise.resolve(l.componentWillMount&&l.componentWillMount()).then(function(){if(l.$PSS){var e=l.state,n=l.$PS;if(null===e)l.state=n;else for(var o in n)e[o]=n[o];l.$PSS=!1,l.$PS=null}l.$BR=!1;var i=l.render(l.props,l.state,l.context);return l.$PSS=!1,s.renderNode(i,r,t)})},t.prototype.renderChildren=function(e,t){var r=this;if(s(e))return this.push(h(e));if(u(e))return this.push(e+"");if(e){var n=$(e);if(!n&&!o(e))return this.renderNode(e,t,!1);if(!n)throw new Error("invalid component");return e.reduce(function(e,n){return e.then(function(e){return function(e){var t=typeof e;return"string"===t||"number"===t}(n)?(!0===e&&r.push("\x3c!----\x3e"),s(n)?r.push(h(n)):r.push(n+""),!0):$(n)?(r.push("\x3c!----\x3e"),Promise.resolve(r.renderChildren(n)).then(function(){return r.push("\x3c!--!--\x3e"),!0})):o(n)?void 0:((1&n.flags)>0&&e&&r.push("\x3c!----\x3e"),Promise.resolve(r.renderNode(n,t,!1)).then(function(){return!!(1&n.flags)}))})},Promise.resolve(!1))}},t.prototype.renderText=function(e){var t=this;return N.then(function(r){return t.push(e.children),r})},t.prototype.renderElement=function(e,t,r){var n=this,o=e.type,i=e.props,a=function(e){for(var t=[],r=e&&Object.keys(e)||[],n=0,o=r.length;n<o;n++){var i=r[n];if("children"!==i&&"dangerouslySetInnerHTML"!==i&&"style"!==i){var a=e[i];s(a)?t.push(i+'="'+h(a)+'"'):u(a)?t.push(i+'="'+a+'"'):l(a)&&t.push(i)}}return t}(i),c="",p=e.className;if(s(p)?a.push('class="'+h(p)+'"'):u(p)&&a.push('class="'+p+'"'),i){var f=i.style;f&&a.push('style="'+v(f)+'"'),i.dangerouslySetInnerHTML&&(c=i.dangerouslySetInnerHTML.__html)}if(t&&a.push("data-infernoroot"),this.push("<"+o+(a.length>0?" "+a.join(" "):"")+">"),!b.has(o))return c?(this.push(c),void this.push("</"+o+">")):Promise.resolve(this.renderChildren(e.children,r)).then(function(){n.push("</"+o+">")})},t}(r.Readable),B={RenderQueueStream:C,RenderStream:w,renderToStaticMarkup:S,renderToString:y,streamAsStaticMarkup:Q,streamAsString:T,streamQueueAsStaticMarkup:x,streamQueueAsString:g};e.default=B,e.RenderQueueStream=C,e.RenderStream=w,e.renderToStaticMarkup=S,e.renderToString=y,e.streamAsStaticMarkup=Q,e.streamAsString=T,e.streamQueueAsStaticMarkup=x,e.streamQueueAsString=g,Object.defineProperty(e,"__esModule",{value:!0})});
