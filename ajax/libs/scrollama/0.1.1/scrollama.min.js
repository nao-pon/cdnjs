!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):t.scrollama=e()}(this,function(){"use strict";function t(t){for(var e=t.length,n=[],o=0;o<e;o+=1)n.push(t[o]);return n}function e(t){return document.querySelector(t)}function n(e,n){return void 0===n&&(n=document),t(n.querySelectorAll(e))}return function(t,e){function n(t){this.time=t.time,this.target=t.target,this.rootBounds=t.rootBounds,this.boundingClientRect=t.boundingClientRect,this.intersectionRect=t.intersectionRect||{top:0,bottom:0,left:0,right:0,width:0,height:0},this.isIntersecting=!!t.intersectionRect;var e=this.boundingClientRect,n=e.width*e.height,o=this.intersectionRect,r=o.width*o.height;this.intersectionRatio=n?r/n:this.isIntersecting?1:0}function o(t,e){var n=e||{};if("function"!=typeof t)throw new Error("callback must be a function");if(n.root&&1!=n.root.nodeType)throw new Error("root must be an Element");this._checkForIntersections=i(this._checkForIntersections.bind(this),this.THROTTLE_TIMEOUT),this._callback=t,this._observationTargets=[],this._queuedEntries=[],this._rootMarginValues=this._parseRootMargin(n.rootMargin),this.thresholds=this._initThresholds(n.threshold),this.root=n.root||null,this.rootMargin=this._rootMarginValues.map(function(t){return t.value+t.unit}).join(" ")}function r(){return t.performance&&performance.now&&performance.now()}function i(t,e){var n=null;return function(){n||(n=setTimeout(function(){t(),n=null},e))}}function s(t,e,n,o){"function"==typeof t.addEventListener?t.addEventListener(e,n,o||!1):"function"==typeof t.attachEvent&&t.attachEvent("on"+e,n)}function c(t,e,n,o){"function"==typeof t.removeEventListener?t.removeEventListener(e,n,o||!1):"function"==typeof t.detatchEvent&&t.detatchEvent("on"+e,n)}function u(t,e){var n=Math.max(t.top,e.top),o=Math.min(t.bottom,e.bottom),r=Math.max(t.left,e.left),i=Math.min(t.right,e.right),s=i-r,c=o-n;return s>=0&&c>=0&&{top:n,bottom:o,left:r,right:i,width:s,height:c}}function h(t){var e;try{e=t.getBoundingClientRect()}catch(t){}return e?(e.width&&e.height||(e={top:e.top,right:e.right,bottom:e.bottom,left:e.left,width:e.right-e.left,height:e.bottom-e.top}),e):{top:0,bottom:0,left:0,right:0,width:0,height:0}}function a(t,e){for(var n=e;n;){if(n==t)return!0;n=l(n)}return!1}function l(t){var e=t.parentNode;return e&&11==e.nodeType&&e.host?e.host:e}if("IntersectionObserver"in t&&"IntersectionObserverEntry"in t&&"intersectionRatio"in t.IntersectionObserverEntry.prototype)"isIntersecting"in t.IntersectionObserverEntry.prototype||Object.defineProperty(t.IntersectionObserverEntry.prototype,"isIntersecting",{get:function(){return this.intersectionRatio>0}});else{var p=[];o.prototype.THROTTLE_TIMEOUT=100,o.prototype.POLL_INTERVAL=null,o.prototype.observe=function(t){if(!this._observationTargets.some(function(e){return e.element==t})){if(!t||1!=t.nodeType)throw new Error("target must be an Element");this._registerInstance(),this._observationTargets.push({element:t,entry:null}),this._monitorIntersections(),this._checkForIntersections()}},o.prototype.unobserve=function(t){this._observationTargets=this._observationTargets.filter(function(e){return e.element!=t}),this._observationTargets.length||(this._unmonitorIntersections(),this._unregisterInstance())},o.prototype.disconnect=function(){this._observationTargets=[],this._unmonitorIntersections(),this._unregisterInstance()},o.prototype.takeRecords=function(){var t=this._queuedEntries.slice();return this._queuedEntries=[],t},o.prototype._initThresholds=function(t){var e=t||[0];return Array.isArray(e)||(e=[e]),e.sort().filter(function(t,e,n){if("number"!=typeof t||isNaN(t)||t<0||t>1)throw new Error("threshold must be a number between 0 and 1 inclusively");return t!==n[e-1]})},o.prototype._parseRootMargin=function(t){var e=(t||"0px").split(/\s+/).map(function(t){var e=/^(-?\d*\.?\d+)(px|%)$/.exec(t);if(!e)throw new Error("rootMargin must be specified in pixels or percent");return{value:parseFloat(e[1]),unit:e[2]}});return e[1]=e[1]||e[0],e[2]=e[2]||e[0],e[3]=e[3]||e[1],e},o.prototype._monitorIntersections=function(){this._monitoringIntersections||(this._monitoringIntersections=!0,this.POLL_INTERVAL?this._monitoringInterval=setInterval(this._checkForIntersections,this.POLL_INTERVAL):(s(t,"resize",this._checkForIntersections,!0),s(e,"scroll",this._checkForIntersections,!0),"MutationObserver"in t&&(this._domObserver=new MutationObserver(this._checkForIntersections),this._domObserver.observe(e,{attributes:!0,childList:!0,characterData:!0,subtree:!0}))))},o.prototype._unmonitorIntersections=function(){this._monitoringIntersections&&(this._monitoringIntersections=!1,clearInterval(this._monitoringInterval),this._monitoringInterval=null,c(t,"resize",this._checkForIntersections,!0),c(e,"scroll",this._checkForIntersections,!0),this._domObserver&&(this._domObserver.disconnect(),this._domObserver=null))},o.prototype._checkForIntersections=function(){var t=this._rootIsInDom(),e=t?this._getRootRect():{top:0,bottom:0,left:0,right:0,width:0,height:0};this._observationTargets.forEach(function(o){var i=o.element,s=h(i),c=this._rootContainsTarget(i),u=o.entry,a=t&&c&&this._computeTargetAndRootIntersection(i,e),l=o.entry=new n({time:r(),target:i,boundingClientRect:s,rootBounds:e,intersectionRect:a});u?t&&c?this._hasCrossedThreshold(u,l)&&this._queuedEntries.push(l):u&&u.isIntersecting&&this._queuedEntries.push(l):this._queuedEntries.push(l)},this),this._queuedEntries.length&&this._callback(this.takeRecords(),this)},o.prototype._computeTargetAndRootIntersection=function(n,o){var r=this;if("none"!=t.getComputedStyle(n).display){for(var i=h(n),s=l(n),c=!1;!c;){var a=null,p=1==s.nodeType?t.getComputedStyle(s):{};if("none"==p.display)return;if(s==r.root||s==e?(c=!0,a=o):s!=e.body&&s!=e.documentElement&&"visible"!=p.overflow&&(a=h(s)),a&&!(i=u(a,i)))break;s=l(s)}return i}},o.prototype._getRootRect=function(){var t;if(this.root)t=h(this.root);else{var n=e.documentElement,o=e.body;t={top:0,left:0,right:n.clientWidth||o.clientWidth,width:n.clientWidth||o.clientWidth,bottom:n.clientHeight||o.clientHeight,height:n.clientHeight||o.clientHeight}}return this._expandRectByRootMargin(t)},o.prototype._expandRectByRootMargin=function(t){var e=this._rootMarginValues.map(function(e,n){return"px"==e.unit?e.value:e.value*(n%2?t.width:t.height)/100}),n={top:t.top-e[0],right:t.right+e[1],bottom:t.bottom+e[2],left:t.left-e[3]};return n.width=n.right-n.left,n.height=n.bottom-n.top,n},o.prototype._hasCrossedThreshold=function(t,e){var n=this,o=t&&t.isIntersecting?t.intersectionRatio||0:-1,r=e.isIntersecting?e.intersectionRatio||0:-1;if(o!==r)for(var i=0;i<this.thresholds.length;i++){var s=n.thresholds[i];if(s==o||s==r||s<o!=s<r)return!0}},o.prototype._rootIsInDom=function(){return!this.root||a(e,this.root)},o.prototype._rootContainsTarget=function(t){return a(this.root||e,t)},o.prototype._registerInstance=function(){p.indexOf(this)<0&&p.push(this)},o.prototype._unregisterInstance=function(){var t=p.indexOf(this);-1!=t&&p.splice(t,1)},t.IntersectionObserver=o,t.IntersectionObserverEntry=n}}(window,document),function(){function t(t){var e=+t.getAttribute("data-scrollama-index"),n={direction:x,element:t,index:e};C.step&&"function"==typeof C.step&&C.step(n)}function o(){var t={direction:x};C.enter&&"function"==typeof C.enter&&C.enter(t)}function r(){var t={direction:x};C.exit&&"function"==typeof C.exit&&C.exit(t)}function i(e){e.forEach(function(e){var n=e.isIntersecting,o=e.boundingClientRect,r=e.target;n&&o.bottom>=0&&(x="down",t(r))})}function s(e){e.forEach(function(e){var n=e.isIntersecting,o=e.boundingClientRect,r=e.target;n&&o.top<0&&(x="up",t(r))})}function c(t){var e=t[0],n=e.isIntersecting,i=e.boundingClientRect,s=i.top,c=i.bottom;n&&s<=0&&c>w?(x="down",o()):!n&&s>=0&&(x="up",r())}function u(t){var e=t[0],n=e.isIntersecting;e.boundingClientRect.bottom<w+R.height&&(x=n?"up":"down",n?o():r())}function h(){k.top&&k.top.unobserve(b);var t={root:null,rootMargin:"0px 0px -"+w+"px 0px",threshold:0};k.top=new IntersectionObserver(c,t),k.top.observe(b)}function a(){k.bottom&&k.bottom.unobserve(b);var t={root:null,rootMargin:"-"+R.height+"px 0px 0px 0px",threshold:0};k.bottom=new IntersectionObserver(u,t),k.bottom.observe(b)}function l(){k.step&&k.stepDown.disconnect();var t={root:null,rootMargin:M.top+"px 0px "+M.bottom+"px 0px",threshold:0};k.stepDown=new IntersectionObserver(i,t),y.forEach(function(t){return k.stepDown.observe(t)})}function p(){k.step&&k.stepUp.disconnect();var t={root:null,rootMargin:"-"+E+"px 0px "+E+"px 0px",threshold:0};k.stepUp=new IntersectionObserver(s,t),y.forEach(function(t){return k.stepUp.observe(t)})}function f(){h(),a(),l(),p()}function d(){if(w=window.innerHeight,R=_?_.getBoundingClientRect():null,y){var t=y[0].getBoundingClientRect().height;E=I*w,M.top=t-E,M.bottom=-w+E}T&&f(),O&&(document.querySelector(".scrollama__offset").style.top=E+"px")}function g(t){t&&!T?(f(),T=!0):t||(Object.keys(observer).map(function(t){return observer[t].disconnect()}),T=!1)}function v(){y.forEach(function(t,e){return t.setAttribute("data-scrollama-index",e)})}function m(){var t=document.createElement("div");t.setAttribute("class","scrollama__offset"),t.style.position="fixed",t.style.top="0",t.style.left="0",t.style.width="100%",t.style.height="1px",t.style.backgroundColor="lime",document.body.appendChild(t)}var b=null,_=null,y=null,I=0,E=0,w=0,x=null,R=null,T=!1,O=!1,M={},C={},k={},L={};return L.setup=function(t){var o=t.container,r=t.graphic,i=t.step,s=t.offset;void 0===s&&(s=.5);var c=t.debug;return void 0===c&&(c=!1),o&&r&&i?(b=e(o),_=e(r),y=n(i),I=s,(O=c)&&m(),v(),d(),g(!0)):console.log("improper scrollama setup config"),L},L.resize=function(){return d(),L},L.enable=function(){return g(!0),L},L.disable=function(){return g(!1),L},L.onStep=function(t){return C.step=t,L},L.onIncrement=function(t){return C.increment=t,L},L.onEnter=function(t){return C.enter=t,L},L.onExit=function(t){return C.exit=t,L},L}});
