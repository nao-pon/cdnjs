!function(e){e.fn.tokenInput=function(n,t){var o=e.extend({url:n,hintText:"Type in a search term",noResultsText:"No results",searchingText:"Searching...",deleteText:"&times;",searchDelay:300,minChars:1,tokenLimit:null,jsonContainer:null,method:"GET",contentType:"json",queryParam:"q",tokenDelimiter:",",preventDuplicates:!1,prePopulate:null,animateDropdown:!0,onResult:null,onAdd:null,onDelete:null,crossDomain:!1},t||{});return o.classes=e.extend({tokenList:"token-input-list",token:"token-input-token",tokenDelete:"token-input-delete-token",selectedToken:"token-input-selected-token",highlightedToken:"token-input-highlighted-token",dropdown:"token-input-dropdown",dropdownItem:"token-input-dropdown-item",dropdownItem2:"token-input-dropdown-item2",selectedDropdownItem:"token-input-selected-dropdown-item",inputToken:"token-input-input-token"},t.classes||{}),this.each(function(){new e.TokenList(this,o)})},e.TokenList=function(n,t){function o(e){return e>=48&&e<=90||e>=96&&e<=111||e>=186&&e<=192||e>=219&&e<=222}function i(n,t){return e(n.target).closest(t)}function s(n,o){var i=e("<li><p>"+o+"</p> </li>").addClass(t.classes.token).insertBefore(B);e("<span>"+t.deleteText+"</span>").addClass(t.classes.tokenDelete).appendTo(i).click(function(){return c(e(this).parent()),!1}),e.data(i.get(0),"tokeninput",{id:n,name:o}),L.val("").focus(),p();var s=n+t.tokenDelimiter;return A.val(A.val()+s),y.push(i),x++,i}function a(n){var o=e.data(n.get(0),"tokeninput"),i=t.onAdd;if(x>0&&t.preventDuplicates){var a=l(o.id);if(a>-1)return u(y[a]),B.insertAfter(y[a]),void L.focus()}if(null!==t.tokenLimit&&x>=t.tokenLimit)return L.hide(),void p();s(o.id,o.name),e.isFunction(i)&&i(o.id)}function l(n){for(var t=-1,o=0;o<y.length;o++)if(e.data(e(y[o]).get(0),"tokeninput").id==n){t=o;break}return t}function u(e){e.addClass(t.classes.selectedToken),F=e.get(0),L.val(""),p()}function r(e,n){e.removeClass(t.classes.selectedToken),F=null,n===D.BEFORE?B.insertBefore(e):n===D.AFTER?B.insertAfter(e):B.appendTo(O),L.focus()}function d(n){F===n.get(0)?r(n,D.END):(F&&r(e(F),D.END),u(n))}function c(n){var o=e.data(n.get(0),"tokeninput"),i=t.onDelete;n.remove(),F=null,L.focus();var s=A.val(),a=s.indexOf(o.id+t.tokenDelimiter),l=s.indexOf(t.tokenDelimiter,a)+1;l>=s.length?A.val(s.slice(0,a)):A.val(s.slice(0,a)+s.slice(l,s.length)),x--,null!==t.tokenLimit&&L.show().val("").focus(),e.isFunction(i)&&i(o.id)}function p(){setTimeout(function(){N.hide().empty(),I=null},300)}function f(){t.searchingText&&N.html("<p>"+t.searchingText+"</p>").show()}function h(){t.hintText&&N.html("<p>"+t.hintText+"</p>").show()}function k(e,n){return e.replace(new RegExp("(?![^&;]+;)(?!<[^<>]*)("+n+")(?![^<>]*>)(?![^&;]+;)","gi"),"<b>$1</b>")}function m(n,o){if(o&&o.length){N.empty();var s=e("<ul>").appendTo(N).mouseover(function(e){T(i(e,"li"))}).mousedown(function(e){return a(i(e,"li")),!1}).hide();e.each(o,function(o,i){var a=e("<li>"+k(i.name,n)+"</li>").appendTo(s);o%2?a.addClass(t.classes.dropdownItem):a.addClass(t.classes.dropdownItem2),0===o&&T(a),e.data(a.get(0),"tokeninput",{id:i.id,name:i.name})}),N.show(),t.animateDropdown?s.slideDown("fast"):s.show()}else t.noResultsText&&N.html("<p>"+t.noResultsText+"</p>").show()}function T(n){n&&(I&&v(e(I)),n.addClass(t.classes.selectedDropdownItem),I=n.get(0))}function v(e){e.removeClass(t.classes.selectedDropdownItem),I=null}function g(n){var o=L.val().toLowerCase();o&&o.length&&(F&&r(e(F),D.AFTER),o.length>=t.minChars?(f(),n?C(o):(clearTimeout(w),w=setTimeout(function(){C(o)},t.searchDelay))):p())}function C(n){var o=R.get(n);if(o)m(n,o);else{var i={};if(i.data={},t.url.indexOf("?")>-1){var s=t.url.split("?");i.url=s[0];for(var a=s[1].split("&"),l=0;l<a.length;l++){var u=a[l].split("=");i.data[u[0]]=u[1]}}else i.url=t.url;i.data[t.queryParam]=n,i.type=t.method,i.success=function(o){e.isFunction(t.onResult)&&(o=t.onResult.call(this,o)),R.add(n,t.jsonContainer?o[t.jsonContainer]:o),L.val().toLowerCase()==n&&m(n,t.jsonContainer?o[t.jsonContainer]:o)},i.dataType=t.contentType,t.crossDomain&&(i.dataType="jsonp"),e.ajax(i)}}var w,D={BEFORE:0,AFTER:1,END:2},E={BACKSPACE:8,TAB:9,RETURN:13,ESC:27,LEFT:37,UP:38,RIGHT:39,DOWN:40,COMMA:188},y=[],x=0,R=new e.TokenList.Cache,L=e('<input type="text"  autocomplete="off">').css({outline:"none"}).focus(function(){null!==t.tokenLimit&&t.tokenLimit===x||h()}).blur(function(){p()}).keydown(function(n){var t,i;switch(n.keyCode){case E.LEFT:case E.RIGHT:case E.UP:case E.DOWN:if(e(this).val()){var s=null;return(s=n.keyCode===E.DOWN||n.keyCode===E.RIGHT?e(I).next():e(I).prev()).length&&T(s),!1}t=B.prev(),i=B.next(),t.length&&t.get(0)===F||i.length&&i.get(0)===F?n.keyCode===E.LEFT||n.keyCode===E.UP?r(e(F),D.BEFORE):r(e(F),D.AFTER):n.keyCode!==E.LEFT&&n.keyCode!==E.UP||!t.length?n.keyCode!==E.RIGHT&&n.keyCode!==E.DOWN||!i.length||u(e(i.get(0))):u(e(t.get(0)));break;case E.BACKSPACE:if(t=B.prev(),!e(this).val().length)return F?c(e(F)):t.length&&u(e(t.get(0))),!1;1===e(this).val().length?p():setTimeout(function(){g(!1)},5);break;case E.TAB:case E.RETURN:case E.COMMA:if(I)return a(e(I)),!1;break;case E.ESC:return p(),!0;default:o(n.keyCode)&&setTimeout(function(){g(!1)},5)}}),A=e(n).hide().focus(function(){L.focus()}).blur(function(){L.blur()}),F=null,I=null,O=e("<ul />").addClass(t.classes.tokenList).insertBefore(A).click(function(n){var t=i(n,"li");if(t&&t.get(0)!==B.get(0))return d(t),!1;L.focus(),F&&r(e(F),D.END)}).mouseover(function(e){var n=i(e,"li");n&&F!==this&&n.addClass(t.classes.highlightedToken)}).mouseout(function(e){var n=i(e,"li");n&&F!==this&&n.removeClass(t.classes.highlightedToken)}).mousedown(function(e){if(i(e,"li"))return!1}),N=e("<div>").addClass(t.classes.dropdown).insertAfter(O).hide(),B=e("<li />").addClass(t.classes.inputToken).appendTo(O).append(L);A.val(""),li_data=t.prePopulate,li_data&&li_data.length&&e.each(li_data,function(e,n){s(n.id,n.name)})},e.TokenList.Cache=function(n){var t=e.extend({max_size:50},n),o={},i=0,s=function(){o={},i=0};this.add=function(e,n){i>t.max_size&&s(),o[e]||i++,o[e]=n},this.get=function(e){return o[e]}}}(jQuery);