/**
 * PgwSlider - Version 2.0
 *
 * Copyright 2014, Jonathan M. Piat
 * http://pgwjs.com - http://pagawa.com
 * 
 * Released under the GNU GPLv3 license - http://opensource.org/licenses/gpl-3.0
 */
(function(a){a.fn.pgwSlider=function(k){var f={mainClassName:"pgwSlider",listPosition:"right",selectionMode:"click",autoSlide:true,verticalCentering:false,beforeSlide:null,afterSlide:null,maxHeight:null,adaptiveHeight:false,adaptiveDuration:200,transitionDuration:600,intervalDuration:3000};if(this.length==0){return this}else{if(this.length>1){this.each(function(){a(this).pgwSlider(k)});return this}}var i=this;i.plugin=this;i.data=[];i.config={};i.currentSlide=0;i.slideCount=0;i.eventInterval=null;i.eventResize=null;i.eventAdaptive=null;i.window=a(window);var j=function(){i.config=a.extend({},f,k);d();if(i.config.autoSlide){g()}return true};var b=function(m){var n={};var p=m.find("a").attr("href");if((typeof p!="undefined")&&(p!="")){n.link=p;var s=m.find("a").attr("target");if((typeof s!="undefined")&&(s!="")){n.linkTarget=s}}var l=m.find("img").attr("src");if((typeof l!="undefined")&&(l!="")){n.thumbnail=l}var t=m.find("img").attr("data-large-src");if((typeof t!="undefined")&&(t!="")){n.image=t}var q=m.find("span").text();if((typeof q!="undefined")&&(q!="")&&(q!=null)){n.title=q}else{var o=m.find("img").attr("alt");if((typeof o!="undefined")&&(o!="")){n.title=o}}var r=m.find("img").attr("data-description");if((typeof r!="undefined")&&(r!="")){n.description=r}return n};var e=function(l,m){if(i.config.maxHeight){if(i.window.width()>480&&l>i.config.maxHeight){l=i.config.maxHeight}else{if(i.window.width()<=480){if(l+i.plugin.find(".ps-list").height()>i.config.maxHeight){l=i.config.maxHeight-i.plugin.find(".ps-list").height()}}}}var n=((l-((i.slideCount-1)*6))/i.slideCount);var o=(100/i.slideCount);i.plugin.find(".ps-list > li").css({width:o+"%"});if(typeof m!="undefined"&&m&&i.config.maxHeight==false){clearTimeout(i.eventAdaptive);i.eventAdaptive=setTimeout(function(){if(typeof i.plugin.find(".ps-current").animate=="function"){i.plugin.find(".ps-current").animate({height:l},i.config.adaptiveDuration,function(){i.plugin.find(".ps-list > li").animate({height:n},i.config.adaptiveDuration)})}else{i.plugin.find(".ps-current").css("height",l);i.plugin.find(".ps-list > li").css("height",n)}},100)}else{i.plugin.find(".ps-current").css("height",l);i.plugin.find(".ps-list > li").css("height",n)}if(i.config.verticalCentering){clearTimeout(i.eventResize);i.eventResize=setTimeout(function(){i.plugin.find(".ps-list > li").each(function(){if((n>50)&&(a(this).find("img").height()>n)){var p=Math.round((a(this).find("img").height()-n)/2);a(this).find("img").css("margin-top",-p)}else{if(a(this).find("img").height()<n){var p=Math.round((n-a(this).find("img").height())/2);a(this).find("img").css("margin-top",p)}else{a(this).find("img").css("margin-top","")}}});i.plugin.find(".ps-current > ul > li").each(function(){var p=(a(this).css("display")=="none")?false:true;if(!p){a(this).show()}if(a(this).show().find("img").height()>l){var q=Math.round((a(this).find("img").height()-l)/2);a(this).find("img").css("margin-top",-q)}else{if(a(this).show().find("img").height()<l){var q=Math.round((l-a(this).find("img").height())/2);a(this).find("img").css("margin-top",q)}else{a(this).find("img").css("margin-top","")}}if(!p){a(this).hide()}})},200)}return true};var c=function(){if(i.plugin.width()<=480){i.plugin.addClass("narrow").removeClass("wide")}else{i.plugin.addClass("wide").removeClass("narrow")}return true};var d=function(){i.plugin.removeClass(i.config.mainClassName).addClass("ps-list");i.plugin.wrap('<div class="'+i.config.mainClassName+'"></div>');i.plugin=i.plugin.parent();i.plugin.prepend('<div class="ps-current"><ul></ul><span class="ps-caption"></span></div>');i.slideCount=i.plugin.find(".ps-list > li").length;if(i.slideCount==0){throw new Error("PgwSlider - No slider item has been found");return false}var l=1;i.plugin.find(".ps-list > li").each(function(){var n=b(a(this));n.id=l;i.data.push(n);a(this).addClass("elt_"+n.id);if(n.title){if(a(this).find("span").length==1){if(a(this).find("span").text()==""){a(this).find("span").text(n.title)}}else{a(this).find("img").after("<span>"+n.title+"</span>")}}var m=a('<li class="elt_'+l+'"></li>');if(n.image){m.html('<img src="'+n.image+'" alt="'+(n.title?n.title:"")+'">')}else{if(n.thumbnail){m.html('<img src="'+n.thumbnail+'" alt="'+(n.title?n.title:"")+'">')}}if(n.link){m.html('<a href="'+n.link+'"'+(n.linkTarget?' target="'+n.linkTarget+'"':"")+">"+m.html()+"</a>")}i.plugin.find(".ps-current > ul").append(m);if(i.config.selectionMode=="mouseOver"){a(this).css("cursor","default").click(function(o){o.preventDefault()}).bind("mouseenter",function(o){h(n.id)});a(this).find("a").css("cursor","default")}else{a(this).css("cursor","pointer").click(function(o){o.preventDefault();h(n.id)})}l++});if(i.config.listPosition=="left"){i.plugin.addClass("listOnTheLeft")}if(i.config.autoSlide){i.plugin.on("mouseenter",function(){clearInterval(i.eventInterval);i.eventInterval=null}).on("mouseleave",function(){g()})}h(1);i.plugin.find(".ps-current > ul > li.elt_1 img").on("load",function(){c();var m=i.plugin.find(".ps-current > ul > li.elt_1 img").height();e(m);i.window.resize(function(){c();var n=i.plugin.find(".ps-current > ul > li.elt_"+i.currentSlide+" img").height();e(n,i.config.adaptiveHeight)})});return true};var h=function(l,q){if(l==i.currentSlide){return false}var p=i.data[l-1];var o=i.plugin.find(".ps-current > ul");if(typeof p=="undefined"){throw new Error("PgwSlider - The element "+l+" is undefined");return false}if(typeof i.config.beforeSlide=="function"){i.config.beforeSlide(l)}i.plugin.find(".ps-list > li").css("opacity","0.6");i.plugin.find(".ps-list > li.elt_"+l).css("opacity","1");o.find("li").not(".elt_"+i.currentSlide).not(".elt_"+l).each(function(){if(typeof a(this).stop=="function"){a(this).stop()}a(this).css("position","").css("z-index",1).hide()});if(typeof i.plugin.find(".ps-current > span").fadeOut=="function"){i.plugin.find(".ps-current > span").fadeOut(i.config.transitionDuration/2)}else{i.plugin.find(".ps-current > span").hide()}if(i.currentSlide>0){var m=o.find(".elt_"+i.currentSlide);if(typeof m.animate!="function"){m.animate=function(r,s,t){m.css(r);if(t){t()}}}if(typeof m.stop=="function"){m.stop()}m.css("position","absolute").animate({opacity:0},i.config.transitionDuration,function(){m.css("position","").css("z-index",1).hide()})}i.currentSlide=l;var n=o.find(".elt_"+l);if(typeof n.animate!="function"){n.animate=function(r,s,t){n.css(r);if(t){t()}}}if(typeof n.stop=="function"){n.stop()}n.css("position","absolute").show().animate({opacity:1},i.config.transitionDuration,function(){n.css("position","").css("z-index",2).show();var s="";if(p.title){s+="<b>"+p.title+"</b>"}if(p.description){if(s!=""){s+="<br>"}s+=p.description}if(s!=""){if(p.link){s='<a href="'+p.link+'"'+(p.linkTarget?' target="'+p.linkTarget+'"':"")+">"+s+"</a>"}if(typeof i.plugin.find(".ps-current > span").fadeOut=="function"){i.plugin.find(".ps-current > span").html(s).fadeIn(i.config.transitionDuration/2)}else{i.plugin.find(".ps-current > span").html(s).show()}}if(typeof i.config.afterSlide=="function"){i.config.afterSlide(l)}if(i.config.adaptiveHeight){var r=i.plugin.find(".ps-current .elt_"+l+" img").height();e(r,true)}});if(typeof q!="undefined"&&i.config.autoSlide){g()}return true};var g=function(){clearInterval(i.eventInterval);if(i.slideCount>1&&i.config.autoSlide){i.eventInterval=setInterval(function(){if(i.currentSlide+1<=i.slideCount){var l=i.currentSlide+1}else{var l=1}h(l)},i.config.intervalDuration)}return true};i.startSlide=function(){i.config.autoSlide=true;g();return true};i.stopSlide=function(){i.config.autoSlide=false;clearInterval(i.eventInterval);return true};i.getCurrentSlide=function(){return i.currentSlide};i.getSlideCount=function(){return i.slideCount};i.displaySlide=function(l){h(l,true);return true};i.nextSlide=function(){if(i.currentSlide+1<=i.slideCount){var l=i.currentSlide+1}else{var l=1}h(l,true);return true};i.previousSlide=function(){if(i.currentSlide-1>=1){var l=i.currentSlide-1}else{var l=i.slideCount}h(l,true);return true};i.destroy=function(l){clearInterval(i.eventInterval);if(typeof l!="undefined"){i.plugin.find(".ps-list > li").each(function(){a(this).attr("style","").removeClass().css("cursor","").unbind("click").unbind("mouseenter");a(this).find("a").css("cursor","")});i.plugin.find(".ps-list").addClass(i.config.mainClassName).removeClass("ps-list");i.plugin.find(".ps-current").unwrap().remove();i.hide()}else{i.parent().remove()}i.plugin=null;i.data=[];i.config={};i.currentSlide=0;i.slideCount=0;i.eventInterval=null;i.window=null;return true};i.reload=function(l){i.destroy(true);i=this;i.plugin=this;i.window=a(window);i.plugin.show();i.config=a.extend({},f,l);d();if(i.config.autoSlide){g()}return true};j();return this}})(window.Zepto||window.jQuery);
