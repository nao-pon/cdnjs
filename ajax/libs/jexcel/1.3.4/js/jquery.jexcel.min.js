!function($){var methods={init:function(e){void 0!=(e=$.extend({colHeaders:[],colWidths:[],defaultColWidth:50,colAlignments:[],columns:[],minSpareRows:0,minSpareCols:0,minDimensions:[0,0],contextMenu:null,columnSorting:!0,columnResize:!0,rowDrag:!0,editable:!0,allowInsertRow:!0,allowManualInsertRow:!0,allowInsertColumn:!0,allowManualInsertColumn:!0,allowDeleteRow:!0,allowDeleteColumn:!0,wordWrap:!1,tableId:null,about:"jExcel Spreadsheet\\nVersion 1.3.3\\nAuthor: Paul Hodel <paul.hodel@gmail.com>\\nWebsite: http://bossanova.uk/jexcel"},e)).manualColumnResize&&(e.columnResize=e.manualColumnResize),void 0!=e.manualRowMove&&(e.rowDrag=e.manualRowMove);var l=$(this).prop("id"),t=$(this);prepareTable=function(){$.fn.jexcel.defaults||($.fn.jexcel.defaults=new Array),$.fn.jexcel.defaults[l]=e,$.fn.jexcel.defaults[l].history=[],$.fn.jexcel.defaults[l].historyIndex=-1;var n=[];for(e.data||(e.data=[]),$.fn.jexcel.defaults[l].data.length||($.fn.jexcel.defaults[l].data=[[]]),size=e.colHeaders.length,e.data[0].length>size&&(size=e.data[0].length),$.fn.jexcel.defaults[l].minDimensions[0]>size&&(size=$.fn.jexcel.defaults[l].minDimensions[0]),i=0;i<size;i++)e.colHeaders[i]||(e.colHeaders[i]=$.fn.jexcel("getColumnName",i)),e.columns[i]?e.columns[i]||(e.columns[i].type="text"):e.columns[i]={type:"text"},e.columns[i].source||($.fn.jexcel.defaults[l].columns[i].source=[]),e.columns[i].options||($.fn.jexcel.defaults[l].columns[i].options=[]),e.columns[i].editor||(e.columns[i].editor=null),e.colAlignments[i]||(e.colAlignments[i]="center"),e.colWidths[i]||(e.colWidths[i]=e.defaultColWidth||"50"),"autocomplete"==e.columns[i].type||"dropdown"==e.columns[i].type?e.columns[i].url&&n.push($.ajax({url:e.columns[i].url,index:i,dataType:"json",success:function(e){$.fn.jexcel.defaults[l].columns[this.index].source=e},error:function(e){console.error("It was not possible to load the url: "+this.url)}})):"calendar"==e.columns[i].type&&($.fn.jexcel.defaults[l].columns[i].options.format||($.fn.jexcel.defaults[l].columns[i].options.format="DD/MM/YYYY"));n.length>0?$.when.apply(this,n).done(function(){$(t).jexcel("createTable")}):$(t).jexcel("createTable")},e.csv?$.csv?(e.delimiter=e.delimiter||",",$.ajax({url:e.csv,success:function(l){var t=$.csv.toArrays(l);1==e.csvHeaders&&(e.colHeaders=t.shift()),e.data=t,prepareTable()}})):console.error("Jexcel error: jquery-csv library not loaded"):e.url?$.ajax({url:e.url,dataType:"json",success:function(l){e.data=$.parseJSON(l.data?l.data:l),prepareTable()}}):prepareTable()},createTable:function(){var e=$(this).prop("id"),l=$.fn.jexcel.defaults[e],t=document.createElement("table");$(t).prop("class","jexcel bossanova-ui"),$(t).prop("cellpadding","0"),$(t).prop("cellspacing","0"),l.tableId&&$(t).prop("id",l.tableId),$(t).prop("unselectable","yes"),$(t).prop("onselectstart","return false"),$(t).prop("draggable","false");var n=document.createElement("thead"),c=document.createElement("tbody");$(n).prop("class","jexcel_label");var s='<td width="30" class="jexcel_label"></td>';for(i=0;i<l.colHeaders.length;i++)width=l.colWidths[i],align=l.colAlignments[i],align="center",header=l.colHeaders[i],"hidden"==l.columns[i].type?s+='<td id="col-'+i+'" style="display:none;" title="'+header+'">'+header+"</td>":s+='<td id="col-'+i+'" width="'+width+'" align="'+align+'" title="'+header+'">'+header+"</td>";if($(n).html("<tr>"+s+"</tr>"),$(t).append(n),$(t).append(c),$(t).on("dragstart",function(){return!1}),$(this).html(t),!$(".jexcel_corner").length){var a=document.createElement("div");$(a).prop("class","jexcel_corner"),$(a).prop("id","corner");var r=document.createElement("textarea");$(r).prop("class","jexcel_textarea"),$(r).prop("id","textarea");var o=document.createElement("div");$(o).css("display","none"),$(o).prop("class","jexcel_contextmenu"),$(o).prop("id","jexcel_contextmenu");var d=document.createElement("div");$(d).css("display","none"),$(d).html('<a href="http://github.com/paulhodel/jexcel">jExcel Spreadsheet</a>'),$("body").append(a),$("body").append(r),$("body").append(o),$("body").append(d),$(a).prop("unselectable","yes"),$(a).prop("onselectstart","return false"),$(a).prop("draggable","false"),$(a).on("dragstart",function(){return!1}),$.fn.jexcel.selectedCorner=!1,$.fn.jexcel.selectedHeader=null,$.fn.jexcel.resizeColumn=null,$(document).on("contextmenu",function(e){if("block"==$("#jexcel_contextmenu").css("display")&&$("#jexcel_contextmenu").css("display","none"),$.fn.jexcel.current){var t=$(e.target).parent().parent().parent();if($(t).is(".jexcel")){var n=$(e.target).prop("id");n&&(n=n.split("-"),contextMenuContent="","function"==typeof l.contextMenu?contextMenuContent=l.contextMenu(n[0],n[1]):$(e.target).parent().parent().is("thead")?(contextMenuContent+="<a onclick=\"$('#"+$.fn.jexcel.current+"').jexcel('orderBy', "+n[1]+', 0)">Order ascending <span></span></a>',contextMenuContent+="<a onclick=\"$('#"+$.fn.jexcel.current+"').jexcel('orderBy', "+n[1]+', 1)">Order descending <span></span></a><hr>',1==$.fn.jexcel.defaults[$.fn.jexcel.current].allowInsertColumn&&(contextMenuContent+="<a onclick=\"$('#"+$.fn.jexcel.current+"').jexcel('insertColumn', 1, null, "+n[1]+')">Insert a new column<span></span></a>'),1==$.fn.jexcel.defaults[$.fn.jexcel.current].allowInsertRow&&(contextMenuContent+="<a onclick=\"$('#"+$.fn.jexcel.current+"').jexcel('insertRow', 1, "+n[1]+')">Insert a new row<span></span></a><hr>'),1==$.fn.jexcel.defaults[$.fn.jexcel.current].allowDeleteColumn&&(contextMenuContent+="<a onclick=\"$('#"+$.fn.jexcel.current+"').jexcel('deleteColumn',"+n[1]+')">Delete this column<span></span></a><hr>'),contextMenuContent+="<a onclick=\"$('#"+$.fn.jexcel.current+"').jexcel('download')\">Save as...<span>Ctrl + S</span></a>",l.about&&(contextMenuContent+="<a onclick=\"alert('"+l.about+"')\">About<span></span></a>")):$(e.target).parent().parent().is("tbody")&&(1==$.fn.jexcel.defaults[$.fn.jexcel.current].allowInsertColumn&&(contextMenuContent+="<a onclick=\"$('#"+$.fn.jexcel.current+"').jexcel('insertColumn', 1, null, "+n[1]+')">Insert a new column<span></span></a>'),1==$.fn.jexcel.defaults[$.fn.jexcel.current].allowInsertRow&&(contextMenuContent+="<a onclick=\"$('#"+$.fn.jexcel.current+"').jexcel('insertRow', 1, "+n[1]+')">Insert a new row<span></span></a><hr>'),1==$.fn.jexcel.defaults[$.fn.jexcel.current].allowDeleteRow&&(contextMenuContent+="<a onclick=\"$('#"+$.fn.jexcel.current+"').jexcel('deleteRow',"+n[1]+')">Delete this row<span></span></a><hr>'),contextMenuContent+="<a onclick=\"$('#"+$.fn.jexcel.current+"').jexcel('download')\">Save as...<span>Ctrl + S</span></a>",l.about&&(contextMenuContent+="<a onclick=\"alert('"+l.about+"')\">About<span></span></a>")),contextMenuContent&&($("#jexcel_contextmenu").html(contextMenuContent),$("#jexcel_contextmenu").css({display:"block",top:e.pageY+"px",left:e.pageX+"px"}),e.preventDefault()))}}}),$(document).on("mousewheel",function(e){$(".jexcel_contextmenu").css("display","none")}),$(document).on("mousedown touchstart",function(e){if("corner"==e.target.id)1==$.fn.jexcel.defaults[$.fn.jexcel.current].editable&&($.fn.jexcel.selectedCorner=!0);else{var l=$(e.target).parent().parent().parent();if($(l).is(".jexcel")){var t=$(l).parent().prop("id");if($.fn.jexcel.current&&$.fn.jexcel.current!=t&&$("#"+$.fn.jexcel.current).jexcel("updateSelection"),$.fn.jexcel.current=t,$(e.target).parent().parent().is("thead")){if(a=$(e.target).prop("id")){if(a=a.split("-"),$.fn.jexcel.selectedHeader&&(e.shiftKey||e.ctrlKey))var n=$($.fn.jexcel.selectedHeader).prop("id").split("-");else{n=$(e.target).prop("id").split("-");$.fn.jexcel.selectedHeader=$(e.target),$.fn.jexcel.selectedRow=null}if($(e.target).outerWidth()-e.offsetX<8)1==$.fn.jexcel.defaults[$.fn.jexcel.current].columnResize&&($.fn.jexcel.resizeColumn={mousePosition:e.pageX,column:a[1],width:parseInt($(e.target).css("width"))},$(l).parent().find(".c"+a[1]).addClass("resizing"),$(l).parent().find("#col-"+a[1]).addClass("resizing"),$("#"+$.fn.jexcel.current).jexcel("updateSelection"),$(".jexcel_corner").css("left","-200px"));else{var c=$("#"+$.fn.jexcel.current).find("#"+a[1]+"-0"),s=$("#"+$.fn.jexcel.current).find("#"+n[1]+"-"+parseInt($.fn.jexcel.defaults[$.fn.jexcel.current].data.length-1));$("#"+$.fn.jexcel.current).jexcel("updateSelection",c,s,!1,1),$.fn.jexcel.selectedCell=$(c)}}}else $.fn.jexcel.selectedHeader=!1;if($(e.target).parent().parent().is("tbody"))if($(e.target).is(".jexcel_label"))if(1==$.fn.jexcel.defaults[$.fn.jexcel.current].rowDrag&&$(e.target).outerWidth()-e.offsetX<8)$("#"+$.fn.jexcel.current).jexcel("resetSelection"),$.fn.jexcel.dragRowFrom=$(e.target).prop("id"),$.fn.jexcel.dragRowOver=$(e.target).prop("id"),$(e.target).parent().find("td").css("background-color","rgba(0,0,0,0.1)");else{var a=$(e.target).prop("id").split("-");if($.fn.jexcel.selectedRow&&(e.shiftKey||e.ctrlKey))n=$($.fn.jexcel.selectedRow).prop("id").split("-");else{n=$(e.target).prop("id").split("-");$.fn.jexcel.selectedRow=$(e.target),$.fn.jexcel.selectedHeader=null}c=$("#"+$.fn.jexcel.current).find("#0-"+a[1]),s=$("#"+$.fn.jexcel.current).find("#"+parseInt($.fn.jexcel.defaults[$.fn.jexcel.current].columns.length-1)+"-"+n[1]);$("#"+$.fn.jexcel.current).jexcel("updateSelection",c,s),$.fn.jexcel.selectedCell=$(s)}else $($.fn.jexcel.selectedCell).hasClass("edition")?$(e.target)!=$.fn.jexcel.selectedCell&&($.fn.jexcel.selectedCell=$(e.target),$("#"+$.fn.jexcel.current).jexcel("updateSelection",$.fn.jexcel.selectedCell,$(e.target))):($.fn.jexcel.selectedCell&&e.shiftKey||($.fn.jexcel.selectedCell=$(e.target)),$("#"+$.fn.jexcel.current).jexcel("updateSelection",$.fn.jexcel.selectedCell,$(e.target))),$.fn.jexcel.selectedRow=null}else $(e.target).parents(".jexcel").length||e.target!=$("html").get(0)&&$("#"+$.fn.jexcel.current).jexcel("resetSelection")}}),$(document).on("mouseup",function(e){if("jexcel_arrow"==e.target.id)$.fn.jexcel.current||($.fn.jexcel.current=$(e.target).parents(".jexcel").parent().prop("id")),$.fn.jexcel.selectedCell=$(e.target).parent().parent(),$("#"+$.fn.jexcel.current).jexcel("updateSelection",$.fn.jexcel.selectedCell,$.fn.jexcel.selectedCell),$("#"+$.fn.jexcel.current).jexcel("openEditor",$.fn.jexcel.selectedCell);else{3!=e.which&&$("#jexcel_contextmenu").css("display","none"),$.fn.jexcel.selectedCorner=!1,$.fn.jexcel.resizeColumn&&("function"==typeof $.fn.jexcel.defaults[$.fn.jexcel.current].onresize&&$.fn.jexcel.defaults[$.fn.jexcel.current].onresize($(this),$.fn.jexcel.resizeColumn.column,$.fn.jexcel.resizeColumn.width),$("#"+$.fn.jexcel.current).find("thead td").removeClass("resizing"),$("#"+$.fn.jexcel.current).find("tbody td").removeClass("resizing"),$.fn.jexcel.resizeColumn=null);var l=$("#"+$.fn.jexcel.current).find("tbody td.selection");if($(l).length>0){var t=$(l[0]).prop("id").split("-"),n=$(l[l.length-1]).prop("id").split("-");$("#"+$.fn.jexcel.current).jexcel("copyData",t,n),$(l).removeClass("selection selection-left selection-right selection-top selection-bottom")}}$.fn.jexcel.dragRowFrom&&($.fn.jexcel.dragRowFrom!=$.fn.jexcel.dragRowOver&&(t=$.fn.jexcel.dragRowFrom.split("-"),n=$.fn.jexcel.dragRowOver.split("-"),$.fn.jexcel.defaults[$.fn.jexcel.current].data.splice(n[1],0,$.fn.jexcel.defaults[$.fn.jexcel.current].data.splice(t[1],1)[0]),$("#"+$.fn.jexcel.current).jexcel("setData",null,!0),"function"==typeof $.fn.jexcel.defaults[$.fn.jexcel.current].onmoverow&&$.fn.jexcel.defaults[$.fn.jexcel.current].onmoverow($(this),$.fn.jexcel.dragRowFrom,$.fn.jexcel.dragRowOver)),$("#"+$.fn.jexcel.dragRowFrom).css("cursor",""),$("#"+$.fn.jexcel.dragRowOver).css("cursor",""),$("#"+$.fn.jexcel.current+" #"+$.fn.jexcel.dragRowOver).parent().find("td").css("background-color","")),$.fn.jexcel.dragRowFrom=null,$.fn.jexcel.dragRowOver=null}),$(document).on("dblclick touchend",function(e){if($.fn.jexcel.current){if(1==$.fn.jexcel.defaults[$.fn.jexcel.current].editable){if("corner"==e.target.id){var l=$("#"+$.fn.jexcel.current).find("tbody td.highlight");if("object"==typeof l){var t=$(l[0]).prop("id").split("-"),n=$(l[l.length-1]).prop("id").split("-");t[1]=parseInt(n[1])+1,n[1]=parseInt($.fn.jexcel.defaults[$.fn.jexcel.current].data.length),$("#"+$.fn.jexcel.current).jexcel("copyData",t,n)}}$(e.target).is(".highlight")&&$("#"+$.fn.jexcel.current).jexcel("openEditor",$(e.target))}if(1==$.fn.jexcel.defaults[$.fn.jexcel.current].columnSorting&&$(e.target).parent().parent().is("thead")){(t=$(e.target).prop("id"))&&(t=$(e.target).prop("id").split("-"),$("#"+$.fn.jexcel.current).jexcel("orderBy",t[1]))}}}),$(document).on("mousemove",function(e){if($.fn.jexcel.current){if(1==$.fn.jexcel.defaults[$.fn.jexcel.current].columnResize)if($.fn.jexcel.resizeColumn){var l=e.pageX-$.fn.jexcel.resizeColumn.mousePosition;$.fn.jexcel.resizeColumn.width+l>0&&$("#"+$.fn.jexcel.current).jexcel("setWidth",$.fn.jexcel.resizeColumn.column,$.fn.jexcel.resizeColumn.width+l)}else $(e.target).parent().parent().is("thead")&&($(e.target).outerWidth()-e.offsetX<8&&""!=$(e.target).prop("id")?$(e.target).css("cursor","col-resize"):$(e.target).css("cursor",""));1==$.fn.jexcel.defaults[$.fn.jexcel.current].rowDrag&&$(e.target).parent().parent().is("tbody")&&$(e.target).is(".jexcel_label")&&($(e.target).outerWidth()-e.offsetX<8?$(e.target).css("cursor","all-scroll"):$(e.target).css("cursor","")),$($.fn.jexcel.selectedCell).hasClass("edition")||e.preventDefault()}$.fn.jexcel.dragRowFrom?$("body").css("cursor","all-scroll"):$("body").css("cursor","")}),$(document).on("mouseover",function(e){if(!$.fn.jexcel.resizeColumn){var l=$(e.target).closest(".jexcel");if($.fn.jexcel.current==$(l).parent().prop("id")){if($(e.target).parent().parent().is("thead")&&$.fn.jexcel.selectedHeader&&e.buttons){var t=$($.fn.jexcel.selectedHeader).prop("id"),n=$(e.target).prop("id");if(t&&n){t=t.split("-"),n=n.split("-");var c=$("#"+$.fn.jexcel.current).find("#"+t[1]+"-0"),s=$("#"+$.fn.jexcel.current).find("#"+n[1]+"-"+parseInt($.fn.jexcel.defaults[$.fn.jexcel.current].data.length-1));$("#"+$.fn.jexcel.current).jexcel("updateSelection",c,s)}}if($(e.target).parent().parent().is("tbody"))if($(e.target).is(".jexcel_label"))if($.fn.jexcel.selectedRow){if(e.buttons){t=$($.fn.jexcel.selectedRow).prop("id"),n=$(e.target).prop("id");if(t&&n){t=t.split("-"),n=n.split("-");c=$("#"+$.fn.jexcel.current).find("#0-"+t[1]),s=$("#"+$.fn.jexcel.current).find("#"+parseInt($.fn.jexcel.defaults[$.fn.jexcel.current].columns.length-1)+"-"+n[1]);$("#"+$.fn.jexcel.current).jexcel("updateSelection",c,s)}}}else $.fn.jexcel.dragRowFrom&&($("#"+$.fn.jexcel.current+" #"+$.fn.jexcel.dragRowOver).parent().find("td").css("background-color",""),$(e.target).parent().find("td").css("background-color","rgba(0,0,0,0.1)"),$.fn.jexcel.dragRowOver=$(e.target).prop("id"));else $.fn.jexcel.selectedCell&&($($.fn.jexcel.selectedCell).hasClass("edition")||(1==$.fn.jexcel.selectedCorner?$("#"+$.fn.jexcel.current).jexcel("updateCornerSelection",$(e.target)):e.buttons&&$("#"+$.fn.jexcel.current).jexcel("updateSelection",$.fn.jexcel.selectedCell,$(e.target))))}}}),$(document).on("paste",function(e){$($.fn.jexcel.selectedCell).hasClass("edition")||e.originalEvent&&(1==$.fn.jexcel.defaults[$.fn.jexcel.current].editable&&$("#"+$.fn.jexcel.current).jexcel("paste",$.fn.jexcel.selectedCell,e.originalEvent.clipboardData.getData("text")),e.preventDefault())});var f=null;$(document).keydown(function(e){if($.fn.jexcel.current){var l=null;if($.fn.jexcel.selectedCell){if(columnId=$($.fn.jexcel.selectedCell).prop("id").split("-"),37==e.which)$($.fn.jexcel.selectedCell).hasClass("edition")||(l=e.ctrlKey?$($.fn.jexcel.selectedCell).parent().find("td").not(".jexcel_label").first():$($.fn.jexcel.selectedCell).prev(),e.preventDefault());else if(39==e.which)$($.fn.jexcel.selectedCell).hasClass("edition")||(l=e.ctrlKey?$($.fn.jexcel.selectedCell).parent().find("td").last():$($.fn.jexcel.selectedCell).next(),e.preventDefault());else if(38==e.which)$($.fn.jexcel.selectedCell).hasClass("edition")||(l=e.ctrlKey?$($.fn.jexcel.selectedCell).parent().parent().find("tr").first().find("#"+columnId[0]+"-0"):$($.fn.jexcel.selectedCell).parent().prev().find("#"+columnId[0]+"-"+(columnId[1]-1)),e.preventDefault());else if(40==e.which)$($.fn.jexcel.selectedCell).hasClass("edition")||(l=e.ctrlKey?$($.fn.jexcel.selectedCell).parent().parent().find("tr").last().find("#"+columnId[0]+"-"+($.fn.jexcel.defaults[$.fn.jexcel.current].data.length-1)):$($.fn.jexcel.selectedCell).parent().next().find("#"+columnId[0]+"-"+(parseInt(columnId[1])+1)),e.preventDefault());else if(27==e.which)$($.fn.jexcel.selectedCell).hasClass("edition")&&$("#"+$.fn.jexcel.current).jexcel("closeEditor",$($.fn.jexcel.selectedCell),!1);else if(13==e.which)$($.fn.jexcel.selectedCell).hasClass("edition")&&("calendar"==$.fn.jexcel.defaults[$.fn.jexcel.current].columns[columnId[0]].type?$("#"+$.fn.jexcel.current).find("editor").jcalendar("close",1):$("#"+$.fn.jexcel.current).jexcel("closeEditor",$($.fn.jexcel.selectedCell),!0)),1==$.fn.jexcel.defaults[$.fn.jexcel.current].allowInsertRow&&1==$.fn.jexcel.defaults[$.fn.jexcel.current].allowManualInsertRow&&columnId[1]==$.fn.jexcel.defaults[$.fn.jexcel.current].data.length-1&&$("#"+$.fn.jexcel.current).jexcel("insertRow"),l=$($.fn.jexcel.selectedCell).parent().next().find("#"+columnId[0]+"-"+(parseInt(columnId[1])+1)),e.preventDefault();else if(9==e.which)$($.fn.jexcel.selectedCell).hasClass("edition")&&("calendar"==$.fn.jexcel.defaults[$.fn.jexcel.current].columns[columnId[0]].type?$("#"+$.fn.jexcel.current).find("editor").jcalendar("close",1):$("#"+$.fn.jexcel.current).jexcel("closeEditor",$($.fn.jexcel.selectedCell),!0)),1==$.fn.jexcel.defaults[$.fn.jexcel.current].allowInsertColumn&&1==$.fn.jexcel.defaults[$.fn.jexcel.current].allowManualInsertColumn&&columnId[0]==$.fn.jexcel.defaults[$.fn.jexcel.current].data[0].length-1&&$("#"+$.fn.jexcel.current).jexcel("insertColumn"),$($.fn.jexcel.selectedCell).hasClass("edition")||(l=$($.fn.jexcel.selectedCell).next()),e.preventDefault();else if(46==e.which){if(1==$.fn.jexcel.defaults[$.fn.jexcel.current].editable&&!$($.fn.jexcel.selectedCell).hasClass("edition"))if($.fn.jexcel.selectedRow){if(confirm("Are you sure to delete the selected rows?")){var t=$("#"+$.fn.jexcel.current).find("tbody").find(".jexcel_label.selected");$("#"+$.fn.jexcel.current).jexcel("deleteRow",$(t[0]).prop("id").split("-")[1],t.length),$("#"+$.fn.jexcel.current).jexcel("resetSelection")}}else if($.fn.jexcel.selectedHeader){if(confirm("Are you sure to delete the selected columns?")){var n=$("#"+$.fn.jexcel.current).find("thead.jexcel_label").find(".selected");$("#"+$.fn.jexcel.current).jexcel("deleteColumn",$(n).prop("id").split("-")[1],n.length),$("#"+$.fn.jexcel.current).jexcel("resetSelection")}}else $("#"+$.fn.jexcel.current).jexcel("setValue",$("#"+$.fn.jexcel.current).find(".highlight"),"")}else if(!e.metaKey||e.shiftKey||e.ctrlKey)if(e.ctrlKey){if(!e.shiftKey&&e.ctrlKey&&!$($.fn.jexcel.selectedCell).hasClass("edition"))if(65==e.which){var c=parseInt($.fn.jexcel.defaults[$.fn.jexcel.current].columns.length-1),s=parseInt($.fn.jexcel.defaults[$.fn.jexcel.current].data.length-1),a=$("#"+$.fn.jexcel.current).find("#0-0"),r=$("#"+$.fn.jexcel.current).find("#"+c+"-"+s);$("#"+$.fn.jexcel.current).jexcel("updateSelection",a,r),e.preventDefault()}else 83==e.which?($("#"+$.fn.jexcel.current).jexcel("download"),e.preventDefault()):89==e.which?($($.fn.jexcel.selectedCell).hasClass("edition")||$("#"+$.fn.jexcel.current).jexcel("redo"),e.preventDefault()):90==e.which?($($.fn.jexcel.selectedCell).hasClass("edition")||$("#"+$.fn.jexcel.current).jexcel("undo"),e.preventDefault()):67==e.which?($("#"+$.fn.jexcel.current).jexcel("copy",!0),e.preventDefault()):88==e.which?(1==$.fn.jexcel.defaults[$.fn.jexcel.current].editable?$("#"+$.fn.jexcel.current).jexcel("cut"):$("#"+$.fn.jexcel.current).jexcel("copy",!0),e.preventDefault()):86==e.which&&window.clipboardData&&(1==$.fn.jexcel.defaults[$.fn.jexcel.current].editable&&$("#"+$.fn.jexcel.current).jexcel("paste",$.fn.jexcel.selectedCell,window.clipboardData.getData("Text")),e.preventDefault())}else $.fn.jexcel.selectedCell&&1==$.fn.jexcel.defaults[$.fn.jexcel.current].editable&&"readonly"!=$.fn.jexcel.defaults[$.fn.jexcel.current].columns[columnId[0]].type&&($($.fn.jexcel.selectedCell).hasClass("edition")||(110==e.keyCode||190==e.keyCode||e.keyCode>=48&&e.keyCode<=57||e.keyCode>=65&&e.keyCode<=90||e.keyCode>=96&&e.keyCode<=105?$("#"+$.fn.jexcel.current).jexcel("openEditor",$($.fn.jexcel.selectedCell),!0):113==e.keyCode&&$("#"+$.fn.jexcel.current).jexcel("openEditor",$($.fn.jexcel.selectedCell),!1)));else $($.fn.jexcel.selectedCell).hasClass("edition")||67==e.which&&($("#"+$.fn.jexcel.current).jexcel("copy",!0),e.preventDefault());l&&$(l).length>0&&"row"!=$(l).prop("id").substr(0,3)&&(e.shiftKey?(f||(f=$.fn.jexcel.selectedCell),a=f):(e.ctrlKey,f=null,a=l),r=l,$.fn.jexcel.selectedCell=l,$(l).focus(),$("#"+$.fn.jexcel.current).jexcel("updateSelection",a,r))}}})}$(this).jexcel("setData",$.fn.jexcel.defaults[e].data)},setData:function(e,l){var t=$(this).prop("id");e&&("string"==typeof e&&(e=JSON.parse(e)),$.fn.jexcel.defaults[t].data=e),$.fn.jexcel.defaults[t].history=[],$.fn.jexcel.defaults[t].historyIndex=-1;var n=$.fn.jexcel.defaults[t].colHeaders.length,c=$.fn.jexcel.defaults[t].data.length,s=$.fn.jexcel.defaults[t].minDimensions[0],a=$.fn.jexcel.defaults[t].minDimensions[1],r=s>n?s:n,o=a>c?a:c;for(j=0;j<o;j++)for(i=0;i<r;i++)void 0==$.fn.jexcel.defaults[t].data[j]&&($.fn.jexcel.defaults[t].data[j]=[]),void 0==$.fn.jexcel.defaults[t].data[j][i]&&($.fn.jexcel.defaults[t].data[j][i]="");$.fn.jexcel.defaults[t].dynamicColumns=[];var d=$(this).find("tbody");$(d).html("");var f=[];for(j=0;j<$.fn.jexcel.defaults[t].data.length;j++){for(tr=document.createElement("tr"),$(tr).append('<td id="row-'+j+'" class="jexcel_label">'+parseInt(j+1)+"</td>"),i=0;i<$.fn.jexcel.defaults[t].colHeaders.length;i++)td=$(this).jexcel("createCell",i,j),$(tr).append(td),f.push({cell:$(td),newValue:$.fn.jexcel.defaults[t].data[j][i],oldValue:""});$(d).append(tr)}$(this).jexcel("loadCells",f),$.fn.jexcel.defaults[t].dynamicColumns.length>0&&$(this).jexcel("formula"),l||$(this).jexcel("spareCheck"),$(this).jexcel("updateSettings"),e&&"function"==typeof $.fn.jexcel.defaults[t].onload&&$.fn.jexcel.defaults[t].onload($(this))},updateSettings:function(e){var l=$(this).prop("id");if(e||$.fn.jexcel.defaults[l].updateSettingsOptions&&(e=$.fn.jexcel.defaults[l].updateSettingsOptions),"object"==typeof e){$.fn.jexcel.defaults[l].updateSettingsOptions=e;var t=$(this).find(".jexcel tbody td").not(".jexcel_label");"function"==typeof e.cells&&$.each(t,function(t,n){l=$(n).prop("id").split("-"),e.cells($(n),l[0],l[1])})}},openEditor:function(e,l){var t=$(this).prop("id"),n=$(this),c=$.fn.jexcel.defaults[t],s=$(e).prop("id").split("-");if(1==$(e).hasClass("readonly"));else if($.fn.jexcel.edition=$(e).html(),$.fn.jexcel.editionValue=$(this).jexcel("getValue",$(e)),c.columns[s[0]].editor)$(e).addClass("edition"),c.columns[s[0]].editor.openEditor(e);else if("checkbox"==c.columns[s[0]].type||"hidden"==c.columns[s[0]].type);else if("dropdown"==c.columns[s[0]].type){if($(e).addClass("edition"),"function"==typeof c.columns[s[0]].filter)var a=c.columns[s[0]].filter($(this),$(e),s[0],s[1],c.columns[s[0]].source);else a=c.columns[s[0]].source;var r="<select>";for(i=0;i<a.length;i++)"object"==typeof a[i]?(k=a[i].id,v=a[i].name):(k=a[i],v=a[i]),r+='<option value="'+k+'">'+v+"</option>";r+="</select>";var o=$(e).find("input").val();$(e).html(r);var d=$(e).find("select");$(d).change(function(){$(n).jexcel("closeEditor",$(this).parent(),!0)}),$(d).blur(function(){$(n).jexcel("closeEditor",$(this).parent(),!0)}),$(d).focus(),o&&$(d).val(o)}else if("calendar"==c.columns[s[0]].type){$(e).addClass("edition");o=$(e).find("input").val(),d=document.createElement("input");$(d).prop("class","editor"),$(d).css("width",$(e).width()),$(d).val($(e).text()),$(e).html(d),$(e).find(""),$(e).focus(),c.columns[s[0]].options.onclose=function(){$(n).jexcel("closeEditor",$(e),!0)},$(d).jcalendar(c.columns[s[0]].options),$(d).jcalendar("open",o)}else if("multiple"==c.columns[s[0]].type){showResult=function(e,l){$(f).html(""),$.each(e,function(e,n){"object"==typeof n?(name=n.name,t=n.id):(name=n,t=n),-1!=name.toLowerCase().indexOf(l.toLowerCase())&&(li=document.createElement("li"),$(li).prop("id",t),$(li).html('<input type="checkbox"> '+name),$(li).mousedown(function(e){$(this).parent().removeClass("selected"),$(this).addClass("selected")}),$(f).append(li))}),$(f).html()||$(f).html('<div style="padding:6px;">No result found</div>'),$(f).css("display","")},$(e).addClass("edition");r=$(e).text().trim(),o=$(e).find("input").val(),a=c.columns[s[0]].source;var f=document.createElement("div");$(f).prop("class","results"),$(f).prop("tabindex",s[0]),$(f).css("width",$(e).outerWidth()),showResult(a,""),$(e).html(f),$(f).focus(),$(f).blur(function(){$(n).jexcel("closeEditor",$(e),!1)})}else if("autocomplete"==c.columns[s[0]].type){showResult=function(l,c){$(f).html(""),$.each(l,function(l,s){"object"==typeof s?(name=s.name,t=s.id):(name=s,t=s),-1!=name.toLowerCase().indexOf(c.toLowerCase())&&(li=document.createElement("li"),$(li).prop("id",t),$(li).html(name),$(li).mousedown(function(l){$(this).parent().removeClass("selected"),$(this).addClass("selected"),$(n).jexcel("closeEditor",$(e),!0)}),$(f).append(li))}),$(f).html()||$(f).html('<div style="padding:6px;">No result found</div>'),$(f).css("display","")},$(e).addClass("edition");r=$(e).text().trim(),o=$(e).find("input").val(),d=document.createElement("input");if($(d).prop("class","editor"),$(d).css("width",$(e).width()),"function"==typeof c.columns[s[0]].filter)a=c.columns[s[0]].filter($(this),$(e),s[0],s[1],c.columns[s[0]].source);else a=c.columns[s[0]].source;f=document.createElement("div");$(f).prop("class","results"),$(f).css("width",$(e).outerWidth()),showResult(a,r.trim());var u=null;$(d).on("keyup",function(e){if(38==e.which){var l=$(f).find("li.selected");$(l).length&&($(l).removeClass("selected"),$(l).prev().addClass("selected"),$(f).scrollTop($(f).scrollTop()-26))}else if(40==e.which){l=$(f).find("li.selected");$(l).length?($(l).removeClass("selected"),$(l).next().addClass("selected"),$(f).scrollTop($(f).scrollTop()+26)):(l=$(f).find("li"),$(l[0]).addClass("selected"))}else{var t=$(this).val();u&&clearTimeout(u),u=setTimeout(function(){c.columns[s[0]].url?$.getJSON(c.columns[s[0]].url+"?q="+t+"&r="+$(n).jexcel("getRowData",s[1]).join(","),function(e){showResult(e,t)}):a&&showResult(a,t)},500)}}),$(e).html(d),$(e).append(f),$(d).focus(),$(d).val(r),$(d).blur(function(){$(n).jexcel("closeEditor",$(e),!1)})}else{if($(e).addClass("edition"),1==c.wordWrap||1==c.columns[s[0]].wordWrap)var p=$(e).find("textarea");else p=$(e).find("input");if($(p).length)r=$(p).val();else r=$(e).html();if(1==c.wordWrap||1==c.columns[s[0]].wordWrap)d=document.createElement("textarea");else d=document.createElement("input");$(d).prop("class","editor"),$(d).css("width",$(e).width()),$(d).css("height",$(e).height()),$(e).html(d),c.columns[s[0]].mask&&($.fn.masked?$(d).mask(c.columns[s[0]].mask,c.columns[s[0]].options):console.error("Jexcel: it was not possible to load the mask plugin.")),$(d).focus(),l||$(d).val(r),$(d).blur(function(){$(n).jexcel("closeEditor",$(this).parent(),!0)})}},closeEditor:function(e,l){$(e).removeClass("edition");var t=$(this).prop("id"),n=$.fn.jexcel.defaults[t],c=$(e).prop("id").split("-");if(1==l){if(n.columns[c[0]].editor)s=n.columns[c[0]].editor.closeEditor(e,l);else if("checkbox"==n.columns[c[0]].type||"hidden"==n.columns[c[0]].type);else if("dropdown"==n.columns[c[0]].type)var s=$(e).find("select").val();else if("autocomplete"==n.columns[c[0]].type){var a=$(e).find("li.selected");if(a.length>0)s=$(a).prop("id");else s=""}else if("calendar"==n.columns[c[0]].type)s=$(e).find(".jcalendar_value").val();else if("numeric"==n.columns[c[0]].type){if("="!=(s=$(e).find(".editor").val()).substr(0,1))s=Number(s)||0}else s=$(e).find(".editor").val();$.fn.jexcel.defaults[t].data[c[1]][c[0]]=s,$(this).jexcel("updateCells",[{cell:$(e),newValue:s,oldValue:$.fn.jexcel.editionValue}])}else n.columns[c[0]].editor?n.columns[c[0]].editor.closeEditor(e,l):"calendar"==n.columns[c[0]].type||($(e).html($.fn.jexcel.edition),$.fn.jexcel.edition=null)},getCell:function(e){return e=$(this).jexcel("getIdFromColumnName",e),e=$(this).find("[id="+e+"]")},getValue:function(e){var l=null;if("object"!=typeof e&&(e=$(this).jexcel("getIdFromColumnName",e),e=$(this).find("[id="+e+"]")),$(e).length){var t=$(this).prop("id"),n=$.fn.jexcel.defaults[t],c=$(e).prop("id").split("-");n.columns[c[0]].editor?l=n.columns[c[0]].editor.getValue(e):"checkbox"==n.columns[c[0]].type?l=$(e).find("input").is(":checked")?"1":"0":"dropdown"==n.columns[c[0]].type||"autocomplete"==n.columns[c[0]].type||"calendar"==n.columns[c[0]].type?l=$(e).find("input").val():"currency"==n.columns[c[0]].type?l=$(e).html().replace(/\D/g,""):(l=$(e).find("input"),l=$(l).length?$(l).val():$(e).html())}return l},setValue:function(e,l){if("object"!=typeof e&&(e=$(this).jexcel("getIdFromColumnName",e),e=$(this).find("[id="+e+"]")),$(e).length){var t=$(this).prop("id"),n=$(this),c=($.fn.jexcel.defaults[t],[]);return $.each(e,function(e,t){c.push({cell:$(t),newValue:l,oldValue:$(n).jexcel("getValue",$(t))})}),$(this).jexcel("updateCells",c),!0}return!1},loadCells:function(e){var l=$(this).prop("id"),t=$(this);$.fn.jexcel.defaults[l];$.each(e,function(e,l){$(t).jexcel("updateCell",l,!0)})},updateCells:function(e,l){var t=$(this).prop("id"),n=$(this),c=$.fn.jexcel.defaults[t];$.each(e,function(e,l){"function"==typeof c.onbeforechange&&c.onbeforechange(n,$(l.cell),l.oldValue,l.newValue),$(n).jexcel("updateCell",l,!1),"function"==typeof c.onchange&&c.onchange(n,$(l.cell),l.newValue,l.oldValue)}),$(this).jexcel("afterChange"),l||$(this).jexcel("setHistory",e)},updateCell:function(e,l){var t=$(this).prop("id"),n=$.fn.jexcel.defaults[t],c=$(e.cell).prop("id").split("-");if(value=""+e.newValue,n.columns[c[0]].editor)n.columns[c[0]].editor.setValue($(e.cell),value);else if(1==$(e.cell).hasClass("readonly")&&0==l)value=null;else if("checkbox"==n.columns[c[0]].type)1==value||1==value?$(e.cell).find("input").prop("checked",!0):$(e.cell).find("input").prop("checked",!1),e.oldValue=!e.newValue;else if("dropdown"==n.columns[c[0]].type||"autocomplete"==n.columns[c[0]].type){if(key="",val="",value){var s=[],a=n.columns[c[0]].source;for(num=0;num<a.length;num++)"object"==typeof a[num]?s[a[num].id]=a[num].name:s[a[num]]=a[num];s[value]?(key=value,val=s[value]):val=null}val||(val="&nbsp"),$(e.cell).html('<input type="hidden" value="'+key+'">'+val+'<span class="jexcel_arrow"><span id="jexcel_arrow"></span></span>')}else"calendar"==n.columns[c[0]].type?(val="","undefined"!=value?val=$.fn.jcalendar("label",value,n.columns[c[0]].options.format):val="",$(e.cell).html('<input type="hidden" value="'+value+'">'+val)):"numeric"==n.columns[c[0]].type?(val=value,value&&"="==value.substr(0,1)&&-1==$.fn.jexcel.defaults[t].dynamicColumns.indexOf($(e.cell).prop("id"))&&$.fn.jexcel.defaults[t].dynamicColumns.push($(e.cell).prop("id")),$(e.cell).html('<input type="hidden" value="'+value+'">'+val)):(val=value,value&&"="==value.substr(0,1)&&-1==$.fn.jexcel.defaults[t].dynamicColumns.indexOf($(e.cell).prop("id"))&&$.fn.jexcel.defaults[t].dynamicColumns.push($(e.cell).prop("id")),$(e.cell).html(value));$.fn.jexcel.defaults[t].data[c[1]][c[0]]=value},updateSelection:function(e,l,t,n){var c=$(this),s=$(this).prop("id"),a=$(this).find("tbody td"),r=$(this).find("thead td"),o=$(this).find(".highlight").length>0,d=!1;if($(a).removeClass("highlight"),$(a).removeClass("highlight-left"),$(a).removeClass("highlight-right"),$(a).removeClass("highlight-top"),$(a).removeClass("highlight-bottom"),$(r).removeClass("selected"),$(a).removeClass("selected"),e&&l){for($(e).addClass("selected"),or=$(e).prop("id").split("-"),de=$(l).prop("id").split("-"),parseInt(or[0])<parseInt(de[0])?(px=parseInt(or[0]),ux=parseInt(de[0])):(px=parseInt(de[0]),ux=parseInt(or[0])),parseInt(or[1])<parseInt(de[1])?(py=parseInt(or[1]),uy=parseInt(de[1])):(py=parseInt(de[1]),uy=parseInt(or[1])),i=px;i<=ux;i++)for(j=py;j<=uy;j++)$(this).find("#"+i+"-"+j).addClass("highlight"),$(this).find("#"+px+"-"+j).addClass("highlight-left"),$(this).find("#"+ux+"-"+j).addClass("highlight-right"),$(this).find("#"+i+"-"+py).addClass("highlight-top"),$(this).find("#"+i+"-"+uy).addClass("highlight-bottom"),$(c).find("#col-"+i).addClass("selected"),$(c).find("#row-"+j).addClass("selected");d=!0}t||($.fn.jexcel.defaults[s].onblur&&"function"==typeof $.fn.jexcel.defaults[s].onblur&&1==o&&0==d&&$.fn.jexcel.defaults[s].onblur($(this)),$.fn.jexcel.defaults[s].onfocus&&"function"==typeof $.fn.jexcel.defaults[s].onfocus&&0==o&&1==d&&$.fn.jexcel.defaults[s].onfocus($(this)),1==d&&(t||$.fn.jexcel.defaults[s].onselection&&"function"==typeof $.fn.jexcel.defaults[s].onselection&&$.fn.jexcel.defaults[s].onselection($(this),e,l,n))),$.fn.jexcel.selection=e&&l?[e,l]:null,$(this).jexcel("updateCornerPosition")},updateCornerSelection:function(e){$(this);var l=$(this).find("tbody td");$(l).removeClass("selection"),$(l).removeClass("selection-left"),$(l).removeClass("selection-right"),$(l).removeClass("selection-top"),$(l).removeClass("selection-bottom");var t=$(this).find("tbody td.highlight"),n=$(t[0]).prop("id").split("-"),c=$(t[t.length-1]).prop("id").split("-"),s=$(e).prop("id").split("-");if(s[1]>c[1]||s[1]<n[1]){var a=parseInt(n[0]),r=parseInt(c[0]);if(parseInt(s[1])>parseInt(c[1]))var o=parseInt(c[1])+1,d=parseInt(s[1]);else o=parseInt(s[1]),d=parseInt(n[1])-1}else if(s[0]>c[0]||s[0]<n[0]){o=parseInt(n[1]),d=parseInt(c[1]);if(parseInt(s[0])>parseInt(c[0]))a=parseInt(c[0])+1,r=parseInt(s[0]);else a=parseInt(s[0]),r=parseInt(n[0])-1}for(j=o;j<=d;j++)for(i=a;i<=r;i++)$(this).find("#"+i+"-"+j).addClass("selection"),$(this).find("#"+i+"-"+o).addClass("selection-top"),$(this).find("#"+i+"-"+d).addClass("selection-bottom"),$(this).find("#"+a+"-"+j).addClass("selection-left"),$(this).find("#"+r+"-"+j).addClass("selection-right")},updateCornerPosition:function(){var e=$(this).find(".highlight");if($(e).length){corner=$(e).last();var l=parseInt($(corner).offset().top)+$(corner).parent().outerHeight()-4,t=parseInt($(corner).offset().left)+$(corner).outerWidth()-4;$(".jexcel_corner").css("top",l),$(".jexcel_corner").css("left",t)}},getRowData:function(e){var l=[];if((e=$(this).find("#row-"+e).parent().find("td").not(":first")).length>0)for(i=0;i<e.length;i++)l.push($(this).jexcel("getValue",$(e)[i]));return l},getData:function(e){var l=[],t=0,n=0,c=$(this).find("thead tr td").not(":first").length,s=$(this).find("tbody tr").length;for(j=0;j<s;j++){for(t=0,i=0;i<c;i++)cell=$(this).find("#"+i+"-"+j),e&&!$(cell).hasClass("highlight")||(l[n]||(l[n]=[]),l[n][t]=$(this).jexcel("getValue",$(cell)),t++);t>0&&n++}return l},copy:function(e,l,t){l||(l="\t");var n="",c="",s="",a=!1,r=!1,o=$(this).find("thead tr td").not(":first").length,d=$(this).find("tbody tr").length;for(j=0;j<d;j++){for(c="",a=!1,i=0;i<o;i++)cell=$(this).find("#"+i+"-"+j),e&&!$(cell).hasClass("highlight")||(a&&(c+=l),((s=$(this).jexcel("getValue",$(cell))).match(/,/g)||s.match(/\n/))&&(s='"'+s+'"'),c+=s,a=!0);c&&(r&&(n+="\n"),n+=c,r=!0)}return t||(txt=$(".jexcel_textarea"),$(txt).val(n),$(txt).select(),document.execCommand("copy")),n},cut:function(){$(this);$(this).jexcel("copy",!0);var e=$(this).find(".highlight");$(this).jexcel("setValue",e,"")},paste:function(e,l){var t=$(this).prop("id");l=$(this).jexcel("parseCSV",l,"\t");var n=$(e).prop("id");if(n){n=n.split("-");var c=parseInt(n[0]),s=parseInt(n[1]);s+l.length>$.fn.jexcel.defaults[t].data.length&&$(this).jexcel("insertRow",s+l.length-$.fn.jexcel.defaults[t].data.length),l[0]&&(row=l[0],c+row.length>$.fn.jexcel.defaults[t].data[s].length&&$(this).jexcel("insertColumn",c+row.length-$.fn.jexcel.defaults[t].data[s].length));var a=[];for(j=0;j<l.length;j++)for(row=l[j],i=0;i<row.length;i++)e=$(this).find("#"+(parseInt(i)+parseInt(c))+"-"+(parseInt(j)+parseInt(s))),$(e).length>0&&a.push({cell:$(e),newValue:row[i],oldValue:$(this).jexcel("getValue",$(e))});a.length>0&&$(this).jexcel("updateCells",a)}},parseCSV:function(e,l){l=l||",";for(var t=new RegExp("(\\"+l+'|\\r?\\n|\\r|^)(?:"([^"]*(?:""[^"]*)*)"|([^"\\'+l+"\\r\\n]*))","gi"),n=[[]],c=!1;c=t.exec(e);){var s=c[1];s.length&&s!==l&&n.push([]);var a;a=c[2]?c[2].replace(new RegExp('""',"g"),'"'):c[3],n[n.length-1].push(a)}return n},insertColumn:function(e,l,t,n){var c=$(this),s=$(this).prop("id");e||(e=1);l=$.extend({column:{type:"text"},width:"50",align:"center"},l);var a=$.fn.jexcel.defaults[s],r=[];if(1==a.allowInsertColumn){var o=a.colHeaders.length;for(i=o;i<o+e;i++){a.colHeaders[i]=l.header||$.fn.jexcel("getColumnName",i),a.colWidths[i]=l.width,a.colAlignments[i]=l.align,a.columns[i]=l.column,a.columns[i].source||($.fn.jexcel.defaults[s].columns[i].source=[]),a.columns[i].options||($.fn.jexcel.defaults[s].columns[i].options=[]),width=a.colWidths[i],align=a.colAlignments[i],header=a.colHeaders[i];var d='<td id="col-'+i+'" width="'+width+'" align="'+align+'">'+header+"</td>",f=$(this).find("thead.jexcel_label tr")[0];$(f).append(d),f=$(this).find("table > tbody > tr"),$.each(f,function(e,l){a.data[e][i]="",d=$(c).jexcel("createCell",i,e),$(l).append(d),r.push({cell:$(d),newValue:"",oldValue:""})})}$(this).jexcel("loadCells",r,!0),n||"function"==typeof a.oninsertcolumn&&a.oninsertcolumn($(this)),$(this).jexcel("afterChange")}},insertRow:function(e,l,t){var n=$(this).prop("id"),c=$.fn.jexcel.defaults[n],s=[];if(1==c.allowInsertRow){for(e||(e=1),j=parseInt($.fn.jexcel.defaults[n].data.length),row=0;row<e;row++){for(tr=document.createElement("tr"),$(tr).append('<td id="row-'+j+'" class="jexcel_label">'+parseInt(j+1)+"</td>"),$.fn.jexcel.defaults[n].data[j]=[],i=0;i<$.fn.jexcel.defaults[n].colHeaders.length;i++)$.fn.jexcel.defaults[n].data[j][i]="",td=$(this).jexcel("createCell",i,j),$(tr).append(td),s.push({cell:$(td),newValue:"",oldValue:""});$(this).find("tbody").append(tr),j++}$(this).jexcel("loadCells",s,!0),t||"function"==typeof c.oninsertrow&&c.oninsertrow($(this)),$(this).jexcel("afterChange")}},deleteRow:function(e,l){var t=$(this).prop("id");parseInt(l)||(l=1);var n=$.fn.jexcel.defaults[t];1==n.allowDeleteRow&&(n.data.length>1?(parseInt(e)>-1&&($.fn.jexcel.defaults[t].data.splice(parseInt(e),l),$(this).jexcel("setData")),"function"==typeof n.ondeleterow&&n.ondeleterow($(this)),$(this).jexcel("afterChange")):console.error("It is not possible to delete the last row"))},deleteColumn:function(e,l){var t=$(this).prop("id");parseInt(l)||(l=1);var n=$.fn.jexcel.defaults[t];if(1==n.allowDeleteColumn)if(n.data[0].length>1){if(parseInt(e)>-1){for(n.columns.splice(parseInt(e),l),n.colHeaders.splice(parseInt(e),l),n.colAlignments.splice(parseInt(e),l),n.colWidths.splice(parseInt(e),l),j=0;j<$.fn.jexcel.defaults[t].data.length;j++)n.data[j].splice(parseInt(e),l);$(this).find(".c"+parseInt(e)).remove(),$(this).find("#col-"+parseInt(e)).remove(),$(this).jexcel("resetHeaders"),$(this).jexcel("setData")}"function"==typeof n.ondeletecolumn&&n.ondeletecolumn($(this)),$(this).jexcel("afterChange")}else console.error("It is not possible to delete the last column")},setWidth:function(e,l){if(l>0){"object"==typeof e&&(e=(e=$(e).prop("id").split("-"))[0]);var t=$(this).find("thead #col-"+e);t.length&&$(t).prop("width",l)}},getWidth:function(e){"object"==typeof e&&(e=(e=$(e).prop("id").split("-"))[0]);var l=$(this).find("thead #col-"+e);if(l.length)return $(l).prop("width")},getHeader:function(e){var l=$(this).find("thead #col-"+e);if(l.length)return $(l).html()},setHeader:function(e,l){if(l){var t=$(this).find("thead #col-"+e);t.length&&$(t).html(l)}},resetHeaders:function(){var e=$(this).prop("id"),l=$.fn.jexcel.defaults[e],t='<td width="30" class="jexcel_label"></td>';for(i=0;i<l.colHeaders.length;i++)width=l.colWidths[i],align=l.colAlignments[i],header=l.colHeaders[i],"hidden"==l.columns[i].type?t+='<td id="col-'+i+'" style="display:none;">'+l.colHeaders[i]+"</td>":t+='<td id="col-'+i+'" width="'+width+'" align="'+align+'">'+header+"</td>";$(this).find("thead.jexcel_label").html("<tr>"+t+"</tr>")},setSource:function(e,l){"object"==typeof e&&(e=(e=$(e).prop("id").split("-"))[0]);var t=$(this).prop("id");$.fn.jexcel.defaults[t].columns[e].source=l},afterChange:function(e){var l=$(this).prop("id");$.fn.jexcel.defaults[l].dynamicColumns.length>0&&$(this).jexcel("formula"),"function"==typeof $.fn.jexcel.defaults[l].onafterchange&&$.fn.jexcel.defaults[l].onafterchange($(this)),e||$(this).jexcel("spareCheck"),$(this).jexcel("updateCornerPosition"),$(this).jexcel("updateSettings")},copyData:function(e,l){var t=$(this).jexcel("getData",!0),n=parseInt(e[0]),c=parseInt(l[0]),s=parseInt(e[1]),a=parseInt(l[1]),r=[],o=0,d=0;for(j=s;j<=a;j++){for(void 0==t[d]&&(d=0),o=0,i=n;i<=c;i++)void 0==t[d]?o=0:void 0==t[d][o]&&(o=0),cell=$(this).find("#"+i+"-"+j),$(cell).length&&!$(cell).hasClass("readonly")&&r.push({cell:$(cell),newValue:t[d][o],oldValue:$(this).jexcel("getValue",$(cell))}),o++;d++}r.length>0&&$(this).jexcel("updateCells",r)},orderBy:function(e,l){if(e>=0){var t=$(this).find("#col-"+e).parent();if("0"!=l&&"1"!=l){var n=$(t).find(".arrow-down");l=$(n).length>0?1:0}$(t).find(".arrow-down").remove(),$(t).find(".arrow-up").remove(),$(t).find("td").css("text-decoration","none"),1==l?$(t).find("#col-"+e).append('<span class="arrow-up"></span>').css("text-decoration","underline"):$(t).find("#col-"+e).append('<span class="arrow-down"></span>').css("text-decoration","underline"),$(".jexcel_corner").css("top","-200px"),$(".jexcel_corner").css("left","-200px");var c=$(this).prop("id"),s=$.fn.jexcel.defaults[c];return Array.prototype.sortBy=function(e,l){return this.slice(0).sort(function(t,n){var c=t[e],a=n[e];switch(s.columns[e].type){case"numeric":c=Number(c),a=Number(a)}return l?c>a?-1:c<a?1:0:c>a?1:c<a?-1:0})},s.data=s.data.sortBy(e,l),$(this).jexcel("setData",null,!0),"function"==typeof $.fn.jexcel.defaults[c].onsort&&$.fn.jexcel.defaults[c].onsort($(this),e,l),!0}},formula:function(){var main=$(this),id=$(this).prop("id");if($.fn.jexcel.defaults[id].formulas){var formulas=$.fn.jexcel.defaults[id].formulas;$.fn.jexcel.defaults[id].formulas.instance=this}var columns=$.fn.jexcel.defaults[id].dynamicColumns,variables=$(this).find(".jexcel tbody td").not(".jexcel_label");$.each(variables,function(e,l){i=$(main).jexcel("getColumnNameFromId",$(l).prop("id")),l=$(main).jexcel("getValue",$(l)),console.log(l),console.log(Number(l)),l==Number(l)?window[i]=Number(l):window[i]=l}),"object"==typeof excelFormulaUtilities?$.each(columns,function(k,column){formula=$(main).jexcel("getValue",column),formula&&"="==formula.substr(0,1)?(value=excelFormulaUtilities.formula2JavaScript(formula),value=eval(value),null===value||isNaN(value)?($(main).find("#"+column).addClass("error"),value='<input type="hidden" value="'+formula+'">#ERROR',$(main).find("#"+column).html(value)):(i=$(main).jexcel("getColumnNameFromId",column),window[i]=value,$(main).find("#"+column).removeClass("error"),value='<input type="hidden" value="'+formula+'">'+value,$(main).find("#"+column).html(value))):($(main).find("#"+column).removeClass("error"),columns.splice(k,1))}):console.error("excelFormulaUtilities lib not included")},helper:function(e){var l=[];if("object"==typeof e&&"createEmptyData"==e.action){var t=e.cols||10,n=e.rows||100;for(j=0;j<n;j++)for(l[j]=[],i=0;i<t;i++)l[j][i]=""}return l},download:function(){var e=$(this).prop("id"),l=$.fn.jexcel.defaults[e],t="";1==l.csvHeaders&&(t=l.colHeaders.join()+"\n"),t+=$(this).jexcel("copy",!1,",",!0);var n=document.createElement("a"),c=new Blob([t],{type:"text/csv;charset=utf-8;"}),s=URL.createObjectURL(c);n.href=s,n.setAttribute("download","jexcelTable.csv"),n.click()},setHistory:function(e){$(this);var l=$(this).prop("id"),t=++$.fn.jexcel.defaults[l].historyIndex;($.fn.jexcel.defaults[l].history=$.fn.jexcel.defaults[l].history.slice(0,t+1))[t]={firstSelected:e[0].cell,lastSelected:e[e.length-1].cell,cellChanges:e}},undo:function(){var e=$(this).prop("id"),l=[];if($.fn.jexcel.defaults[e].historyIndex>=0){for(var t=$.fn.jexcel.defaults[e].history[$.fn.jexcel.defaults[e].historyIndex--],n=0;n<t.cellChanges.length;n++)l.push({cell:$(t.cellChanges[n].cell),newValue:t.cellChanges[n].oldValue,oldValue:t.cellChanges[n].newValue});$(this).jexcel("updateCells",l,!0),$(this).jexcel("updateSelection",t.firstSelected,t.lastSelected)}},redo:function(){var e=$(this).prop("id");if($.fn.jexcel.defaults[e].historyIndex<$.fn.jexcel.defaults[e].history.length-1){var l=$.fn.jexcel.defaults[e].history[++$.fn.jexcel.defaults[e].historyIndex];$(this).jexcel("updateCells",l.cellChanges,!0),$(this).jexcel("updateSelection",l.firstSelected,l.lastSelected)}},createCell:function(e,l){var t=$(this).prop("id"),n=$.fn.jexcel.defaults[t];return align=n.colAlignments[e],width=n.colWidths[e],td=document.createElement("td"),$(td).prop("width",width),$(td).prop("align",align),$(td).prop("id",e+"-"+l),$(td).addClass("c"+e),$(td).addClass("r"+l),"hidden"==n.columns[e].type?$(td).css("display","none"):"checkbox"==n.columns[e].type&&(1==n.columns[e].readOnly?$(td).html('<input type="checkbox" disabled="disabled">'):$(td).html("<input type=\"checkbox\" onclick=\"var instance = $(this).parents('.jexcel').parent(); $(instance).jexcel('setValue', $(this).parent(), $(this).prop('checked') ? 1 : 0);\">")),1==n.columns[e].readOnly&&$(td).addClass("readonly","readonly"),1!=n.wordWrap&&1!=n.columns[e].wordWrap||$(td).css("white-space","pre"),n.columns[e].cssClass&&$(td).addClass(n.columns[e].cssClass),$(td)},resetSelection:function(){$.fn.jexcel.current&&$("#"+$.fn.jexcel.current).jexcel("updateSelection"),$(".jexcel_corner").css("left","-200px"),$.fn.jexcel.selectedRow=null,$.fn.jexcel.selectedCell=null,$.fn.jexcel.selectedHeader=null},spareCheck:function(){var e=$(this).prop("id"),l=!1;if($.fn.jexcel.defaults[e].minSpareCols>0){for(lastCol=$.fn.jexcel.defaults[e].data[0]?$.fn.jexcel.defaults[e].data[0].length:0,lastRow=$.fn.jexcel.defaults[e].data.length,checkPoint=lastCol-$.fn.jexcel.defaults[e].minSpareCols,checkPoint<0&&(checkPoint=0),l=!1,rowNumber=0;rowNumber<lastRow;rowNumber++)for(colNumber=checkPoint;colNumber<lastCol;colNumber++)$.fn.jexcel.defaults[e].data[rowNumber][colNumber]&&(l=!0);l&&$(this).jexcel("insertColumn",$.fn.jexcel.defaults[e].minSpareCols)}if($.fn.jexcel.defaults[e].minSpareRows>0){for(lastCol=$.fn.jexcel.defaults[e].data[0]?$.fn.jexcel.defaults[e].data[0].length:0,lastRow=$.fn.jexcel.defaults[e].data.length,checkPoint=lastRow-$.fn.jexcel.defaults[e].minSpareRows,checkPoint<0&&(checkPoint=0),l=!1,rowNumber=checkPoint;rowNumber<lastRow;rowNumber++)for(colNumber=0;colNumber<lastCol;colNumber++)$.fn.jexcel.defaults[e].data[rowNumber][colNumber]&&(l=!0);l&&$(this).jexcel("insertRow",$.fn.jexcel.defaults[e].minSpareCols)}},getColumnName:function(e){var l="";return e>701?(l+=String.fromCharCode(64+parseInt(e/676)),l+=String.fromCharCode(64+parseInt(e%676/26))):e>25&&(l+=String.fromCharCode(64+parseInt(e/26))),l+=String.fromCharCode(65+e%26)},getIdFromColumnName:function(e){var l=/^[a-zA-Z]+/.exec(e);if(l){for(var t=0,n=0;n<l[0].length;n++)t+=parseInt(l[0].charCodeAt(n)-65)+26*n;e=t+"-"+(parseInt(/[0-9]+$/.exec(e))-1)}return e},getColumnNameFromId:function(e){var l=e.split("-");return $.fn.jexcel("getColumnName",l[0])+(parseInt(l[1])+1)}};$.fn.jexcel=function(e){return methods[e]?methods[e].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof e&&e?void $.error("Method "+e+" does not exist on jQuery.tooltip"):methods.init.apply(this,arguments)}}(jQuery);