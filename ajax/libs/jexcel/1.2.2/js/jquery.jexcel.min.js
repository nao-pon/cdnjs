!function($){var methods={init:function(e){var t={colHeaders:[],colWidths:[],colAlignments:[],columns:[],minSpareRows:0,minSpareCols:0,minDimensions:[0,0],contextMenu:null,columnSorting:!0,columnResize:!0,rowDrag:!0,editable:!0,allowInsertRow:!0,allowInsertColumn:!0,allowDeleteRow:!0,allowDeleteColumn:!0,about:"jExcel Spreadsheet\\nVersion 1.2.1\\nAuthor: Paul Hodel <paul.hodel@gmail.com>\\nWebsite: http://bossanova.uk/jexcel"};void 0!=(e=$.extend(t,e)).manualColumnResize&&(e.columnResize=e.manualColumnResize),void 0!=e.manualRowMove&&(e.rowDrag=e.manualRowMove);var l=$(this).prop("id"),n=$(this);prepareTable=function(){$.fn.jexcel.defaults||($.fn.jexcel.defaults=new Array),$.fn.jexcel.defaults[l]=e,$.fn.jexcel.defaults[l].history=[],$.fn.jexcel.defaults[l].historyIndex=-1;var t=[];for(e.data||(e.data=[]),$.fn.jexcel.defaults[l].data.length||($.fn.jexcel.defaults[l].data=[[]]),size=e.colHeaders.length,e.data[0].length>size&&(size=e.data[0].length),$.fn.jexcel.defaults[l].minDimensions[0]>size&&(size=$.fn.jexcel.defaults[l].minDimensions[0]),i=0;i<size;i++)e.colHeaders[i]||(e.colHeaders[i]=$.fn.jexcel("getColumnName",i)),e.columns[i]?e.columns[i]||(e.columns[i].type="text"):e.columns[i]={type:"text"},e.columns[i].source||($.fn.jexcel.defaults[l].columns[i].source=[]),e.columns[i].options||($.fn.jexcel.defaults[l].columns[i].options=[]),e.columns[i].editor||(e.columns[i].editor=null),e.colAlignments[i]||(e.colAlignments[i]="center"),e.colWidths[i]||(e.colWidths[i]="50"),"autocomplete"==e.columns[i].type||"dropdown"==e.columns[i].type?e.columns[i].url&&t.push($.ajax({url:e.columns[i].url,index:i,dataType:"json",success:function(e){$.fn.jexcel.defaults[l].columns[this.index].source=e}})):"calendar"==e.columns[i].type&&($.fn.jexcel.defaults[l].columns[i].options.format||($.fn.jexcel.defaults[l].columns[i].options.format="DD/MM/YYYY"));t.length>0?$.when.apply(this,t).done(function(){$(n).jexcel("createTable")}):$(n).jexcel("createTable")},e.csv?$.csv?(e.delimiter=e.delimiter||",",$.ajax({url:e.csv,success:function(t){var l=$.csv.toArrays(t);1==e.csvHeaders&&(e.colHeaders=l.shift()),e.data=l,prepareTable()}})):console.error("Jexcel error: jquery-csv library not loaded"):e.url?$.ajax({url:e.url,dataType:"json",success:function(t){e.data=t.data?t.data:t,prepareTable()}}):prepareTable()},createTable:function(){var e=$(this).prop("id"),l=$.fn.jexcel.defaults[e],n=document.createElement("table");$(n).prop("class","jexcel bossanova-ui"),$(n).prop("cellpadding","0"),$(n).prop("cellspacing","0"),$(n).prop("unselectable","yes"),$(n).prop("onselectstart","return false"),$(n).prop("draggable","false");var c=document.createElement("thead"),r=document.createElement("tbody");$(c).prop("class","jexcel_label");var s='<td width="30" class="jexcel_label"></td>';for(i=0;i<l.colHeaders.length;i++)width=l.colWidths[i],align=l.colAlignments[i],header=l.colHeaders[i],"hidden"==l.columns[i].type?s+='<td id="col-'+i+'" style="display:none;">'+l.colHeaders[i]+"</td>":s+='<td id="col-'+i+'" width="'+width+'" align="'+align+'">'+header+"</td>";if($(c).html("<tr>"+s+"</tr>"),$(n).append(c),$(n).append(r),$(n).on("dragstart",function(){return!1}),$(this).html(n),!$(".jexcel_corner").length){var a=document.createElement("div");$(a).prop("class","jexcel_corner"),$(a).prop("id","corner");var d=document.createElement("textarea");$(d).prop("class","jexcel_textarea"),$(d).prop("id","textarea");var f=document.createElement("div");$(f).css("display","none"),$(f).prop("class","jexcel_contextmenu"),$(f).prop("id","jexcel_contextmenu");var u=document.createElement("div");$(u).css("display","none"),$(u).html('<a href="http://github.com/paulhodel/jexcel">jExcel Spreadsheet</a>'),$("body").append(a),$("body").append(d),$("body").append(f),$("body").append(u),$(a).on("dragstart",function(){return!1}),$.fn.jexcel.selectedCorner=!1,$.fn.jexcel.selectedHeader=null,$.fn.jexcel.resizeColumn=null,$(document).on("contextmenu",function(e){var t=$(e.target).parent().parent().parent();if($(t).is(".jexcel")){var n=$(e.target).prop("id");n&&(n=n.split("-"),contextMenuContent="","function"==typeof l.contextMenu?contextMenuContent=l.contextMenu(n[0],n[1]):$(e.target).parent().parent().is("thead")?(contextMenuContent+="<a onclick=\"$('#"+$.fn.jexcel.current+"').jexcel('orderBy', "+n[1]+', 0)">Order ascending <span></span></a>',contextMenuContent+="<a onclick=\"$('#"+$.fn.jexcel.current+"').jexcel('orderBy', "+n[1]+', 1)">Order descending <span></span></a><hr>',1==$.fn.jexcel.defaults[$.fn.jexcel.current].allowInsertColumn&&(contextMenuContent+="<a onclick=\"$('#"+$.fn.jexcel.current+"').jexcel('insertColumn', 1, null, "+n[1]+')">Insert a new column<span></span></a>'),1==$.fn.jexcel.defaults[$.fn.jexcel.current].allowInsertRow&&(contextMenuContent+="<a onclick=\"$('#"+$.fn.jexcel.current+"').jexcel('insertRow', 1, "+n[1]+')">Insert a new row<span></span></a><hr>'),$.fn.jexcel.defaults[$.fn.jexcel.current].allowDeleteColumn,contextMenuContent+="<a onclick=\"$('#"+$.fn.jexcel.current+"').jexcel('download')\">Save as...<span>Ctrl + S</span></a>",contextMenuContent+="<a onclick=\"alert('"+l.about+"')\">About<span></span></a>"):$(e.target).parent().parent().is("tbody")&&(1==$.fn.jexcel.defaults[$.fn.jexcel.current].allowInsertColumn&&(contextMenuContent+="<a onclick=\"$('#"+$.fn.jexcel.current+"').jexcel('insertColumn', 1, null, "+n[1]+')">Insert a new column<span></span></a>'),1==$.fn.jexcel.defaults[$.fn.jexcel.current].allowInsertRow&&(contextMenuContent+="<a onclick=\"$('#"+$.fn.jexcel.current+"').jexcel('insertRow', 1, "+n[1]+')">Insert a new row<span></span></a><hr>'),1==$.fn.jexcel.defaults[$.fn.jexcel.current].allowDeleteRow&&(contextMenuContent+="<a onclick=\"$('#"+$.fn.jexcel.current+"').jexcel('deleteRow',"+n[1]+')">Delete this row<span></span></a><hr>'),contextMenuContent+="<a onclick=\"$('#"+$.fn.jexcel.current+"').jexcel('download')\">Save as...<span>Ctrl + S</span></a>",contextMenuContent+="<a onclick=\"alert('"+l.about+"')\">About<span></span></a>"),contextMenuContent&&($("#jexcel_contextmenu").html(contextMenuContent),$("#jexcel_contextmenu").css({display:"block",top:event.pageY+"px",left:event.pageX+"px"}),e.preventDefault()))}}),$(document).on("mousewheel",function(e){$(".jexcel_contextmenu").css("display","none")}),$(document).on("mousedown",function(e){if("corner"==e.target.id)1==$.fn.jexcel.defaults[$.fn.jexcel.current].editable&&($.fn.jexcel.selectedCorner=!0);else{var t=$(e.target).parent().parent().parent();if($(t).is(".jexcel")){var l=$(t).parent().prop("id");if($.fn.jexcel.current&&$.fn.jexcel.current!=l&&$("#"+$.fn.jexcel.current).find("td").removeClass("selected highlight highlight-top highlight-left highlight-right highlight-bottom"),$.fn.jexcel.current=l,$(e.target).parent().parent().is("thead")){if(r=$(e.target).prop("id")){if(r=r.split("-"),$.fn.jexcel.selectedHeader&&(e.shiftKey||e.ctrlKey))s=$($.fn.jexcel.selectedHeader).prop("id").split("-");else{s=$(e.target).prop("id").split("-");$.fn.jexcel.selectedHeader=$(e.target)}if($(e.target).outerWidth()-e.offsetX<8)1==$.fn.jexcel.defaults[$.fn.jexcel.current].columnResize&&($.fn.jexcel.resizeColumn={mousePosition:e.pageX,column:r[1],width:parseInt($(e.target).css("width"))},$(t).parent().find(".c"+r[1]).addClass("resizing"),$(t).parent().find("#col-"+r[1]).addClass("resizing"),$("#"+$.fn.jexcel.current).jexcel("updateSelection"),$(".jexcel_corner").css("left","-200px"));else{var n=$("#"+$.fn.jexcel.current).find("#"+r[1]+"-0"),c=$("#"+$.fn.jexcel.current).find("#"+s[1]+"-"+parseInt($.fn.jexcel.defaults[$.fn.jexcel.current].data.length-1));$("#"+$.fn.jexcel.current).jexcel("updateSelection",n,c,!1,1)}}}else $.fn.jexcel.selectedHeader=!1;if($(e.target).parent().parent().is("tbody"))if($(e.target).is(".jexcel_label"))if(1==$.fn.jexcel.defaults[$.fn.jexcel.current].rowDrag&&$(e.target).outerWidth()-e.offsetX<8)$("#"+$.fn.jexcel.current).find("td").removeClass("selected highlight highlight-top highlight-left highlight-right highlight-bottom"),$(a).css("top","-200px"),$(a).css("left","-200px"),$.fn.jexcel.selectedRow=null,$.fn.jexcel.selectedCell=null,$.fn.jexcel.selectedHeader=null,$.fn.jexcel.dragRowFrom=$(e.target).prop("id"),$.fn.jexcel.dragRowOver=$(e.target).prop("id"),$(e.target).parent().find("td").css("background-color","rgba(0,0,0,0.1)");else{var r=$(e.target).prop("id").split("-");if($.fn.jexcel.selectedRow&&(e.shiftKey||e.ctrlKey))s=$($.fn.jexcel.selectedRow).prop("id").split("-");else{var s=$(e.target).prop("id").split("-");$.fn.jexcel.selectedRow=$(e.target)}var n=$("#"+$.fn.jexcel.current).find("#0-"+r[1]),c=$("#"+$.fn.jexcel.current).find("#"+parseInt($.fn.jexcel.defaults[$.fn.jexcel.current].columns.length-1)+"-"+s[1]);$("#"+$.fn.jexcel.current).jexcel("updateSelection",n,c)}else $($.fn.jexcel.selectedCell).hasClass("edition")?$(e.target)!=$.fn.jexcel.selectedCell&&($.fn.jexcel.selectedCell=$(e.target),$("#"+$.fn.jexcel.current).jexcel("updateSelection",$.fn.jexcel.selectedCell,$(e.target))):($.fn.jexcel.selectedCell&&e.shiftKey||($.fn.jexcel.selectedCell=$(e.target)),$("#"+$.fn.jexcel.current).jexcel("updateSelection",$.fn.jexcel.selectedCell,$(e.target))),$.fn.jexcel.selectedRow=null}else $(e.target).parents(".jexcel").length||($.fn.jexcel.current&&$("#"+$.fn.jexcel.current).find("td").removeClass("selected highlight highlight-top highlight-left highlight-right highlight-bottom"),$(a).css("top","-200px"),$(a).css("left","-200px"),$.fn.jexcel.current=null,$.fn.jexcel.selectedRow=null,$.fn.jexcel.selectedCell=null,$.fn.jexcel.selectedHeader=null)}}),$(document).on("mouseup",function(t){if("jexcel_arrow"==t.target.id)$.fn.jexcel.current||($.fn.jexcel.current=$(t.target).parents(".jexcel").parent().prop("id")),$.fn.jexcel.selectedCell=$(t.target).parent().parent(),$("#"+$.fn.jexcel.current).jexcel("updateSelection",$.fn.jexcel.selectedCell,$.fn.jexcel.selectedCell),$("#"+$.fn.jexcel.current).jexcel("openEditor",$.fn.jexcel.selectedCell);else{$("#jexcel_contextmenu").css("display","none"),$.fn.jexcel.selectedCorner=!1,$.fn.jexcel.resizeColumn&&($("#"+$.fn.jexcel.current).find("thead td").removeClass("resizing"),$("#"+$.fn.jexcel.current).find("tbody td").removeClass("resizing"),$.fn.jexcel.resizeColumn=null);var l=$("#"+$.fn.jexcel.current).find("tbody td.selection");if($(l).length>0){var n=$(l[0]).prop("id").split("-"),c=$(l[l.length-1]).prop("id").split("-");$("#"+$.fn.jexcel.current).jexcel("copyData",n,c),$(l).removeClass("selection selection-left selection-right selection-top selection-bottom")}l=$("#"+$.fn.jexcel.current).find("tbody td.highlight"),$(l).length>0&&(n=$(l[0]),c=$(l[l.length-1]),"function"==typeof $.fn.jexcel.defaults[e].onselection&&$.fn.jexcel.defaults[e].onselection($("#"+$.fn.jexcel.current),n,c))}$.fn.jexcel.dragRowFrom&&($.fn.jexcel.dragRowFrom!=$.fn.jexcel.dragRowOver&&(n=$.fn.jexcel.dragRowFrom.split("-"),c=$.fn.jexcel.dragRowOver.split("-"),$.fn.jexcel.defaults[$.fn.jexcel.current].data.splice(c[1],0,$.fn.jexcel.defaults[$.fn.jexcel.current].data.splice(n[1],1)[0]),$("#"+$.fn.jexcel.current).jexcel("setData",$.fn.jexcel.defaults[$.fn.jexcel.current].data)),$("#"+$.fn.jexcel.dragRowFrom).css("cursor",""),$("#"+$.fn.jexcel.dragRowOver).css("cursor",""),$("#"+$.fn.jexcel.dragRowOver).parent().find("td").css("background-color","")),$.fn.jexcel.dragRowFrom=null,$.fn.jexcel.dragRowOver=null}),$(document).on("dblclick",function(e){if($.fn.jexcel.current){if(1==$.fn.jexcel.defaults[$.fn.jexcel.current].editable){if("corner"==e.target.id){var t=$("#"+$.fn.jexcel.current).find("tbody td.highlight");if("object"==typeof t){var l=$(t[0]).prop("id").split("-"),n=$(t[t.length-1]).prop("id").split("-");l[1]=parseInt(n[1])+1,n[1]=parseInt($.fn.jexcel.defaults[$.fn.jexcel.current].data.length),$("#"+$.fn.jexcel.current).jexcel("copyData",l,n)}}$(e.target).is(".highlight")&&$("#"+$.fn.jexcel.current).jexcel("openEditor",$(e.target))}1==$.fn.jexcel.defaults[$.fn.jexcel.current].columnSorting&&$(e.target).parent().parent().is("thead")&&(l=$(e.target).prop("id"))&&(l=$(e.target).prop("id").split("-"),$("#"+$.fn.jexcel.current).jexcel("orderBy",l[1]))}}),$(document).on("mousemove",function(e){if($.fn.jexcel.current){if(1==$.fn.jexcel.defaults[$.fn.jexcel.current].columnResize)if($.fn.jexcel.resizeColumn){var t=e.pageX-$.fn.jexcel.resizeColumn.mousePosition;$.fn.jexcel.resizeColumn.width+t>0&&$("#"+$.fn.jexcel.current).jexcel("setWidth",$.fn.jexcel.resizeColumn.column,$.fn.jexcel.resizeColumn.width+t)}else $(e.target).parent().parent().is("thead")&&($(e.target).outerWidth()-e.offsetX<8&&""!=$(e.target).prop("id")?$(e.target).css("cursor","col-resize"):$(e.target).css("cursor",""));1==$.fn.jexcel.defaults[$.fn.jexcel.current].rowDrag&&$(e.target).parent().parent().is("tbody")&&$(e.target).is(".jexcel_label")&&($(e.target).outerWidth()-e.offsetX<8?$(e.target).css("cursor","all-scroll"):$(e.target).css("cursor",""))}$.fn.jexcel.dragRowFrom?$("body").css("cursor","all-scroll"):$("body").css("cursor","")}),$(document).on("mouseover",function(e){if(!$.fn.jexcel.resizeColumn){var t=$(e.target).closest(".jexcel");if($.fn.jexcel.current==$(t).parent().prop("id")){if($(e.target).parent().parent().is("thead")&&$.fn.jexcel.selectedHeader&&e.buttons){var l=$($.fn.jexcel.selectedHeader).prop("id"),n=$(e.target).prop("id");if(l&&n){l=l.split("-"),n=n.split("-");var c=$("#"+$.fn.jexcel.current).find("#"+l[1]+"-0"),r=$("#"+$.fn.jexcel.current).find("#"+n[1]+"-"+parseInt($.fn.jexcel.defaults[$.fn.jexcel.current].data.length-1));$("#"+$.fn.jexcel.current).jexcel("updateSelection",c,r)}}if($(e.target).parent().parent().is("tbody"))if($(e.target).is(".jexcel_label"))if($.fn.jexcel.selectedRow){if(e.buttons){var l=$($.fn.jexcel.selectedRow).prop("id"),n=$(e.target).prop("id");if(l&&n){l=l.split("-"),n=n.split("-");var c=$("#"+$.fn.jexcel.current).find("#0-"+l[1]),r=$("#"+$.fn.jexcel.current).find("#"+parseInt($.fn.jexcel.defaults[$.fn.jexcel.current].columns.length-1)+"-"+n[1]);$("#"+$.fn.jexcel.current).jexcel("updateSelection",c,r)}}}else $.fn.jexcel.dragRowFrom&&($("#"+$.fn.jexcel.dragRowOver).parent().find("td").css("background-color",""),$(e.target).parent().find("td").css("background-color","rgba(0,0,0,0.1)"),$.fn.jexcel.dragRowOver=$(e.target).prop("id"));else $.fn.jexcel.selectedCell&&($($.fn.jexcel.selectedCell).hasClass("edition")||(1==$.fn.jexcel.selectedCorner?$("#"+$.fn.jexcel.current).jexcel("updateCornerSelection",$(e.target)):e.buttons&&$("#"+$.fn.jexcel.current).jexcel("updateSelection",$.fn.jexcel.selectedCell,$(e.target))))}}}),$(document).on("paste",function(e){e.originalEvent&&(1==$.fn.jexcel.defaults[$.fn.jexcel.current].editable&&$("#"+$.fn.jexcel.current).jexcel("paste",$.fn.jexcel.selectedCell,e.originalEvent.clipboardData.getData("text")),e.preventDefault())});var p=null;$(document).keydown(function(e){if($.fn.jexcel.current){var l=null;if($.fn.jexcel.selectedCell){if(columnId=$($.fn.jexcel.selectedCell).prop("id").split("-"),37==e.which)$($.fn.jexcel.selectedCell).hasClass("edition")||(l=e.ctrlKey?$($.fn.jexcel.selectedCell).parent().find("td").not(".jexcel_label").first():$($.fn.jexcel.selectedCell).prev(),e.preventDefault());else if(39==e.which)$($.fn.jexcel.selectedCell).hasClass("edition")||(l=e.ctrlKey?$($.fn.jexcel.selectedCell).parent().find("td").last():$($.fn.jexcel.selectedCell).next(),e.preventDefault());else if(38==e.which)$($.fn.jexcel.selectedCell).hasClass("edition")||(l=e.ctrlKey?$($.fn.jexcel.selectedCell).parent().parent().find("tr").first().find("#"+columnId[0]+"-0"):$($.fn.jexcel.selectedCell).parent().prev().find("#"+columnId[0]+"-"+(columnId[1]-1)),e.preventDefault());else if(40==e.which)$($.fn.jexcel.selectedCell).hasClass("edition")||(l=e.ctrlKey?$($.fn.jexcel.selectedCell).parent().parent().find("tr").last().find("#"+columnId[0]+"-"+($.fn.jexcel.defaults[$.fn.jexcel.current].data.length-1)):$($.fn.jexcel.selectedCell).parent().next().find("#"+columnId[0]+"-"+(parseInt(columnId[1])+1)),e.preventDefault());else if(27==e.which)$($.fn.jexcel.selectedCell).hasClass("edition")&&$("#"+$.fn.jexcel.current).jexcel("closeEditor",$($.fn.jexcel.selectedCell),!1);else if(13==e.which)$($.fn.jexcel.selectedCell).hasClass("edition")&&("calendar"==$.fn.jexcel.defaults[$.fn.jexcel.current].columns[columnId[0]].type?$("#"+$.fn.jexcel.current).find("editor").jcalendar("close",1):$("#"+$.fn.jexcel.current).jexcel("closeEditor",$($.fn.jexcel.selectedCell),!0)),1==$.fn.jexcel.defaults[$.fn.jexcel.current].allowInsertRow&&columnId[1]==$.fn.jexcel.defaults[$.fn.jexcel.current].data.length-1&&$("#"+$.fn.jexcel.current).jexcel("insertRow"),l=$($.fn.jexcel.selectedCell).parent().next().find("#"+columnId[0]+"-"+(parseInt(columnId[1])+1)),e.preventDefault();else if(9==e.which)$($.fn.jexcel.selectedCell).hasClass("edition")&&("calendar"==$.fn.jexcel.defaults[$.fn.jexcel.current].columns[columnId[0]].type?$("#"+$.fn.jexcel.current).find("editor").jcalendar("close",1):$("#"+$.fn.jexcel.current).jexcel("closeEditor",$($.fn.jexcel.selectedCell),!0)),1==$.fn.jexcel.defaults[$.fn.jexcel.current].allowInsertColumn&&columnId[0]==$.fn.jexcel.defaults[$.fn.jexcel.current].data[0].length-1&&$("#"+$.fn.jexcel.current).jexcel("insertColumn"),$($.fn.jexcel.selectedCell).hasClass("edition")||(l=$($.fn.jexcel.selectedCell).next()),e.preventDefault();else if(46==e.which){if(1==$.fn.jexcel.defaults[$.fn.jexcel.current].editable&&!$($.fn.jexcel.selectedCell).hasClass("edition")){var n=$("#"+$.fn.jexcel.current).jexcel("prepareHistoryRecords",$("#"+$.fn.jexcel.current).find(".highlight"),"");$("#"+$.fn.jexcel.current).jexcel("setHistory",n),$("#"+$.fn.jexcel.current).jexcel("setValue",$("#"+$.fn.jexcel.current).find(".highlight"),"")}}else!e.metaKey||e.shiftKey||e.ctrlKey?e.shiftKey||e.ctrlKey?!e.shiftKey&&e.ctrlKey&&(65==e.which?(t=$(this).find(".jexcel tbody td").not(".jexcel_label"),o=$(t).first(),t=$(t).last(),$("#"+$.fn.jexcel.current).jexcel("updateSelection",o,t),e.preventDefault()):83==e.which?($("#"+$.fn.jexcel.current).jexcel("download"),e.preventDefault()):89==e.which?($($.fn.jexcel.selectedCell).hasClass("edition")||$("#"+$.fn.jexcel.current).jexcel("redo"),e.preventDefault()):90==e.which?($($.fn.jexcel.selectedCell).hasClass("edition")||$("#"+$.fn.jexcel.current).jexcel("undo"),e.preventDefault()):67==e.which?($("#"+$.fn.jexcel.current).jexcel("copy",!0),e.preventDefault()):88==e.which?(1==$.fn.jexcel.defaults[$.fn.jexcel.current].editable?$("#"+$.fn.jexcel.current).jexcel("cut"):$("#"+$.fn.jexcel.current).jexcel("copy",!0),e.preventDefault()):86==e.which&&window.clipboardData&&(1==$.fn.jexcel.defaults[$.fn.jexcel.current].editable&&$("#"+$.fn.jexcel.current).jexcel("paste",$.fn.jexcel.selectedCell,window.clipboardData.getData("Text")),e.preventDefault())):$.fn.jexcel.selectedCell&&1==$.fn.jexcel.defaults[$.fn.jexcel.current].editable&&"readonly"!=$.fn.jexcel.defaults[$.fn.jexcel.current].columns[columnId[0]].type&&($($.fn.jexcel.selectedCell).hasClass("edition")||/[a-zA-Z0-9]/.test(String.fromCharCode(e.keyCode))&&$("#"+$.fn.jexcel.current).jexcel("openEditor",$($.fn.jexcel.selectedCell),!0)):67==e.which&&($("#"+$.fn.jexcel.current).jexcel("copy",!0),e.preventDefault());l&&$(l).length>0&&"row"!=$(l).prop("id").substr(0,3)&&(e.shiftKey?(p||(p=$.fn.jexcel.selectedCell),o=p):(e.ctrlKey,p=null,o=l),t=l,$.fn.jexcel.selectedCell=l,$(l).focus(),$("#"+$.fn.jexcel.current).jexcel("updateSelection",o,t))}}})}$(this).jexcel("setData")},setData:function(e){var t=$(this).prop("id");e&&("string"==typeof e&&(e=JSON.parse(e)),$.fn.jexcel.defaults[t].data=e),$.fn.jexcel.defaults[t].history=[],$.fn.jexcel.defaults[t].historyIndex=-1;var l=$.fn.jexcel.defaults[t].colHeaders.length,n=$.fn.jexcel.defaults[t].data.length,c=$.fn.jexcel.defaults[t].minDimensions[0],r=$.fn.jexcel.defaults[t].minDimensions[1],s=c>l?c:l,a=r>n?r:n;for(j=0;j<a;j++)for(i=0;i<s;i++)void 0==$.fn.jexcel.defaults[t].data[j]&&($.fn.jexcel.defaults[t].data[j]=[]),void 0==$.fn.jexcel.defaults[t].data[j][i]&&($.fn.jexcel.defaults[t].data[j][i]="");$.fn.jexcel.defaults[t].dynamicColumns=[];var o=$(this).find("tbody");for($(o).html(""),j=0;j<$.fn.jexcel.defaults[t].data.length;j++){for(tr=document.createElement("tr"),$(tr).append('<td id="row-'+j+'" class="jexcel_label">'+parseInt(j+1)+"</td>"),i=0;i<$.fn.jexcel.defaults[t].colHeaders.length;i++)td=$(this).jexcel("createCell",i,j),$(tr).append(td);$(o).append(tr)}$.fn.jexcel.defaults[t].dynamicColumns.length>0&&$(this).jexcel("formula"),"function"==typeof $.fn.jexcel.defaults[t].onload&&$.fn.jexcel.defaults[t].onload($(this))},updateSettings:function(e){var t=$(this).prop("id");if(e||$.fn.jexcel.defaults[t].updateSettingsOptions&&(e=$.fn.jexcel.defaults[t].updateSettingsOptions),"object"==typeof e){$.fn.jexcel.defaults[t].updateSettingsOptions=e;var l=$(this).find(".jexcel tbody td").not(".jexcel_label");"function"==typeof e.cells&&$.each(l,function(l,n){t=$(n).prop("id").split("-"),e.cells($(n),t[0],t[1])})}},openEditor:function(e,t){var l=$(this).prop("id"),n=$(this),c=$.fn.jexcel.defaults[l],r=$(e).prop("id").split("-");if(1==$(e).hasClass("readonly"));else if($.fn.jexcel.edition=$(e).html(),$.fn.jexcel.editionValue=$(this).jexcel("getValue",$(e)),c.columns[r[0]].editor)$(e).addClass("edition"),c.columns[r[0]].editor.openEditor(e);else if("checkbox"==c.columns[r[0]].type||"hidden"==c.columns[r[0]].type);else if("dropdown"==c.columns[r[0]].type){if($(e).addClass("edition"),"function"==typeof c.columns[r[0]].filter)s=c.columns[r[0]].filter($(this),$(e),r[0],r[1],c.columns[r[0]].source);else var s=c.columns[r[0]].source;d="<select>";for(i=0;i<s.length;i++)"object"==typeof s[i]?(k=s[i].id,v=s[i].name):(k=s[i],v=s[i]),d+='<option value="'+k+'">'+v+"</option>";d+="</select>";a=$(e).find("input").val();$(e).html(d);o=$(e).find("select");$(o).change(function(){$(n).jexcel("closeEditor",$(this).parent(),!0)}),$(o).blur(function(){$(n).jexcel("closeEditor",$(this).parent(),!0)}),$(o).focus(),a&&$(o).val(a)}else if("calendar"==c.columns[r[0]].type){$(e).addClass("edition");var a=$(e).find("input").val(),o=document.createElement("input");$(o).prop("class","editor"),$(o).css("width",$(e).width()),$(o).val($(e).text()),$(e).html(o),$(e).find(""),$(e).focus(),c.columns[r[0]].options.onclose=function(){$(n).jexcel("closeEditor",$(e),!0)},$(o).jcalendar(c.columns[r[0]].options),$(o).jcalendar("open",a)}else if("autocomplete"==c.columns[r[0]].type){$(e).addClass("edition");var d=$(e).text(),a=$(e).find("input").val(),o=document.createElement("input");$(o).prop("class","editor"),$(o).css("width",$(e).width());var f=document.createElement("div");$(f).prop("class","results"),d?$(f).html('<li id="'+a+'">'+d+"</li>"):$(f).css("display","none");var u=null;$(o).on("keyup",function(){var t=$(this).val();u&&clearTimeout(u),u=setTimeout(function(){$(f).html(""),showResult=function(t,c){$.each(t,function(t,r){"object"==typeof r?(name=r.name,l=r.id):(name=r,l=r),-1!=name.toLowerCase().indexOf(c.toLowerCase())&&(li=document.createElement("li"),$(li).prop("id",l),$(li).html(name),$(li).mousedown(function(t){$(e).html(this),$(n).jexcel("closeEditor",$(e),!0)}),$(f).append(li))}),$(f).html()||$(f).html('<div style="padding:6px;">No result found</div>'),$(f).css("display","")},c.columns[r[0]].url?$.getJSON(c.columns[r[0]].url+"?q="+t+"&r="+$(n).jexcel("getRowData",r[1]),function(e){showResult(e,t)}):c.columns[r[0]].source&&showResult(c.columns[r[0]].source,t)},500)}),$(e).html(o),$(e).append(f),$(o).focus(),$(o).val(""),$(o).blur(function(){$(n).jexcel("closeEditor",$(e),!1)})}else{$(e).addClass("edition");var p=$(e).find("input");if($(p).length)d=$(p).val();else d=$(e).html();o=document.createElement("input");$(o).prop("class","editor"),$(o).css("width",$(e).width()),$(e).html(o),c.columns[r[0]].mask&&($.fn.masked?$(o).mask(c.columns[r[0]].mask,c.columns[r[0]].options):console.error("Jexcel: it was not possible to load the mask plugin.")),$(o).focus(),t||$(o).val(d),$(o).blur(function(){$(n).jexcel("closeEditor",$(this).parent(),!0)})}},closeEditor:function(e,t){$(e).removeClass("edition");var l=$(this).prop("id"),n=$.fn.jexcel.defaults[l],c=$(e).prop("id").split("-");if(1==t){if("function"==typeof n.columns[c[0]].onbeforechange&&n.columns[c[0]].onbeforechange($(this),$(e)),n.columns[c[0]].editor)n.columns[c[0]].editor.closeEditor(e,t);else if("checkbox"==n.columns[c[0]].type||"hidden"==n.columns[c[0]].type);else if("dropdown"==n.columns[c[0]].type){r=$(e).find("select").val();(s=$(e).find("select").find("option:selected").text())||(s="&nbsp"),$(e).html('<input type="hidden" value="'+r+'">'+s+'<span class="jexcel_arrow"><span id="jexcel_arrow"></span></span>')}else if("autocomplete"==n.columns[c[0]].type)if($(e).find("li").length>0){var r=$(e).find("li").prop("id"),s=$(e).find("li").html();$(e).html('<input type="hidden" value="'+r+'">'+s)}else $(e).html("");else if("calendar"==n.columns[c[0]].type){var r=$(e).find(".jcalendar_value").val(),s=$(e).find(".jcalendar_input").val();$(e).html('<input type="hidden" value="'+r+'">'+s)}else"="==(r=$(e).find(".editor").val()).substr(0,1)&&-1==$.fn.jexcel.defaults[l].dynamicColumns.indexOf($(e).prop("id"))&&$.fn.jexcel.defaults[l].dynamicColumns.push($(e).prop("id")),$(e).html(r);var a=$(this).jexcel("prepareHistoryRecords",e,r,$.fn.jexcel.editionValue);$(this).jexcel("setHistory",a),$.fn.jexcel.defaults[l].data[c[1]][c[0]]=$(this).jexcel("getValue",$(e)),"function"==typeof n.onchange&&n.onchange($(this),$(e),r),$(this).jexcel("afterChange"),n.minSpareCols>0&&c[0]==$.fn.jexcel.defaults[l].data[0].length-1&&$("#"+$.fn.jexcel.current).jexcel("insertColumn",n.minSpareCols),n.minSpareRows>0&&c[1]==$.fn.jexcel.defaults[l].data.length-1&&$("#"+$.fn.jexcel.current).jexcel("insertRow",n.minSpareRows)}else"calendar"==n.columns[c[0]].type||($(e).html($.fn.jexcel.edition),$.fn.jexcel.edition=null)},getValue:function(e){var t=null;if("object"!=typeof e&&(e=$(this).jexcel("getIdFromColumnName",e),e=$(this).find("[id="+e+"]")),$(e).length){var l=$(this).prop("id"),n=$.fn.jexcel.defaults[l],c=$(e).prop("id").split("-");n.columns[c[0]].editor?t=n.columns[c[0]].editor.getValue(e):"checkbox"==n.columns[c[0]].type?t=$(e).find("input").is(":checked")?"1":"0":"dropdown"==n.columns[c[0]].type||"autocomplete"==n.columns[c[0]].type||"calendar"==n.columns[c[0]].type?t=$(e).find("input").val():"currency"==n.columns[c[0]].type?t=$(e).html().replace(/\D/g,""):(t=$(e).find("input"),t=$(t).length?$(t).val():$(e).html())}return t},setValue:function(e,t,l){if("object"!=typeof e&&(e=$(this).jexcel("getIdFromColumnName",e),e=$(this).find("[id="+e+"]")),$(e).length){var n=$(this).prop("id"),c=($(this),$.fn.jexcel.defaults[n]);return $.each(e,function(r,s){var a=$(s).prop("id").split("-");if(l||"function"==typeof c.columns[a[0]].onbeforechange&&c.columns[a[0]].onbeforechange($(this),$(s)),c.columns[a[0]].editor)c.columns[a[0]].editor.setValue(s,t);else if(1==$(s).hasClass("readonly"))t=null;else if("checkbox"==c.columns[a[0]].type)1==t||1==t?$(s).find("input").prop("checked",!0):$(s).find("input").prop("checked",!1);else if("dropdown"==c.columns[a[0]].type||"autocomplete"==c.columns[a[0]].type){if(key="",val="",t){var i=[],o=c.columns[a[0]].source;for(num=0;num<o.length;num++)"object"==typeof o[num]?i[o[num].id]=o[num].name:i[o[num]]=o[num];i[t]?(key=t,val=i[t]):val=null}val||(val="&nbsp"),$(s).html('<input type="hidden" value="'+key+'">'+val+'<span class="jexcel_arrow"><span id="jexcel_arrow"></span></span>')}else"calendar"==c.columns[a[0]].type?(val="",val="undefined"!=t?$.fn.jcalendar("label",t):"",$(s).html('<input type="hidden" value="'+t+'">'+val)):(t&&"="==t.substr(0,1)&&-1==$.fn.jexcel.defaults[n].dynamicColumns.indexOf($(e).prop("id"))&&$.fn.jexcel.defaults[n].dynamicColumns.push($(e).prop("id")),$(s).html(t));$.fn.jexcel.defaults[n].data[a[1]][a[0]]=t,l||"function"==typeof c.onchange&&c.onchange($(this),$(s),t)}),l||$(this).jexcel("afterChange"),!0}return!1},updateSelection:function(e,t,l,n){var c=$(this),r=$(this).prop("id"),s=$(this).find("tbody td"),a=$(this).find("thead td");if($(s).removeClass("highlight"),$(s).removeClass("highlight-left"),$(s).removeClass("highlight-right"),$(s).removeClass("highlight-top"),$(s).removeClass("highlight-bottom"),$(a).removeClass("selected"),$(s).removeClass("selected"),e&&t)for($(e).addClass("selected"),e=$(e).prop("id").split("-"),t=$(t).prop("id").split("-"),parseInt(e[0])<parseInt(t[0])?(px=parseInt(e[0]),ux=parseInt(t[0])):(px=parseInt(t[0]),ux=parseInt(e[0])),parseInt(e[1])<parseInt(t[1])?(py=parseInt(e[1]),uy=parseInt(t[1])):(py=parseInt(t[1]),uy=parseInt(e[1])),i=px;i<=ux;i++)for(j=py;j<=uy;j++)$(this).find("#"+i+"-"+j).addClass("highlight"),$(this).find("#"+px+"-"+j).addClass("highlight-left"),$(this).find("#"+ux+"-"+j).addClass("highlight-right"),$(this).find("#"+i+"-"+py).addClass("highlight-top"),$(this).find("#"+i+"-"+uy).addClass("highlight-bottom"),$(c).find("#col-"+i).addClass("selected"),$(c).find("#row-"+j).addClass("selected");l||"function"==typeof $.fn.jexcel.defaults[r].oncellselection&&$.fn.jexcel.defaults[r].oncellselection($("#"+$.fn.jexcel.current),e,t,n),$(this).jexcel("updateCornerPosition")},updateCornerSelection:function(e){$(this);var t=$(this).find("tbody td");$(t).removeClass("selection"),$(t).removeClass("selection-left"),$(t).removeClass("selection-right"),$(t).removeClass("selection-top"),$(t).removeClass("selection-bottom");var l=$(this).find("tbody td.highlight"),n=$(l[0]).prop("id").split("-"),c=$(l[l.length-1]).prop("id").split("-"),r=$(e).prop("id").split("-");if(r[1]>c[1]||r[1]<n[1]){var s=parseInt(n[0]),a=parseInt(c[0]);if(parseInt(r[1])>parseInt(c[1]))var o=parseInt(c[1])+1,d=parseInt(r[1]);else var o=parseInt(r[1]),d=parseInt(n[1])-1}else if(r[0]>c[0]||r[0]<n[0]){var o=parseInt(n[1]),d=parseInt(c[1]);if(parseInt(r[0])>parseInt(c[0]))var s=parseInt(c[0])+1,a=parseInt(r[0]);else var s=parseInt(r[0]),a=parseInt(n[0])-1}for(j=o;j<=d;j++)for(i=s;i<=a;i++)$(this).find("#"+i+"-"+j).addClass("selection"),$(this).find("#"+i+"-"+o).addClass("selection-top"),$(this).find("#"+i+"-"+d).addClass("selection-bottom"),$(this).find("#"+s+"-"+j).addClass("selection-left"),$(this).find("#"+a+"-"+j).addClass("selection-right")},updateCornerPosition:function(){var e=$(this).find(".highlight");if($(e).length){corner=$(e).last();var t=parseInt($(corner).offset().top)+$(corner).height()+5,l=parseInt($(corner).offset().left)+$(corner).width()+5;$(".jexcel_corner").css("top",t),$(".jexcel_corner").css("left",l)}},getRowData:function(e){var t="";if((e=$(this).find("#row-"+e).parent().find("td").not(":first")).length>0)for(i=0;i<e.length;i++)t+=$(this).jexcel("getValue",$(e)[i])+",";return t},getData:function(e){var t=[],l=0,n=0,c=$(this).find("thead tr td").not(":first").length,r=$(this).find("tbody tr").length;for(j=0;j<r;j++){for(l=0,i=0;i<c;i++)cell=$(this).find("#"+i+"-"+j),e&&!$(cell).hasClass("highlight")||(t[n]||(t[n]=[]),t[n][l]=$(this).jexcel("getValue",$(cell)),l++);l>0&&n++}return t},copy:function(e,t,l){t||(t="\t");var n="",c="",r="",s=!1,a=!1,o=$(this).find("thead tr td").not(":first").length,d=$(this).find("tbody tr").length;for(j=0;j<d;j++){for(c="",s=!1,i=0;i<o;i++)cell=$(this).find("#"+i+"-"+j),e&&!$(cell).hasClass("highlight")||(s&&(c+=t),(r=$(this).jexcel("getValue",$(cell))).match(/,/g)&&(r='"'+r+'"'),c+=r,s=!0);c&&(a&&(n+="\n"),n+=c,a=!0)}return l||(txt=$(".jexcel_textarea"),$(txt).val(n),$(txt).select(),document.execCommand("copy")),n},cut:function(){$(this);$(this).jexcel("copy",!0);var e=$(this).find(".highlight"),t=$("#"+$.fn.jexcel.current).jexcel("prepareHistoryRecords",e,"");$("#"+$.fn.jexcel.current).jexcel("setHistory",t),$(this).jexcel("setValue",e,"")},paste:function(e,t){var l=$(this).prop("id");t=(t=t.replace(/(\r)/gm,"")).split("\n");var n=$(e).prop("id");if(n){n=n.split("-");var c=parseInt(n[0]),r=parseInt(n[1]);r+t.length>$.fn.jexcel.defaults[l].data.length&&$(this).jexcel("insertRow",r+t.length-$.fn.jexcel.defaults[l].data.length),t[0]&&(row=t[0].split("\t"),c+row.length>$.fn.jexcel.defaults[l].data[r].length&&$(this).jexcel("insertColumn",c+row.length-$.fn.jexcel.defaults[l].data[r].length));var s=[];for(j=0;j<t.length;j++)for(row=t[j].split("\t"),i=0;i<row.length;i++)e=$(this).find("#"+(parseInt(i)+parseInt(c))+"-"+(parseInt(j)+parseInt(r))),$(e).length>0&&(s.push({cell:$(e),newValue:row[i],oldValue:$(this).jexcel("getValue",$(e))}),$(this).jexcel("setValue",$(e),row[i],!1));s.length>0&&$(this).jexcel("setHistory",s)}},insertColumn:function(e,t,l){var n=$(this),c=$(this).prop("id");e||(e=1);var r={column:{type:"text"},width:"50",align:"center"};t=$.extend(r,t);var s=$.fn.jexcel.defaults[c];if(1==s.allowInsertColumn){var a=s.colHeaders.length;for(i=a;i<a+e;i++){s.colHeaders[i]=t.header||$.fn.jexcel("getColumnName",i),s.colWidths[i]=t.width,s.colAlignments[i]=t.align,s.columns[i]=t.column,s.columns[i].source||($.fn.jexcel.defaults[c].columns[i].source=[]),s.columns[i].options||($.fn.jexcel.defaults[c].columns[i].options=[]),width=s.colWidths[i],align=s.colAlignments[i],header=s.colHeaders[i];var o='<td id="col-'+i+'" width="'+width+'" align="'+align+'">'+header+"</td>",d=$(this).find("thead.jexcel_label tr")[0];$(d).append(o),d=$(this).find("table > tbody > tr"),$.each(d,function(e,t){s.data[e][i]="",o=$(n).jexcel("createCell",i,e),$(t).append(o)})}}},insertRow:function(e,t){var l=$(this).prop("id");if(1==$.fn.jexcel.defaults[l].allowInsertRow)for(e||(e=1),j=parseInt($.fn.jexcel.defaults[l].data.length),row=0;row<e;row++){for(tr=document.createElement("tr"),$(tr).append('<td id="row-'+j+'" class="jexcel_label">'+parseInt(j+1)+"</td>"),$.fn.jexcel.defaults[l].data[j]=[],i=0;i<$.fn.jexcel.defaults[l].colHeaders.length;i++)$.fn.jexcel.defaults[l].data[j][i]="",td=$(this).jexcel("createCell",i,j),$(tr).append(td);$(this).find("tbody").append(tr),j++}},deleteRow:function(e){t=$(this).prop("id");if(1==$.fn.jexcel.defaults[t].allowDeleteRow){var t=$(this).prop("id");parseInt(e)>-1&&($.fn.jexcel.defaults[t].data.splice(parseInt(e),1),$(this).jexcel("setData",$.fn.jexcel.defaults[t].data))}},deleteColumn:function(e){},setWidth:function(e,t){if(t>0){"object"==typeof e&&(e=(e=$(e).prop("id").split("-"))[0]);var l=$(this).find("thead #col-"+e);l.length&&$(l).prop("width",t)}},getWidth:function(e){"object"==typeof e&&(e=(e=$(e).prop("id").split("-"))[0]);var t=$(this).find("thead #col-"+e);if(t.length)return $(t).prop("width")},setHeader:function(e,t){if(t){var l=$(this).find("thead #col-"+e);l.length&&$(l).html(t)}},setSource:function(e,t){"object"==typeof e&&(e=(e=$(e).prop("id").split("-"))[0]);var l=$(this).prop("id");$.fn.jexcel.defaults[l].columns[e].source=t},afterChange:function(){var e=$(this).prop("id");$.fn.jexcel.defaults[e].dynamicColumns.length>0&&$(this).jexcel("formula"),"function"==typeof $.fn.jexcel.defaults[e].onafterchange&&$.fn.jexcel.defaults[e].onafterchange($(this)),$(this).jexcel("updateSettings")},copyData:function(e,t){var l=$(this).jexcel("getData",!0),n=parseInt(e[0]),c=parseInt(t[0]),r=parseInt(e[1]),s=parseInt(t[1]),a=[],o=0,d=0;for(j=r;j<=s;j++){for(void 0==l[d]&&(d=0),o=0,i=n;i<=c;i++)void 0==l[d]?o=0:void 0==l[d][o]&&(o=0),cell=$(this).find("#"+i+"-"+j),$(cell).length&&!$(cell).hasClass("readonly")&&(a.push({cell:$(cell),newValue:l[d][o],oldValue:$(this).jexcel("getValue",$(cell))}),$(this).jexcel("setValue",cell,l[d][o],!1)),o++;d++}a.length>0&&$(this).jexcel("setHistory",a)},orderBy:function(e,t){if(e>=0){var l=$(this).find("thead").first();if("0"!=t&&"1"!=t){var n=$(l).find(".arrow-down");t=$(n).length>0?1:0}$(l).find(".arrow-down").remove(),$(l).find(".arrow-up").remove(),$(l).find("td").css("text-decoration","none"),1==t?$(l).find("#col-"+e).append('<span class="arrow-up"></span>').css("text-decoration","underline"):$(l).find("#col-"+e).append('<span class="arrow-down"></span>').css("text-decoration","underline"),$(".jexcel_corner").css("top","-200px"),$(".jexcel_corner").css("left","-200px");var c=$(this).prop("id"),r=$.fn.jexcel.defaults[c];Array.prototype.sortBy=function(e,t){return this.slice(0).sort(function(l,n){return t?l[e]>n[e]?-1:l[e]<n[e]?1:0:l[e]>n[e]?1:l[e]<n[e]?-1:0})};var s=r.data.sortBy(e,t);return $(this).jexcel("setData",s),!0}},formula:function(){var main=$(this),id=$(this).prop("id");if($.fn.jexcel.defaults[id].formulas){var formulas=$.fn.jexcel.defaults[id].formulas;$.fn.jexcel.defaults[id].formulas.instance=this}var columns=$.fn.jexcel.defaults[id].dynamicColumns,varibles=$(this).find(".jexcel tbody td").not(".jexcel_label");$.each(varibles,function(e,t){i=$(main).jexcel("getColumnNameFromId",$(t).prop("id")),(t=$(main).jexcel("getValue",$(t)))==parseInt(t)?window[i]=parseInt(t):window[i]=t}),"object"==typeof excelFormulaUtilities?$.each(columns,function(k,column){formula=$(main).jexcel("getValue",column),formula&&"="==formula.substr(0,1)?(value=excelFormulaUtilities.formula2JavaScript(formula),value=eval(value),null===value||isNaN(value)?($(main).find("#"+column).addClass("error"),value='<input type="hidden" value="'+formula+'">#ERROR',$(main).find("#"+column).html(value)):($(main).find("#"+column).removeClass("error"),value='<input type="hidden" value="'+formula+'">'+value,$(main).find("#"+column).html(value))):($(main).find("#"+column).removeClass("error"),columns.splice(k,1))}):console.error("excelFormulaUtilities lib not included")},helper:function(e){var t=[];if("object"==typeof e&&"createEmptyData"==e.action){var l=e.cols||10,n=e.rows||100;for(j=0;j<n;j++)for(t[j]=[],i=0;i<l;i++)t[j][i]=""}return t},download:function(){var e=$(this).prop("id"),t=$.fn.jexcel.defaults[e],l="";1==t.csvHeaders&&(l=t.colHeaders.join()+"\n"),l+=$(this).jexcel("copy",!1,",",!0);var n=document.createElement("a"),c=new Blob([l],{type:"text/csv;charset=utf-8;"}),r=URL.createObjectURL(c);n.href=r,n.setAttribute("download","jexcelTable.csv"),n.click()},setHistory:function(e){$(this);var t=$(this).prop("id"),l=++$.fn.jexcel.defaults[t].historyIndex;($.fn.jexcel.defaults[t].history=$.fn.jexcel.defaults[t].history.slice(0,l+1))[l]={firstSelected:e[0].cell,lastSelected:e[e.length-1].cell,cellChanges:e}},prepareHistoryRecords:function(e,t,l){var n=$(this),c=[];return $.each(e,function(e,r){ov=void 0===l?$(n).jexcel("getValue",$(r)):l,c.push({cell:$(r),newValue:t,oldValue:ov})}),c},prepareHistory:function(e,t,l){var n={firstSelected:e[0],lastSelected:e[e.length-1],cellChanges:[]};return $.each(e,function(e,c){ov=void 0===l?$(main).jexcel("getValue",$(c)):l,n.cellChanges.push({cell:$(c),newValue:t,oldValue:ov})}),n},undo:function(){var e=$(this).prop("id");if($.fn.jexcel.defaults[e].historyIndex>=0){for(var t=$.fn.jexcel.defaults[e].history[$.fn.jexcel.defaults[e].historyIndex--],l=0;l<t.cellChanges.length;l++)$(this).jexcel("setValue",$(t.cellChanges[l].cell),t.cellChanges[l].oldValue,!0);$(this).jexcel("updateSelection",t.firstSelected,t.lastSelected)}},redo:function(){var e=$(this).prop("id");if($.fn.jexcel.defaults[e].historyIndex<$.fn.jexcel.defaults[e].history.length-1){for(var t=$.fn.jexcel.defaults[e].history[++$.fn.jexcel.defaults[e].historyIndex],l=0;l<t.cellChanges.length;l++)$(this).jexcel("setValue",$(t.cellChanges[l].cell),t.cellChanges[l].newValue,!0);$(this).jexcel("updateSelection",t.firstSelected,t.lastSelected)}},createCell:function(e,t){var l=$(this).prop("id"),n=$.fn.jexcel.defaults[l];return align=n.colAlignments[e],width=n.colWidths[e],td=document.createElement("td"),$(td).prop("width",width),$(td).prop("align",align),$(td).prop("id",e+"-"+t),$(td).addClass("c"+e),$(td).addClass("r"+t),"hidden"==n.columns[e].type?$(td).css("display","none"):"checkbox"==n.columns[e].type&&(1==n.columns[e].readOnly?$(td).html('<input type="checkbox" disabled="disabled">'):$(td).html("<input type=\"checkbox\" onclick=\"var instance = $(this).parents('.jexcel').parent(); $(instance).jexcel('setHistory', $(instance).jexcel('prepareHistoryRecords', $(this).parent(), $(this).prop('checked') ? 1 : 0, $(this).prop('checked') ? 0 : 1)); $(instance).jexcel('setValue', $(this).parent(), $(this).prop('checked') ? 1 : 0);\">")),$(this).jexcel("setValue",$(td),""+n.data[t][e],!0),1==n.columns[e].readOnly&&$(td).addClass("readonly","readonly"),$(td)},getColumnName:function(e){var t="";return e>701?(t+=String.fromCharCode(64+parseInt(e/676)),t+=String.fromCharCode(64+parseInt(e%676/26))):e>25&&(t+=String.fromCharCode(64+parseInt(e/26))),t+=String.fromCharCode(65+e%26)},getIdFromColumnName:function(e){var t=/^[a-zA-Z]+/.exec(e);if(t){for(var l=0,n=0;n<t[0].length;n++)l+=parseInt(t[0].charCodeAt(n)-65);e=l+"-"+(parseInt(/[0-9]+$/.exec(e))-1)}return e},getColumnNameFromId:function(e){var t=e.split("-");return $.fn.jexcel("getColumnName",t[0])+(parseInt(t[1])+1)}};$.fn.jexcel=function(e){return methods[e]?methods[e].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof e&&e?void $.error("Method "+e+" does not exist on jQuery.tooltip"):methods.init.apply(this,arguments)}}(jQuery);