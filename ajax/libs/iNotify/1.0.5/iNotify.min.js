!function(t,i){"function"==typeof define&&define.amd?define([],i):"object"==typeof exports?module.exports=i():t.iNotify=i()}(this,function(t,i){function e(t,i){var e,o=document.createElement("canvas"),n=(document.createElement("img"),document.getElementsByTagName("head")[0]),a=document.createElement("link");o.height=o.width=32,e=o.getContext("2d"),e.fillStyle=i.backgroundColor,e.fillRect(0,0,32,32),e.textAlign="center",e.font='22px "helvetica", sans-serif',e.fillStyle=i.textColor,e.fillText(t,16,24),console.log("message2:"),a.setAttribute("rel","shortcut icon"),a.setAttribute("type","image/x-icon"),a.setAttribute("id","new"+i.id),a.setAttribute("href",o.toDataURL("image/png")),n.appendChild(a),s.icon=o.toDataURL("image/png")}function o(t,i){console.group("test"),console.log("jsonArguments:",t),console.log("jsonArguments:",i);for(var e in i)t[e]&&(i[e]=t[e]);return console.log("message:",i),console.groupEnd(),i}var n=["flash","scroll"],s={title:"通知！",body:"您来了一条新消息"},a={init:function(t){return t||(t={}),this.interval=t.interval||200,this.effect=t.effect||"flash",this.title=t.title||document.title,this.message=t.message||this.title,this.updateFavicon=t.updateFavicon||{id:"favicon",textColor:"#fff",backgroundColor:"#2F9A00"},this.audio=t.audio||"",this.favicon=document.querySelectorAll("link[rel~=shortcut]")[0],this.favicon=this.favicon,this.cloneFavicon=this.favicon.cloneNode(!0),s.icon=this.favicon.href,this.notification=t.notification||s,console.log("message1:",this.notification),0<=n.indexOf(this.effect)&&this.addTimer(),this},render:function(){switch(this.effect){case"flash":document.title=this.title===document.title?this.message:this.title;break;case"scroll":document.title=document.title.slice(1),0===document.title.length&&(document.title=this.message)}},setURL:function(t){return this.audioElm||(t=t?this.audio.file=t:this.audio.file,this.audioElm=document.createElement("audio"),document.body.appendChild(this.audioElm)),t&&(this.audioElm.src=t),this},loopPlay:function(){return this.setURL(),this.audioElm.loop=!0,this.player(),this},stopPlay:function(){return this.audioElm&&(this.audioElm.loop=!1,this.audioElm.pause()),this},player:function(){return this.audio&&this.audio.file?(this.audioElm||(this.audioElm=document.createElement("audio"),this.audioElm.src=this.audio.file,document.body.appendChild(this.audioElm)),this.audioElm.play(),this):void 0},notify:function(t){var i=this.notification;return console.group("notiry"),console.log("message:a"),Notification&&(t?(console.log("message:b"),i=o(t,i)):i=s,new Notification(i.title,{icon:i.icon,body:i.body})),console.log("n:",this.notification),console.log("n:",i),console.groupEnd(),this},setTitle:function(t){return t?(this.message=t,this.addTimer()):(this.clearTimer(),this.title=this.title),this},setInterval:function(t){return t&&(this.interval=t,this.addTimer()),this},setFavicon:function(t){if(!t&&0!==t)return this.faviconClear();var i=document.getElementById("new"+this.updateFavicon.id);return this.favicon&&this.favicon.remove(),i&&i.remove(),e(t,this.updateFavicon),this},addTimer:function(){return this.clearTimer(),0<=n.indexOf(this.effect)&&(this.timer=setInterval(this.render.bind(this),this.interval)),this},faviconClear:function(){var t=document.getElementById("new"+this.updateFavicon.id);return head=document.getElementsByTagName("head")[0],t&&t.remove(),head.appendChild(this.cloneFavicon),this.favicon=this.cloneFavicon,this},clearTimer:function(){return clearInterval(this.timer),document.title=this.title,this}};return Notification&&"granted"!==Notification.permission&&Notification.requestPermission(),a});