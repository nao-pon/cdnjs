// Pressure v0.0.1 alpha | Created By Stuart Yamartino | MIT License | 2015 
!function(e,t){"use strict";function n(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),s={set:function(e,t,n){d(e,t,null,n)},setForceTouch:function(e,t,n){d(e,t,"force",n)},set3DTouch:function(e,t,n){d(e,t,"3d",n)}},u=function(){function e(t,n,o){i(this,e),this.element=t,this.block=n,this.type=o}return r(e,[{key:"routeEvents",value:function(){f.mobile!==!1||"force"!==this.type&&"3d"===this.type?f.mobile!==!0||"3d"!==this.type&&"force"===this.type?this.failEvents():this.touch3DAdapter():this.touchForceAdapter()}},{key:"touchForceAdapter",value:function(){var e=new c(new l(this));e.handle()}},{key:"touch3DAdapter",value:function(){var e=new c(new h(this));e.handle()}},{key:"failEvents",value:function(){var e=this;f.mobile?this.element.addEventListener("touchstart",function(){return p(e.block,"unsupported")},!1):this.element.addEventListener("mousedown",function(){return p(e.block,"unsupported")},!1)}}]),e}(),c=function(){function e(t){i(this,e),this.adapter=t}return r(e,[{key:"handle",value:function(){this.adapter.support(),this.adapter.block.hasOwnProperty("start")&&this.adapter.start(),this.adapter.block.hasOwnProperty("change")&&this.adapter.change(),this.adapter.block.hasOwnProperty("end")&&this.adapter.end()}}]),e}(),a=function(){function e(t){i(this,e),this.element=t,this.el=t.element,this.block=t.block,this.down=!1}return r(e,[{key:"add",value:function(e,t){this.el.addEventListener(e,t,!1)}},{key:"remove",value:function(e,t){this.el.removeEventListener(e,t)}},{key:"_dispatch",value:function(){f.forPressure?this.remove("webkitmouseforcewillbegin",this._touchForceEnabled):(f.didFail(),p(this.block,"unsupported",this.el))}},{key:"_setDown",value:function(){this.down=!0}},{key:"_setUp",value:function(){this.down=!1}}]),e}(),h=function(e){function t(e){return i(this,t),n(this,Object.getPrototypeOf(t).call(this,e))}return o(t,e),r(t,[{key:"support",value:function(){this.add("touchstart",this._dispatch.bind(this))}},{key:"_dispatch",value:function(e){void 0!==e.touches[0].force?(f.didSucceed("3d"),this.remove("touchstart",this._dispatch.bind(this))):(f.didFail(),p(this.block,"unsupported",this.el))}},{key:"start",value:function(){var e=this;this.add("touchstart",function(){f.forPressure&&p(e.block,"start",e.el)})}},{key:"change",value:function(){var e=this;this.add("touchstart",function(t){f.forPressure&&(e.setDown(),e.touch=e.selectTouch(t),e.touch&&e.fetchForce(t))})}},{key:"end",value:function(){var e=this;this.add("touchend",function(){f.forPressure&&(e.setUp(),p(e.block,"end",e.el))})}},{key:"_fetchForce",value:function(e){this.down&&(this.touch=this.selectTouch(e),setTimeout(this.fetchForce.bind(this),10,e),p(this.block,"change",this.el,this.touch.force,e))}},{key:"_selectTouch",value:function(e){if(1===e.touches.length)return e.touches[0];for(var t=0;t<e.touches.length;t++)if(e.touches[t].target===this.el)return e.touches[t]}}]),t}(a),l=function(e){function t(e){i(this,t);var o=n(this,Object.getPrototypeOf(t).call(this,e));return o._preventDefaultForceTouch(),o}return o(t,e),r(t,[{key:"support",value:function(){this.add("webkitmouseforcewillbegin",this._touchForceEnabled),this.add("mousedown",this._dispatch.bind(this))}},{key:"_touchForceEnabled",value:function(e){e.preventDefault(),f.didSucceed("force")}},{key:"_dispatch",value:function(){f.forPressure?this.remove("webkitmouseforcewillbegin",this._touchForceEnabled):(f.didFail(),p(this.block,"unsupported",this.el))}},{key:"start",value:function(){var e=this;this.add("mousedown",function(){f.forPressure&&(e._setDown(),p(e.block,"start",e.el))})}},{key:"change",value:function(){var e=this;this.add("webkitmouseforcechanged",function(t){f.forPressure&&0!==t.webkitForce&&p(e.block,"change",e.el,e._normalizeForce(t.webkitForce),t)})}},{key:"end",value:function(){var e=this;this.add("mouseup",function(){f.forPressure&&(e._setUp(),p(e.block,"end",e.el))}),this.add("mouseleave",function(){f.forPressure&&(e.down===!0&&p(e.block,"end",e.el),e._setUp())})}},{key:"_preventDefaultForceTouch",value:function(){this.add("webkitmouseforcewillbegin",function(e){f.forPressure&&e.preventDefault()})}},{key:"_normalizeForce",value:function(e){return(e-1)/2}}]),t}(a),f={hasRun:!1,forPressure:!1,type:!1,didFail:function(){this.hasRun=!0,this.forPressure=!1},didSucceed:function(e){this.hasRun=!0,this.forPressure=!0,this.type=e}},d=function(e,t,n){for(var o=arguments.length<=3||void 0===arguments[3]?!0:arguments[3],i=v(e),r=0;r<i.length;r++){o&&(i[r].style.webkitUserSelect="none");var s=new u(i[r],t,n);s.routeEvents()}},p=function(e,t,n){e.hasOwnProperty(t)&&e[t].apply(n||this,Array.prototype.slice.call(arguments,3))},v=function(e){return t.querySelectorAll(e)};f.mobile="ontouchstart"in t,e.Pressure=s}(window,document);