{"version":3,"file":"snarkdown.es.js","sources":["../src/index.js"],"sourcesContent":["const TAGS = {\n\t_ : ['<em>','</em>'],\n\t__ : ['<strong>','</strong>'],\n\t'\\n\\n' : ['<br />\\n\\n', false],\n\t'>' : ['<blockquote>','</blockquote>'],\n\t'*' : ['<ul>','</ul>'],\n\t'#' : ['<ol>','</ol>']\n};\n\nconst ESCAPED = /[^\\\\](\\\\\\\\)*\\\\$/;\n\n/** Given a parser context and a Markdown token, returns an opening or closing tag corresponding to the token's type.\n *\t@private\n */\nfunction tag(context, token) {\n\tvar norm = token.replace(/\\*/g,'_').replace(/^( {2}\\n\\n*|\\n{2,})/g,'\\n\\n'),\n\t\tend = context[context.length-1]===token,\n\t\tdesc = TAGS[norm];\n\tif (!desc) return token;\n\tif (desc[1]===false) return desc[0];\n\tcontext[end?'pop':'push'](token);\n\treturn desc[ end ? 1 : 0 ];\n}\n\n/** Outdent a string based on the first indented line's leading whitespace\n *\t@private\n */\nfunction outdent(str) {\n\treturn str.replace(new RegExp('^'+(str.match(/^(\\t| )+/) || '')[0], 'gm'), '');\n}\n\n/** Encode special attribute characters to HTML entities in a String.\n *\t@private\n */\nfunction encodeAttr(str) {\n\treturn str.replace(/\"/g, '&quot;');\n}\n\n/** Trim leading/trailing newlines only\n *\t@private\n */\nfunction trim(str) {\n\treturn str.replace(/^\\n+|\\n+$/g, '');\n}\n\nexport default function parse(md) {\n\t// eslint-disable-next-line\n\tlet tokenizer = /(?:^```(\\w*)\\n([\\s\\S]*?)\\n```$)|((?:(?:^|\\n+)(?:\\t|  {2,}).+)+\\n*)|((?:(?:^|\\n)([>*+-]|\\d+\\.)\\s+.*)+)|(?:\\!\\[([^\\]]*?)\\]\\(([^\\)]+?)\\))|(\\[)|(\\](?:\\(([^\\)]+?)\\))?)|(?:(?:^|\\n+)([^\\s].*)\\n(\\-{3,}|={3,})(?:\\n+|$))|(?:(?:^|\\n+)(#{1,3})\\s*(.+)(?:\\n+|$))|(?:`([^`].*?)`)|(  \\n\\n*|\\n{2,}|__|\\*\\*|[_*])/gm,\n\t\tcontext = [],\n\t\tout = '',\n\t\tlast = 0,\n\t\tlinks = {},\n\t\tchunk, prev, token, inner, t;\n\n\tmd = trim(md).replace(/^\\[(.+?)\\]:\\s*(.+)$/gm, (s, name, url) => {\n\t\tlinks[name.toLowerCase()] = url;\n\t\treturn '';\n\t});\n\n\twhile ( (token=tokenizer.exec(md)) ) {\n\t\tprev = md.substring(last, token.index);\n\t\tlast = tokenizer.lastIndex;\n\t\tchunk = token[0];\n\t\tif (ESCAPED.test(prev)) {\n\t\t\t// escaped\n\t\t}\n\t\t// Code/Indent blocks:\n\t\telse if (token[2] || token[3]) {\n\t\t\tchunk = '\\n<pre class=\"code '+(token[3]?'poetry':token[1].toLowerCase())+'\">'+outdent(trim(token[2] || token[3]))+'</pre>\\n';\n\t\t}\n\t\t// > Quotes, -* lists:\n\t\telse if (token[5]) {\n\t\t\tt = token[5];\n\t\t\tif (t.charAt(t.length-1)==='.') {\n\t\t\t\tt = '.';\n\t\t\t\ttoken[4] = token[4].replace(/^\\d+/gm, '');\n\t\t\t}\n\t\t\tinner = parse(outdent(token[4].replace(/^\\s*[>*+.-]/gm, '')));\n\t\t\tif (t!=='>') {\n\t\t\t\tt = t==='.' ? '#' : '*';\n\t\t\t\tinner = inner.replace(/^(.*)$/gm, '\\t<li>$1</li>');\n\t\t\t}\n\t\t\tchunk = '\\n'+TAGS[t][0]+'\\n' + inner + '\\n'+TAGS[t][1]+'\\n';\n\t\t}\n\t\t// Images:\n\t\telse if (token[7]) {\n\t\t\tchunk = `<img src=\"${encodeAttr(token[7])}\" alt=\"${encodeAttr(token[6])}\">`;\n\t\t}\n\t\t// Links:\n\t\telse if (token[9]) {\n\t\t\tout = out.replace('<a>', `<a href=\"${encodeAttr(token[10] || links[prev.toLowerCase()])}\">`);\n\t\t\tchunk = '</a>';\n\t\t}\n\t\telse if (token[8]) {\n\t\t\tchunk = '<a>';\n\t\t}\n\t\t// Headings:\n\t\telse if (token[11] || token[13]) {\n\t\t\tt = 'h' + (token[13] ? token[13].length : (token[12][0]==='='?1:2));\n\t\t\tchunk = '\\n\\n<'+t+'>' + parse(token[11] || token[14]) + '</'+t+'>\\n';\n\t\t}\n\t\t// `code`:\n\t\telse if (token[15]) {\n\t\t\tchunk = '<code>'+token[15]+'</code>';\n\t\t}\n\t\t// Inline formatting: *em*, **strong** & friends\n\t\telse if (token[16]) {\n\t\t\tchunk = tag(context, token[16]);\n\t\t}\n\t\tout += prev;\n\t\tout += chunk;\n\t}\n\n\tout += md.substring(last);\n\n\twhile ((token=context.pop())) {\n\t\tout += tag(context, token);\n\t}\n\n\treturn trim(out);\n}\n"],"names":["const","let"],"mappings":"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"}