!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):t.EmbedJS=e()}(this,function(){"use strict";function t(e,n){var r=[].slice.call(arguments),o=!1;"boolean"==typeof r[0]&&(o=r.shift());for(var i=r[0],s=r.slice(1),u=s.length,c=0;c<u;c++){var a=s[c];for(var p in a){var h=a[p];if(o&&h&&"object"==typeof h){var l=Array.isArray(h)?[]:{};i[p]=t(!0,i[p]||l,h)}else i[p]=h}}return i}function e(t,e){return e={exports:{}},t(e,e.exports),e.exports}function n(t,e){for(var n=[],r=e.exec(t);r&&(n.push(r),e.global);)r=e.exec(t);return n}function r(t,e){return e.reverse().reduce(function(t,e){var n=t.slice(0,e.index),r=t.slice(e.index+e[0].length);return n+e.replacement+r},t)}function o(t,e){var n=t.concat([t.index,t.input]);return e.apply(null,n).then(function(e){return R({},t,{replacement:e})})}function i(t,e){var n=t.map(function(t){return o(t,e)});return Promise.all(n)}function s(t,e,o){return i(n(t,e),o).then(function(e){return r(t,e)})}function u(t,e,n){e.lastIndex=0;try{return Promise.resolve(s(t,e,n))}catch(t){return Promise.reject(t)}}function c(t,e,n){return void 0===n&&(n=!1),n?t.test(e):e.match(t)}function a(t){return J.test(t)}function p(t){return t.sort(function(t,e){return t.index-e.index})}function h(t){return p(t).map(function(t){return t.content}).join(" ")}function l(t){return t.result+" "+h(t._embeds)}function f(t,e,n){var r=t._services,o=e.name;r.filter(function(t){return t.match===n}).length||r.push({name:o,match:n})}function m(t,e,n,r){return new Promise(function(o,i){var s,c;return c=n,s=c.regex,u(t,s,function(){for(var t=[],o=arguments.length;o--;)t[o]=arguments[o];return new Promise(function(o,i){return w(t,e,n).then(function(s){try{return e._embeds.push({content:s,index:r||t.find(function(t){return"number"==typeof t})}),f(e,n,t[0]),o()}catch(t){return i(t)}},i)})}).then(function(t){try{return o(e)}catch(t){return i(t)}},i)})}function d(t,e){var n=this;return new Promise(function(r,o){function i(){return r(p)}var s,p,h;return h=e,s=h.regex,p=R({},t),a(p.result)?u(p.result,J,function(t,n,r){return new Promise(function(o,i){return c(s,t,!0)?(f(p,e,t),m(n,p,e,r).then(function(e){try{return p=e,o(t)}catch(t){return i(t)}},i)):o(t)})}).then(function(t){try{return i.call(n)}catch(t){return o(t)}},o):(p=m(p.result,p,e),i.call(n))})}function v(t,e){t.lastIndex=0;var n=t.exec(e);return t.lastIndex=0,n}function w(t,e,n){var r=this;return new Promise(function(o,i){function s(){return o(c(t,e,n,a))}var u,c,a,p;return p=n,u=p._process,c=p.template,u?u(t,e,n).then(function(t){try{return a=t,s.call(r)}catch(t){return i(t)}},i):s.call(r)})}function g(t,e){return new Promise(function(n,r){var o=t.result,i=t.replaceUrl,s=e.regex,c=e._replaceAnyways;return n(u(o,s,function(){for(var n=[],r=arguments.length;r--;)n[r]=arguments[r];return new Promise(function(r,o){return f(t,e,n[0]),new Promise(function(r,o){return i||c?r(w(n,t,e)):w(n,t,e).then(function(t){try{return r(n[0]+" "+t)}catch(t){return o(t)}},o)}).then(r,o)})}))})}function y(t,e){return new Promise(function(n,r){var o=t.result,i=t.replaceUrl,s=e.regex,a=e._replaceAnyways;return n(u(o,J,function(n,r){return new Promise(function(o,p){var h,l;return c(s,r,!0)?i||a?o(u(r,s,function(){for(var n=[],r=arguments.length;r--;)n[r]=arguments[r];return new Promise(function(r,o){return f(t,e,n[0]),r(w(n,t,e))})})):(h=v(s,r),f(t,e,h[0]),w(h,t,e).then(function(t){try{return l=t,o(h?n+l:n)}catch(t){return p(t)}},p)):o(n)})}))})}function b(t,e){return new Promise(function(n,r){var o,i,s,u,c,p;o=(p=t).result,i=p.inlineEmbed;var h;return h=e,s=h._ignoreAnchorCheck,u=h._ignoreInlineCheck,i||u?new Promise(function(n,r){return a(o)&&!s?y(t,e).then(n,r):g(t,e).then(n,r)}).then(function(e){try{return c=e,n(R({},t,{result:c}))}catch(t){return r(t)}},r):n(d(t,e))})}function x(t){var e={name:W,regex:/(`{3})(\s|[a-z]+)\s*([\s\S]*?[^`])\s*\1(?!`)/gm,prismjs:G()?require("prismjs"):window.Prism,template:function(t,e,n){var r=n.prismjs,o=t[2],i=t[3],s="language-"+(o||"markup");return'<pre class="'+s+'"><code class="'+s+'">'+r.highlight(i,r.languages[o||"markup"])+"</code></pre>"}},n=R({},e,t,{_replaceAnyways:!0,_ignoreAnchorCheck:!0,_ignoreInlineCheck:!0});return Q(n)}function j(t){var e={name:rt,regex:X(),template:function(t){return'<span class="ec ec-'+tt(t)+'"></span>'}},n=R({},e,t);return{transform:function(t){return Promise.resolve(R({},t,{result:t.result.replace(n.regex,function(e,r){return t._services.push({name:rt,match:e}),n.template(r,t,n)})}))}}}function _(t){return new Promise(function(e,n){var r,o,i,s;r=(s=t)[1],o=s[2];var u=function(t){try{return e({})}catch(t){return n(t)}};try{return ot("https://api.github.com/repos/"+r+"/"+o).then(function(t){try{return i=t,e(i.json())}catch(t){return u()}},u)}catch(t){u()}})}function k(t){var e=R({},{name:ut,regex:/[^\.]github.com\/([\w\.\-]+)\/([\w\.\-]+[^\.])/gi,template:function(t,e,n,r){var o=r.owner,i=r.description,s=r.html_url,u=r.full_name;return new Promise(function(t,e){return t(st({thumbnail:o.avatar_url,url:s,description:i,title:u}))})}},t,{_process:_});return Q(e)}function A(t){var e={name:ct,regex:new RegExp("(?:https?)://\\S*\\.(?:"+at.concat(pt,ht).join("|")+")","gi"),template:function(t){var e=t[0],n=e.split(".").slice(-1)[0];return at.indexOf(n)>=0?'<img class="ejs-embed" src="'+e+'"/>':pt.indexOf(n)>=0?'<video src="'+e+'" controls class="ejs-video"></video>':ht.indexOf(n)>=0?'<audio src="'+e+'" controls class="ejs-audio"></audio>':void 0}},n=R({},e,t);return Q(n)}function P(t){var e=t.snippet,n=t.id;return{title:e.title,thumbnail:e.thumbnails.medium.url,description:e.description,url:dt+"watch?v="+n,embedUrl:dt+"embed/"+n}}function E(t,e){return new Promise(function(n,r){var o,i,s=function(t){try{return n({})}catch(t){return r(t)}};try{return ot("https://www.googleapis.com/youtube/v3/videos?id="+t+"&key="+e+"&part=snippet,statistics").then(function(t){try{return(o=t).json().then(function(t){try{return i=t,n(i.items[0])}catch(t){return s()}},s)}catch(t){return s()}},s)}catch(t){s()}})}function L(t,e){var n=t.input,r=e.clickClass,o=e.onVideoShow,i=e.height;if(!$(n))throw new Error("input should be a DOM Element.");for(var s=document.getElementsByClassName(r),u=0;u<s.length;u++)s[u].onclick=function(){var t=this.getAttribute("data-url");o(t),t+="?autoplay=1",this.parentNode.innerHTML=ft(t,i,mt)}}function z(t,e,n){var r=n.gAuthKey;return n.details&&E(t[1],r)}function C(t){var e={name:mt,regex:lt(),gAuthKey:"",details:!0,height:300,clickClass:"ejs-video-thumb",onVideoShow:function(){},_onLoadInternal:function(t,e){L(t,e)},onLoad:function(){},template:function(t,e,n,r){var o=n.details,i=n.height,s=n.clickClass;return new Promise(function(e,n){var u=dt+"embed/"+t[1];return e(o?st(P(r),s):ft(u,i,mt))})}};if(!t.gAuthKey)throw new Error("You need to pass google auth key.");var n=R({},e,t,{_process:z});return Q(n)}function O(t){for(var e=[],n=t.length,r=0;r<n;r++){var o=t[r];Array.isArray(o)?e.push.apply(e,O(o)):e.push(o)}return e}function S(t){void 0===t&&(t=[]);var e=gt.filter(function(e){return-1===t.indexOf(e.name.toLowerCase())}),n=wt(vt(e,"patterns"));return new RegExp(n.join("|"),"gi")}function I(t,e){var n=gt.filter(function(e){return e.name.toLowerCase()===t})[0];return new RegExp(n.patterns.join("|"),"gi").test(e)}function Z(t){return new Promise(function(e,n){var r,o;r=t[0];var i=function(t){try{return e({html:r})}catch(t){return n(t)}};try{return ot("https://noembed.com/embed?url="+r).then(function(t){try{return(o=t).json().then(e,i)}catch(t){return i()}},i)}catch(t){i()}})}function T(t){void 0===t&&(t={});var e={name:yt,regex:null,exclude:[],twttr:G()?null:window.twttr,onLoad:function(){},template:function(t,e,n,r){var o=r.html;return new Promise(function(t,e){return t('<div class="ejs-embed">'+o+"</div>")})},_onLoadInternal:function(t,e){var n=t.input,r=t.result,o=e.twttr,i=e.onLoad;I("twitter",r)&&o&&$(n)&&(o.widgets.load(n),o.events.bind("loaded",i))}},n=R({},e,t,{_process:Z});return t.regex||(n.regex=S(n.exclude)),Q(n)}function D(t){return String(null===t||void 0===t?"":t)}function M(t,e){var n=Pt(t),r=t;return/^[a-zA-Z]{1,6}:/.test(r)||(r="http://"+r),"<a "+K({href:r},e)+">"+n+"</a>"}function K(){return Array.prototype.slice.call(arguments).map(q).filter(Boolean).join(" ")}function N(t,e){var n=q(e);return t.replace(Lt,function(t,e){var r=q({href:"mailto:"+e});return n&&(r+=" "+n),"<a "+r+">"+Pt(e)+"</a>"})}function q(t){return t?Object.keys(t).map(function(e){var n=t[e];return Pt(e)+'="'+Pt(n)+'"'}).join(" "):""}function H(t){var e=R({},{attributes:{},escape:!1},t),n=e.attributes,r=e.escape;return{transform:function(t){return new Promise(function(e,o){return e(R({},t,{result:zt(t.result,{attributes:n,escape:r})}))})}}}function U(t){var e=R({},{name:Ct,regex:/(https?:\/\/)?www\.facebook\.com\/(?:(videos|posts)\.php\?v=\d+|.*?\/(videos|posts)\/\d+\/?)/gi,height:225,template:function(t,e,n){var r=n.height,o=t[0],i=o.indexOf("/videos/")<0?"post":"video";return ft("https://www.facebook.com/plugins/"+i+".php?href="+o,r,Ct)}},t);return Q(e)}function Y(t){var e=R({},{name:Ot,height:440,regex:/((https?:\/\/)(www\.)?instagram.com\/p\/[a-zA-Z0-9_\-\=]+)(\/\?[a-zA-Z0-9_\-\=]+)?/gi,template:function(t,e,n){n.width;var r=n.height;return'<iframe class="ejs-embed ejs-instagram" src="'+t[1]+'/embed" height="'+r+'"></iframe>'}},t);return Q(e)}function B(t){var e=t.input,n=t.target;return $(e)||n&&$(n)}var R=t,F=e(function(t){t.exports=function(t,e,n){return new Promise(function(r,o){var i=t[Symbol.iterator](),s=0,u=function(t){var n=i.next();n.done?r(t):Promise.all([t,n.value]).then(function(t){u(e(t[0],t[1],s++))}).catch(o)};u(n)})}}),V=function(t,e){return F(t,function(t,e){return e(t)},e)},$=function(t){return!(!t||"object"!=typeof t)&&("object"==typeof window&&"object"==typeof window.Node?t instanceof window.Node:"number"==typeof t.nodeType&&"string"==typeof t.nodeName)},J=/<a[^>]*>([^<]+)<\/a>/gi,G=e(function(t,e){t.exports=function(){return"undefined"!=typeof process}}),Q=function(t){var e=R({},{_replaceAnyways:!1,_ignoreAnchorCheck:!1,_ignoreInlineCheck:!1,onLoad:function(){}},t),n=e._onLoadInternal,r=e.onLoad,o=e.regex,i=e.template;if(!o)throw new Error("regex not passed.");if(!i)throw new Error("template not passed.");return{transform:function(t){return new Promise(function(n,r){return b(t,e).then(function(e){try{return n(R({},t,e))}catch(t){return r(t)}},r)})},onLoad:function(t){n&&n(t,e),r&&r(t,e)}}},W="highlight";x.id=W;var X=function(){return/:([a-z0-9_\+\-]+):/g},tt=function(t){return(t=t.replace(nt,function(t){return" "+(t.toLowerCase()||t)})).trim().split(et).join("-")},et=/[\s\u2000-\u206F\u2E00-\u2E7F\\'!"#$%&()*+,\-.\/:;<=>?@\[\]^_`{|}~]+/,nt=/[A-Z\u00C0-\u00D6\u00D9-\u00DD]/g,rt="emoji";j.id=rt;var ot=G()?require("node-fetch"):window.fetch||window.unfetch,it=function(t,e,n){return null==e||e>=t.length?t:(null==n&&(n="..."),t.slice(0,Math.max(0,e-n.length))+n)},st=function(t,e){var n=t.url,r=t.title,o=t.embedUrl,i=t.description;return'<div class="ejs-preview ejs-embed"><div class="ejs-thumb '+e+'" data-url="'+o+'" style="background-image:url('+t.thumbnail+')"><span>&#9658;</span></div><div class="ejs-info"><h4 class="ejs-title"><a href="'+n+'">'+r+'</a></h4><div class="ejs-desc">'+it(i,150)+"</div></div></div>"},ut="github";k.id=ut;var ct="media",at=["gif","jpg","jpeg","tiff","png","svg","webp"],pt=["ogv","webm","mp4"],ht=["wav","mp3","ogg"];A.id=ct;var lt=function(){return/(?:youtube\.com\/\S*(?:(?:\/e(?:mbed))?\/|watch\/?\?(?:\S*?&?v\=))|youtu\.be\/)([a-zA-Z0-9_-]{6,11})/g},ft=function(t,e,n){return'<iframe class="ejs-embed ejs-'+n+'" src="'+t+'" frameBorder="0" height="'+e+'"></iframe>'},mt="youtube",dt="https://www.youtube.com/";C.id=mt;var vt=function(t,e){if(!t||"object"!=typeof t)return new Error("expected first argument to be an object or array");var n,r,o,i,s;if(Array.isArray(t))for(n=[],r=t.length,o=0;o<r;o++)n.push(t[o][e]);else for(n={},r=(i=Object.keys(t)).length,o=0;o<r;o++)n[s=i[o]]=t[s][e];return n},wt=O,gt=[{patterns:["https?://soundcloud.com/.*/.[^\\s]*"],name:"SoundCloud"},{name:"slideshare",patterns:["https?://www\\.slideshare\\.net/.*/.[^\\s]*","https?://fr\\.slideshare\\.net/.*/.[^\\s]*","https?://de\\.slideshare\\.net/.*/.[^\\s]*","https?://es\\.slideshare\\.net/.*/.[^\\s]*","https?://pt\\.slideshare\\.net/.*/.[^\\s]*"]},{name:"vimeo",patterns:["https?://vimeo\\.com/.[^\\s]*","https?://vimeo\\.com/album/.*/video/.[^\\s]*","https?://vimeo\\.com/channels/.*/.[^\\s]*","https?://vimeo\\.com/groups/.*/videos/.[^\\s]*","https?://vimeo\\.com/ondemand/.*/.[^\\s]*"]},{patterns:["https?://photos\\.app\\.net/.*/.[^\\s]*","https?://live\\.amcharts\\.com/.[^\\s]*","https?://codepen\\.io/.[^\\s]*","https?://codepen\\.io/.[^\\s]*","https?://www\\.collegehumor\\.com/video/.[^\\s]*","https?://www\\.dailymotion\\.com/video/.[^\\s]*","https?://.*\\.deviantart\\.com/art/.[^\\s]*","https?://.*\\.deviantart\\.com/.*#/d.[^\\s]*","https?://dotsub\\.com/view/.[^\\s]*","https?://.*\\.flickr\\.com/photos/.[^\\s]*","https?://flic\\.kr/p/.[^\\s]*","https?://.*\\.wikimedia\\.org/.*_geograph\\.org\\.uk_.[^\\s]*","https?://gfycat\\.com/.[^\\s]*","https?://www\\.gfycat\\.com/.[^\\s]*","https?://gfycat\\.com/.[^\\s]*","https?://www\\.gfycat\\.com/.[^\\s]*","https?://giphy\\.com/gifs/.[^\\s]*","https?://media\\.giphy\\.com/media/.*/giphy\\.gif","https?://www\\.hulu\\.com/watch/.[^\\s]*","https?://www\\.kickstarter\\.com/projects/.[^\\s]*","https?://www\\.mixcloud\\.com/.*/.*/","https?://reddit\\.com/r/.*/comments/.*/.[^\\s]*","https?://.*\\.screen9\\.tv/.[^\\s]*","https?://www\\.scribd\\.com/doc/.[^\\s]*","https?://.*\\.smugmug\\.com/.[^\\s]*","https?://soundcloud\\.com/.[^\\s]*","https?://play\\.soundsgood\\.co/playlist/.[^\\s]*","https?://speakerdeck\\.com/.*/.[^\\s]*","https?://speakerdeck\\.com/.*/.[^\\s]*","https?://ted\\.com/talks/.[^\\s]*","https?://www\\.nytimes\\.com/svc/oembed","https?://nytimes\\.com/.[^\\s]*","https?://.*\\.nytimes\\.com/.[^\\s]*","https?://clips\\.twitch\\.tv/.[^\\s]*","https?://clips\\.twitch\\.tv/.[^\\s]*","https?://www\\.twitch\\.tv/.[^\\s]*","https?://www\\.twitch\\.tv/.[^\\s]*","https?://twitch\\.tv/.[^\\s]*","https?://twitch\\.tv/.[^\\s]*","https?://.*\\.ustream\\.tv/.[^\\s]*","https?://.*\\.ustream\\.com/.[^\\s]*","https?://veervr\\.tv/videos/.[^\\s]*","https?://www\\.vevo\\.com/.[^\\s]*","https?://www\\.vevo\\.com/.[^\\s]*","https?://player\\.vimeo\\.com/video/.[^\\s]*","https?://vine\\.co/v/.[^\\s]*","https?://vine\\.co/v/.[^\\s]*"],name:"oEmbed"},{name:"Imgur",patterns:["https?://imgur\\.com/(?:[^\\/]+/)?[0-9a-zA-Z]+$"]},{patterns:["https?://www\\.(dropbox\\.com/s/.+\\.(?:jpg|png|gif))","https?://db\\.tt/[a-zA-Z0-9][^\\s]+"],name:"Dropbox"},{patterns:["https?://(?:www|mobile\\.)?twitter\\.com/(?:#!/)?([^/]+)/status(?:es)?/(\\d+)"],name:"Twitter"}],yt="noEmbed";T.id=yt;G()&&require("node-fetch");var bt=/&/g,xt=/</g,jt=/>/g,_t=/\'/g,kt=/\"/g,At=/[&<>\"\']/,Pt=function(t){return t=D(t),At.test(t)?t.replace(bt,"&amp;").replace(xt,"&lt;").replace(jt,"&gt;").replace(_t,"&#39;").replace(kt,"&quot;"):t},Et=/\b((?:https?:\/\/|www\d{0,3}[.]|[a-z0-9.\-]+[.][a-z]{2,4}\/)(?:[^\s()<>]+|\(([^\s()<>]+|(\([^\s()<>]+\)))*\))+(?:\(([^\s()<>]+|(\([^\s()<>]+\)))*\)|[^\s`!()\[\]{};:'".,<>?«»“”‘’]))/gi,Lt=/\b(([a-zA-Z0-9\-\_\.])+(\+[a-zA-Z0-9]*)?@[a-zA-Z\_\-]+?(\.[a-zA-Z]{2,6})+)/gim,zt=function(t,e){e||(e={});for(var n,r="",o=0,i=!1===e.escape?function(t){return t}:Pt;n=Et.exec(t);)r+=i(t.slice(o,n.index)),r+=M(n[0],e.attributes),o=Et.lastIndex;return r+=i(t.slice(o)),r=N(r,e.attributes)};H.id="url";var Ct="facebook";U.id=Ct;var Ot="instagram";Y.id=Ot;var St=Object.freeze({highlight:x,media:A,emoji:j,github:k,youtube:C,noEmbed:T,url:H,facebook:U,base:Q,instagram:Y}),It=Object.freeze({all:function(t){var e=R({},{exclude:[]},t);return[H,j,k,T,C,U,x,A,Y].map(function(n){var r=n.id,o=e[r];return-1===e.exclude.indexOf(n.id)?n("youtube"===r||"map"===r?R({},{gAuthKey:t.gAuthKey},o):"noEmbed"===r?R({},o,{exclude:["youtube"]}):o):null}).filter(function(t){return!!t})}}),Zt=function(t){var e={plugins:[],preset:null,inlineEmbed:!0,replaceText:!1,_embeds:[],_services:[]},n=t.input,r=t.plugins;void 0===r&&(r=[]);var o=t.preset;if(!n)throw new Error("You need to pass input element or string in the options object.");var i=$(n)?n.innerHTML:n;this.options=R({},e,t,{result:i,plugins:o?r.concat(o):r,inputString:i})};return Zt.prototype.text=function(){var t=this.resetOptions(),e=t.plugins.map(function(t){return t.transform});return V(e,t)},Zt.prototype.resetOptions=function(){return R({},this.options,{_embeds:[]})},Zt.prototype.load=function(){var t=this;this.options.plugins.forEach(function(e){return e.onLoad&&e.onLoad(t.options)})},Zt.prototype.render=function(){var t=this;return new Promise(function(e,n){function r(){return this.load(),e(c)}var o,i,s,u,c,a;return a=t.options,o=a.input,i=a.target,s=a.inlineEmbed,B(t.options)?$(o)&&o.classList.contains("ejs-applied")?(c=t.options,r.call(t)):t.text().then(function(e){try{return c=e,u=i||o,u.innerHTML=s?c.result:l(c),u.classList.add("ejs-applied"),r.call(t)}catch(t){return n(t)}},n):n(new Error("You haven't passed the input as an element."))})},Zt.prototype.destroy=function(){var t=this.options,e=t.inputString,n=t.input,r=t.target;if(!B(this.options))throw new Error("You haven't passed the input as an element.");var o=r||n;return o.innerHTML=e,o.classList.remove("ejs-applied"),this.options},Zt.plugins=St,Zt.presets=It,Zt});
//# sourceMappingURL=embed.umd.min.js.map
