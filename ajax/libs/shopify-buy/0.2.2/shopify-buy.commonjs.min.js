"use strict";function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function checkStatus(e){if(e.status>=200&&e.status<300)return e;var t=new Error(e.statusText);throw t.status=e.status,t.response=e,t}function parseResponse(e){return e.json().then(function(t){return{json:t,originalResponse:e,isJSON:!0}}).catch(function(){var t=e.clone();return t.text().then(function(e){return{text:e,originalResponse:t,isText:!0}})})}function ajax(e,t){var r=arguments.length<=2||void 0===arguments[2]?{}:arguments[2];return _global2.default.XDomainRequest?_ie9Ajax2.default.apply(void 0,arguments):(r.method=e,r.mode="cors",fetch(t,r).then(checkStatus).then(parseResponse))}function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function authToUrl(e,t){var r=void 0;if(t.headers&&Object.keys(t.headers).forEach(function(e){"authorization"===e.toLowerCase()&&(r=t.headers[e])}),r){var i=r.split(" ").slice(-1)[0];try{var n=atob(i);return e.indexOf("?")>-1?e+"&_x_http_authorization="+n:e+"?_x_http_authorization="+n}catch(e){}}return e}function ie9Ajax(e,t,r){return new Promise(function(i,n){function o(){n(new Error("There was an error with the XDR"))}var a=new XDomainRequest;a.onload=function(){try{var e=JSON.parse(a.responseText);i({json:e,originalResponse:a,isJSON:!0})}catch(e){i({text:a.responseText,originalResponse:a,isText:!0})}},a.onerror=o,a.ontimeout=o,a.open(e,authToUrl(t,r)),a.send(r.data)})}function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _toConsumableArray(e){if(Array.isArray(e)){for(var t=0,r=Array(e.length);t<e.length;t++)r[t]=e[t];return r}return Array.from(e)}function wrapConsole(e){var t=function(){if(console[e]){var t;(t=console)[e].apply(t,arguments)}else{var r;(r=console).log.apply(r,arguments)}};return function(){var e=[].concat(Array.prototype.slice.call(arguments));e.unshift("[JS-BUY-SDK]: "),t.apply(void 0,_toConsumableArray(e))}}function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function wrap(e,t){function r(){var r=this.super;this.super=function(){return t.apply(this,arguments)};var i=e.apply(this,arguments);return this.super=r,i}return r.wrappedFunction=e,r}function defineProperties(e,t,r){var i=Object.getPrototypeOf(r);e.forEach(function(e){var n=Object.getOwnPropertyDescriptor(t,e),o=i.hasOwnProperty(e)&&Object.getOwnPropertyDescriptor(i,e);if("function"==typeof o.value&&"function"==typeof n.value){var a=wrap(n.value,o.value);Object.defineProperty(r,e,{value:a})}else Object.defineProperty(r,e,n)})}function createClass(e){var t=arguments.length<=1||void 0===arguments[1]?Object:arguments[1],r=wrap(e.constructor,t),i=Object.getOwnPropertyNames(e).filter(function(e){return!(0,_includes2.default)(["constructor","static"],e)});(0,_assign2.default)(r,t),r.prototype=Object.create(t.prototype),defineProperties(i,e,r.prototype),r.prototype.constructor=r;var n=e.static;return n&&defineProperties(Object.getOwnPropertyNames(n),n,r),r}function isNodeLikeEnvironment(){var e="undefined"==typeof window,t="function"==typeof require;return e&&t}function uuid(){return++uuidSeed}function setGuidFor(e){if(e&&e[GUID_KEY])return e[GUID_KEY];if(void 0===e)return"(undefined)";if(null===e)return"(null)";var t=void 0;switch(void 0===e?"undefined":_typeof(e)){case"number":(t=numberCache[e])||(t=numberCache[e]="nu"+e);break;case"string":(t=stringCache[e])||(t=stringCache[e]="st"+uuid());break;case"boolean":t=e?"(true)":"(false)";break;default:if(e===Object){t="(Object)";break}if(e===Array){t="(Array)";break}t=GUID_PREFIX+"."+uuid(),null===e[GUID_KEY]?e[GUID_KEY]=t:(GUID_DESC.value=t,Object.defineProperty(e,GUID_KEY,GUID_DESC))}return t}function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _toConsumableArray(e){if(Array.isArray(e)){for(var t=0,r=Array(e.length);t<e.length;t++)r[t]=e[t];return r}return Array.from(e)}function objectsEqual(e,t){return e===t||Object.keys(e).every(function(r){return e[r]instanceof Date?e[r].toString()===t[r].toString():"object"===_typeof(e[r])?objectsEqual(e[r],t[r]):e[r]===t[r]})}function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function fetchFactory(e,t){var r=void 0;switch(e){case"all":r=function(){return this.fetchAll(t)};break;case"one":r=function(){return this.fetch.apply(this,[t].concat(Array.prototype.slice.call(arguments)))};break;case"query":r=function(){return this.fetchQuery.apply(this,[t].concat(Array.prototype.slice.call(arguments)))}}return r}function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(exports,"__esModule",{value:!0});var _ajax=require("../ajax"),_ajax2=_interopRequireDefault(_ajax),_coreObject=require("../metal/core-object"),_coreObject2=_interopRequireDefault(_coreObject),_version=require("../version"),_version2=_interopRequireDefault(_version),ListingsAdapter=_coreObject2.default.extend({ajax:_ajax2.default,constructor:function(e){this.config=e},get base64ApiKey(){return btoa(this.config.apiKey)},get baseUrl(){var e=this.config;return"https://"+e.domain+"/api/apps/"+e.appId},get headers(){return{Authorization:"Basic "+this.base64ApiKey,"Content-Type":"application/json","X-SDK-Variant":"javascript","X-SDK-Version":_version2.default}},pathForType:function(e){return"/"+e.slice(0,-1)+"_listings"},buildUrl:function(e,t,r){switch(e){case"multiple":return this.buildMultipleUrl(t,r);case"single":return this.buildSingleUrl(t,r);default:return""}},buildMultipleUrl:function(e){var t=arguments.length<=1||void 0===arguments[1]?{}:arguments[1],r=""+this.baseUrl+this.pathForType(e),i=Object.keys(t);return i.length>0?r+"?"+i.map(function(e){var r=void 0;return r=Array.isArray(t[e])?t[e].join(","):t[e],e+"="+encodeURIComponent(r)}).join("&"):r},buildSingleUrl:function(e,t){return""+this.baseUrl+this.pathForType(e)+"/"+t},fetchMultiple:function(){var e=this.buildUrl.apply(this,["multiple"].concat(Array.prototype.slice.call(arguments)));return this.ajax("GET",e,{headers:this.headers}).then(function(e){return e.json})},fetchSingle:function(){var e=this.buildUrl.apply(this,["single"].concat(Array.prototype.slice.call(arguments)));return this.ajax("GET",e,{headers:this.headers}).then(function(e){return e.json})}});exports.default=ListingsAdapter,Object.defineProperty(exports,"__esModule",{value:!0});var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol?"symbol":typeof e},_coreObject2=_interopRequireDefault(_coreObject=require("../metal/core-object")),_setGuidFor2=_interopRequireDefault(_setGuidFor=require("../metal/set-guid-for")),_store=require("../store"),_store2=_interopRequireDefault(_store),LocalStorageAdapter=_coreObject2.default.extend({constructor:function(){this.store=new _store2.default},idKeyForType:function(){return _setGuidFor.GUID_KEY},fetchSingle:function(e,t){var r=this;return new Promise(function(i,n){var o=r.store.getItem(r.storageKey(e,t));null!==o?i(o):n(new Error(e+"#"+t+" not found"))})},create:function(e,t){var r=this;return new Promise(function(i){var n=r.identify(t);r.store.setItem(r.storageKey(e,n),t),i(t)})},update:function(e,t,r){var i=this;return new Promise(function(n){i.store.setItem(i.storageKey(e,t),r),n(r)})},storageKey:function(e,t){return e+"."+t},identify:function(e){var t=Object.keys(e);return 1===t.length&&"object"===_typeof(e[t[0]])?(0,_setGuidFor2.default)(e[t[0]]):(0,_setGuidFor2.default)(e)}});exports.default=LocalStorageAdapter,Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=ajax;var _ie9Ajax=require("./ie9-ajax"),_ie9Ajax2=_interopRequireDefault(_ie9Ajax),_global=require("./metal/global"),_global2=_interopRequireDefault(_global);Object.defineProperty(exports,"__esModule",{value:!0});var _coreObject2=_interopRequireDefault(_coreObject=require("./metal/core-object")),_logger=require("./logger"),_logger2=_interopRequireDefault(_logger),Config=_coreObject2.default.extend({constructor:function(e){var t=this;Object.keys(this.deprecatedProperties).forEach(function(r){if(e.hasOwnProperty(r)){var i=t.deprecatedProperties[r];(0,t[i])(e[r],e)}}),this.requiredProperties.forEach(function(r){if(!e.hasOwnProperty(r))throw new Error("new Config() requires the option '"+r+"'");t[r]=e[r]})},deprecatedProperties:{myShopifyDomain:"transformMyShopifyDomain"},transformMyShopifyDomain:function(e,t){_logger2.default.warn("Config - ","myShopifyDomain is deprecated, please use domain and provide the full shop domain."),t.domain=e+".myshopify.com"},requiredProperties:["apiKey","appId","domain"],apiKey:"",appId:"",domain:"",myShopifyDomain:""});exports.default=Config,Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=ie9Ajax;var _global2=_interopRequireDefault(_global=require("./metal/global")),_isNodeLikeEnvironment=require("./metal/is-node-like-environment"),_isNodeLikeEnvironment2=_interopRequireDefault(_isNodeLikeEnvironment),btoa=_global2.default.btoa;!btoa&&(0,_isNodeLikeEnvironment2.default)()&&(_global2.default.btoa=function(e){return new Buffer(e).toString("base64")});var _global2=_interopRequireDefault(_global=require("./metal/global")),_isNodeLikeEnvironment2=_interopRequireDefault(_isNodeLikeEnvironment=require("./metal/is-node-like-environment")),fetch=_global2.default.fetch;if(!fetch&&(0,_isNodeLikeEnvironment2.default)()){var localRequire=require;_global2.default.fetch=localRequire("node-fetch"),_global2.default.Response=_global2.default.fetch.Response}Object.defineProperty(exports,"__esModule",{value:!0}),exports.wrapConsole=void 0;var Logger=(_coreObject2=_interopRequireDefault(_coreObject=require("./metal/core-object"))).default.extend({constructor:function(){},debug:wrapConsole("debug"),info:wrapConsole("info"),warn:wrapConsole("warn"),error:wrapConsole("error")});exports.wrapConsole=wrapConsole,exports.default=new Logger,Object.defineProperty(exports,"__esModule",{value:!0});var assign=void 0;assign="function"==typeof Object.assign?Object.assign:function(e){if(void 0===e||null===e)throw new TypeError("Cannot convert undefined or null to object");var t=Object(e),r=[].slice.call(arguments,1);return r.length>0&&r.forEach(function(e){if(void 0!==e&&null!==e){var r=void 0;for(r in e)e.hasOwnProperty(r)&&(t[r]=e[r])}}),t},exports.default=assign,Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=require("./create-class"),_createClass2=_interopRequireDefault(_createClass),CoreObject=(0,_createClass2.default)({constructor:function(){},static:{extend:function(e){return(0,_createClass2.default)(e,this)}}});exports.default=CoreObject,Object.defineProperty(exports,"__esModule",{value:!0});var _assign=require("./assign"),_assign2=_interopRequireDefault(_assign),_includes=require("./includes"),_includes2=_interopRequireDefault(_includes);exports.default=createClass,Object.defineProperty(exports,"__esModule",{value:!0});var globalNamespace=void 0;globalNamespace="undefined"==typeof global?window:global,exports.default=globalNamespace,Object.defineProperty(exports,"__esModule",{value:!0});var includes=void 0;includes=Array.prototype.includes?function(e){var t=[].slice.call(arguments,1);return Array.prototype.includes.apply(e,t)}:function(e,t){var r=Object(e),i=parseInt(r.length,10)||0;if(0===i)return!1;var n=parseInt(arguments[1],10)||0,o=void 0;for(n>=0?o=n:(o=i+n)<0&&(o=0);o<i;){var a=r[o];if(t===a||t!==t&&a!==a)return!0;o++}return!1},exports.default=includes,Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=isNodeLikeEnvironment,Object.defineProperty(exports,"__esModule",{value:!0});var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol?"symbol":typeof e},GUID_KEY="shopify-buy-uuid",GUID_PREFIX="shopify-buy."+Date.now(),GUID_DESC={writable:!0,configurable:!0,enumerable:!0,value:null},uuidSeed=0,numberCache={},stringCache={};exports.default=setGuidFor,exports.GUID_KEY=GUID_KEY,Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=function(e){return e.reduce(function(e,t){return e.indexOf(t)<0&&e.push(t),e},[])},Object.defineProperty(exports,"__esModule",{value:!0});var _coreObject2=_interopRequireDefault(_coreObject=require("../metal/core-object")),_assign2=_interopRequireDefault(_assign=require("../metal/assign")),BaseModel=_coreObject2.default.extend({constructor:function(){var e=arguments.length<=0||void 0===arguments[0]?{}:arguments[0],t=arguments.length<=1||void 0===arguments[1]?{}:arguments[1];this.attrs=e,(0,_assign2.default)(this,t)},attrs:null,serializer:null,adapter:null,shopClient:null});exports.default=BaseModel,Object.defineProperty(exports,"__esModule",{value:!0});var _baseModel=require("./base-model"),_baseModel2=_interopRequireDefault(_baseModel),_setGuidFor=require("../metal/set-guid-for"),CartLineItem=_baseModel2.default.extend({constructor:function(){this.super.apply(this,arguments)},get id(){return this.attrs[_setGuidFor.GUID_KEY]},get variant_id(){return this.attrs.variant_id},get product_id(){return this.attrs.product_id},get image(){return this.attrs.image},get title(){return this.attrs.title},get quantity(){return this.attrs.quantity},set quantity(e){var t=parseInt(e,10);if(t<0)throw new Error("Quantities must be positive");if(t!==parseFloat(e))throw new Error("Quantities must be whole numbers");return this.attrs.quantity=t,this.attrs.quantity},get properties(){return this.attrs.properties||{}},set properties(e){return this.attrs.properties=e||{},e},get variant_title(){return this.attrs.variant_title},get price(){return this.attrs.price},get compare_at_price(){return this.attrs.compare_at_price},get line_price(){return(this.quantity*parseFloat(this.price)).toFixed(2)},get grams(){return this.attrs.grams}});exports.default=CartLineItem,Object.defineProperty(exports,"__esModule",{value:!0});var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol?"symbol":typeof e},_baseModel2=_interopRequireDefault(_baseModel=require("./base-model")),_cartLineItemModel=require("./cart-line-item-model"),_cartLineItemModel2=_interopRequireDefault(_cartLineItemModel),_assign2=_interopRequireDefault(_assign=require("../metal/assign")),_setGuidFor2=_interopRequireDefault(_setGuidFor=require("../metal/set-guid-for")),_global2=_interopRequireDefault(_global=require("../metal/global")),CartModel=_baseModel2.default.extend({constructor:function(){this.super.apply(this,arguments)},get id(){return this.attrs[_setGuidFor.GUID_KEY]},get lineItems(){return(this.attrs.line_items||[]).map(function(e){return new _cartLineItemModel2.default(e)})},get lineItemCount(){return this.lineItems.reduce(function(e,t){return e+t.quantity},0)},get subtotal(){return this.lineItems.reduce(function(e,t){return e+parseFloat(t.line_price)},0).toFixed(2)},get checkoutUrl(){var e=this.config,t="https://"+e.domain+"/cart",r=this.lineItems.map(function(e){return e.variant_id+":"+e.quantity}),i="api_key="+e.apiKey;if("function"==typeof _global2.default.ga){var n=void 0;_global2.default.ga(function(e){n=e.get("linkerParam")}),n&&(i+="&"+n)}return t+"/"+r+"?"+i},addVariants:function(){var e=[].concat(Array.prototype.slice.call(arguments)).map(function(e){var t={image:e.variant.image,variant_id:e.variant.id,product_id:e.variant.productId,title:e.variant.productTitle,quantity:parseInt(e.quantity,10),properties:e.properties||{},variant_title:e.variant.title,price:e.variant.price,compare_at_price:e.variant.compareAtPrice,grams:e.variant.grams};return(0,_setGuidFor2.default)(t),t}),t=this.attrs.line_items;t.push.apply(t,_toConsumableArray(e));var r=t.reduce(function(e,t){var r=e.filter(function(e){return e.variant_id===t.variant_id&&objectsEqual(e.properties,t.properties)})[0];return r?r.quantity=r.quantity+t.quantity:e.push(t),e},[]);return this.attrs.line_items=r.reduce(function(e,t){return t.quantity>=1&&e.push(t),e},[]),this.updateModel()},updateLineItem:function(e,t){if(t<1)return this.removeLineItem(e);var r=this.lineItems.filter(function(t){return t.id===e})[0];return r?(r.quantity=t,this.updateModel()):new Promise(function(t,r){r(new Error("line item with id: "+e+" not found in cart#"+this.id))})},removeLineItem:function(e){var t=this.lineItems.length,r=this.lineItems.filter(function(t){return t.id!==e});return r.length<t?(this.attrs.line_items=r.map(function(e){return e.attrs}),this.updateModel()):new Promise(function(t,r){r(new Error("line item with id: "+e+" not found in cart#"+this.id))})},clearLineItems:function(){return this.attrs.line_items=[],this.updateModel()},updateModel:function(){var e=this;return this.shopClient.update("carts",this).then(function(t){return(0,_assign2.default)(e.attrs,t.attrs),e})}});exports.default=CartModel,Object.defineProperty(exports,"__esModule",{value:!0}),exports.NO_IMAGE_URI=void 0;var _baseModel2=_interopRequireDefault(_baseModel=require("./base-model")),_productOptionModel=require("./product-option-model"),_productOptionModel2=_interopRequireDefault(_productOptionModel),_productVariantModel=require("./product-variant-model"),_productVariantModel2=_interopRequireDefault(_productVariantModel),_uniq=require("../metal/uniq"),_uniq2=_interopRequireDefault(_uniq),NO_IMAGE_URI="https://widgets.shopifyapps.com/assets/no-image.svg",ProductModel=_baseModel2.default.extend({constructor:function(){this.super.apply(this,arguments)},get id(){return this.attrs.product_id},get title(){return this.attrs.title},get description(){return this.attrs.body_html},get images(){return this.attrs.images},get memoized(){return this._memoized=this._memoized||{},this._memoized},get options(){if(this.memoized.options)return this.memoized.options;var e=this.attrs.options,t=this.variants;return this.memoized.options=e.map(function(e){var r=e.name,i=t.reduce(function(t,r){var i=r.optionValues.filter(function(t){return t.name===e.name})[0];return t.push(i.value),t},[]),n=(0,_uniq2.default)(i);return new _productOptionModel2.default({name:r,values:n})}),this.memoized.options},get variants(){var e=this;return this.attrs.variants.map(function(t){return new _productVariantModel2.default({variant:t,product:e},{config:e.config})})},get selections(){return this.options.map(function(e){return e.selected})},get selectedVariant(){var e=this.selections.join(" / ");return this.variants.filter(function(t){return t.title===e})[0]||null},get selectedVariantImage(){return this.selectedVariant?this.selectedVariant.image:null}});exports.default=ProductModel,exports.NO_IMAGE_URI=NO_IMAGE_URI,Object.defineProperty(exports,"__esModule",{value:!0});var _baseModel2=_interopRequireDefault(_baseModel=require("./base-model")),_includes2=_interopRequireDefault(_includes=require("../metal/includes")),ProductOptionModel=_baseModel2.default.extend({constructor:function(){this.super.apply(this,arguments),this.selected=this.values[0]},get name(){return this.attrs.name},get values(){return this.attrs.values},get selected(){return this._selected},set selected(e){if(!(0,_includes2.default)(this.values,e))throw new Error("Invalid option selection for "+this.name+".");return this._selected=e,e}});exports.default=ProductOptionModel,Object.defineProperty(exports,"__esModule",{value:!0});var ProductVariantModel=(_baseModel2=_interopRequireDefault(_baseModel=require("./base-model"))).default.extend({constructor:function(){this.super.apply(this,arguments)},get id(){return this.attrs.variant.id},get productId(){return this.attrs.product.id},get title(){return this.attrs.variant.title},get productTitle(){return this.attrs.product.title},get compareAtPrice(){return this.attrs.variant.compare_at_price},get price(){return this.attrs.variant.price},get grams(){return this.attrs.variant.grams},get optionValues(){return this.attrs.variant.option_values},get available(){return this.attrs.variant.available},get image(){var e=this.id,t=this.attrs.product.images,r=t[0];return t.filter(function(t){return-1!==t.variant_ids.indexOf(e)})[0]||r},get imageVariants(){if(!this.image)return[];var e=this.image.src,t=e.lastIndexOf("."),r=e.slice(0,t),i=e.slice(t),n=[{name:"pico",dimension:"16x16"},{name:"icon",dimension:"32x32"},{name:"thumb",dimension:"50x50"},{name:"small",dimension:"100x100"},{name:"compact",dimension:"160x160"},{name:"medium",dimension:"240x240"},{name:"large",dimension:"480x480"},{name:"grande",dimension:"600x600"},{name:"1024x1024",dimension:"1024x1024"},{name:"2048x2048",dimension:"2048x2048"}];return n.forEach(function(e){e.src=r+"_"+e.name+i}),n},checkoutUrl:function(){var e=arguments.length<=0||void 0===arguments[0]?1:arguments[0],t=this.config;return"https://"+t.domain+"/cart"+"/"+(this.id+":"+parseInt(e,10))+"?"+("api_key="+t.apiKey)}});exports.default=ProductVariantModel,Object.defineProperty(exports,"__esModule",{value:!0});var _baseModel2=_interopRequireDefault(_baseModel=require("./base-model")),_setGuidFor=require("../metal/set-guid-for"),ReferenceModel=_baseModel2.default.extend({constructor:function(e){if(Object.keys(e).indexOf("referenceId")<0)throw new Error("Missing key referenceId of reference. References to null are not allowed");this.super.apply(this,arguments)},get id(){return this.attrs[_setGuidFor.GUID_KEY]},get referenceId(){return this.attrs.referenceId},set referenceId(e){return this.attrs.referenceId=e,e}});exports.default=ReferenceModel,Object.defineProperty(exports,"__esModule",{value:!0});var _coreObject2=_interopRequireDefault(_coreObject=require("../metal/core-object")),_assign2=_interopRequireDefault(_assign=require("../metal/assign")),_cartModel=require("../models/cart-model"),_cartModel2=_interopRequireDefault(_cartModel),CartSerializer=_coreObject2.default.extend({constructor:function(e){this.config=e},rootKeyForType:function(e){return e.slice(0,-1)},modelForType:function(){return _cartModel2.default},deserializeSingle:function(e){var t=arguments.length<=1||void 0===arguments[1]?{}:arguments[1],r=arguments.length<=2||void 0===arguments[2]?{}:arguments[2],i=t[this.rootKeyForType(e)];return this.modelFromAttrs(e,i,r)},modelFromAttrs:function(e,t,r){var i=this.modelForType(e);return r.config=this.config,new i(t,r)},serialize:function(e,t){var r=this.rootKeyForType(e),i={},n=(0,_assign2.default)({},t.attrs);return i[r]=n,delete n.attributes,Object.keys(n).forEach(function(e){var t=n[e];(null===t||"string"==typeof t&&0===t.length)&&delete n[e]}),i}});exports.default=CartSerializer,Object.defineProperty(exports,"__esModule",{value:!0});var _coreObject2=_interopRequireDefault(_coreObject=require("../metal/core-object")),_baseModel2=_interopRequireDefault(_baseModel=require("../models/base-model")),_productModel2=_interopRequireDefault(_productModel=require("../models/product-model")),ListingsSerializer=_coreObject2.default.extend({constructor:function(e){this.config=e},rootKeyForType:function(e){return e.slice(0,-1)+"_listing"},models:{collections:_baseModel2.default,products:_productModel2.default},modelForType:function(e){return this.models[e]},deserializeSingle:function(e){var t=arguments.length<=1||void 0===arguments[1]?{}:arguments[1],r=arguments.length<=2||void 0===arguments[2]?{}:arguments[2],i=t[this.rootKeyForType(e)];return this.modelFromAttrs(e,i,r)},deserializeMultiple:function(e){var t=this,r=arguments.length<=1||void 0===arguments[1]?{}:arguments[1],i=arguments.length<=2||void 0===arguments[2]?{}:arguments[2];return r[this.rootKeyForType(e)+"s"].map(function(r){return t.modelFromAttrs(e,r,i)})},modelFromAttrs:function(e,t,r){var i=this.modelForType(e);return r.config=this.config,new i(t,r)}});exports.default=ListingsSerializer,Object.defineProperty(exports,"__esModule",{value:!0});var _coreObject2=_interopRequireDefault(_coreObject=require("../metal/core-object")),_assign2=_interopRequireDefault(_assign=require("../metal/assign")),_referenceModel=require("../models/reference-model"),_referenceModel2=_interopRequireDefault(_referenceModel),ReferenceSerializer=_coreObject2.default.extend({constructor:function(e){this.config=e},modelForType:function(){return _referenceModel2.default},deserializeSingle:function(e){var t=arguments.length<=1||void 0===arguments[1]?{}:arguments[1],r=arguments.length<=2||void 0===arguments[2]?{}:arguments[2];return new(this.modelForType(e))(t,r)},serialize:function(e,t){return(0,_assign2.default)({},t.attrs)}});exports.default=ReferenceSerializer,Object.defineProperty(exports,"__esModule",{value:!0});var _listingsSerializer=require("./serializers/listings-serializer"),_listingsSerializer2=_interopRequireDefault(_listingsSerializer),_listingsAdapter=require("./adapters/listings-adapter"),_listingsAdapter2=_interopRequireDefault(_listingsAdapter),_cartSerializer=require("./serializers/cart-serializer"),_cartSerializer2=_interopRequireDefault(_cartSerializer),_referenceSerializer=require("./serializers/reference-serializer"),_referenceSerializer2=_interopRequireDefault(_referenceSerializer),_localStorageAdapter=require("./adapters/local-storage-adapter"),_localStorageAdapter2=_interopRequireDefault(_localStorageAdapter),_coreObject2=_interopRequireDefault(_coreObject=require("./metal/core-object")),_assign2=_interopRequireDefault(_assign=require("./metal/assign")),_setGuidFor=require("./metal/set-guid-for"),ShopClient=_coreObject2.default.extend({constructor:function(e){this.config=e,this.serializers={products:_listingsSerializer2.default,collections:_listingsSerializer2.default,carts:_cartSerializer2.default,references:_referenceSerializer2.default},this.adapters={products:_listingsAdapter2.default,collections:_listingsAdapter2.default,carts:_localStorageAdapter2.default,references:_localStorageAdapter2.default}},config:null,get serializers(){return(0,_assign2.default)({},this.shadowedSerializers)},set serializers(e){this.shadowedSerializers=(0,_assign2.default)({},e)},get adapters(){return(0,_assign2.default)({},this.shadowedAdapters)},set adapters(e){this.shadowedAdapters=(0,_assign2.default)({},e)},fetchAll:function(e){var t=this,r=new this.adapters[e](this.config);return r.fetchMultiple(e).then(function(i){return t.deserialize(e,i,r,null,{multiple:!0})})},fetch:function(e,t){var r=this,i=new this.adapters[e](this.config);return i.fetchSingle(e,t).then(function(t){return r.deserialize(e,t,i,null,{single:!0})})},fetchQuery:function(e,t){var r=this,i=new this.adapters[e](this.config);return i.fetchMultiple(e,t).then(function(t){return r.deserialize(e,t,i,null,{multiple:!0})})},create:function(e){var t=this,r=arguments.length<=1||void 0===arguments[1]?{}:arguments[1],i=new this.adapters[e](this.config),n=new this.serializers[e](this.config),o=new(n.modelForType(e))(r,{shopClient:this}),a=n.serialize(e,o);return i.create(e,a).then(function(r){return t.deserialize(e,r,i,n,{single:!0})})},update:function(e,t){var r=this,i=t.adapter,n=t.serializer,o=n.serialize(e,t),a=t.attrs[i.idKeyForType(e)];return i.update(e,a,o).then(function(t){return r.deserialize(e,t,i,n,{single:!0})})},deserialize:function(e,t,r,i){var n=arguments.length<=4||void 0===arguments[4]?{}:arguments[4],o=i||new this.serializers[e](this.config),a={shopClient:this,adapter:r,serializer:o,type:e};return n.multiple?o.deserializeMultiple(e,t,a):o.deserializeSingle(e,t,a)},createCart:function(){var e=arguments.length<=0||void 0===arguments[0]?{}:arguments[0],t={};return(0,_assign2.default)(t,{line_items:[]}),(0,_assign2.default)(t,e),this.create("carts",t)},updateCart:function(e){return this.update("carts",e)},fetchCart:fetchFactory("one","carts"),fetchAllProducts:fetchFactory("all","products"),fetchAllCollections:fetchFactory("all","collections"),fetchProduct:fetchFactory("one","products"),fetchCollection:fetchFactory("one","collections"),fetchQueryProducts:fetchFactory("query","products"),fetchQueryCollections:fetchFactory("query","collections"),fetchRecentCart:function(){var e=this;return this.fetch("references",this.config.domain+".recent-cart").then(function(t){var r=t.referenceId;return e.fetchCart(r)}).catch(function(){return e.createCart().then(function(t){var r={referenceId:t.id};return r[_setGuidFor.GUID_KEY]=e.config.domain+".recent-cart",e.create("references",r),t})})}});exports.default=ShopClient,Object.defineProperty(exports,"__esModule",{value:!0});var _config=require("./config"),_config2=_interopRequireDefault(_config),_version2=_interopRequireDefault(_version=require("./version")),_shopClient=require("./shop-client"),_shopClient2=_interopRequireDefault(_shopClient);require("./isomorphic-fetch"),require("./isomorphic-btoa");var _productModel=require("./models/product-model"),Shopify={ShopClient:_shopClient2.default,Config:_config2.default,version:_version2.default,NO_IMAGE_URI:_productModel.NO_IMAGE_URI,buildClient:function(){var e=arguments.length<=0||void 0===arguments[0]?{}:arguments[0],t=new this.Config(e);return new this.ShopClient(t)}};exports.default=Shopify,Object.defineProperty(exports,"__esModule",{value:!0});var _global2=_interopRequireDefault(_global=require("./metal/global")),Store=(_coreObject2=_interopRequireDefault(_coreObject=require("./metal/core-object"))).default.extend({constructor:function(){this.localStorageAvailable=this.storageAvailable("localStorage"),this.cache={}},setItem:function(e,t){return this.localStorageAvailable?localStorage.setItem(e,JSON.stringify(t)):this.cache[e]=t,t},getItem:function(e){if(!this.localStorageAvailable)return this.cache[e]||null;var t=localStorage.getItem(e);try{return JSON.parse(t)}catch(e){return null}},storageAvailable:function(e){try{var t=_global2.default[e],r="__storage_test__";return t.setItem(r,r),t.removeItem(r),!0}catch(e){return!1}}});exports.default=Store,Object.defineProperty(exports,"__esModule",{value:!0});var version="v0.2.2-a8212a";exports.default=version;