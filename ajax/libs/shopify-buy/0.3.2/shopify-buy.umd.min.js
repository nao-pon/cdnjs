!function(e,t){if("function"==typeof define&&define.amd)define("shopify-buy",["module"],t);else if("undefined"!=typeof exports)t(module);else{var n={exports:{}};t(n),e.ShopifyBuy=n.exports}}(this,function(e){"use strict";function t(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}function n(e,t){function n(){var n=this.super;this.super=function(){return t.apply(this,arguments)};var r=e.apply(this,arguments);return this.super=n,r}return n.wrappedFunction=e,n}function r(e,t,r){var i=Object.getPrototypeOf(r);e.forEach(function(e){var o=Object.getOwnPropertyDescriptor(t,e),a=i.hasOwnProperty(e)&&Object.getOwnPropertyDescriptor(i,e);if("function"==typeof a.value&&"function"==typeof o.value){var u=n(o.value,a.value);Object.defineProperty(r,e,{value:u})}else Object.defineProperty(r,e,o)})}function i(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Object,i=n(e.constructor,t),o=Object.getOwnPropertyNames(e).filter(function(e){return!_(["constructor","static"],e)});y(i,t),i.prototype=Object.create(t.prototype),r(o,e,i.prototype),i.prototype.constructor=i;var a=e.static;if(a){var u=Object.getOwnPropertyNames(a);r(u,a,i)}return i}function o(e){var n=function(){var t=void 0;t=console[e]?Function.prototype.bind.call(console[e],console):Function.prototype.bind.call(console.log,console),t.apply(void 0,arguments)};return function(){var e=[].concat(Array.prototype.slice.call(arguments));e.unshift("[JS-BUY-SDK]: "),n.apply(void 0,t(e))}}function a(e){return e.reduce(function(e,t){return e.indexOf(t)<0&&e.push(t),e},[])}function u(e,t){var n=void 0;if(t.headers&&Object.keys(t.headers).forEach(function(e){"authorization"===e.toLowerCase()&&(n=t.headers[e])}),n){var r=n.split(" ").slice(-1)[0];try{var i=atob(r),o=void 0;return o=e.indexOf("?")>-1?e+"&_x_http_authorization="+i:e+"?_x_http_authorization="+i}catch(e){}}return e}function s(e,t,n){return new Promise(function(r,i){function o(){i(new Error("There was an error with the XDR"))}var a=new XDomainRequest;a.onload=function(){try{var e=JSON.parse(a.responseText);r({json:e,originalResponse:a,isJSON:!0})}catch(e){r({text:a.responseText,originalResponse:a,isText:!0})}},a.onerror=o,a.ontimeout=o,a.open(e,u(t,n)),a.send(n.data)})}function c(){var e="undefined"==typeof window,t="function"==typeof require;return e&&t}function l(e){if(e.status>=200&&e.status<300)return e;var t=new Error(e.statusText);throw t.status=e.status,t.response=e,t}function f(e){return e.json().then(function(t){return{json:t,originalResponse:e,isJSON:!0}}).catch(function(){var t=e.clone();return t.text().then(function(e){return{text:e,originalResponse:t,isText:!0}})})}function h(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(!c()){var r=new XMLHttpRequest;if(!("withCredentials"in r))return s.apply(void 0,arguments)}return n.method=e,n.mode="cors",fetch(t,n).then(l).then(f)}function p(){return++M}function d(e){if(e&&e[K])return e[K];if(void 0===e)return"(undefined)";if(null===e)return"(null)";var t="undefined"==typeof e?"undefined":v(e),n=void 0;switch(t){case"number":n=U[e],n||(n=U[e]="nu"+e);break;case"string":n=D[e],n||(n=D[e]="st"+p());break;case"boolean":n=e?"(true)":"(false)";break;default:if(e===Object){n="(Object)";break}if(e===Array){n="(Array)";break}n=E+"."+p(),null===e[K]?e[K]=n:(k.value=n,Object.defineProperty(e,K,k))}return n}function m(e,t){return e===t||Object.keys(e).every(function(n){return e[n]instanceof Date?e[n].toString()===t[n].toString():"object"===v(e[n])?m(e[n],t[n]):e[n]===t[n]})}function g(e,t){var n=void 0;switch(e){case"all":n=function(){return this.fetchAll(t)};break;case"one":n=function(){return this.fetch.apply(this,[t].concat(Array.prototype.slice.call(arguments)))};break;case"query":n=function(){return this.fetchQuery.apply(this,[t].concat(Array.prototype.slice.call(arguments)))}}return n}var v="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},b=void 0;b="function"==typeof Object.assign?Object.assign:function(e){if(void 0===e||null===e)throw new TypeError("Cannot convert undefined or null to object");var t=Object(e),n=[].slice.call(arguments,1);return n.length>0&&n.forEach(function(e){if(void 0!==e&&null!==e){var n=void 0;for(n in e)e.hasOwnProperty(n)&&(t[n]=e[n])}}),t};var y=b,w=void 0;w=Array.prototype.includes?function(e){var t=[].slice.call(arguments,1);return Array.prototype.includes.apply(e,t)}:function(e,t){var n=Object(e),r=parseInt(n.length,10)||0;if(0===r)return!1;var i=parseInt(arguments[1],10)||0,o=void 0;for(i>=0?o=i:(o=r+i,o<0&&(o=0));o<r;){var a=n[o];if(t===a||t!==t&&a!==a)return!0;o++}return!1};var _=w,x=i({constructor:function(){},static:{extend:function(e){return i(e,this)}}}),O=x.extend({constructor:function(){},debug:o("debug"),info:o("info"),warn:o("warn"),error:o("error")}),j=new O,I=x.extend({constructor:function(e){var t=this;Object.keys(this.deprecatedProperties).forEach(function(n){if(e.hasOwnProperty(n)){var r=t.deprecatedProperties[n],i=t[r];i(e[n],e)}}),this.requiredProperties.forEach(function(n){if(!e.hasOwnProperty(n))throw new Error("new Config() requires the option '"+n+"'");t[n]=e[n]})},deprecatedProperties:{myShopifyDomain:"transformMyShopifyDomain"},transformMyShopifyDomain:function(e,t){j.warn("Config - ","myShopifyDomain is deprecated, please use domain and provide the full shop domain."),t.domain=e+".myshopify.com"},requiredProperties:["apiKey","appId","domain"],apiKey:"",appId:"",domain:"",myShopifyDomain:""}),S=void 0,A=x.extend({constructor:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.attrs=e,y(this,t)},attrs:null,serializer:null,adapter:null,shopClient:null}),P=A.extend(Object.defineProperties({constructor:function(){this.super.apply(this,arguments),this.selected=this.values[0]}},{name:{get:function(){return this.attrs.name},configurable:!0,enumerable:!0},values:{get:function(){return this.attrs.values},configurable:!0,enumerable:!0},selected:{get:function(){return this._selected},set:function(e){if(!_(this.values,e))throw new Error("Invalid option selection for "+this.name+".");return this._selected=e,e},configurable:!0,enumerable:!0}})),z=A.extend(Object.defineProperties({constructor:function(){this.super.apply(this,arguments)},checkoutUrl:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=this.config,n="https://"+t.domain+"/cart",r=this.id+":"+parseInt(e,10),i="api_key="+t.apiKey;return n+"/"+r+"?"+i}},{id:{get:function(){return this.attrs.variant.id},configurable:!0,enumerable:!0},productId:{get:function(){return this.attrs.product.id},configurable:!0,enumerable:!0},title:{get:function(){return this.attrs.variant.title},configurable:!0,enumerable:!0},productTitle:{get:function(){return this.attrs.product.title},configurable:!0,enumerable:!0},compareAtPrice:{get:function(){return this.attrs.variant.compare_at_price},configurable:!0,enumerable:!0},price:{get:function(){return this.attrs.variant.price},configurable:!0,enumerable:!0},formattedPrice:{get:function(){return this.attrs.variant.formatted_price},configurable:!0,enumerable:!0},grams:{get:function(){return this.attrs.variant.grams},configurable:!0,enumerable:!0},optionValues:{get:function(){return this.attrs.variant.option_values},configurable:!0,enumerable:!0},available:{get:function(){return this.attrs.variant.available},configurable:!0,enumerable:!0},image:{get:function(){var e=this.id,t=this.attrs.product.images,n=t[0],r=t.filter(function(t){return t.variant_ids.indexOf(e)!==-1})[0];return r||n},configurable:!0,enumerable:!0},imageVariants:{get:function(){var e=this.image;if(!e)return[];var t=this.image.src,n=t.lastIndexOf("."),r=t.slice(0,n),i=t.slice(n),o=[{name:"pico",dimension:"16x16"},{name:"icon",dimension:"32x32"},{name:"thumb",dimension:"50x50"},{name:"small",dimension:"100x100"},{name:"compact",dimension:"160x160"},{name:"medium",dimension:"240x240"},{name:"large",dimension:"480x480"},{name:"grande",dimension:"600x600"},{name:"1024x1024",dimension:"1024x1024"},{name:"2048x2048",dimension:"2048x2048"}];return o.forEach(function(e){e.src=r+"_"+e.name+i}),o},configurable:!0,enumerable:!0}})),F="https://widgets.shopifyapps.com/assets/no-image.svg",T=A.extend(Object.defineProperties({constructor:function(){this.super.apply(this,arguments)}},{id:{get:function(){return this.attrs.product_id},configurable:!0,enumerable:!0},title:{get:function(){return this.attrs.title},configurable:!0,enumerable:!0},description:{get:function(){return this.attrs.body_html},configurable:!0,enumerable:!0},images:{get:function(){return this.attrs.images},configurable:!0,enumerable:!0},memoized:{get:function(){return this._memoized=this._memoized||{},this._memoized},configurable:!0,enumerable:!0},options:{get:function(){if(this.memoized.options)return this.memoized.options;var e=this.attrs.options,t=this.variants;return this.memoized.options=e.map(function(e){var n=e.name,r=t.reduce(function(t,n){var r=n.optionValues.filter(function(t){return t.name===e.name})[0];return t.push(r.value),t},[]),i=a(r);return new P({name:n,values:i})}),this.memoized.options},configurable:!0,enumerable:!0},variants:{get:function(){var e=this;return this.attrs.variants.map(function(t){return new z({variant:t,product:e},{config:e.config})})},configurable:!0,enumerable:!0},selections:{get:function(){return this.options.map(function(e){return e.selected})},configurable:!0,enumerable:!0},selectedVariant:{get:function(){var e=this.selections.join(" / ");return this.variants.filter(function(t){return t.title===e})[0]||null},configurable:!0,enumerable:!0},selectedVariantImage:{get:function(){return this.selectedVariant?this.selectedVariant.image:null},configurable:!0,enumerable:!0}})),C=x.extend({constructor:function(e){this.config=e},rootKeyForType:function(e){return e.slice(0,-1)+"_listing"},models:{collections:A,products:T},modelForType:function(e){return this.models[e]},deserializeSingle:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=t[this.rootKeyForType(e)],i=this.modelFromAttrs(e,r,n);return i},deserializeMultiple:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i=n[this.rootKeyForType(e)+"s"];return i.map(function(n){var i=t.modelFromAttrs(e,n,r);return i})},modelFromAttrs:function(e,t,n){var r=this.modelForType(e);return n.config=this.config,new r(t,n)}}),q=x.extend(Object.defineProperties({ajax:h,constructor:function(e){this.config=e},pathForType:function(e){return"/"+e.slice(0,-1)+"_listings"},buildUrl:function(e,t,n){switch(e){case"multiple":return this.buildMultipleUrl(t,n);case"single":return this.buildSingleUrl(t,n);default:return""}},buildMultipleUrl:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=""+this.baseUrl+this.pathForType(e),r=Object.keys(t);if(r.length>0){var i=r.map(function(e){var n=void 0;return n=Array.isArray(t[e])?t[e].join(","):t[e],e+"="+encodeURIComponent(n)}).join("&");return n+"?"+i}return n},buildSingleUrl:function(e,t){return""+this.baseUrl+this.pathForType(e)+"/"+t},fetchMultiple:function(){var e=this.buildUrl.apply(this,["multiple"].concat(Array.prototype.slice.call(arguments)));return this.ajax("GET",e,{headers:this.headers}).then(function(e){return e.json})},fetchSingle:function(){var e=this.buildUrl.apply(this,["single"].concat(Array.prototype.slice.call(arguments)));return this.ajax("GET",e,{headers:this.headers}).then(function(e){return e.json})}},{base64ApiKey:{get:function(){return btoa(this.config.apiKey)},configurable:!0,enumerable:!0},baseUrl:{get:function(){var e=this.config,t=e.domain,n=e.appId;return"https://"+t+"/api/apps/"+n},configurable:!0,enumerable:!0},headers:{get:function(){return{Authorization:"Basic "+this.base64ApiKey,"Content-Type":"application/json","X-SDK-Variant":"javascript","X-SDK-Version":S}},configurable:!0,enumerable:!0}})),K="shopify-buy-uuid",E="shopify-buy."+Date.now(),k={writable:!0,configurable:!0,enumerable:!0,value:null},M=0,U={},D={},R=A.extend(Object.defineProperties({constructor:function(){this.super.apply(this,arguments)}},{id:{get:function(){return this.attrs[K]},configurable:!0,enumerable:!0},variant_id:{get:function(){return this.attrs.variant_id},configurable:!0,enumerable:!0},product_id:{get:function(){return this.attrs.product_id},configurable:!0,enumerable:!0},image:{get:function(){return this.attrs.image},configurable:!0,enumerable:!0},title:{get:function(){return this.attrs.title},configurable:!0,enumerable:!0},quantity:{get:function(){return this.attrs.quantity},set:function(e){var t=parseInt(e,10);if(t<0)throw new Error("Quantities must be positive");if(t!==parseFloat(e))throw new Error("Quantities must be whole numbers");return this.attrs.quantity=t,this.attrs.quantity},configurable:!0,enumerable:!0},properties:{get:function(){return this.attrs.properties||{}},set:function(e){return this.attrs.properties=e||{},e},configurable:!0,enumerable:!0},variant_title:{get:function(){return this.attrs.variant_title},configurable:!0,enumerable:!0},price:{get:function(){return this.attrs.price},configurable:!0,enumerable:!0},compare_at_price:{get:function(){return this.attrs.compare_at_price},configurable:!0,enumerable:!0},line_price:{get:function(){return(this.quantity*parseFloat(this.price)).toFixed(2)},configurable:!0,enumerable:!0},grams:{get:function(){return this.attrs.grams},configurable:!0,enumerable:!0}})),V=void 0;V="undefined"==typeof global?window:global;var N=V,J=A.extend(Object.defineProperties({constructor:function(){this.super.apply(this,arguments)},addVariants:function(){var e=[].concat(Array.prototype.slice.call(arguments)).map(function(e){var t={image:e.variant.image,variant_id:e.variant.id,product_id:e.variant.productId,title:e.variant.productTitle,quantity:parseInt(e.quantity,10),properties:e.properties||{},variant_title:e.variant.title,price:e.variant.price,compare_at_price:e.variant.compareAtPrice,grams:e.variant.grams};return d(t),t}),n=this.attrs.line_items;n.push.apply(n,t(e));var r=n.reduce(function(e,t){var n=e.filter(function(e){return e.variant_id===t.variant_id&&m(e.properties,t.properties)})[0];return n?n.quantity=n.quantity+t.quantity:e.push(t),e},[]);return this.attrs.line_items=r.reduce(function(e,t){return t.quantity>=1&&e.push(t),e},[]),this.updateModel()},updateLineItem:function(e,t){if(t<1)return this.removeLineItem(e);var n=this.lineItems.filter(function(t){return t.id===e})[0];return n?(n.quantity=t,this.updateModel()):new Promise(function(t,n){n(new Error("line item with id: "+e+" not found in cart#"+this.id))})},removeLineItem:function(e){var t=this.lineItems.length,n=this.lineItems.filter(function(t){return t.id!==e}),r=n.length;return r<t?(this.attrs.line_items=n.map(function(e){return e.attrs}),this.updateModel()):new Promise(function(t,n){n(new Error("line item with id: "+e+" not found in cart#"+this.id))})},clearLineItems:function(){return this.attrs.line_items=[],this.updateModel()},updateModel:function(){var e=this;return this.shopClient.update("carts",this).then(function(t){return y(e.attrs,t.attrs),e})}},{id:{get:function(){return this.attrs[K]},configurable:!0,enumerable:!0},lineItems:{get:function(){return(this.attrs.line_items||[]).map(function(e){return new R(e)})},configurable:!0,enumerable:!0},lineItemCount:{get:function(){return this.lineItems.reduce(function(e,t){return e+t.quantity},0)},configurable:!0,enumerable:!0},subtotal:{get:function(){var e=this.lineItems.reduce(function(e,t){return e+parseFloat(t.line_price)},0);return e.toFixed(2)},configurable:!0,enumerable:!0},checkoutUrl:{get:function(){var e=this.config,t="https://"+e.domain+"/cart",n=this.lineItems.map(function(e){return e.variant_id+":"+e.quantity}),r="api_key="+e.apiKey;if("function"==typeof N.ga){var i=void 0;N.ga(function(e){i=e.get("linkerParam")}),i&&(r+="&"+i)}return t+"/"+n+"?"+r},configurable:!0,enumerable:!0}})),L=x.extend({constructor:function(e){this.config=e},rootKeyForType:function(e){return e.slice(0,-1)},modelForType:function(){return J},deserializeSingle:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=t[this.rootKeyForType(e)],i=this.modelFromAttrs(e,r,n);return i},modelFromAttrs:function(e,t,n){var r=this.modelForType(e);return n.config=this.config,new r(t,n)},serialize:function(e,t){var n=this.rootKeyForType(e),r={},i=y({},t.attrs);return r[n]=i,delete i.attributes,Object.keys(i).forEach(function(e){var t=i[e];(null===t||"string"==typeof t&&0===t.length)&&delete i[e]}),r}}),Q=A.extend(Object.defineProperties({constructor:function(e){if(Object.keys(e).indexOf("referenceId")<0)throw new Error("Missing key referenceId of reference. References to null are not allowed");this.super.apply(this,arguments)}},{id:{get:function(){return this.attrs[K]},configurable:!0,enumerable:!0},referenceId:{get:function(){return this.attrs.referenceId},set:function(e){return this.attrs.referenceId=e,e},configurable:!0,enumerable:!0}})),X=x.extend({constructor:function(e){this.config=e},modelForType:function(){return Q},deserializeSingle:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=this.modelForType(e);return new r(t,n)},serialize:function(e,t){var n=y({},t.attrs);return n}}),B=x.extend({constructor:function(){this.localStorageAvailable=this.storageAvailable("localStorage"),this.cache={}},setItem:function(e,t){return this.localStorageAvailable?localStorage.setItem(e,JSON.stringify(t)):this.cache[e]=t,t},getItem:function(e){if(!this.localStorageAvailable)return this.cache[e]||null;var t=localStorage.getItem(e);try{return JSON.parse(t)}catch(e){return null}},storageAvailable:function(e){try{var t=N[e],n="__storage_test__";return t.setItem(n,n),t.removeItem(n),!0}catch(e){return!1}}}),G=x.extend({constructor:function(){this.store=new B},idKeyForType:function(){return K},fetchSingle:function(e,t){var n=this;return new Promise(function(r,i){var o=n.store.getItem(n.storageKey(e,t));return null===o?void i(new Error(e+"#"+t+" not found")):void r(o)})},create:function(e,t){var n=this;return new Promise(function(r){var i=n.identify(t);n.store.setItem(n.storageKey(e,i),t),r(t)})},update:function(e,t,n){var r=this;return new Promise(function(i){r.store.setItem(r.storageKey(e,t),n),i(n)})},storageKey:function(e,t){return e+"."+t},identify:function(e){var t=Object.keys(e);return d(1===t.length&&"object"===v(e[t[0]])?e[t[0]]:e)}}),H=x.extend(Object.defineProperties({constructor:function(e){this.config=e,this.serializers={products:C,collections:C,carts:L,references:X},this.adapters={products:q,collections:q,carts:G,references:G}},config:null,fetchAll:function(e){var t=this,n=new this.adapters[e](this.config);return n.fetchMultiple(e).then(function(r){return t.deserialize(e,r,n,null,{multiple:!0})})},fetch:function(e,t){var n=this,r=new this.adapters[e](this.config);return r.fetchSingle(e,t).then(function(t){return n.deserialize(e,t,r,null,{single:!0})})},fetchQuery:function(e,t){var n=this,r=new this.adapters[e](this.config);return r.fetchMultiple(e,t).then(function(t){return n.deserialize(e,t,r,null,{multiple:!0})})},create:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=new this.adapters[e](this.config),i=new this.serializers[e](this.config),o=i.modelForType(e),a=new o(n,{shopClient:this}),u=i.serialize(e,a);return r.create(e,u).then(function(n){return t.deserialize(e,n,r,i,{single:!0})})},update:function(e,t){var n=this,r=t.adapter,i=t.serializer,o=i.serialize(e,t),a=t.attrs[r.idKeyForType(e)];return r.update(e,a,o).then(function(t){return n.deserialize(e,t,r,i,{single:!0})})},deserialize:function(e,t,n,r){var i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{},o=r||new this.serializers[e](this.config),a={shopClient:this,adapter:n,serializer:o,type:e},u=void 0;return u=i.multiple?o.deserializeMultiple(e,t,a):o.deserializeSingle(e,t,a)},createCart:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t={line_items:[]},n={};return y(n,t),y(n,e),this.create("carts",n)},updateCart:function(e){return this.update("carts",e)},fetchCart:g("one","carts"),fetchAllProducts:g("all","products"),fetchAllCollections:g("all","collections"),fetchProduct:g("one","products"),fetchCollection:g("one","collections"),fetchQueryProducts:g("query","products"),fetchQueryCollections:g("query","collections"),fetchRecentCart:function(){var e=this;return this.fetch("references",this.config.domain+".recent-cart").then(function(t){var n=t.referenceId;return e.fetchCart(n)}).catch(function(){return e.createCart().then(function(t){var n={referenceId:t.id};return n[K]=e.config.domain+".recent-cart",e.create("references",n),t})})}},{serializers:{get:function(){return y({},this.shadowedSerializers)},set:function(e){this.shadowedSerializers=y({},e)},configurable:!0,enumerable:!0},adapters:{get:function(){return y({},this.shadowedAdapters)},set:function(e){this.shadowedAdapters=y({},e)},configurable:!0,enumerable:!0}})),Y=N.fetch;if(!Y&&c()){var W=require;N.fetch=W("node-fetch"),N.Response=N.fetch.Response}var Z=N.btoa;!Z&&c()&&(N.btoa=function(e){return new Buffer(e).toString("base64")});var $={ShopClient:H,Config:I,version:S,NO_IMAGE_URI:F,buildClient:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=new this.Config(e);return new this.ShopClient(t)}};e.exports=$});