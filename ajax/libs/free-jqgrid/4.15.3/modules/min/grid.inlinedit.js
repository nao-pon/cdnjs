!function(e){"use strict";"function"==typeof define&&define.amd?define(["jquery","./grid.base","./jquery.fmatter","./grid.common"],e):"object"==typeof module&&module.exports?module.exports=function(t,i){return t||(t=window),void 0===i&&(i="undefined"!=typeof window?require("jquery"):require("jquery")(t)),require("./grid.base"),require("./jquery.fmatter"),require("./grid.common"),e(i),i}:e(jQuery)}(function(e){"use strict";var t=e.jgrid,i=t.fullBoolFeedback,r=t.hasOneFromClasses,a=e.fn.jqGrid,o=function(e){return a.getGuiStyles.call(this,"states."+e)},n=function(i){var r=e.makeArray(arguments).slice(1);return r.unshift(""),r.unshift("Inline"),r.unshift(i),t.feedback.apply(this,r)};t.inlineEdit=t.inlineEdit||{},t.extend({editRow:function(r,a,d,l,s,c,u,f,m,p){var v={},w=e.makeArray(arguments).slice(1);return"object"===e.type(w[0])?v=w[0]:(void 0!==a&&(v.keys=a),e.isFunction(d)&&(v.oneditfunc=d),e.isFunction(l)&&(v.successfunc=l),void 0!==s&&(v.url=s),null!=c&&(v.extraparam=c),e.isFunction(u)&&(v.aftersavefunc=u),e.isFunction(f)&&(v.errorfunc=f),e.isFunction(m)&&(v.afterrestorefunc=m),e.isFunction(p)&&(v.beforeEditRow=p)),this.each(function(){var a=this,d=e(a),l=a.p,s=0,c=null,u={},f={},m=l.colModel,p=l.prmNames;if(a.grid){var w=e.extend(!0,{keys:!1,oneditfunc:null,successfunc:null,url:null,extraparam:{},aftersavefunc:null,errorfunc:null,afterrestorefunc:null,restoreAfterError:!0,beforeEditRow:null,focusField:!0},t.inlineEdit,l.inlineEditing||{},v),h=d.jqGrid("getInd",r,!0),R=w.focusField,g="object"==typeof R&&null!=R?e(R.target||R).closest("tr.jqgrow>td")[0]:null;if(!1!==h&&(w.extraparam[p.oper]===p.addoper||n.call(a,w,"beforeEditRow",w,r))&&"0"===(e(h).attr("editable")||"0")&&!e(h).hasClass("not-editable-row")){var j=t.detectRowEditing.call(a,r);if(null!=j&&"cellEditing"===j.mode){var x=j.savedRow,q=a.rows[x.id],b=o.call(a,"select");d.jqGrid("restoreCell",x.id,x.ic),e(q.cells[x.ic]).removeClass("edit-cell "+b),e(q).addClass(b).attr({"aria-selected":"true",tabindex:"0"})}if(t.enumEditableCells.call(a,h,e(h).hasClass("jqgrid-new-row")?"add":"edit",function(i){var o,n,d,m=i.cm,p=e(i.dataElement),v=i.dataWidth,w=m.name,h=m.edittype,R=i.iCol,g=m.editoptions||{};if(f[w]=i.editable,"hidden"!==i.editable){try{o=e.unformat.call(this,i.td,{rowId:r,colModel:m},R)}catch(e){o="textarea"===h?p.text():p.html()}u[w]=o,p.html(""),n=e.extend({},g,{id:r+"_"+w,name:w,rowId:r,mode:i.mode,cm:m,iCol:R}),("&nbsp;"===o||"&#160;"===o||1===o.length&&160===o.charCodeAt(0))&&(o=""),d=t.createEl.call(a,h,n,o,!0,e.extend({},t.ajaxOptions,l.ajaxSelectOptions||{})),e(d).addClass("editable"),p.append(d),v&&e(d).width(i.dataWidth),t.bindEv.call(a,d,n),"select"===h&&!0===g.multiple&&void 0===g.dataUrl&&t.msie&&e(d).width(e(d).width()),null===c&&(c=R),s++}}),s>0){if(u.id=r,l.savedRow.push(u),l.editingInfo[r]={mode:"inlineEditing",savedRow:u,editable:f},e(h).attr("editable","1"),R&&("number"==typeof R&&parseInt(R,10)<=m.length?c=R:"string"==typeof R?c=l.iColByName[R]:null!=g&&(c=g.cellIndex),setTimeout(function(){var t=d.jqGrid("getNumberOfFrozenColumns"),i=function(e){return l.frozenColumns&&t>0&&c<t?a.grid.fbRows[h.rowIndex].cells[e]:h.cells[e]},r=function(t){return e(t).find("input,textarea,select,button,object,*[tabindex]").filter(":input:visible:not(:disabled)")},o=function(){return r(l.frozenColumns&&t>0?a.grid.fbRows[h.rowIndex]:h).first()},n=r(i(c));n.length>0?n.first().focus():"number"==typeof w.defaultFocusField||"string"==typeof w.defaultFocusField?(0===(n=r(i("number"==typeof w.defaultFocusField?w.defaultFocusField:l.iColByName[w.defaultFocusField]))).length&&(n=o()),n.first().focus()):o().focus()},0)),!0===w.keys){var y=e(h);l.frozenColumns&&(y=y.add(a.grid.fbRows[h.rowIndex])),y.on("keydown",function(e){if(27===e.keyCode)return d.jqGrid("restoreRow",r,w.afterrestorefunc),!1;if(13===e.keyCode){return"TEXTAREA"===e.target.tagName||(d.jqGrid("saveRow",r,w),!1)}})}i.call(a,w.oneditfunc,"jqGridInlineEditRow",r,w)}}}})},saveRow:function(r,a,d,l,s,c,u,f){var m,p=e.makeArray(arguments).slice(1),v={},w=this[0],h=e(w),R=null!=w?w.p:null,g=t.info_dialog,j=e.isFunction,x=null!=t.defaults&&j(t.defaults.fatalError)?t.defaults.fatalError:alert;if(w.grid&&null!=R){"object"===e.type(p[0])?v=p[0]:(j(a)&&(v.successfunc=a),void 0!==d&&(v.url=d),void 0!==l&&(v.extraparam=l),j(s)&&(v.aftersavefunc=s),j(c)&&(v.errorfunc=c),j(u)&&(v.afterrestorefunc=u),j(f)&&(v.beforeSaveRow=f));var q=function(e){return h.jqGrid("getGridRes",e)};v=e.extend(!0,{successfunc:null,url:null,extraparam:{},aftersavefunc:null,errorfunc:null,afterrestorefunc:null,restoreAfterError:!0,beforeSaveRow:null,ajaxSaveOptions:{},serializeSaveData:null,mtype:"POST",saveui:"enable",savetext:q("defaults.savetext")||"Saving..."},t.inlineEdit,R.inlineEditing||{},v);var b,y,I,G,E,C,P,S,D={},k={},F={},A=h.jqGrid("getInd",r,!0),_=e(A),O=R.prmNames,T=q("errors.errcap"),B=q("edit.bClose"),N=function(i,r){try{var a=t.getRelativeRect.call(w,r);g.call(w,T,i,B,{top:a.top,left:a.left+e(w).closest(".ui-jqgrid").offset().left})}catch(e){x(i)}};if(!1!==A&&(m=v.extraparam[O.oper]===O.addoper?"add":"edit",n.call(w,v,"beforeSaveRow",v,r,m)&&(b=_.attr("editable"),v.url=v.url||R.editurl,P="clientArray"!==v.url,"1"===b))){if(C=e.jgrid.detectRowEditing.call(w,r),t.enumEditableCells.call(w,A,_.hasClass("jqgrid-new-row")?"add":"edit",function(i){var r=i.cm,a=r.formatter,o=r.editoptions||{},n=r.formatoptions||{},d={},l=t.getEditedValue.call(w,e(i.dataElement),r,d,i.editable);if("select"===r.edittype&&"select"!==r.formatter&&(k[r.name]=d.text),null!=(E=t.checkValues.call(w,l,i.iCol,void 0,void 0,e.extend(i,{oldValue:null!=C?C.savedRow[r.name]:null,newValue:l,oldRowData:null!=C?C.savedRow:null})))&&!1===E[0])return S=!0,N(E[1],i.td),!1;"date"===a&&!0!==n.sendFormatted&&(l=e.unformat.date.call(w,l,r)),P&&!0===o.NullIfEmpty&&""===l&&(l="null"),D[r.name]=l}),S)return;var z;O=R.prmNames,z=!1===R.keyName?O.id:R.keyName,D&&(D[O.oper]=O.editoper,void 0!==D[z]&&""!==D[z]||(D[z]=t.stripPref(R.idPrefix,r)),D=e.extend({},D,R.inlineData||{},v.extraparam));var V={options:v,rowid:r,tr:A,iRow:A.rowIndex,savedRow:C.savedRow,newData:D,mode:m};if(!n.call(w,v,"saveRowValidation",V))return void(V.errorText&&N(V.errorText,A));if(P)h.jqGrid("progressBar",{method:"show",loadtype:v.saveui,htmlcontent:v.savetext}),(F=e.extend({},D,F))[z]=t.stripPref(R.idPrefix,F[z]),R.autoEncodeOnEdit&&e.each(F,function(e,i){j(i)||(F[e]=t.oldEncodePostedData(i))}),A.id===R.idPrefix+F[z]||null==O.idold||F.hasOwnProperty(O.idold)||(F[O.idold]=t.stripPref(R.idPrefix,A.id)),e.ajax(e.extend({url:j(v.url)?v.url.call(w,F[z],m,F,v):v.url,data:t.serializeFeedback.call(w,j(v.serializeSaveData)?v.serializeSaveData:R.serializeRowData,"jqGridInlineSerializeSaveData",F),type:j(v.mtype)?v.mtype.call(w,m,v,F[z],F):v.mtype,complete:function(a,o){if(h.jqGrid("progressBar",{method:"hide",loadtype:v.saveui}),(a.status<300||304===a.status)&&(0!==a.status||4!==a.readyState)){var n,d,l;if(null!=(d=h.triggerHandler("jqGridInlineSuccessSaveRow",[a,r,v,m,F]))&&!0!==d||(d=[!0,D]),d[0]&&j(v.successfunc)&&(d=v.successfunc.call(w,a,r,v,m,F)),e.isArray(d)?(n=d[0],D=d[1]||D):n=d,!0===n){for(R.autoEncodeOnEdit&&e.each(D,function(e,i){D[e]=t.oldDecodePostedData(i)}),D=e.extend({},D,k),h.jqGrid("setRowData",r,D),_.attr("editable","0"),l=0;l<R.savedRow.length;l++)if(String(R.savedRow[l].id)===String(r)){I=l;break}I>=0&&(R.savedRow.splice(I,1),delete R.editingInfo[r]),i.call(w,v.aftersavefunc,"jqGridInlineAfterSaveRow",r,a,D,v),null!=d[2]?h.jqGrid("changeRowid",r,R.idPrefix+d[2]):A.id!==R.idPrefix+D[z]&&h.jqGrid("changeRowid",A.id,R.idPrefix+D[z]),_.removeClass("jqgrid-new-row").off("keydown")}else i.call(w,v.errorfunc,"jqGridInlineErrorSaveRow",r,a,o,null,v),!0===v.restoreAfterError&&h.jqGrid("restoreRow",r,v.afterrestorefunc)}},error:function(e,t,i){if(h.triggerHandler("jqGridInlineErrorSaveRow",[r,e,t,i,v]),j(v.errorfunc))v.errorfunc.call(w,r,e,t,i);else{var a=e.responseText||e.statusText;try{g.call(w,T,'<div class="'+o.call(w,"error")+'">'+a+"</div>",B,{buttonalign:"right"})}catch(e){x(a)}}!0===v.restoreAfterError&&h.jqGrid("restoreRow",r,v.afterrestorefunc)}},t.ajaxOptions,R.ajaxRowOptions,v.ajaxSaveOptions||{}));else{for(D=e.extend({},D,k),G=h.jqGrid("setRowData",r,D),_.attr("editable","0"),y=0;y<R.savedRow.length;y++)if(String(R.savedRow[y].id)===String(r)){I=y;break}I>=0&&(R.savedRow.splice(I,1),delete R.editingInfo[r]),i.call(w,v.aftersavefunc,"jqGridInlineAfterSaveRow",r,G,D,v),_.removeClass("jqgrid-new-row").off("keydown"),A.id!==R.idPrefix+D[z]&&h.jqGrid("changeRowid",A.id,R.idPrefix+D[z])}}}},restoreRow:function(r,a){var o=e.makeArray(arguments).slice(1),d={};return"object"===e.type(o[0])?d=o[0]:e.isFunction(a)&&(d.afterrestorefunc=a),this.each(function(){var a,o=this,l=e(o),s=o.p,c=-1,u={};if(o.grid){var f=e.extend(!0,{},t.inlineEdit,s.inlineEditing||{},d),m=l.jqGrid("getInd",r,!0);if(!1!==m&&n.call(o,f,"beforeCancelRow",f,r)){for(a=0;a<s.savedRow.length;a++)if(String(s.savedRow[a].id)===String(r)){c=a;break}if(c>=0){if(e.isFunction(e.fn.datepicker))try{e("input.hasDatepicker","#"+t.jqID(m.id)).datepicker("hide")}catch(e){}e.each(s.colModel,function(){var t=this.name;s.savedRow[c].hasOwnProperty(t)&&(u[t]=s.savedRow[c][t],!this.formatter||"date"!==this.formatter||null!=this.formatoptions&&!0===this.formatoptions.sendFormatted||(u[t]=e.unformat.date.call(o,u[t],this)))}),l.jqGrid("setRowData",r,u),e(m).attr("editable","0").off("keydown"),s.savedRow.splice(c,1),delete s.editingInfo[r],e("#"+t.jqID(r),o).hasClass("jqgrid-new-row")&&setTimeout(function(){l.jqGrid("delRowData",r),l.jqGrid("showAddEditButtons",!1)},0)}i.call(o,f.afterrestorefunc,"jqGridInlineAfterRestoreRow",r)}}})},addRow:function(i){return this.each(function(){if(this.grid){var r=this,a=e(r),o=r.p,d=e.extend(!0,{rowID:null,initdata:{},position:"first",useDefValues:!0,useFormatter:!1,beforeAddRow:null,addRowParams:{extraparam:{}}},t.inlineEdit,o.inlineEditing||{},i||{});if(n.call(r,d,"beforeAddRow",d.addRowParams))if(d.rowID=e.isFunction(d.rowID)?d.rowID.call(r,d):null!=d.rowID?d.rowID:t.randId(),!0===d.useDefValues&&e(o.colModel).each(function(){if(this.editoptions&&this.editoptions.defaultValue){var t=this.editoptions.defaultValue;d.initdata[this.name]=e.isFunction(t)?t.call(r,d):t}}),d.rowID=o.idPrefix+d.rowID,a.jqGrid("addRowData",d.rowID,d.initdata,d.position),e("#"+t.jqID(d.rowID),r).addClass("jqgrid-new-row"),d.useFormatter)e("#"+t.jqID(d.rowID)+" .ui-inline-edit",r).click();else{var l=o.prmNames,s=l.oper;d.addRowParams.extraparam[s]=l.addoper,a.jqGrid("editRow",d.rowID,d.addRowParams),a.jqGrid("setSelection",d.rowID)}}})},inlineNav:function(i,a){return"object"==typeof i&&(a=i,i=void 0),this.each(function(){var n=this,d=e(n),l=n.p;if(this.grid&&null!=l){var s,c=i===l.toppager?l.idSel+"_top":l.idSel,u=i===l.toppager?l.id+"_top":l.id,f=o.call(n,"disabled"),m=e.extend(!0,{edit:!0,editicon:"ui-icon-pencil",add:!0,addicon:"ui-icon-plus",save:!0,saveicon:"ui-icon-disk",cancel:!0,cancelicon:"ui-icon-cancel",commonIconClass:"ui-icon",iconsOverText:!1,addParams:{addRowParams:{extraparam:{}}},editParams:{},restoreAfterSelect:!0},d.jqGrid("getGridRes","nav"),t.nav||{},l.navOptions||{},t.inlineNav||{},l.inlineNavOptions||{},a||{}),p=function(){n.modalAlert()};if(void 0===i)if(l.pager){if(d.jqGrid("inlineNav",l.pager,m),!l.toppager)return;i=l.toppager,c=l.idSel+"_top",u=l.id+"_top"}else l.toppager&&(i=l.toppager,c=l.idSel+"_top",u=l.id+"_top");if(void 0!==i&&!((s=e(i)).length<=0)){if(s.find(".navtable").length<=0&&d.jqGrid("navGrid",i,{add:!1,edit:!1,del:!1,search:!1,refresh:!1,view:!1}),l._inlinenav=!0,!0===m.addParams.useFormatter){var v,w,h,R=l.colModel;for(v=0;v<R.length;v++)if(R[v].formatter&&"actions"===R[v].formatter){R[v].formatoptions&&(w={keys:!1,onEdit:null,onSuccess:null,afterSave:null,onError:null,afterRestore:null,extraparam:{},url:null},h=e.extend(w,R[v].formatoptions),m.addParams.addRowParams={keys:h.keys,oneditfunc:h.onEdit,successfunc:h.onSuccess,url:h.url,extraparam:h.extraparam,aftersavefunc:h.afterSave,errorfunc:h.onError,afterrestorefunc:h.afterRestore});break}}m.add&&d.jqGrid("navButtonAdd",i,{caption:m.addtext,title:m.addtitle,commonIconClass:m.commonIconClass,buttonicon:m.addicon,iconsOverText:m.iconsOverText,id:u+"_iladd",onClickButton:function(){r(this,f)||d.jqGrid("addRow",m.addParams)}}),m.edit&&d.jqGrid("navButtonAdd",i,{caption:m.edittext,title:m.edittitle,commonIconClass:m.commonIconClass,buttonicon:m.editicon,iconsOverText:m.iconsOverText,id:u+"_iledit",onClickButton:function(){if(!r(this,f)){var e=l.selrow;e?d.jqGrid("editRow",e,m.editParams):p()}}}),m.save&&(d.jqGrid("navButtonAdd",i,{caption:m.savetext,title:m.savetitle,commonIconClass:m.commonIconClass,buttonicon:m.saveicon,iconsOverText:m.iconsOverText,id:u+"_ilsave",onClickButton:function(){if(!r(this,f)){var i=l.savedRow[0].id;if(i){var a=l.prmNames,o=a.oper,s=m.editParams;e("#"+t.jqID(i),n).hasClass("jqgrid-new-row")?(m.addParams.addRowParams.extraparam[o]=a.addoper,s=m.addParams.addRowParams):(m.editParams.extraparam||(m.editParams.extraparam={}),m.editParams.extraparam[o]=a.editoper),d.jqGrid("saveRow",i,s)}else p()}}}),e(c+"_ilsave").addClass(f)),m.cancel&&(d.jqGrid("navButtonAdd",i,{caption:m.canceltext,title:m.canceltitle,commonIconClass:m.commonIconClass,buttonicon:m.cancelicon,iconsOverText:m.iconsOverText,id:u+"_ilcancel",onClickButton:function(){if(!r(this,f)){var i=l.savedRow[0].id,a=m.editParams;i?(e("#"+t.jqID(i),n).hasClass("jqgrid-new-row")&&(a=m.addParams.addRowParams),d.jqGrid("restoreRow",i,a)):p()}}}),e(c+"_ilcancel").addClass(f)),!0===m.restoreAfterSelect&&d.on("jqGridSelectRow",function(e,t){if(l.savedRow.length>0&&!0===l._inlinenav){var i=l.savedRow[0].id;t!==i&&"number"!=typeof i&&d.jqGrid("restoreRow",i,m.editParams)}}),d.on("jqGridInlineAfterRestoreRow jqGridInlineAfterSaveRow",function(){d.jqGrid("showAddEditButtons",!1)}),d.on("jqGridInlineEditRow",function(e,t){d.jqGrid("showAddEditButtons",!0,t)})}}})},showAddEditButtons:function(t){return this.each(function(){if(this.grid){var i=this.p,r=i.idSel,a=o.call(this,"disabled"),n=r+"_ilsave,"+r+"_ilcancel"+(i.toppager?","+r+"_top_ilsave,"+r+"_top_ilcancel":""),d=r+"_iladd,"+r+"_iledit"+(i.toppager?","+r+"_top_iladd,"+r+"_top_iledit":"");e(t?d:n).addClass(a),e(t?n:d).removeClass(a)}})}})});
//# sourceMappingURL=grid.inlinedit.js.map