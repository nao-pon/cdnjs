!function(t){function e(t){for(var e in l)t[e]=l[e]}function i(s){if(!(this instanceof i))return new i(s);var o=this;e(o),o.bufferCheckPosition=t.MAX_BUFFER_LENGTH,o.q=o.c=o.p="",o.opt=s||{},o.closed=o.closedRoot=o.sawRoot=!1,o.tag=o.error=null,o.state=E.BEGIN,o.stack=new Array,o.position=o.column=0,o.line=1,o.slashed=!1,o.unicodeI=0,o.unicodeS=null,o.depth=0,n(o,"onready")}function s(t){if(!(this instanceof s))return new s(t);this._parser=new i(t),this.writable=!0,this.readable=!0,this.bytes_remaining=0,this.bytes_in_sequence=0,this.temp_buffs={2:new Buffer(2),3:new Buffer(3),4:new Buffer(4)},this.string="";var e=this;f.apply(e),this._parser.onend=function(){e.emit("end")},this._parser.onerror=function(t){e.emit("error",t),e._parser.error=null},d.forEach(function(t){Object.defineProperty(e,"on"+t,{get:function(){return e._parser["on"+t]},set:function(i){if(!i)return e.removeAllListeners(t),e._parser["on"+t]=i,i;e.on(t,i)},enumerable:!0,configurable:!1})})}function n(e,i,s){t.INFO&&console.log("-- emit",i,s),e[i]&&e[i](s)}function o(t,e,i){r(t),n(t,e,i)}function r(t,e){t.textNode=function(t,e){if(void 0===e)return e;t.trim&&(e=e.trim());t.normalize&&(e=e.replace(/\s+/g," "));return e}(t.opt,t.textNode),void 0!==t.textNode&&n(t,e||"onvalue",t.textNode),t.textNode=void 0}function h(t){t.numberNode&&n(t,"onvalue",parseFloat(t.numberNode)),t.numberNode=""}function a(t,e){return r(t),e+="\nLine: "+t.line+"\nColumn: "+t.column+"\nChar: "+t.c,e=new Error(e),t.error=e,n(t,"onerror",e),t}function c(t){return t.state===E.VALUE&&0===t.depth||a(t,"Unexpected end"),r(t),t.c="",t.closed=!0,n(t,"onend"),i.call(t,t.opt),t}var u;u="object"==typeof process&&process.env?process.env:window,t.parser=function(t){return new i(t)},t.CParser=i,t.CStream=s,t.createStream=function(t){return new s(t)},t.MAX_BUFFER_LENGTH=65536,t.DEBUG="debug"===u.CDEBUG,t.INFO="debug"===u.CDEBUG||"info"===u.CDEBUG,t.EVENTS=["value","string","key","openobject","closeobject","openarray","closearray","error","end","ready"];var f,l={textNode:void 0,numberNode:""},d=t.EVENTS.filter(function(t){return"error"!==t&&"end"!==t}),E=0;t.STATE={BEGIN:E++,VALUE:E++,OPEN_OBJECT:E++,CLOSE_OBJECT:E++,OPEN_ARRAY:E++,CLOSE_ARRAY:E++,TEXT_ESCAPE:E++,STRING:E++,BACKSLASH:E++,END:E++,OPEN_KEY:E++,CLOSE_KEY:E++,TRUE:E++,TRUE2:E++,TRUE3:E++,FALSE:E++,FALSE2:E++,FALSE3:E++,FALSE4:E++,NULL:E++,NULL2:E++,NULL3:E++,NUMBER_DECIMAL_POINT:E++,NUMBER_DIGIT:E++};for(var p in t.STATE)t.STATE[t.STATE[p]]=p;E=t.STATE,Object.create||(Object.create=function(t){function e(){this.__proto__=t}return e.prototype=t,new e}),Object.getPrototypeOf||(Object.getPrototypeOf=function(t){return t.__proto__}),Object.keys||(Object.keys=function(t){var e=[];for(var i in t)t.hasOwnProperty(i)&&e.push(i);return e});var _=/[\\"\n]/g;i.prototype={end:function(){c(this)},write:function(e){if(this.error)throw this.error;if(this.closed)return a(this,"Cannot write after close. Assign an onready handler.");if(null===e)return c(this);var i=0,s=e[0],u=this.p;for(t.DEBUG&&console.log("write -> ["+e+"]");s&&(u=s,this.c=s=e.charAt(i++),u!==s?this.p=u:u=this.p,s);)switch(t.DEBUG&&console.log(i,s,t.STATE[this.state]),this.position++,"\n"===s?(this.line++,this.column=0):this.column++,this.state){case E.BEGIN:"{"===s?this.state=E.OPEN_OBJECT:"["===s?this.state=E.OPEN_ARRAY:"\r"!==s&&"\n"!==s&&" "!==s&&"\t"!==s&&a(this,"Non-whitespace before {[.");continue;case E.OPEN_KEY:case E.OPEN_OBJECT:if("\r"===s||"\n"===s||" "===s||"\t"===s)continue;if(this.state===E.OPEN_KEY)this.stack.push(E.CLOSE_KEY);else{if("}"===s){n(this,"onopenobject"),this.depth++,n(this,"oncloseobject"),this.depth--,this.state=this.stack.pop()||E.VALUE;continue}this.stack.push(E.CLOSE_OBJECT)}'"'===s?this.state=E.STRING:a(this,'Malformed object key should start with "');continue;case E.CLOSE_KEY:case E.CLOSE_OBJECT:if("\r"===s||"\n"===s||" "===s||"\t"===s)continue;this.state,E.CLOSE_KEY,":"===s?(this.state===E.CLOSE_OBJECT?(this.stack.push(E.CLOSE_OBJECT),r(this,"onopenobject"),this.depth++):r(this,"onkey"),this.state=E.VALUE):"}"===s?(o(this,"oncloseobject"),this.depth--,this.state=this.stack.pop()||E.VALUE):","===s?(this.state===E.CLOSE_OBJECT&&this.stack.push(E.CLOSE_OBJECT),r(this),this.state=E.OPEN_KEY):a(this,"Bad object");continue;case E.OPEN_ARRAY:case E.VALUE:if("\r"===s||"\n"===s||" "===s||"\t"===s)continue;if(this.state===E.OPEN_ARRAY){if(n(this,"onopenarray"),this.depth++,this.state=E.VALUE,"]"===s){n(this,"onclosearray"),this.depth--,this.state=this.stack.pop()||E.VALUE;continue}this.stack.push(E.CLOSE_ARRAY)}'"'===s?this.state=E.STRING:"{"===s?this.state=E.OPEN_OBJECT:"["===s?this.state=E.OPEN_ARRAY:"t"===s?this.state=E.TRUE:"f"===s?this.state=E.FALSE:"n"===s?this.state=E.NULL:"-"===s?this.numberNode+=s:"0"===s?(this.numberNode+=s,this.state=E.NUMBER_DIGIT):-1!=="123456789".indexOf(s)?(this.numberNode+=s,this.state=E.NUMBER_DIGIT):a(this,"Bad value");continue;case E.CLOSE_ARRAY:if(","===s)this.stack.push(E.CLOSE_ARRAY),r(this,"onvalue"),this.state=E.VALUE;else if("]"===s)o(this,"onclosearray"),this.depth--,this.state=this.stack.pop()||E.VALUE;else{if("\r"===s||"\n"===s||" "===s||"\t"===s)continue;a(this,"Bad array")}continue;case E.STRING:void 0===this.textNode&&(this.textNode="");var f=i-1,d=this.slashed,p=this.unicodeI;t:for(;;){for(t.DEBUG&&console.log(i,s,t.STATE[this.state],d);p>0;)if(this.unicodeS+=s,s=e.charAt(i++),this.position++,4===p?(this.textNode+=String.fromCharCode(parseInt(this.unicodeS,16)),p=0,f=i-1):p++,!s)break t;if('"'===s&&!d){this.state=this.stack.pop()||E.VALUE,this.textNode+=e.substring(f,i-1),this.position+=i-1-f;break}if("\\"===s&&!d&&(d=!0,this.textNode+=e.substring(f,i-1),this.position+=i-1-f,s=e.charAt(i++),this.position++,!s))break;if(d){if(d=!1,"n"===s?this.textNode+="\n":"r"===s?this.textNode+="\r":"t"===s?this.textNode+="\t":"f"===s?this.textNode+="\f":"b"===s?this.textNode+="\b":"u"===s?(p=1,this.unicodeS=""):this.textNode+=s,s=e.charAt(i++),this.position++,f=i-1,s)continue;break}_.lastIndex=i;var b=_.exec(e);if(null===b){i=e.length+1,this.textNode+=e.substring(f,i-1),this.position+=i-1-f;break}if(i=b.index+1,!(s=e.charAt(b.index))){this.textNode+=e.substring(f,i-1),this.position+=i-1-f;break}}this.slashed=d,this.unicodeI=p;continue;case E.TRUE:if(""===s)continue;"r"===s?this.state=E.TRUE2:a(this,"Invalid true started with t"+s);continue;case E.TRUE2:if(""===s)continue;"u"===s?this.state=E.TRUE3:a(this,"Invalid true started with tr"+s);continue;case E.TRUE3:if(""===s)continue;"e"===s?(n(this,"onvalue",!0),this.state=this.stack.pop()||E.VALUE):a(this,"Invalid true started with tru"+s);continue;case E.FALSE:if(""===s)continue;"a"===s?this.state=E.FALSE2:a(this,"Invalid false started with f"+s);continue;case E.FALSE2:if(""===s)continue;"l"===s?this.state=E.FALSE3:a(this,"Invalid false started with fa"+s);continue;case E.FALSE3:if(""===s)continue;"s"===s?this.state=E.FALSE4:a(this,"Invalid false started with fal"+s);continue;case E.FALSE4:if(""===s)continue;"e"===s?(n(this,"onvalue",!1),this.state=this.stack.pop()||E.VALUE):a(this,"Invalid false started with fals"+s);continue;case E.NULL:if(""===s)continue;"u"===s?this.state=E.NULL2:a(this,"Invalid null started with n"+s);continue;case E.NULL2:if(""===s)continue;"l"===s?this.state=E.NULL3:a(this,"Invalid null started with nu"+s);continue;case E.NULL3:if(""===s)continue;"l"===s?(n(this,"onvalue",null),this.state=this.stack.pop()||E.VALUE):a(this,"Invalid null started with nul"+s);continue;case E.NUMBER_DECIMAL_POINT:"."===s?(this.numberNode+=s,this.state=E.NUMBER_DIGIT):a(this,"Leading zero not followed by .");continue;case E.NUMBER_DIGIT:-1!=="0123456789".indexOf(s)?this.numberNode+=s:"."===s?(-1!==this.numberNode.indexOf(".")&&a(this,"Invalid number has two dots"),this.numberNode+=s):"e"===s||"E"===s?(-1===this.numberNode.indexOf("e")&&-1===this.numberNode.indexOf("E")||a(this,"Invalid number has two exponential"),this.numberNode+=s):"+"===s||"-"===s?("e"!==u&&"E"!==u&&a(this,"Invalid symbol in number"),this.numberNode+=s):(h(this),i--,this.state=this.stack.pop()||E.VALUE);continue;default:a(this,"Unknown state: "+this.state)}return this.position>=this.bufferCheckPosition&&function(e){var i=Math.max(t.MAX_BUFFER_LENGTH,10),s=0;for(var n in l){var o=void 0===e[n]?0:e[n].length;if(o>i)switch(n){case"text":closeText(e);break;default:a(e,"Max buffer length exceeded: "+n)}s=Math.max(s,o)}e.bufferCheckPosition=t.MAX_BUFFER_LENGTH-s+e.position}(this),this},resume:function(){return this.error=null,this},close:function(){return this.write(null)}};try{f=require("stream").Stream}catch(t){f=function(){}}(s.prototype=Object.create(f.prototype,{constructor:{value:s}})).write=function(t){t=new Buffer(t);for(var e=0;e<t.length;e++){var i=t[e];if(this.bytes_remaining>0){for(var s=0;s<this.bytes_remaining;s++)this.temp_buffs[this.bytes_in_sequence][this.bytes_in_sequence-this.bytes_remaining+s]=t[s];this.string=this.temp_buffs[this.bytes_in_sequence].toString(),this.bytes_in_sequence=this.bytes_remaining=0,e=e+s-1,this._parser.write(this.string),this.emit("data",this.string)}else if(0===this.bytes_remaining&&i>=128){if(i>=194&&i<=223&&(this.bytes_in_sequence=2),i>=224&&i<=239&&(this.bytes_in_sequence=3),i>=240&&i<=244&&(this.bytes_in_sequence=4),this.bytes_in_sequence+e>t.length){for(var n=0;n<=t.length-1-e;n++)this.temp_buffs[this.bytes_in_sequence][n]=t[e+n];return this.bytes_remaining=e+this.bytes_in_sequence-t.length,!0}this.string=t.slice(e,e+this.bytes_in_sequence).toString(),e=e+this.bytes_in_sequence-1,this._parser.write(this.string),this.emit("data",this.string)}else{for(var o=e;o<t.length&&!(t[o]>=128);o++);this.string=t.slice(e,o).toString(),this._parser.write(this.string),this.emit("data",this.string),e=o-1}}},s.prototype.end=function(t){return t&&t.length&&this._parser.write(t.toString()),this._parser.end(),!0},s.prototype.on=function(t,e){var i=this;return i._parser["on"+t]||-1===d.indexOf(t)||(i._parser["on"+t]=function(){var e=1===arguments.length?[arguments[0]]:Array.apply(null,arguments);e.splice(0,0,t),i.emit.apply(i,e)}),f.prototype.on.call(i,t,e)},s.prototype.destroy=function(){e(this._parser),this.emit("close")}}("undefined"==typeof exports?clarinet={}:exports);