/*
 * botui 0.1.0
 * A JS library to build the UI for your bot
 * https://botui.moin.im
 *
 * Copyright 2017, Moin Uddin <me@moin.im> (https://moin.im/)
 * Released under the MIT license.
*/

!function(e,t){"use strict";"function"==typeof define&&define.amd?define([],function(){return e.BotUI=t(e)}):e.BotUI=t(e)}("undefined"!=typeof window?window:this,function(e,t){"use strict";return function(t,n){function o(e){return e.replace(f.image,"<img class='botui-message-content-image' src='$2' alt='$1' />").replace(f.link,function(e,t,n,o){return"<a class='botui-message-content-link' target='"+(o?"blank":"")+"' href='"+n+"'>"+t+"</a>"})}function i(e,t){var n=document.createElement("script");n.type="text/javascript",n.src=e,t&&(n.onload=t),document.body.appendChild(n)}function r(e){h.action.addMessage&&m.message.human({delay:100,content:e}),h.action.show=!h.action.autoHide}function s(e){if(!e.content)throw Error('BotUI: "content" is required in message object.');e.visible=!e.delay;var t=h.messages.push(e)-1;return new Promise(function(n,o){setTimeout(function(){h.messages[t].visible=!0,n(t)},e.delay||0)})}function u(e,t){for(var n in e)t.hasOwnProperty(n)||(t[n]=e[n])}if(n=n||{},!t)throw Error("BotUI: Container id is required as first argument.");if(!document.getElementById(t))throw Error("BotUI: Element with id #"+t+" does not exist.");if(!e.Vue&&!n.vue)throw Error("BotUI: Vue is required by not found.");var a,c,d={debug:!1,fontawesome:!0},m={},f={link:/\[([^\[]+)\]\(([^\)]+)\)(\^?)/gim,image:/!\[(.*?)\]\((.*?)\)/gim};e.Vue=e.Vue||n.vue;for(var l in d)n.hasOwnProperty(l)&&(d[l]=n[l]);e.Promise||Promise||options.promise||i("https://cdn.jsdelivr.net/es6-promise/4.1.0/es6-promise.min.js");var p={template:"<div class="botui botui-container"><div class="botui-messages-container"><div v-for="msg in messages"><transition name="slide-fade"><div class="botui-message" v-if="msg.visible" v-botui-scroll><div class="botui-message-content" :class="{human: msg.human}" v-text="msg.content" v-botui-markdown></div></div></transition></div></div><div class="botui-actions-container"><transition name="slide-fade"><div v-if="action.show" v-botui-scroll><form v-if="action.type == \'text\'" class="botui-actions-text" @submit.prevent="handle_action_text()"> <input type="text" ref="input" :type="action.text.sub_type" v-model="action.text.value" class="botui-actions-text-input" :placeholder="action.text.placeholder" :size="action.text.size" :value="action.text.value" required/> <button v-if="isMobile" class="botui-actions-text-submit">Go</button></form><div v-if="action.type == \'button\'" class="botui-actions-buttons"> <button type="button" class="botui-actions-buttons-button" v-for="button in action.button.buttons" @click="handle_action_button(button)" autofocus><i v-if="button.icon" class="fa" :class="\'fa-\' + button.icon"></i> {{button.text}}</button></div></div></transition></div></div>",data:function(){return{action:{text:{size:30,placeholder:"Write here .."},button:{},show:!1,type:"text",autoHide:!0,addMessage:!0},messages:[]}},computed:{isMobile:function(){return e.innerWidth&&e.innerWidth<=768}},methods:{handle_action_button:function(e){r(e.text),c({type:"button",text:e.text,value:e.value})},handle_action_text:function(){this.action.text.value&&(r(this.action.text.value),c({type:"text",value:this.action.text.value}),this.action.text.value="")}}};e.Vue.directive("botui-markdown",function(e){e.innerHTML=o(e.textContent)}),e.Vue.directive("botui-scroll",{inserted:function(e){e.scrollIntoView()}}),a=new e.Vue({components:{"bot-ui":p}}).$mount("#"+t);var h=a.$children[0];m.message={add:function(e){return s(e)},bot:function(e){return e=e||{},s(e)},human:function(e){return e=e||{},e.human=!0,s(e)},get:function(e){return Promise.resolve(h.messages[e])},remove:function(e){return h.messages.splice(e,1),Promise.resolve()},update:function(e,t){return h.messages[e].content=t.content,Promise.resolve(t.content)},removeAll:function(){return h.messages.splice(0,h.messages.length),Promise.resolve()}};var g=function(e){return u({type:"text",autoHide:!0,addMessage:!0},e),h.action.type=e.type,h.action.autoHide=e.autoHide,h.action.addMessage=e.addMessage,new Promise(function(t,n){c=t,setTimeout(function(){h.action.show=!0,"text"==e.type&&Vue.nextTick(function(){h.$refs.input.focus()})},e.delay||0)})};return m.action={show:g,hide:function(){h.action.show=!1},text:function(e){return h.action.text=e,g(e)},button:function(e){if(e.type="button",!e.buttons)throw Error('BotUI: "buttons" property is expected as an array.');return h.action.button.buttons=e.buttons,g(e)}},d.fontawesome&&i("https://use.fontawesome.com/ea731dcb6f.js"),d.debug&&(m._botApp=a),m}});